




<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  <link rel="dns-prefetch" href="https://github.githubassets.com">
  <link rel="dns-prefetch" href="https://avatars0.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars1.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars2.githubusercontent.com">
  <link rel="dns-prefetch" href="https://avatars3.githubusercontent.com">
  <link rel="dns-prefetch" href="https://github-cloud.s3.amazonaws.com">
  <link rel="dns-prefetch" href="https://user-images.githubusercontent.com/">



  <link crossorigin="anonymous" media="all" integrity="sha512-jFUBCdWOA1Ov3xo3oFMBwsdP4Up2K1bRnP4QYI5WqvpaIYxWVek89k2M0oyTbNhYMViGtxJB3Vdwcw8ln8hGQw==" rel="stylesheet" href="https://github.githubassets.com/assets/frameworks-8c550109d58e0353afdf1a37a05301c2.css" />
  
    <link crossorigin="anonymous" media="all" integrity="sha512-O1IJMyBVp2Cojf3HfhUjtNAQgE4xjlsNaToZzVMHfGkujqOnsh6PWxlsFhZFBD3gTmIGwZhRE6CKB2vyWgoZCA==" rel="stylesheet" href="https://github.githubassets.com/assets/github-3b5209332055a760a88dfdc77e1523b4.css" />
    
    
    
    


  <meta name="viewport" content="width=device-width">
  
  <title>aframe-physics-system/aframe-physics-system.min.js at master ¬∑ powersimple/aframe-physics-system</title>
    <meta name="description" content="Physics system for A-Frame VR, built on CANNON.js. - powersimple/aframe-physics-system">
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub">
  <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub">
  <meta property="fb:app_id" content="1401488693436528">
  <meta name="apple-itunes-app" content="app-id=1477376905">

    <meta name="twitter:image:src" content="https://avatars0.githubusercontent.com/u/1588791?s=400&amp;v=4" /><meta name="twitter:site" content="@github" /><meta name="twitter:card" content="summary" /><meta name="twitter:title" content="powersimple/aframe-physics-system" /><meta name="twitter:description" content="Physics system for A-Frame VR, built on CANNON.js. - powersimple/aframe-physics-system" />
    <meta property="og:image" content="https://avatars0.githubusercontent.com/u/1588791?s=400&amp;v=4" /><meta property="og:site_name" content="GitHub" /><meta property="og:type" content="object" /><meta property="og:title" content="powersimple/aframe-physics-system" /><meta property="og:url" content="https://github.com/powersimple/aframe-physics-system" /><meta property="og:description" content="Physics system for A-Frame VR, built on CANNON.js. - powersimple/aframe-physics-system" />

  <link rel="assets" href="https://github.githubassets.com/">
    <link rel="shared-web-socket" href="wss://alive.github.com/_sockets/u/32787544/ws?session=eyJ2IjoiVjMiLCJ1IjozMjc4NzU0NCwicyI6NTY5OTUxNDY1LCJjIjoxMzg1NTAxOTU3LCJ0IjoxNTk3ODAzODkzfQ==--1d607a3df28b8fc88b5e41509399a36b2442c2c599bf9c6dcb33c800e3d9c080" data-refresh-url="/_ws">
  <link rel="sudo-modal" href="/sessions/sudo_modal">

  <meta name="request-id" content="1209:8566:1AC05E3:25C5C3D:5F3C8D6F" data-pjax-transient="true" /><meta name="html-safe-nonce" content="5a5d191c9e271cc0887b2cad7eabe4a8bc4617a1" data-pjax-transient="true" /><meta name="visitor-payload" content="eyJyZWZlcnJlciI6Imh0dHBzOi8vZ2l0aHViLmNvbS9wb3dlcnNpbXBsZS9hZnJhbWUtcGh5c2ljcy1zeXN0ZW0vdHJlZS9tYXN0ZXIvZGlzdCIsInJlcXVlc3RfaWQiOiIxMjA5Ojg1NjY6MUFDMDVFMzoyNUM1QzNEOjVGM0M4RDZGIiwidmlzaXRvcl9pZCI6IjM5MzI4NjY5ODAwMjMyNTUwMTYiLCJyZWdpb25fZWRnZSI6InNlYSIsInJlZ2lvbl9yZW5kZXIiOiJpYWQifQ==" data-pjax-transient="true" /><meta name="visitor-hmac" content="7a4ce31e3d25a1583a6e0e1c3d345e36e630a187b7bd5e778e6794c91e4846b9" data-pjax-transient="true" />

    <meta name="hovercard-subject-tag" content="repository:287959869" data-pjax-transient>


  <meta name="github-keyboard-shortcuts" content="repository,source-code" data-pjax-transient="true" />

  

  <meta name="selected-link" value="repo_source" data-pjax-transient>

    <meta name="google-site-verification" content="c1kuD-K2HIVF635lypcsWPoD4kilo5-jA_wBFyT4uMY">
  <meta name="google-site-verification" content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU">
  <meta name="google-site-verification" content="ZzhVyEFwb7w3e0-uOTltm8Jsck2F5StVihD0exw2fsA">
  <meta name="google-site-verification" content="GXs5KoUUkNCoaAZn7wPN-t01Pywp9M3sEjnt_3_ZWPc">

  <meta name="octolytics-host" content="collector.githubapp.com" /><meta name="octolytics-app-id" content="github" /><meta name="octolytics-event-url" content="https://collector.githubapp.com/github-external/browser_event" /><meta name="octolytics-dimension-ga_id" content="" class="js-octo-ga-id" /><meta name="octolytics-actor-id" content="32787544" /><meta name="octolytics-actor-login" content="chekeichan" /><meta name="octolytics-actor-hash" content="9c95f5a95ca4c2d029af734118d3f35e59beb20a3c8bc225d0249ad0c0b81a06" />

  <meta name="analytics-location" content="/&lt;user-name&gt;/&lt;repo-name&gt;/blob/show" data-pjax-transient="true" />

  




    <meta name="google-analytics" content="UA-3769691-2">

  <meta class="js-ga-set" name="userId" content="e47ad13a57400a387e02a2d1533a1de0">

<meta class="js-ga-set" name="dimension10" content="Responsive" data-pjax-transient>

<meta class="js-ga-set" name="dimension1" content="Logged In">



  

      <meta name="hostname" content="github.com">
    <meta name="user-login" content="chekeichan">


      <meta name="expected-hostname" content="github.com">

      <meta name="js-proxy-site-detection-payload" content="N2E0MzA1ZjgxOWNiOGFkYWViNGVjNjY0Nzk2YTQyODlkNmMyM2IxODhjMDM3N2NiYTYxZWI4MGM0ODFlZjUzM3x7InJlbW90ZV9hZGRyZXNzIjoiNzAuMTc5LjEwLjIwMSIsInJlcXVlc3RfaWQiOiIxMjA5Ojg1NjY6MUFDMDVFMzoyNUM1QzNEOjVGM0M4RDZGIiwidGltZXN0YW1wIjoxNTk3ODAzODkzLCJob3N0IjoiZ2l0aHViLmNvbSJ9">

    <meta name="enabled-features" content="MARKETPLACE_PENDING_INSTALLATIONS">

  <meta http-equiv="x-pjax-version" content="117ed798292dbc366c8c8e5b8ad3f865">
  

      <link href="https://github.com/powersimple/aframe-physics-system/commits/master.atom" rel="alternate" title="Recent Commits to aframe-physics-system:master" type="application/atom+xml">

  <meta name="go-import" content="github.com/powersimple/aframe-physics-system git https://github.com/powersimple/aframe-physics-system.git">

  <meta name="octolytics-dimension-user_id" content="1588791" /><meta name="octolytics-dimension-user_login" content="powersimple" /><meta name="octolytics-dimension-repository_id" content="287959869" /><meta name="octolytics-dimension-repository_nwo" content="powersimple/aframe-physics-system" /><meta name="octolytics-dimension-repository_public" content="true" /><meta name="octolytics-dimension-repository_is_fork" content="true" /><meta name="octolytics-dimension-repository_parent_id" content="70658141" /><meta name="octolytics-dimension-repository_parent_nwo" content="donmccurdy/aframe-physics-system" /><meta name="octolytics-dimension-repository_network_root_id" content="70658141" /><meta name="octolytics-dimension-repository_network_root_nwo" content="donmccurdy/aframe-physics-system" /><meta name="octolytics-dimension-repository_explore_github_marketplace_ci_cta_shown" content="false" />


    <link rel="canonical" href="https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js" data-pjax-transient>


  <meta name="browser-stats-url" content="https://api.github.com/_private/browser/stats">

  <meta name="browser-errors-url" content="https://api.github.com/_private/browser/errors">

  <link rel="mask-icon" href="https://github.githubassets.com/pinned-octocat.svg" color="#000000">
  <link rel="alternate icon" class="js-site-favicon" type="image/png" href="https://github.githubassets.com/favicons/favicon.png">
  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg">

<meta name="theme-color" content="#1e2327">


  <link rel="manifest" href="/manifest.json" crossOrigin="use-credentials">

  </head>

  <body class="logged-in env-production page-responsive page-blob">
    

    <input type="hidden" value="cUDCyC19/7CkV6vgJsG5pQIVIxkfdPvQOFfahm5aV0vjq99ANaHoNOU/91LlWULnaXvZvAHKgo1TS8SD8hYC5A==" data-csrf="true" class="js-data-websocket-refresh-csrf" />

    <div class="position-relative js-header-wrapper ">
      <a href="#start-of-content" class="p-3 bg-blue text-white show-on-focus js-skip-to-content">Skip to content</a>
      <span class="progress-pjax-loader width-full js-pjax-loader-bar Progress position-fixed">
    <span style="background-color: #79b8ff;width: 0%;" class="Progress-item progress-pjax-loader-bar "></span>
</span>      
      



          <header class="Header py-md-0 js-details-container Details flex-wrap flex-md-nowrap px-3" role="banner">
  <div class="Header-item d-none d-md-flex">
    <a class="Header-link" href="https://github.com/" data-hotkey="g d"
  aria-label="Homepage " data-ga-click="Header, go to dashboard, icon:logo">
  <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
</a>

  </div>

  <div class="Header-item d-md-none">
    <button class="Header-link btn-link js-details-target" type="button" aria-label="Toggle navigation" aria-expanded="false">
      <svg height="24" class="octicon octicon-three-bars" viewBox="0 0 16 16" version="1.1" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M1 2.75A.75.75 0 011.75 2h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 2.75zm0 5A.75.75 0 011.75 7h12.5a.75.75 0 110 1.5H1.75A.75.75 0 011 7.75zM1.75 12a.75.75 0 100 1.5h12.5a.75.75 0 100-1.5H1.75z"></path></svg>
    </button>
  </div>

  <div class="Header-item Header-item--full flex-column flex-md-row width-full flex-order-2 flex-md-order-none mr-0 mr-md-3 mt-3 mt-md-0 Details-content--hidden-not-important d-md-flex">
        <div class="header-search header-search-current js-header-search-current flex-auto  flex-self-stretch flex-md-self-auto mr-0 mr-md-3 mb-3 mb-md-0 scoped-search site-scoped-search js-site-search position-relative js-jump-to js-header-search-current-jump-to"
  role="combobox"
  aria-owns="jump-to-results"
  aria-label="Search or jump to"
  aria-haspopup="listbox"
  aria-expanded="false"
>
  <div class="position-relative">
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="js-site-search-form" role="search" aria-label="Site" data-scope-type="Repository" data-scope-id="287959869" data-scoped-search-url="/powersimple/aframe-physics-system/search" data-unscoped-search-url="/search" action="/powersimple/aframe-physics-system/search" accept-charset="UTF-8" method="get">
      <label class="form-control input-sm header-search-wrapper p-0 header-search-wrapper-jump-to position-relative d-flex flex-justify-between flex-items-center js-chromeless-input-container">
        <input type="text"
          class="form-control input-sm header-search-input jump-to-field js-jump-to-field js-site-search-focus js-site-search-field is-clearable"
          data-hotkey="s,/"
          name="q"
          value=""
          placeholder="Search or jump to‚Ä¶"
          data-unscoped-placeholder="Search or jump to‚Ä¶"
          data-scoped-placeholder="Search or jump to‚Ä¶"
          autocapitalize="off"
          aria-autocomplete="list"
          aria-controls="jump-to-results"
          aria-label="Search or jump to‚Ä¶"
          data-jump-to-suggestions-path="/_graphql/GetSuggestedNavigationDestinations"
          spellcheck="false"
          autocomplete="off"
          >
          <input type="hidden" value="s6W/Nv+qnBHcxUN0hfY0k0VrlXuaylZfZnuLvHpo5ahSNsl13yTA98Pqz8v0sSP1DdddifWt8sXXV9ijxTLIxg==" data-csrf="true" class="js-data-jump-to-suggestions-path-csrf" />
          <input type="hidden" class="js-site-search-type-field" name="type" >
            <img src="https://github.githubassets.com/images/search-key-slash.svg" alt="" class="mr-2 header-search-key-slash">

            <div class="Box position-absolute overflow-hidden d-none jump-to-suggestions js-jump-to-suggestions-container">
              
<ul class="d-none js-jump-to-suggestions-template-container">
  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-suggestion" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path></svg>
      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg>
      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path></svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">‚Üµ</span>
    </div>

    <div aria-hidden="true" class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">‚Üµ</span>
    </div>
  </a>
</li>

</ul>

<ul class="d-none js-jump-to-no-results-template-container">
  <li class="d-flex flex-justify-center flex-items-center f5 d-none js-jump-to-suggestion p-2">
    <span class="text-gray">No suggested jump to results</span>
  </li>
</ul>

<ul id="jump-to-results" role="listbox" class="p-0 m-0 js-navigation-container jump-to-suggestions-results-container js-jump-to-suggestions-results-container">
  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-scoped-search d-none" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path></svg>
      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg>
      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path></svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">‚Üµ</span>
    </div>

    <div aria-hidden="true" class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">‚Üµ</span>
    </div>
  </a>
</li>

  

<li class="d-flex flex-justify-start flex-items-center p-0 f5 navigation-item js-navigation-item js-jump-to-global-search d-none" role="option">
  <a tabindex="-1" class="no-underline d-flex flex-auto flex-items-center jump-to-suggestions-path js-jump-to-suggestion-path js-navigation-open p-2" href="">
    <div class="jump-to-octicon js-jump-to-octicon flex-shrink-0 mr-2 text-center d-none">
      <svg height="16" width="16" class="octicon octicon-repo flex-shrink-0 js-jump-to-octicon-repo d-none" title="Repository" aria-label="Repository" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M2 2.5A2.5 2.5 0 014.5 0h8.75a.75.75 0 01.75.75v12.5a.75.75 0 01-.75.75h-2.5a.75.75 0 110-1.5h1.75v-2h-8a1 1 0 00-.714 1.7.75.75 0 01-1.072 1.05A2.495 2.495 0 012 11.5v-9zm10.5-1V9h-8c-.356 0-.694.074-1 .208V2.5a1 1 0 011-1h8zM5 12.25v3.25a.25.25 0 00.4.2l1.45-1.087a.25.25 0 01.3 0L8.6 15.7a.25.25 0 00.4-.2v-3.25a.25.25 0 00-.25-.25h-3.5a.25.25 0 00-.25.25z"></path></svg>
      <svg height="16" width="16" class="octicon octicon-project flex-shrink-0 js-jump-to-octicon-project d-none" title="Project" aria-label="Project" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg>
      <svg height="16" width="16" class="octicon octicon-search flex-shrink-0 js-jump-to-octicon-search d-none" title="Search" aria-label="Search" viewBox="0 0 16 16" version="1.1" role="img"><path fill-rule="evenodd" d="M11.5 7a4.499 4.499 0 11-8.998 0A4.499 4.499 0 0111.5 7zm-.82 4.74a6 6 0 111.06-1.06l3.04 3.04a.75.75 0 11-1.06 1.06l-3.04-3.04z"></path></svg>
    </div>

    <img class="avatar mr-2 flex-shrink-0 js-jump-to-suggestion-avatar d-none" alt="" aria-label="Team" src="" width="28" height="28">

    <div class="jump-to-suggestion-name js-jump-to-suggestion-name flex-auto overflow-hidden text-left no-wrap css-truncate css-truncate-target">
    </div>

    <div class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none js-jump-to-badge-search">
      <span class="js-jump-to-badge-search-text-default d-none" aria-label="in this repository">
        In this repository
      </span>
      <span class="js-jump-to-badge-search-text-global d-none" aria-label="in all of GitHub">
        All GitHub
      </span>
      <span aria-hidden="true" class="d-inline-block ml-1 v-align-middle">‚Üµ</span>
    </div>

    <div aria-hidden="true" class="border rounded-1 flex-shrink-0 bg-gray px-1 text-gray-light ml-1 f6 d-none d-on-nav-focus js-jump-to-badge-jump">
      Jump to
      <span class="d-inline-block ml-1 v-align-middle">‚Üµ</span>
    </div>
  </a>
</li>


    <li class="d-flex flex-justify-center flex-items-center p-0 f5 js-jump-to-suggestion">
      <img src="https://github.githubassets.com/images/spinners/octocat-spinner-128.gif" alt="Octocat Spinner Icon" class="m-2" width="28">
    </li>
</ul>

            </div>
      </label>
</form>  </div>
</div>


    <nav class="d-flex flex-column flex-md-row flex-self-stretch flex-md-self-auto" aria-label="Global">
    <a class="Header-link py-md-3 d-block d-md-none py-2 border-top border-md-top-0 border-white-fade-15" data-ga-click="Header, click, Nav menu - item:dashboard:user" aria-label="Dashboard" href="/dashboard">
      Dashboard
</a>
  <a class="js-selected-navigation-item Header-link py-md-3  mr-0 mr-md-3 py-2 border-top border-md-top-0 border-white-fade-15" data-hotkey="g p" data-ga-click="Header, click, Nav menu - item:pulls context:user" aria-label="Pull requests you created" data-selected-links="/pulls /pulls/assigned /pulls/mentioned /pulls" href="/pulls">
      Pull<span class="d-inline d-md-none d-lg-inline"> request</span>s
</a>
  <a class="js-selected-navigation-item Header-link py-md-3  mr-0 mr-md-3 py-2 border-top border-md-top-0 border-white-fade-15" data-hotkey="g i" data-ga-click="Header, click, Nav menu - item:issues context:user" aria-label="Issues you created" data-selected-links="/issues /issues/assigned /issues/mentioned /issues" href="/issues">
    Issues
</a>

    <div class="mr-0 mr-md-3 py-2 py-md-0 border-top border-md-top-0 border-white-fade-15">
      <a class="js-selected-navigation-item Header-link py-md-3 d-inline-block" data-ga-click="Header, click, Nav menu - item:marketplace context:user" data-octo-click="marketplace_click" data-octo-dimensions="location:nav_bar" data-selected-links=" /marketplace" href="/marketplace">
        Marketplace
</a>      

    </div>

  <a class="js-selected-navigation-item Header-link py-md-3  mr-0 mr-md-3 py-2 border-top border-md-top-0 border-white-fade-15" data-ga-click="Header, click, Nav menu - item:explore" data-selected-links="/explore /trending /trending/developers /integrations /integrations/feature/code /integrations/feature/collaborate /integrations/feature/ship showcases showcases_search showcases_landing /explore" href="/explore">
    Explore
</a>


    <a class="Header-link d-block d-md-none mr-0 mr-md-3 py-2 py-md-3 border-top border-md-top-0 border-white-fade-15" href="/chekeichan">
      <img class="avatar avatar-user" src="https://avatars2.githubusercontent.com/u/32787544?s=40&amp;v=4" width="20" height="20" alt="@chekeichan" />
      chekeichan
</a>
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form action="/logout" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="mbLkj4K0UVlTzFl+Jlb4lC2x3WffKwSNrlM0oTW14SXOlm4aB5obG38KpOtD6OO+ZlOXItEyyCYzZpZUwqACmg==" />
      <button type="submit" class="Header-link mr-0 mr-md-3 py-2 py-md-3 border-top border-md-top-0 border-white-fade-15 d-md-none btn-link d-block width-full text-left" data-ga-click="Header, sign out, icon:logout" style="padding-left: 2px;">
        <svg class="octicon octicon-sign-out v-align-middle" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M2 2.75C2 1.784 2.784 1 3.75 1h2.5a.75.75 0 010 1.5h-2.5a.25.25 0 00-.25.25v10.5c0 .138.112.25.25.25h2.5a.75.75 0 010 1.5h-2.5A1.75 1.75 0 012 13.25V2.75zm10.44 4.5H6.75a.75.75 0 000 1.5h5.69l-1.97 1.97a.75.75 0 101.06 1.06l3.25-3.25a.75.75 0 000-1.06l-3.25-3.25a.75.75 0 10-1.06 1.06l1.97 1.97z"></path></svg>
        Sign out
      </button>
</form></nav>

  </div>

  <div class="Header-item Header-item--full flex-justify-center d-md-none position-relative">
    <a class="Header-link" href="https://github.com/" data-hotkey="g d"
  aria-label="Homepage " data-ga-click="Header, go to dashboard, icon:logo">
  <svg class="octicon octicon-mark-github v-align-middle" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
</a>

  </div>

  <div class="Header-item mr-0 mr-md-3 flex-order-1 flex-md-order-none">
    

    <notification-indicator class="js-socket-channel" data-channel="eyJjIjoibm90aWZpY2F0aW9uLWNoYW5nZWQ6MzI3ODc1NDQiLCJ0IjoxNTk3ODAzODkzfQ==--4fd1d5a9d63c1e06ef3844c7ad9476a08fa4a9a65f1880ce0f6cc2ee19f0d0af">
      <a href="/notifications"
         class="Header-link notification-indicator position-relative tooltipped tooltipped-sw"
         aria-label="You have no unread notifications"
         data-hotkey="g n"
         data-ga-click="Header, go to notifications, icon:read"
         data-target="notification-indicator.link">
         <span class="mail-status " data-target="notification-indicator.modifier"></span>
         <svg class="octicon octicon-bell" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 16a2 2 0 001.985-1.75c.017-.137-.097-.25-.235-.25h-3.5c-.138 0-.252.113-.235.25A2 2 0 008 16z"></path><path fill-rule="evenodd" d="M8 1.5A3.5 3.5 0 004.5 5v2.947c0 .346-.102.683-.294.97l-1.703 2.556a.018.018 0 00-.003.01l.001.006c0 .002.002.004.004.006a.017.017 0 00.006.004l.007.001h10.964l.007-.001a.016.016 0 00.006-.004.016.016 0 00.004-.006l.001-.007a.017.017 0 00-.003-.01l-1.703-2.554a1.75 1.75 0 01-.294-.97V5A3.5 3.5 0 008 1.5zM3 5a5 5 0 0110 0v2.947c0 .05.015.098.042.139l1.703 2.555A1.518 1.518 0 0113.482 13H2.518a1.518 1.518 0 01-1.263-2.36l1.703-2.554A.25.25 0 003 7.947V5z"></path></svg>
      </a>
    </notification-indicator>

  </div>


  <div class="Header-item position-relative d-none d-md-flex">
    <details class="details-overlay details-reset">
  <summary class="Header-link"
      aria-label="Create new‚Ä¶"
      data-ga-click="Header, create new, icon:add">
    <svg class="octicon octicon-plus" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 2a.75.75 0 01.75.75v4.5h4.5a.75.75 0 010 1.5h-4.5v4.5a.75.75 0 01-1.5 0v-4.5h-4.5a.75.75 0 010-1.5h4.5v-4.5A.75.75 0 018 2z"></path></svg> <span class="dropdown-caret"></span>
  </summary>
  <details-menu class="dropdown-menu dropdown-menu-sw mt-n2">
    
<a role="menuitem" class="dropdown-item" href="/new" data-ga-click="Header, create new repository">
  New repository
</a>

  <a role="menuitem" class="dropdown-item" href="/new/import" data-ga-click="Header, import a repository">
    Import repository
  </a>

<a role="menuitem" class="dropdown-item" href="https://gist.github.com/" data-ga-click="Header, create new gist">
  New gist
</a>

  <a role="menuitem" class="dropdown-item" href="/organizations/new" data-ga-click="Header, create new organization">
    New organization
  </a>



  <a role="menuitem" class="dropdown-item" href="/new/project" data-ga-click="Header, create new project">
    New project
  </a>

  </details-menu>
</details>

  </div>

  <div class="Header-item position-relative mr-0 d-none d-md-flex">
    
  <details class="details-overlay details-reset js-feature-preview-indicator-container" data-feature-preview-indicator-src="/users/chekeichan/feature_preview/indicator_check">

  <summary class="Header-link"
    aria-label="View profile and more"
    data-ga-click="Header, show menu, icon:avatar">
    <img
  alt="@chekeichan"
  width="20"
  height="20"
  src="https://avatars1.githubusercontent.com/u/32787544?s=60&amp;v=4"
  class="avatar avatar-user " />

      <span class="feature-preview-indicator js-feature-preview-indicator" style="top: 10px;" hidden></span>
    <span class="dropdown-caret"></span>
  </summary>
  <details-menu class="dropdown-menu dropdown-menu-sw mt-n2" style="width: 180px" >
    <div class="header-nav-current-user css-truncate"><a role="menuitem" class="no-underline user-profile-link px-3 pt-2 pb-2 mb-n2 mt-n1 d-block" href="/chekeichan" data-ga-click="Header, go to profile, text:Signed in as">Signed in as <strong class="css-truncate-target">chekeichan</strong></a></div>
    <div role="none" class="dropdown-divider"></div>

      <div class="pl-3 pr-3 f6 user-status-container js-user-status-context lh-condensed" data-url="/users/status?compact=1&amp;link_mentions=0&amp;truncate=1">
        
<div class="js-user-status-container rounded-1 px-2 py-1 mt-2 border"
  data-team-hovercards-enabled>
  <details class="js-user-status-details details-reset details-overlay details-overlay-dark">
    <summary class="btn-link btn-block link-gray no-underline js-toggle-user-status-edit toggle-user-status-edit "
      role="menuitem" data-hydro-click="{&quot;event_type&quot;:&quot;user_profile.click&quot;,&quot;payload&quot;:{&quot;profile_user_id&quot;:1588791,&quot;target&quot;:&quot;EDIT_USER_STATUS&quot;,&quot;user_id&quot;:32787544,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;}}" data-hydro-click-hmac="ac757f05952c37e03c3d74ba6f4169250f8736a61afa2aaf8f225371d4b6d06b">
      <div class="d-flex flex-items-center flex-items-stretch">
        <div class="f6 lh-condensed user-status-header d-flex user-status-emoji-only-header circle">
          <div class="user-status-emoji-container flex-shrink-0 mr-2 d-flex flex-items-center flex-justify-center lh-condensed-ultra v-align-bottom">
            <svg class="octicon octicon-smiley" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zM5 8a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zM5.32 9.636a.75.75 0 011.038.175l.007.009c.103.118.22.222.35.31.264.178.683.37 1.285.37.602 0 1.02-.192 1.285-.371.13-.088.247-.192.35-.31l.007-.008a.75.75 0 111.222.87l-.614-.431c.614.43.614.431.613.431v.001l-.001.002-.002.003-.005.007-.014.019a1.984 1.984 0 01-.184.213c-.16.166-.338.316-.53.445-.63.418-1.37.638-2.127.629-.946 0-1.652-.308-2.126-.63a3.32 3.32 0 01-.715-.657l-.014-.02-.005-.006-.002-.003v-.002h-.001l.613-.432-.614.43a.75.75 0 01.183-1.044h.001z"></path></svg>
          </div>
        </div>
        <div class="
          
           user-status-message-wrapper f6 min-width-0"
           style="line-height: 20px;" >
          <div class="css-truncate css-truncate-target width-fit text-gray-dark text-left">
              <span class="text-gray">Set status</span>
          </div>
        </div>
      </div>
    </summary>
    <details-dialog class="details-dialog rounded-1 anim-fade-in fast Box Box--overlay" role="dialog" tabindex="-1">
      <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="position-relative flex-auto js-user-status-form" action="/users/status?circle=0&amp;compact=1&amp;link_mentions=0&amp;truncate=1" accept-charset="UTF-8" method="post"><input type="hidden" name="_method" value="put" /><input type="hidden" name="authenticity_token" value="iKIFt+xIvRG5mmaEwJk9dRkdRJs48vjHfYPUsORUHeZu9Fdt2MDs1lF3oYR4L+GxN7d55Zbp8o4EN6A0O/wh1A==" />
        <div class="Box-header bg-gray border-bottom p-3">
          <button class="Box-btn-octicon js-toggle-user-status-edit btn-octicon float-right" type="reset" aria-label="Close dialog" data-close-dialog>
            <svg class="octicon octicon-x" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>
          </button>
          <h3 class="Box-title f5 text-bold text-gray-dark">Edit status</h3>
        </div>
        <input type="hidden" name="emoji" class="js-user-status-emoji-field" value="">
        <input type="hidden" name="organization_id" class="js-user-status-org-id-field" value="">
        <div class="px-3 py-2 text-gray-dark">
          <div class="js-characters-remaining-container position-relative mt-2">
            <div class="input-group d-table form-group my-0 js-user-status-form-group">
              <span class="input-group-button d-table-cell v-align-middle" style="width: 1%">
                <button type="button" aria-label="Choose an emoji" class="btn-outline btn js-toggle-user-status-emoji-picker btn-open-emoji-picker p-0">
                  <span class="js-user-status-original-emoji" hidden></span>
                  <span class="js-user-status-custom-emoji"></span>
                  <span class="js-user-status-no-emoji-icon" >
                    <svg class="octicon octicon-smiley" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zM5 8a1 1 0 100-2 1 1 0 000 2zm7-1a1 1 0 11-2 0 1 1 0 012 0zM5.32 9.636a.75.75 0 011.038.175l.007.009c.103.118.22.222.35.31.264.178.683.37 1.285.37.602 0 1.02-.192 1.285-.371.13-.088.247-.192.35-.31l.007-.008a.75.75 0 111.222.87l-.614-.431c.614.43.614.431.613.431v.001l-.001.002-.002.003-.005.007-.014.019a1.984 1.984 0 01-.184.213c-.16.166-.338.316-.53.445-.63.418-1.37.638-2.127.629-.946 0-1.652-.308-2.126-.63a3.32 3.32 0 01-.715-.657l-.014-.02-.005-.006-.002-.003v-.002h-.001l.613-.432-.614.43a.75.75 0 01.183-1.044h.001z"></path></svg>
                  </span>
                </button>
              </span>
              <text-expander keys=": @" data-mention-url="/autocomplete/user-suggestions" data-emoji-url="/autocomplete/emoji">
                <input
                  type="text"
                  autocomplete="off"
                  data-no-org-url="/autocomplete/user-suggestions"
                  data-org-url="/suggestions?mention_suggester=1"
                  data-maxlength="80"
                  class="d-table-cell width-full form-control js-user-status-message-field js-characters-remaining-field"
                  placeholder="What's happening?"
                  name="message"
                  value=""
                  aria-label="What is your current status?">
              </text-expander>
              <div class="error">Could not update your status, please try again.</div>
            </div>
            <div style="margin-left: 53px" class="my-1 text-small label-characters-remaining js-characters-remaining" data-suffix="remaining" hidden>
              80 remaining
            </div>
          </div>
          <include-fragment class="js-user-status-emoji-picker" data-url="/users/status/emoji"></include-fragment>
          <div class="overflow-auto ml-n3 mr-n3 px-3 border-bottom" style="max-height: 33vh">
            <div class="user-status-suggestions js-user-status-suggestions collapsed overflow-hidden">
              <h4 class="f6 text-normal my-3">Suggestions:</h4>
              <div class="mx-3 mt-2 clearfix">
                  <div class="float-left col-6">
                      <button type="button" value=":palm_tree:" class="d-flex flex-items-baseline flex-items-stretch lh-condensed f6 btn-link link-gray no-underline js-predefined-user-status mb-1">
                        <div class="emoji-status-width mr-2 v-align-middle js-predefined-user-status-emoji">
                          <g-emoji alias="palm_tree" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f334.png">üå¥</g-emoji>
                        </div>
                        <div class="d-flex flex-items-center no-underline js-predefined-user-status-message ws-normal text-left" style="border-left: 1px solid transparent">
                          On vacation
                        </div>
                      </button>
                      <button type="button" value=":face_with_thermometer:" class="d-flex flex-items-baseline flex-items-stretch lh-condensed f6 btn-link link-gray no-underline js-predefined-user-status mb-1">
                        <div class="emoji-status-width mr-2 v-align-middle js-predefined-user-status-emoji">
                          <g-emoji alias="face_with_thermometer" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f912.png">ü§í</g-emoji>
                        </div>
                        <div class="d-flex flex-items-center no-underline js-predefined-user-status-message ws-normal text-left" style="border-left: 1px solid transparent">
                          Out sick
                        </div>
                      </button>
                  </div>
                  <div class="float-left col-6">
                      <button type="button" value=":house:" class="d-flex flex-items-baseline flex-items-stretch lh-condensed f6 btn-link link-gray no-underline js-predefined-user-status mb-1">
                        <div class="emoji-status-width mr-2 v-align-middle js-predefined-user-status-emoji">
                          <g-emoji alias="house" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f3e0.png">üè†</g-emoji>
                        </div>
                        <div class="d-flex flex-items-center no-underline js-predefined-user-status-message ws-normal text-left" style="border-left: 1px solid transparent">
                          Working from home
                        </div>
                      </button>
                      <button type="button" value=":dart:" class="d-flex flex-items-baseline flex-items-stretch lh-condensed f6 btn-link link-gray no-underline js-predefined-user-status mb-1">
                        <div class="emoji-status-width mr-2 v-align-middle js-predefined-user-status-emoji">
                          <g-emoji alias="dart" fallback-src="https://github.githubassets.com/images/icons/emoji/unicode/1f3af.png">üéØ</g-emoji>
                        </div>
                        <div class="d-flex flex-items-center no-underline js-predefined-user-status-message ws-normal text-left" style="border-left: 1px solid transparent">
                          Focusing
                        </div>
                      </button>
                  </div>
              </div>
            </div>
            <div class="user-status-limited-availability-container">
              <div class="form-checkbox my-0">
                <input type="checkbox" name="limited_availability" value="1" class="js-user-status-limited-availability-checkbox" data-default-message="I may be slow to respond." aria-describedby="limited-availability-help-text-truncate-true-compact-true" id="limited-availability-truncate-true-compact-true">
                <label class="d-block f5 text-gray-dark mb-1" for="limited-availability-truncate-true-compact-true">
                  Busy
                </label>
                <p class="note" id="limited-availability-help-text-truncate-true-compact-true">
                  When others mention you, assign you, or request your review,
                  GitHub will let them know that you have limited availability.
                </p>
              </div>
            </div>
          </div>
          <div class="d-inline-block f5 mr-2 pt-3 pb-2" >
  <div class="d-inline-block mr-1">
    Clear status
  </div>

  <details class="js-user-status-expire-drop-down f6 dropdown details-reset details-overlay d-inline-block mr-2">
    <summary class="btn btn-sm v-align-baseline" aria-haspopup="true">
      <div class="js-user-status-expiration-interval-selected d-inline-block v-align-baseline">
        Never
      </div>
      <div class="dropdown-caret"></div>
    </summary>

    <ul class="dropdown-menu dropdown-menu-se pl-0 overflow-auto" style="width: 220px; max-height: 15.5em">
      <li>
        <button type="button" class="btn-link dropdown-item js-user-status-expire-button ws-normal" title="Never">
          <span class="d-inline-block text-bold mb-1">Never</span>
          <div class="f6 lh-condensed">Keep this status until you clear your status or edit your status.</div>
        </button>
      </li>
      <li class="dropdown-divider" role="none"></li>
        <li>
          <button type="button" class="btn-link dropdown-item ws-normal js-user-status-expire-button" title="in 30 minutes" value="2020-08-18T19:54:53-07:00">
            in 30 minutes
          </button>
        </li>
        <li>
          <button type="button" class="btn-link dropdown-item ws-normal js-user-status-expire-button" title="in 1 hour" value="2020-08-18T20:24:53-07:00">
            in 1 hour
          </button>
        </li>
        <li>
          <button type="button" class="btn-link dropdown-item ws-normal js-user-status-expire-button" title="in 4 hours" value="2020-08-18T23:24:53-07:00">
            in 4 hours
          </button>
        </li>
        <li>
          <button type="button" class="btn-link dropdown-item ws-normal js-user-status-expire-button" title="today" value="2020-08-18T23:59:59-07:00">
            today
          </button>
        </li>
        <li>
          <button type="button" class="btn-link dropdown-item ws-normal js-user-status-expire-button" title="this week" value="2020-08-23T23:59:59-07:00">
            this week
          </button>
        </li>
    </ul>
  </details>
  <input class="js-user-status-expiration-date-input" type="hidden" name="expires_at" value="">
</div>

          <include-fragment class="js-user-status-org-picker" data-url="/users/status/organizations"></include-fragment>
        </div>
        <div class="d-flex flex-items-center flex-justify-between p-3 border-top">
          <button type="submit" disabled class="width-full btn btn-primary mr-2 js-user-status-submit">
            Set status
          </button>
          <button type="button" disabled class="width-full js-clear-user-status-button btn ml-2 ">
            Clear status
          </button>
        </div>
</form>    </details-dialog>
  </details>
</div>

      </div>
      <div role="none" class="dropdown-divider"></div>

    <a role="menuitem" class="dropdown-item" href="/chekeichan" data-ga-click="Header, go to profile, text:your profile" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;YOUR_PROFILE&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="33147ea1310e01280d2af144f47726a8d8d16b6cc9b9bd1a86dffae2d2a46a61" >Your profile</a>

    <a role="menuitem" class="dropdown-item" href="/chekeichan?tab=repositories" data-ga-click="Header, go to repositories, text:your repositories" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;YOUR_REPOSITORIES&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="59d0b6c6772ff5dc148141774c01c803993b268def56095442beca271f603109" >Your repositories</a>



    <a role="menuitem" class="dropdown-item" href="/chekeichan?tab=projects" data-ga-click="Header, go to projects, text:your projects" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;YOUR_PROJECTS&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="258aa06c35540cf8036f7ab0a20eb2f36ef941f061d74ae17d1677f0dd93f670" >Your projects</a>


    <a role="menuitem" class="dropdown-item" href="/chekeichan?tab=stars" data-ga-click="Header, go to starred repos, text:your stars" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;YOUR_STARS&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="787cd34aaa32cd0c4a133bbe47b1d0ef92cee8867fa79f411666186e847b6a56" >Your stars</a>
      <a role="menuitem" class="dropdown-item" href="https://gist.github.com/mine" data-ga-click="Header, your gists, text:your gists" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;YOUR_GISTS&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="0a77f03067bb8bca70923c3ccaef9da584e04171ffceb63fe2dbc5e01b56926a" >Your gists</a>





    <div role="none" class="dropdown-divider"></div>
      <a role="menuitem" class="dropdown-item" href="/settings/billing" data-ga-click="Header, go to billing, text:upgrade" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;UPGRADE&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="1f1bcdd061599076247b36973926df0c83c0aff6824e23a93bb8a2b1d0c0f484" >Upgrade</a>
      
<div id="feature-enrollment-toggle" class="hide-sm hide-md feature-preview-details position-relative">
  <button
    type="button"
    class="dropdown-item btn-link"
    role="menuitem"
    data-feature-preview-trigger-url="/users/chekeichan/feature_previews"
    data-feature-preview-close-details="{&quot;event_type&quot;:&quot;feature_preview.clicks.close_modal&quot;,&quot;payload&quot;:{&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}"
    data-feature-preview-close-hmac="e5eecfd6aa4f346c05d3bead1b6136eb45a4cb56e40e7f9dd82bc3fecbed3484"
    data-hydro-click="{&quot;event_type&quot;:&quot;feature_preview.clicks.open_modal&quot;,&quot;payload&quot;:{&quot;link_location&quot;:&quot;user_dropdown&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}"
    data-hydro-click-hmac="5b06acfbd65143b5fecdb5d6eaf2882827ae81dce0bd2cb505319e34c3fedce5"
  >
    Feature preview
  </button>
    <span class="feature-preview-indicator js-feature-preview-indicator" hidden></span>
</div>

    <a role="menuitem" class="dropdown-item" href="https://docs.github.com" data-ga-click="Header, go to help, text:help" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;HELP&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="b1c3aca76d694fe5f6909080fad11bd8714353041b187d98393c5cb0fd12512e" >Help</a>
    <a role="menuitem" class="dropdown-item" href="/settings/profile" data-ga-click="Header, go to settings, icon:settings" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;SETTINGS&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="03b6fa83670d886e03087c580e72112a00e18bd33a6a54e70fe10acb49da23ea" >Settings</a>
    <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="logout-form" action="/logout" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="AVzbpcBcnZiQa0/b+KpMeSh1Ph8uql6qtXaDdnurT2ZWeFEwRXLX2rytsk6dFFdTY5d0WiCzkgEoQyGDjL6s2Q==" />
      
      <button type="submit" class="dropdown-item dropdown-signout" data-ga-click="Header, sign out, icon:logout" data-hydro-click="{&quot;event_type&quot;:&quot;global_header.user_menu_dropdown.click&quot;,&quot;payload&quot;:{&quot;request_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;target&quot;:&quot;SIGN_OUT&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="05e69d09db51da47ba3bf98308317e6c8227f1eb8dc9d9f824e3b1e3eb3590d5"  role="menuitem">
        Sign out
      </button>
      <input type="text" name="required_field_5258" hidden="hidden" class="form-control" /><input type="hidden" name="timestamp" value="1597803893224" class="form-control" /><input type="hidden" name="timestamp_secret" value="4c3f20cce473e5484d4ea83a947fe938236cb016dc3c9245d67ee98ec067ea8a" class="form-control" />
</form>  </details-menu>
</details>

  </div>

</header>

          

    </div>

  <div id="start-of-content" class="show-on-focus"></div>




    <div id="js-flash-container">


  <template class="js-flash-template">
    <div class="flash flash-full  js-flash-template-container">
  <div class=" px-2" >
    <button class="flash-close js-flash-close" type="button" aria-label="Dismiss this message">
      <svg class="octicon octicon-x" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>
    </button>
    
      <div class="js-flash-template-message"></div>

  </div>
</div>
  </template>
</div>


  

  <include-fragment class="js-notification-shelf-include-fragment" data-base-src="https://github.com/notifications/beta/shelf"></include-fragment>



  <div
    class="application-main "
    data-commit-hovercards-enabled
    data-discussion-hovercards-enabled
    data-issue-and-pr-hovercards-enabled
  >
        <div itemscope itemtype="http://schema.org/SoftwareSourceCode" class="">
    <main  >
      

  










  <div class="bg-gray-light pt-3 hide-full-screen mb-5">

    <div class="d-flex mb-3 px-3 px-md-4 px-lg-5">

      <div class="flex-auto min-width-0 width-fit mr-3">
        <h1 class=" d-flex flex-wrap flex-items-center break-word f3 text-normal">
    <svg class="octicon octicon-repo-forked text-gray" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.122a2.25 2.25 0 10-1.5 0v.878A2.25 2.25 0 005.75 8.5h1.5v2.128a2.251 2.251 0 101.5 0V8.5h1.5a2.25 2.25 0 002.25-2.25v-.878a2.25 2.25 0 10-1.5 0v.878a.75.75 0 01-.75.75h-4.5A.75.75 0 015 6.25v-.878zm3.75 7.378a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm3-8.75a.75.75 0 100-1.5.75.75 0 000 1.5z"></path></svg>
  <span class="author ml-2 flex-self-stretch" itemprop="author">
    <a class="url fn" rel="author" data-hovercard-type="user" data-hovercard-url="/users/powersimple/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="/powersimple">powersimple</a>
  </span>
  <span class="mx-1 flex-self-stretch">/</span>
  <strong itemprop="name" class="mr-2 flex-self-stretch">
    <a data-pjax="#js-repo-pjax-container" href="/powersimple/aframe-physics-system">aframe-physics-system</a>
  </strong>
  
</h1>

  <span class="text-small lh-condensed-ultra no-wrap mt-1" data-repository-hovercards-enabled>
    forked from <a data-hovercard-type="repository" data-hovercard-url="/donmccurdy/aframe-physics-system/hovercard" href="/donmccurdy/aframe-physics-system">donmccurdy/aframe-physics-system</a>
  </span>

      </div>

      <ul class="pagehead-actions flex-shrink-0 d-none d-md-inline" style="padding: 2px 0;">

  <li>
        <form data-remote="true" class="d-flex js-social-form js-social-container" action="/notifications/subscribe" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="oScem6+TQuR3z2fTWuemHDVt2+yGh/bBjd9fS6yuU7zJiW8uBarDCf4DwLDgDq7hoEGxTRVPcJaorfgr9yj2gg==" />      <input type="hidden" name="repository_id" value="287959869">

      <details class="details-reset details-overlay select-menu hx_rsm">
        <summary class="btn btn-sm btn-with-count" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;WATCH_BUTTON&quot;,&quot;repository_id&quot;:287959869,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="d2b14968d733fe37c9e7e8c2fdf0cfc98e1ea4344df807ae8995bce70654967b" data-ga-click="Repository, click Watch settings, action:blob#show">          <span data-menu-button>
              <svg height="16" class="octicon octicon-eye" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.824.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 010 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.824-.742-3.955-1.715C2.92 9.818 2.09 8.69 1.679 8.068a.119.119 0 010-.136zM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 000 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 000-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2zm0 8a2 2 0 100-4 2 2 0 000 4z"></path></svg>
              Watch
          </span>
          <span class="dropdown-caret"></span>
</summary>        <details-menu
          class="select-menu-modal position-absolute mt-5"
          style="z-index: 99;">
          <div class="select-menu-header">
            <span class="select-menu-title">Notifications</span>
          </div>
          <div class="select-menu-list">
            <button type="submit" name="do" value="included" class="select-menu-item width-full" aria-checked="true" role="menuitemradio">
              <svg class="octicon octicon-check select-menu-item-icon" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>
              <div class="select-menu-item-text">
                <span class="select-menu-item-heading">Not watching</span>
                <span class="description">Be notified only when participating or @mentioned.</span>
                <span class="hidden-select-button-text" data-menu-button-contents>
                  <svg height="16" class="octicon octicon-eye" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.824.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 010 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.824-.742-3.955-1.715C2.92 9.818 2.09 8.69 1.679 8.068a.119.119 0 010-.136zM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 000 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 000-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2zm0 8a2 2 0 100-4 2 2 0 000 4z"></path></svg>
                  Watch
                </span>
              </div>
            </button>

            <button type="submit" name="do" value="release_only" class="select-menu-item width-full" aria-checked="false" role="menuitemradio">
              <svg class="octicon octicon-check select-menu-item-icon" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>
              <div class="select-menu-item-text">
                <span class="select-menu-item-heading">Releases only</span>
                <span class="description">Be notified of new releases, and when participating or @mentioned.</span>
                <span class="hidden-select-button-text" data-menu-button-contents>
                  <svg height="16" class="octicon octicon-eye" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.824.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 010 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.824-.742-3.955-1.715C2.92 9.818 2.09 8.69 1.679 8.068a.119.119 0 010-.136zM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 000 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 000-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2zm0 8a2 2 0 100-4 2 2 0 000 4z"></path></svg>
                  Unwatch releases
                </span>
              </div>
            </button>

            <button type="submit" name="do" value="subscribed" class="select-menu-item width-full" aria-checked="false" role="menuitemradio">
              <svg class="octicon octicon-check select-menu-item-icon" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>
              <div class="select-menu-item-text">
                <span class="select-menu-item-heading">Watching</span>
                <span class="description">Be notified of all conversations.</span>
                <span class="hidden-select-button-text" data-menu-button-contents>
                  <svg class="octicon octicon-eye v-align-text-bottom" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.679 7.932c.412-.621 1.242-1.75 2.366-2.717C5.175 4.242 6.527 3.5 8 3.5c1.473 0 2.824.742 3.955 1.715 1.124.967 1.954 2.096 2.366 2.717a.119.119 0 010 .136c-.412.621-1.242 1.75-2.366 2.717C10.825 11.758 9.473 12.5 8 12.5c-1.473 0-2.824-.742-3.955-1.715C2.92 9.818 2.09 8.69 1.679 8.068a.119.119 0 010-.136zM8 2c-1.981 0-3.67.992-4.933 2.078C1.797 5.169.88 6.423.43 7.1a1.619 1.619 0 000 1.798c.45.678 1.367 1.932 2.637 3.024C4.329 13.008 6.019 14 8 14c1.981 0 3.67-.992 4.933-2.078 1.27-1.091 2.187-2.345 2.637-3.023a1.619 1.619 0 000-1.798c-.45-.678-1.367-1.932-2.637-3.023C11.671 2.992 9.981 2 8 2zm0 8a2 2 0 100-4 2 2 0 000 4z"></path></svg>
                  Unwatch
                </span>
              </div>
            </button>

            <button type="submit" name="do" value="ignore" class="select-menu-item width-full" aria-checked="false" role="menuitemradio">
              <svg class="octicon octicon-check select-menu-item-icon" height="16" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M13.78 4.22a.75.75 0 010 1.06l-7.25 7.25a.75.75 0 01-1.06 0L2.22 9.28a.75.75 0 011.06-1.06L6 10.94l6.72-6.72a.75.75 0 011.06 0z"></path></svg>
              <div class="select-menu-item-text">
                <span class="select-menu-item-heading">Ignoring</span>
                <span class="description">Never be notified.</span>
                <span class="hidden-select-button-text" data-menu-button-contents>
                  <svg height="16" class="octicon octicon-mute" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 2.75a.75.75 0 00-1.238-.57L3.472 5H1.75A1.75 1.75 0 000 6.75v2.5C0 10.216.784 11 1.75 11h1.723l3.289 2.82A.75.75 0 008 13.25V2.75zM4.238 6.32L6.5 4.38v7.24L4.238 9.68a.75.75 0 00-.488-.18h-2a.25.25 0 01-.25-.25v-2.5a.25.25 0 01.25-.25h2a.75.75 0 00.488-.18zm7.042-1.1a.75.75 0 10-1.06 1.06L11.94 8l-1.72 1.72a.75.75 0 101.06 1.06L13 9.06l1.72 1.72a.75.75 0 101.06-1.06L14.06 8l1.72-1.72a.75.75 0 00-1.06-1.06L13 6.94l-1.72-1.72z"></path></svg>
                  Stop ignoring
                </span>
              </div>
            </button>
          </div>
        </details-menu>
      </details>
        <a class="social-count js-social-count"
          href="/powersimple/aframe-physics-system/watchers"
          aria-label="0 users are watching this repository">
          0
        </a>
</form>
  </li>

  <li>
      <div class="js-toggler-container js-social-container starring-container ">
    <form class="starred js-social-form" action="/powersimple/aframe-physics-system/unstar" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="Y+Ph2XompZtgGZCzMFRCeUqiV7s/BOqNnSTHufGwxBoM4oaK/ZyeSChoVp+hXjRtDf8zhH4s4pP2m9QWwesDwQ==" />
      <input type="hidden" name="context" value="repository"></input>
      <button type="submit" class="btn btn-sm btn-with-count  js-toggler-target" aria-label="Unstar this repository" title="Unstar powersimple/aframe-physics-system" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;UNSTAR_BUTTON&quot;,&quot;repository_id&quot;:287959869,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="108d5a3bba8a2f84a91ee8e4ae5c89502a60f7be4d6122def908d36e5ee40948" data-ga-click="Repository, click unstar button, action:blob#show; text:Unstar">        <svg height="16" class="octicon octicon-star-fill" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25z"></path></svg>
        Unstar
</button>        <a class="social-count js-social-count" href="/powersimple/aframe-physics-system/stargazers"
           aria-label="0 users starred this repository">
           0
        </a>
</form>
    <form class="unstarred js-social-form" action="/powersimple/aframe-physics-system/star" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="XEk19J20mjQbrRCeUjnURFCaiaQM58CW6VlXZE9TpCdGPbM4ZW/XYajQbiHvsixoAn+8b9khUu4v2zzSER2EMA==" />
      <input type="hidden" name="context" value="repository"></input>
      <button type="submit" class="btn btn-sm btn-with-count  js-toggler-target" aria-label="Unstar this repository" title="Star powersimple/aframe-physics-system" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;STAR_BUTTON&quot;,&quot;repository_id&quot;:287959869,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="6a8820abc7453b3466baf10c6b56f1f3eb225bac8b9738798ac8fee6e121ec31" data-ga-click="Repository, click star button, action:blob#show; text:Star">        <svg height="16" class="octicon octicon-star" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 .25a.75.75 0 01.673.418l1.882 3.815 4.21.612a.75.75 0 01.416 1.279l-3.046 2.97.719 4.192a.75.75 0 01-1.088.791L8 12.347l-3.766 1.98a.75.75 0 01-1.088-.79l.72-4.194L.818 6.374a.75.75 0 01.416-1.28l4.21-.611L7.327.668A.75.75 0 018 .25zm0 2.445L6.615 5.5a.75.75 0 01-.564.41l-3.097.45 2.24 2.184a.75.75 0 01.216.664l-.528 3.084 2.769-1.456a.75.75 0 01.698 0l2.77 1.456-.53-3.084a.75.75 0 01.216-.664l2.24-2.183-3.096-.45a.75.75 0 01-.564-.41L8 2.694v.001z"></path></svg>
        Star
</button>        <a class="social-count js-social-count" href="/powersimple/aframe-physics-system/stargazers"
           aria-label="0 users starred this repository">
          0
        </a>
</form>  </div>

  </li>

  <li>
          <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="btn-with-count" action="/powersimple/aframe-physics-system/fork" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="TdyxW5yxHX6bb6Lg3yMmpCo+9hGT4ne1FMQAAyVHcdfW8v+olm+FgVj/kXGH9tB4xwIQVLQ3alU6s67JfszFLg==" />
            <button class="btn btn-sm btn-with-count" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;FORK_BUTTON&quot;,&quot;repository_id&quot;:287959869,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="4918fcd770c404f17139a9cbe3ab022bfd7a10fe13c281f60bb295cc95ac9b0e" data-ga-click="Repository, show fork modal, action:blob#show; text:Fork" type="submit" title="Fork your own copy of powersimple/aframe-physics-system to your account" aria-label="Fork your own copy of powersimple/aframe-physics-system to your account">              <svg class="octicon octicon-repo-forked" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M5 3.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm0 2.122a2.25 2.25 0 10-1.5 0v.878A2.25 2.25 0 005.75 8.5h1.5v2.128a2.251 2.251 0 101.5 0V8.5h1.5a2.25 2.25 0 002.25-2.25v-.878a2.25 2.25 0 10-1.5 0v.878a.75.75 0 01-.75.75h-4.5A.75.75 0 015 6.25v-.878zm3.75 7.378a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm3-8.75a.75.75 0 100-1.5.75.75 0 000 1.5z"></path></svg>
              Fork
</button></form>
    <a href="/powersimple/aframe-physics-system/network/members" class="social-count"
       aria-label="75 users forked this repository">
      75
    </a>
  </li>
</ul>

    </div>
    
<nav aria-label="Repository" data-pjax="#js-repo-pjax-container" class="js-repo-nav js-sidenav-container-pjax js-responsive-underlinenav overflow-hidden UnderlineNav px-3 px-md-4 px-lg-5 bg-gray-light">
  <ul class="UnderlineNav-body list-style-none ">
          <li class="d-flex">
        <a class="js-selected-navigation-item selected UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item" data-tab-item="code-tab" data-hotkey="g c" data-ga-click="Repository, Navigation click, Code tab" aria-current="page" data-selected-links="repo_source repo_downloads repo_commits repo_releases repo_tags repo_branches repo_packages repo_deployments /powersimple/aframe-physics-system" href="/powersimple/aframe-physics-system">
              <svg classes="UnderlineNav-octicon" display="none inline" height="16" class="octicon octicon-code UnderlineNav-octicon d-none d-sm-inline" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg>
            <span data-content="Code">Code</span>
              <span title="Not available" class="Counter "></span>
</a>      </li>
      <li class="d-flex">
        <a class="js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item" data-tab-item="pull-requests-tab" data-hotkey="g p" data-ga-click="Repository, Navigation click, Pull requests tab" data-selected-links="repo_pulls checks /powersimple/aframe-physics-system/pulls" href="/powersimple/aframe-physics-system/pulls">
              <svg classes="UnderlineNav-octicon" display="none inline" height="16" class="octicon octicon-git-pull-request UnderlineNav-octicon d-none d-sm-inline" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"></path></svg>
            <span data-content="Pull requests">Pull requests</span>
              <span title="0" hidden="hidden" class="Counter ">0</span>
</a>      </li>
      <li class="d-flex">
        <a class="js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item" data-tab-item="actions-tab" data-hotkey="g a" data-ga-click="Repository, Navigation click, Actions tab" data-selected-links="repo_actions /powersimple/aframe-physics-system/actions" href="/powersimple/aframe-physics-system/actions">
              <svg classes="UnderlineNav-octicon" display="none inline" height="16" class="octicon octicon-play UnderlineNav-octicon d-none d-sm-inline" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.5 8a6.5 6.5 0 1113 0 6.5 6.5 0 01-13 0zM8 0a8 8 0 100 16A8 8 0 008 0zM6.379 5.227A.25.25 0 006 5.442v5.117a.25.25 0 00.379.214l4.264-2.559a.25.25 0 000-.428L6.379 5.227z"></path></svg>
            <span data-content="Actions">Actions</span>
              <span title="Not available" class="Counter "></span>
</a>      </li>
      <li class="d-flex">
        <a class="js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item" data-tab-item="projects-tab" data-hotkey="g b" data-ga-click="Repository, Navigation click, Projects tab" data-selected-links="repo_projects new_repo_project repo_project /powersimple/aframe-physics-system/projects" href="/powersimple/aframe-physics-system/projects">
              <svg classes="UnderlineNav-octicon" display="none inline" height="16" class="octicon octicon-project UnderlineNav-octicon d-none d-sm-inline" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.75 0A1.75 1.75 0 000 1.75v12.5C0 15.216.784 16 1.75 16h12.5A1.75 1.75 0 0016 14.25V1.75A1.75 1.75 0 0014.25 0H1.75zM1.5 1.75a.25.25 0 01.25-.25h12.5a.25.25 0 01.25.25v12.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25V1.75zM11.75 3a.75.75 0 00-.75.75v7.5a.75.75 0 001.5 0v-7.5a.75.75 0 00-.75-.75zm-8.25.75a.75.75 0 011.5 0v5.5a.75.75 0 01-1.5 0v-5.5zM8 3a.75.75 0 00-.75.75v3.5a.75.75 0 001.5 0v-3.5A.75.75 0 008 3z"></path></svg>
            <span data-content="Projects">Projects</span>
              <span title="0" hidden="hidden" class="Counter ">0</span>
</a>      </li>
      <li class="d-flex">
        <a class="js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item" data-tab-item="wiki-tab" data-hotkey="g w" data-ga-click="Repository, Navigation click, Wikis tab" data-selected-links="repo_wiki /powersimple/aframe-physics-system/wiki" href="/powersimple/aframe-physics-system/wiki">
              <svg classes="UnderlineNav-octicon" display="none inline" height="16" class="octicon octicon-book UnderlineNav-octicon d-none d-sm-inline" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M0 1.75A.75.75 0 01.75 1h4.253c1.227 0 2.317.59 3 1.501A3.744 3.744 0 0111.006 1h4.245a.75.75 0 01.75.75v10.5a.75.75 0 01-.75.75h-4.507a2.25 2.25 0 00-1.591.659l-.622.621a.75.75 0 01-1.06 0l-.622-.621A2.25 2.25 0 005.258 13H.75a.75.75 0 01-.75-.75V1.75zm8.755 3a2.25 2.25 0 012.25-2.25H14.5v9h-3.757c-.71 0-1.4.201-1.992.572l.004-7.322zm-1.504 7.324l.004-5.073-.002-2.253A2.25 2.25 0 005.003 2.5H1.5v9h3.757a3.75 3.75 0 011.994.574z"></path></svg>
            <span data-content="Wiki">Wiki</span>
              <span title="Not available" class="Counter "></span>
</a>      </li>
      <li class="d-flex">
        <a class="js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item" data-tab-item="security-tab" data-hotkey="g s" data-ga-click="Repository, Navigation click, Security tab" data-selected-links="security overview alerts policy token_scanning code_scanning /powersimple/aframe-physics-system/security" href="/powersimple/aframe-physics-system/security">
              <svg classes="UnderlineNav-octicon" display="none inline" height="16" class="octicon octicon-shield UnderlineNav-octicon d-none d-sm-inline" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.467.133a1.75 1.75 0 011.066 0l5.25 1.68A1.75 1.75 0 0115 3.48V7c0 1.566-.32 3.182-1.303 4.682-.983 1.498-2.585 2.813-5.032 3.855a1.7 1.7 0 01-1.33 0c-2.447-1.042-4.049-2.357-5.032-3.855C1.32 10.182 1 8.566 1 7V3.48a1.75 1.75 0 011.217-1.667l5.25-1.68zm.61 1.429a.25.25 0 00-.153 0l-5.25 1.68a.25.25 0 00-.174.238V7c0 1.358.275 2.666 1.057 3.86.784 1.194 2.121 2.34 4.366 3.297a.2.2 0 00.154 0c2.245-.956 3.582-2.104 4.366-3.298C13.225 9.666 13.5 8.36 13.5 7V3.48a.25.25 0 00-.174-.237l-5.25-1.68zM9 10.5a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.75a.75.75 0 10-1.5 0v3a.75.75 0 001.5 0v-3z"></path></svg>
            <span data-content="Security">Security</span>
              <span data-url="/powersimple/aframe-physics-system/security/overall-count" title="Not available" class="js-security-tab-count Counter "></span>
</a>      </li>
      <li class="d-flex">
        <a class="js-selected-navigation-item UnderlineNav-item hx_underlinenav-item no-wrap js-responsive-underlinenav-item" data-tab-item="insights-tab" data-ga-click="Repository, Navigation click, Insights tab" data-selected-links="repo_graphs repo_contributors dependency_graph dependabot_updates pulse people /powersimple/aframe-physics-system/pulse" href="/powersimple/aframe-physics-system/pulse">
              <svg classes="UnderlineNav-octicon" display="none inline" height="16" class="octicon octicon-graph UnderlineNav-octicon d-none d-sm-inline" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.5 1.75a.75.75 0 00-1.5 0v12.5c0 .414.336.75.75.75h14.5a.75.75 0 000-1.5H1.5V1.75zm14.28 2.53a.75.75 0 00-1.06-1.06L10 7.94 7.53 5.47a.75.75 0 00-1.06 0L3.22 8.72a.75.75 0 001.06 1.06L7 7.06l2.47 2.47a.75.75 0 001.06 0l5.25-5.25z"></path></svg>
            <span data-content="Insights">Insights</span>
              <span title="Not available" class="Counter "></span>
</a>      </li>

</ul>        <div class="position-absolute right-0 pr-3 pr-md-4 pr-lg-5 js-responsive-underlinenav-overflow" style="visibility:hidden;">
      <details class="details-overlay details-reset position-relative">
  <summary role="button">
              <div class="UnderlineNav-item mr-0 border-0">
            <svg class="octicon octicon-kebab-horizontal" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path></svg>
            <span class="sr-only">More</span>
          </div>

</summary>            <details-menu role="menu" class="dropdown-menu dropdown-menu-sw ">
  
            <ul>
                <li data-menu-item="code-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /powersimple/aframe-physics-system" href="/powersimple/aframe-physics-system">
                    Code
</a>                </li>
                <li data-menu-item="pull-requests-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /powersimple/aframe-physics-system/pulls" href="/powersimple/aframe-physics-system/pulls">
                    Pull requests
</a>                </li>
                <li data-menu-item="actions-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /powersimple/aframe-physics-system/actions" href="/powersimple/aframe-physics-system/actions">
                    Actions
</a>                </li>
                <li data-menu-item="projects-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /powersimple/aframe-physics-system/projects" href="/powersimple/aframe-physics-system/projects">
                    Projects
</a>                </li>
                <li data-menu-item="wiki-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /powersimple/aframe-physics-system/wiki" href="/powersimple/aframe-physics-system/wiki">
                    Wiki
</a>                </li>
                <li data-menu-item="security-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /powersimple/aframe-physics-system/security" href="/powersimple/aframe-physics-system/security">
                    Security
</a>                </li>
                <li data-menu-item="insights-tab" hidden>
                  <a role="menuitem" class="js-selected-navigation-item dropdown-item" data-selected-links=" /powersimple/aframe-physics-system/pulse" href="/powersimple/aframe-physics-system/pulse">
                    Insights
</a>                </li>
            </ul>

</details-menu>
</details>    </div>

</nav>
  </div>

<div class="container-xl clearfix new-discussion-timeline  px-3 px-md-4 px-lg-5">
  <div class="repository-content " >

    
    
  


    <a class="d-none js-permalink-shortcut" data-hotkey="y" href="/powersimple/aframe-physics-system/blob/477aeafc668db7e46fe1fdc8d0f451c66cf4613b/dist/aframe-physics-system.min.js">Permalink</a>

    <!-- blob contrib key: blob_contributors:v22:4d0775f13ba83ec0dd346b108ba76571 -->
    

    <div class="d-flex flex-items-start flex-shrink-0 pb-3 flex-wrap flex-md-nowrap flex-justify-between flex-md-justify-start">
      
<details class="details-reset details-overlay mr-0 mb-0 " id="branch-select-menu">
  <summary class="btn css-truncate"
           data-hotkey="w"
           title="Switch branches or tags">
    <svg text="gray" height="16" class="octicon octicon-git-branch text-gray" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M11.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122V6A2.5 2.5 0 0110 8.5H6a1 1 0 00-1 1v1.128a2.251 2.251 0 11-1.5 0V5.372a2.25 2.25 0 111.5 0v1.836A2.492 2.492 0 016 7h4a1 1 0 001-1v-.628A2.25 2.25 0 019.5 3.25zM4.25 12a.75.75 0 100 1.5.75.75 0 000-1.5zM3.5 3.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0z"></path></svg>
    <span class="css-truncate-target" data-menu-button>master</span>
    <span class="dropdown-caret"></span>
  </summary>

  <details-menu class="SelectMenu SelectMenu--hasFilter" src="/powersimple/aframe-physics-system/refs/master/dist/aframe-physics-system.min.js?source_action=show&amp;source_controller=blob" preload>
    <div class="SelectMenu-modal">
      <include-fragment class="SelectMenu-loading" aria-label="Menu is loading">
        <svg class="octicon octicon-octoface anim-pulse" height="32" viewBox="0 0 16 16" version="1.1" width="32" aria-hidden="true"><path fill-rule="evenodd" d="M14.7 5.34c.13-.32.55-1.59-.13-3.31 0 0-1.05-.33-3.44 1.3-1-.28-2.07-.32-3.13-.32s-2.13.04-3.13.32c-2.39-1.64-3.44-1.3-3.44-1.3-.68 1.72-.26 2.99-.13 3.31C.49 6.21 0 7.33 0 8.69 0 13.84 3.33 15 7.98 15S16 13.84 16 8.69c0-1.36-.49-2.48-1.3-3.35zM8 14.02c-3.3 0-5.98-.15-5.98-3.35 0-.76.38-1.48 1.02-2.07 1.07-.98 2.9-.46 4.96-.46 2.07 0 3.88-.52 4.96.46.65.59 1.02 1.3 1.02 2.07 0 3.19-2.68 3.35-5.98 3.35zM5.49 9.01c-.66 0-1.2.8-1.2 1.78s.54 1.79 1.2 1.79c.66 0 1.2-.8 1.2-1.79s-.54-1.78-1.2-1.78zm5.02 0c-.66 0-1.2.79-1.2 1.78s.54 1.79 1.2 1.79c.66 0 1.2-.8 1.2-1.79s-.53-1.78-1.2-1.78z"></path></svg>
      </include-fragment>
    </div>
  </details-menu>
</details>

      <h2 id="blob-path" class="breadcrumb flex-auto min-width-0 text-normal mx-0 mx-md-3 width-full width-md-auto flex-order-1 flex-md-order-none mt-3 mt-md-0">
        <span class="js-repo-root text-bold"><span class="js-path-segment d-inline-block wb-break-all"><a data-pjax="true" href="/powersimple/aframe-physics-system"><span>aframe-physics-system</span></a></span></span><span class="separator">/</span><span class="js-path-segment d-inline-block wb-break-all"><a data-pjax="true" href="/powersimple/aframe-physics-system/tree/master/dist"><span>dist</span></a></span><span class="separator">/</span><strong class="final-path">aframe-physics-system.min.js</strong>
          <span class="separator">/</span><details class="details-reset details-overlay d-inline" id="jumpto-symbol-select-menu">
  <summary class="btn-link link-gray css-truncate" aria-haspopup="true" data-hotkey="r" data-hydro-click="{&quot;event_type&quot;:&quot;code_navigation.click_on_blob_definitions&quot;,&quot;payload&quot;:{&quot;action&quot;:&quot;click_on_blob_definitions&quot;,&quot;repository_id&quot;:287959869,&quot;ref&quot;:&quot;master&quot;,&quot;language&quot;:&quot;JavaScript&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="08fb7acaef34f2d81cd755712b7cd247a3c12866982d4bdfba25d2cefa2f1a93">
      <svg class="octicon octicon-code" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M4.72 3.22a.75.75 0 011.06 1.06L2.06 8l3.72 3.72a.75.75 0 11-1.06 1.06L.47 8.53a.75.75 0 010-1.06l4.25-4.25zm6.56 0a.75.75 0 10-1.06 1.06L13.94 8l-3.72 3.72a.75.75 0 101.06 1.06l4.25-4.25a.75.75 0 000-1.06l-4.25-4.25z"></path></svg>
    <span data-menu-button>Jump to</span>
    <span class="dropdown-caret"></span>
  </summary>
  <details-menu class="SelectMenu SelectMenu--hasFilter" role="menu">
    <div class="SelectMenu-modal">
      <header class="SelectMenu-header">
        <span class="SelectMenu-title">Code definitions</span>
        <button class="SelectMenu-closeButton" type="button" data-toggle-for="jumpto-symbol-select-menu">
          <svg aria-label="Close menu" class="octicon octicon-x" viewBox="0 0 16 16" version="1.1" width="16" height="16" role="img"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>
        </button>
      </header>
      <div class="SelectMenu-list">
          <div class="SelectMenu-blankslate">
            <p class="mb-0 text-gray">
              No definitions found in this file.
            </p>
          </div>
        <div data-filterable-for="jumpto-symbols-filter-field" data-filterable-type="substring">
        </div>
      </div>
      <footer class="SelectMenu-footer">
        <div class="d-flex flex-justify-between">
          Code navigation not available for this commit
          <svg class="octicon octicon-dot-fill text-light-gray" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8z"></path></svg>
        </div>
      </footer>
    </div>
  </details-menu>
</details>

      </h2>
      <a href="/powersimple/aframe-physics-system/find/master"
            class="js-pjax-capture-input btn mr-2 d-none d-md-block"
            data-pjax
            data-hotkey="t">
        Go to file
      </a>

      <details id="blob-more-options-details" class="details-overlay details-reset position-relative">
  <summary role="button">
              <span class="btn">
            <svg aria-label="More options" height="16" class="octicon octicon-kebab-horizontal" viewBox="0 0 16 16" version="1.1" width="16" role="img"><path d="M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path></svg>
          </span>

</summary>            <ul class="dropdown-menu dropdown-menu-sw">
            <li class="d-block d-md-none">
              <a class="dropdown-item d-flex flex-items-baseline" data-hydro-click="{&quot;event_type&quot;:&quot;repository.click&quot;,&quot;payload&quot;:{&quot;target&quot;:&quot;FIND_FILE_BUTTON&quot;,&quot;repository_id&quot;:287959869,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}" data-hydro-click-hmac="dbbab25a4d57adbb928070d768665522a762564e75ee269717ccc9e262feda0e" data-ga-click="Repository, find file, location:repo overview" data-hotkey="t" data-pjax="true" href="/powersimple/aframe-physics-system/find/master">
                <span class="flex-auto">Go to file</span>
                <span class="text-small text-gray" aria-hidden="true">T</span>
</a>            </li>
            <li data-toggle-for="blob-more-options-details">
              <button type="button" data-toggle-for="jumpto-line-details-dialog" class="btn-link dropdown-item">
                <span class="d-flex flex-items-baseline">
                  <span class="flex-auto">Go to line</span>
                  <span class="text-small text-gray" aria-hidden="true">L</span>
                </span>
              </button>
            </li>
            <li data-toggle-for="blob-more-options-details">
              <button type="button" data-toggle-for="jumpto-symbol-select-menu" class="btn-link dropdown-item">
                <span class="d-flex flex-items-baseline">
                  <span class="flex-auto">Go to definition</span>
                  <span class="text-small text-gray" aria-hidden="true">R</span>
                </span>
              </button>
            </li>
            <li class="dropdown-divider" role="none"></li>
            <li>
              <clipboard-copy value="dist/aframe-physics-system.min.js" class="dropdown-item cursor-pointer" data-toggle-for="blob-more-options-details">
                Copy path
              </clipboard-copy>
            </li>
          </ul>

</details>    </div>



    <div class="Box d-flex flex-column flex-shrink-0 mb-3">
      <include-fragment src="/powersimple/aframe-physics-system/contributors/master/dist/aframe-physics-system.min.js" class="commit-loader">
        <div class="Box-header Box-header--blue d-flex flex-items-center">
          <div class="Skeleton avatar avatar-user flex-shrink-0 ml-n1 mr-n1 mt-n1 mb-n1" style="width:24px;height:24px;"></div>
          <div class="Skeleton Skeleton--text col-5 ml-2">&nbsp;</div>
        </div>

        <div class="Box-body d-flex flex-items-center" >
          <div class="Skeleton Skeleton--text col-1">&nbsp;</div>
          <span class="text-red h6 loader-error">Cannot retrieve contributors at this time</span>
        </div>
</include-fragment>    </div>






    <div class="Box mt-3 position-relative
      ">
      
<div class="Box-header py-2 d-flex flex-column flex-shrink-0 flex-md-row flex-md-items-center">
  <div class="text-mono f6 flex-auto pr-3 flex-order-2 flex-md-order-1 mt-2 mt-md-0">

      1 lines (1 sloc)
      <span class="file-info-divider"></span>
    279 KB
  </div>

  <div class="d-flex py-1 py-md-0 flex-auto flex-order-1 flex-md-order-2 flex-sm-grow-0 flex-justify-between">

    <div class="BtnGroup">
      <a href="/powersimple/aframe-physics-system/raw/master/dist/aframe-physics-system.min.js" id="raw-url" role="button" class="btn btn-sm BtnGroup-item ">Raw</a>
        <a href="/powersimple/aframe-physics-system/blame/master/dist/aframe-physics-system.min.js" data-hotkey="b" role="button" class="btn js-update-url-with-hash btn-sm BtnGroup-item ">Blame</a>
    </div>

    <div>
          <a class="btn-octicon tooltipped tooltipped-nw js-remove-unless-platform"
             data-platforms="windows,mac"
             href="x-github-client://openRepo/https://github.com/powersimple/aframe-physics-system?branch=master&amp;filepath=dist%2Faframe-physics-system.min.js"
             aria-label="Open this file in GitHub Desktop"
             data-ga-click="Repository, open with desktop">
              <svg class="octicon octicon-device-desktop" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M1.75 2.5h12.5a.25.25 0 01.25.25v7.5a.25.25 0 01-.25.25H1.75a.25.25 0 01-.25-.25v-7.5a.25.25 0 01.25-.25zM14.25 1H1.75A1.75 1.75 0 000 2.75v7.5C0 11.216.784 12 1.75 12h3.727c-.1 1.041-.52 1.872-1.292 2.757A.75.75 0 004.75 16h6.5a.75.75 0 00.565-1.243c-.772-.885-1.193-1.716-1.292-2.757h3.727A1.75 1.75 0 0016 10.25v-7.5A1.75 1.75 0 0014.25 1zM9.018 12H6.982a5.72 5.72 0 01-.765 2.5h3.566a5.72 5.72 0 01-.765-2.5z"></path></svg>
          </a>

          <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="inline-form js-update-url-with-hash" action="/powersimple/aframe-physics-system/edit/master/dist/aframe-physics-system.min.js" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="aYyK1a6mGmzdEJ9vuA+BHaPDe7M4O+A8GXqzfBb4n0UIS+jgaceo4Y1vU9m9sQ/TlvocGKfpo0WuYqID0vulZg==" />
            <button class="btn-octicon tooltipped tooltipped-nw" type="submit"
              aria-label="Fork this project and edit the file" data-hotkey="e" data-disable-with>
              <svg class="octicon octicon-pencil" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M11.013 1.427a1.75 1.75 0 012.474 0l1.086 1.086a1.75 1.75 0 010 2.474l-8.61 8.61c-.21.21-.47.364-.756.445l-3.251.93a.75.75 0 01-.927-.928l.929-3.25a1.75 1.75 0 01.445-.758l8.61-8.61zm1.414 1.06a.25.25 0 00-.354 0L10.811 3.75l1.439 1.44 1.263-1.263a.25.25 0 000-.354l-1.086-1.086zM11.189 6.25L9.75 4.81l-6.286 6.287a.25.25 0 00-.064.108l-.558 1.953 1.953-.558a.249.249 0 00.108-.064l6.286-6.286z"></path></svg>
            </button>
</form>
          <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="inline-form" action="/powersimple/aframe-physics-system/delete/master/dist/aframe-physics-system.min.js" accept-charset="UTF-8" method="post"><input type="hidden" name="authenticity_token" value="pdvluk+QSq6DEqEqBfce01RH1RUwLDJg8pWU43RwjTVSFjeDvRkaVyJc/WAZRqhuYq05tZrQDeRIaY/iUKngGA==" />
            <button class="btn-octicon btn-octicon-danger tooltipped tooltipped-nw" type="submit"
              aria-label="Fork this project and delete the file" data-disable-with>
              <svg class="octicon octicon-trashcan" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M6.5 1.75a.25.25 0 01.25-.25h2.5a.25.25 0 01.25.25V3h-3V1.75zm4.5 0V3h2.25a.75.75 0 010 1.5H2.75a.75.75 0 010-1.5H5V1.75C5 .784 5.784 0 6.75 0h2.5C10.216 0 11 .784 11 1.75zM4.496 6.675a.75.75 0 10-1.492.15l.66 6.6A1.75 1.75 0 005.405 15h5.19c.9 0 1.652-.681 1.741-1.576l.66-6.6a.75.75 0 00-1.492-.149l-.66 6.6a.25.25 0 01-.249.225h-5.19a.25.25 0 01-.249-.225l-.66-6.6z"></path></svg>
            </button>
</form>    </div>
  </div>
</div>



      

  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-javascript  gist-border-0">
      
<table class="highlight tab-size js-file-line-container" data-tab-size="8" data-paste-markdown-skip>
      <tr>
        <td id="L1" class="blob-num js-line-number" data-line-number="1"></td>
        <td id="LC1" class="blob-code blob-code-inner js-file-line">!function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=&quot;function&quot;==typeof require&amp;&amp;require;if(!f&amp;&amp;c)return c(i,!0);if(u)return u(i,!0);var a=new Error(&quot;Cannot find module &#39;&quot;+i+&quot;&#39;&quot;);throw a.code=&quot;MODULE_NOT_FOUND&quot;,a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=&quot;function&quot;==typeof require&amp;&amp;require,i=0;i&lt;t.length;i++)o(t[i]);return o}}()({1:[function(require,module,exports){var CANNON=require(&quot;cannon-es&quot;);require(&quot;./src/components/math&quot;),require(&quot;./src/components/body/ammo-body&quot;),require(&quot;./src/components/body/body&quot;),require(&quot;./src/components/body/dynamic-body&quot;),require(&quot;./src/components/body/static-body&quot;),require(&quot;./src/components/shape/shape&quot;),require(&quot;./src/components/shape/ammo-shape&quot;),require(&quot;./src/components/ammo-constraint&quot;),require(&quot;./src/components/constraint&quot;),require(&quot;./src/components/spring&quot;),require(&quot;./src/system&quot;),module.exports={registerAll:function(){console.warn(&quot;registerAll() is deprecated. Components are automatically registered.&quot;)}},window.CANNON=window.CANNON||CANNON},{&quot;./src/components/ammo-constraint&quot;:8,&quot;./src/components/body/ammo-body&quot;:9,&quot;./src/components/body/body&quot;:10,&quot;./src/components/body/dynamic-body&quot;:11,&quot;./src/components/body/static-body&quot;:12,&quot;./src/components/constraint&quot;:13,&quot;./src/components/math&quot;:14,&quot;./src/components/shape/ammo-shape&quot;:16,&quot;./src/components/shape/shape&quot;:17,&quot;./src/components/spring&quot;:18,&quot;./src/system&quot;:28,&quot;cannon-es&quot;:4}],2:[function(require,module,exports){var CANNON=require(&quot;cannon-es&quot;);CANNON.shape2mesh=function(body){for(var obj=new THREE.Object3D,l=0;l&lt;body.shapes.length;l++){var mesh,shape=body.shapes[l];switch(shape.type){case CANNON.Shape.types.SPHERE:var sphere_geometry=new THREE.SphereGeometry(shape.radius,8,8);mesh=new THREE.Mesh(sphere_geometry,this.currentMaterial);break;case CANNON.Shape.types.PARTICLE:mesh=new THREE.Mesh(this.particleGeo,this.particleMaterial);var s=this.settings;mesh.scale.set(s.particleSize,s.particleSize,s.particleSize);break;case CANNON.Shape.types.PLANE:var geometry=new THREE.PlaneGeometry(10,10,4,4);mesh=new THREE.Object3D;var submesh=new THREE.Object3D,ground=new THREE.Mesh(geometry,this.currentMaterial);ground.scale.set(100,100,100),submesh.add(ground),ground.castShadow=!0,ground.receiveShadow=!0,mesh.add(submesh);break;case CANNON.Shape.types.BOX:var box_geometry=new THREE.BoxGeometry(2*shape.halfExtents.x,2*shape.halfExtents.y,2*shape.halfExtents.z);mesh=new THREE.Mesh(box_geometry,this.currentMaterial);break;case CANNON.Shape.types.CONVEXPOLYHEDRON:for(var geo=new THREE.Geometry,i=0;i&lt;shape.vertices.length;i++){var v=shape.vertices[i];geo.vertices.push(new THREE.Vector3(v.x,v.y,v.z))}for(i=0;i&lt;shape.faces.length;i++)for(var face=shape.faces[i],a=face[0],j=1;j&lt;face.length-1;j++){var b=face[j],c=face[j+1];geo.faces.push(new THREE.Face3(a,b,c))}geo.computeBoundingSphere(),geo.computeFaceNormals(),mesh=new THREE.Mesh(geo,this.currentMaterial);break;case CANNON.Shape.types.HEIGHTFIELD:geometry=new THREE.Geometry;for(var v0=new CANNON.Vec3,v1=new CANNON.Vec3,v2=new CANNON.Vec3,xi=0;xi&lt;shape.data.length-1;xi++)for(var yi=0;yi&lt;shape.data[xi].length-1;yi++)for(var k=0;k&lt;2;k++){shape.getConvexTrianglePillar(xi,yi,0===k),v0.copy(shape.pillarConvex.vertices[0]),v1.copy(shape.pillarConvex.vertices[1]),v2.copy(shape.pillarConvex.vertices[2]),v0.vadd(shape.pillarOffset,v0),v1.vadd(shape.pillarOffset,v1),v2.vadd(shape.pillarOffset,v2),geometry.vertices.push(new THREE.Vector3(v0.x,v0.y,v0.z),new THREE.Vector3(v1.x,v1.y,v1.z),new THREE.Vector3(v2.x,v2.y,v2.z));i=geometry.vertices.length-3;geometry.faces.push(new THREE.Face3(i,i+1,i+2))}geometry.computeBoundingSphere(),geometry.computeFaceNormals(),mesh=new THREE.Mesh(geometry,this.currentMaterial);break;case CANNON.Shape.types.TRIMESH:for(geometry=new THREE.Geometry,v0=new CANNON.Vec3,v1=new CANNON.Vec3,v2=new CANNON.Vec3,i=0;i&lt;shape.indices.length/3;i++){shape.getTriangleVertices(i,v0,v1,v2),geometry.vertices.push(new THREE.Vector3(v0.x,v0.y,v0.z),new THREE.Vector3(v1.x,v1.y,v1.z),new THREE.Vector3(v2.x,v2.y,v2.z));j=geometry.vertices.length-3;geometry.faces.push(new THREE.Face3(j,j+1,j+2))}geometry.computeBoundingSphere(),geometry.computeFaceNormals(),mesh=new THREE.Mesh(geometry,this.currentMaterial);break;default:throw&quot;Visual type not recognized: &quot;+shape.type}if(mesh.receiveShadow=!0,mesh.castShadow=!0,mesh.children)for(i=0;i&lt;mesh.children.length;i++)if(mesh.children[i].castShadow=!0,mesh.children[i].receiveShadow=!0,mesh.children[i])for(j=0;j&lt;mesh.children[i].length;j++)mesh.children[i].children[j].castShadow=!0,mesh.children[i].children[j].receiveShadow=!0;var o=body.shapeOffsets[l],q=body.shapeOrientations[l];mesh.position.set(o.x,o.y,o.z),mesh.quaternion.set(q.x,q.y,q.z,q.w),obj.add(mesh)}return obj},module.exports=CANNON.shape2mesh},{&quot;cannon-es&quot;:4}],3:[function(require,module,exports){THREE.AmmoDebugConstants={NoDebug:0,DrawWireframe:1,DrawAabb:2,DrawFeaturesText:4,DrawContactPoints:8,NoDeactivation:16,NoHelpText:32,DrawText:64,ProfileTimings:128,EnableSatComparison:256,DisableBulletLCP:512,EnableCCD:1024,DrawConstraints:2048,DrawConstraintLimits:4096,FastWireframe:8192,DrawNormals:16384,DrawOnTop:32768,MAX_DEBUG_DRAW_MODE:4294967295},THREE.AmmoDebugDrawer=function(scene,world,options){this.scene=scene,this.world=world,options=options||{},this.debugDrawMode=options.debugDrawMode||THREE.AmmoDebugConstants.DrawWireframe;var drawOnTop=this.debugDrawMode&amp;THREE.AmmoDebugConstants.DrawOnTop||!1,maxBufferSize=options.maxBufferSize||1e6;this.geometry=new THREE.BufferGeometry;var vertices=new Float32Array(3*maxBufferSize),colors=new Float32Array(3*maxBufferSize);this.geometry.addAttribute(&quot;position&quot;,new THREE.BufferAttribute(vertices,3).setDynamic(!0)),this.geometry.addAttribute(&quot;color&quot;,new THREE.BufferAttribute(colors,3).setDynamic(!0)),this.index=0;var material=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,depthTest:!drawOnTop});this.mesh=new THREE.LineSegments(this.geometry,material),drawOnTop&amp;&amp;(this.mesh.renderOrder=999),this.mesh.frustumCulled=!1,this.enabled=!1,this.debugDrawer=new Ammo.DebugDrawer,this.debugDrawer.drawLine=this.drawLine.bind(this),this.debugDrawer.drawContactPoint=this.drawContactPoint.bind(this),this.debugDrawer.reportErrorWarning=this.reportErrorWarning.bind(this),this.debugDrawer.draw3dText=this.draw3dText.bind(this),this.debugDrawer.setDebugMode=this.setDebugMode.bind(this),this.debugDrawer.getDebugMode=this.getDebugMode.bind(this),this.debugDrawer.enable=this.enable.bind(this),this.debugDrawer.disable=this.disable.bind(this),this.debugDrawer.update=this.update.bind(this),this.world.setDebugDrawer(this.debugDrawer)},THREE.AmmoDebugDrawer.prototype=function(){return this.debugDrawer},THREE.AmmoDebugDrawer.prototype.enable=function(){this.enabled=!0,this.scene.add(this.mesh)},THREE.AmmoDebugDrawer.prototype.disable=function(){this.enabled=!1,this.scene.remove(this.mesh)},THREE.AmmoDebugDrawer.prototype.update=function(){this.enabled&amp;&amp;(0!=this.index&amp;&amp;(this.geometry.attributes.position.needsUpdate=!0,this.geometry.attributes.color.needsUpdate=!0),this.index=0,this.world.debugDrawWorld(),this.geometry.setDrawRange(0,this.index))},THREE.AmmoDebugDrawer.prototype.drawLine=function(from,to,color){const heap=Ammo.HEAPF32,r=heap[(color+0)/4],g=heap[(color+4)/4],b=heap[(color+8)/4],fromX=heap[(from+0)/4],fromY=heap[(from+4)/4],fromZ=heap[(from+8)/4];this.geometry.attributes.position.setXYZ(this.index,fromX,fromY,fromZ),this.geometry.attributes.color.setXYZ(this.index++,r,g,b);const toX=heap[(to+0)/4],toY=heap[(to+4)/4],toZ=heap[(to+8)/4];this.geometry.attributes.position.setXYZ(this.index,toX,toY,toZ),this.geometry.attributes.color.setXYZ(this.index++,r,g,b)},THREE.AmmoDebugDrawer.prototype.drawContactPoint=function(pointOnB,normalOnB,distance,lifeTime,color){const heap=Ammo.HEAPF32,r=heap[(color+0)/4],g=heap[(color+4)/4],b=heap[(color+8)/4],x=heap[(pointOnB+0)/4],y=heap[(pointOnB+4)/4],z=heap[(pointOnB+8)/4];this.geometry.attributes.position.setXYZ(this.index,x,y,z),this.geometry.attributes.color.setXYZ(this.index++,r,g,b);const dx=heap[(normalOnB+0)/4]*distance,dy=heap[(normalOnB+4)/4]*distance,dz=heap[(normalOnB+8)/4]*distance;this.geometry.attributes.position.setXYZ(this.index,x+dx,y+dy,z+dz),this.geometry.attributes.color.setXYZ(this.index++,r,g,b)},THREE.AmmoDebugDrawer.prototype.reportErrorWarning=function(warningString){Ammo.hasOwnProperty(&quot;Pointer_stringify&quot;)?console.warn(Ammo.Pointer_stringify(warningString)):this.warnedOnce||(this.warnedOnce=!0,console.warn(&quot;Cannot print warningString, please rebuild Ammo.js using &#39;debug&#39; flag&quot;))},THREE.AmmoDebugDrawer.prototype.draw3dText=function(location,textString){console.warn(&quot;TODO: draw3dText&quot;)},THREE.AmmoDebugDrawer.prototype.setDebugMode=function(debugMode){this.debugDrawMode=debugMode},THREE.AmmoDebugDrawer.prototype.getDebugMode=function(){return this.debugDrawMode}},{}],4:[function(require,module,exports){&quot;use strict&quot;;Object.defineProperty(exports,&quot;__esModule&quot;,{value:!0});var ObjectCollisionMatrix=function(){function ObjectCollisionMatrix(){this.matrix={}}var _proto=ObjectCollisionMatrix.prototype;return _proto.get=function(bi,bj){var i=bi.id,j=bj.id;if(j&gt;i){var temp=j;j=i,i=temp}return i+&quot;-&quot;+j in this.matrix},_proto.set=function(bi,bj,value){var i=bi.id,j=bj.id;if(j&gt;i){var temp=j;j=i,i=temp}value?this.matrix[i+&quot;-&quot;+j]=!0:delete this.matrix[i+&quot;-&quot;+j]},_proto.reset=function(){this.matrix={}},_proto.setNumObjects=function(n){},ObjectCollisionMatrix}(),Mat3=function(){function Mat3(elements){void 0===elements&amp;&amp;(elements=[0,0,0,0,0,0,0,0,0]),this.elements=elements}var _proto=Mat3.prototype;return _proto.identity=function(){var e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1},_proto.setZero=function(){var e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0},_proto.setTrace=function(vector){var e=this.elements;e[0]=vector.x,e[4]=vector.y,e[8]=vector.z},_proto.getTrace=function(target){void 0===target&amp;&amp;(target=new Vec3);var e=this.elements;target.x=e[0],target.y=e[4],target.z=e[8]},_proto.vmult=function(v,target){void 0===target&amp;&amp;(target=new Vec3);var e=this.elements,x=v.x,y=v.y,z=v.z;return target.x=e[0]*x+e[1]*y+e[2]*z,target.y=e[3]*x+e[4]*y+e[5]*z,target.z=e[6]*x+e[7]*y+e[8]*z,target},_proto.smult=function(s){for(var i=0;i&lt;this.elements.length;i++)this.elements[i]*=s},_proto.mmult=function(matrix,target){void 0===target&amp;&amp;(target=new Mat3);for(var elements=matrix.elements,i=0;i&lt;3;i++)for(var j=0;j&lt;3;j++){for(var sum=0,k=0;k&lt;3;k++)sum+=elements[i+3*k]*this.elements[k+3*j];target.elements[i+3*j]=sum}return target},_proto.scale=function(vector,target){void 0===target&amp;&amp;(target=new Mat3);for(var e=this.elements,t=target.elements,i=0;3!==i;i++)t[3*i+0]=vector.x*e[3*i+0],t[3*i+1]=vector.y*e[3*i+1],t[3*i+2]=vector.z*e[3*i+2];return target},_proto.solve=function(b,target){void 0===target&amp;&amp;(target=new Vec3);var i,j,eqns=[];for(i=0;i&lt;12;i++)eqns.push(0);for(i=0;i&lt;3;i++)for(j=0;j&lt;3;j++)eqns[i+4*j]=this.elements[i+3*j];eqns[3]=b.x,eqns[7]=b.y,eqns[11]=b.z;var np,p,n=3,k=n;do{if(0===eqns[(i=k-n)+4*i])for(j=i+1;j&lt;k;j++)if(0!==eqns[i+4*j]){np=4;do{eqns[(p=4-np)+4*i]+=eqns[p+4*j]}while(--np);break}if(0!==eqns[i+4*i])for(j=i+1;j&lt;k;j++){var multiplier=eqns[i+4*j]/eqns[i+4*i];np=4;do{eqns[(p=4-np)+4*j]=p&lt;=i?0:eqns[p+4*j]-eqns[p+4*i]*multiplier}while(--np)}}while(--n);if(target.z=eqns[11]/eqns[10],target.y=(eqns[7]-eqns[6]*target.z)/eqns[5],target.x=(eqns[3]-eqns[2]*target.z-eqns[1]*target.y)/eqns[0],isNaN(target.x)||isNaN(target.y)||isNaN(target.z)||target.x===1/0||target.y===1/0||target.z===1/0)throw&quot;Could not solve equation! Got x=[&quot;+target.toString()+&quot;], b=[&quot;+b.toString()+&quot;], A=[&quot;+this.toString()+&quot;]&quot;;return target},_proto.e=function(row,column,value){if(void 0===value)return this.elements[column+3*row];this.elements[column+3*row]=value},_proto.copy=function(matrix){for(var i=0;i&lt;matrix.elements.length;i++)this.elements[i]=matrix.elements[i];return this},_proto.toString=function(){for(var r=&quot;&quot;,i=0;i&lt;9;i++)r+=this.elements[i]+&quot;,&quot;;return r},_proto.reverse=function(target){void 0===target&amp;&amp;(target=new Mat3);var i,j,eqns=[];for(i=0;i&lt;18;i++)eqns.push(0);for(i=0;i&lt;3;i++)for(j=0;j&lt;3;j++)eqns[i+6*j]=this.elements[i+3*j];eqns[3]=1,eqns[9]=0,eqns[15]=0,eqns[4]=0,eqns[10]=1,eqns[16]=0,eqns[5]=0,eqns[11]=0,eqns[17]=1;var np,p,n=3,k=n;do{if(0===eqns[(i=k-n)+6*i])for(j=i+1;j&lt;k;j++)if(0!==eqns[i+6*j]){np=6;do{eqns[(p=6-np)+6*i]+=eqns[p+6*j]}while(--np);break}if(0!==eqns[i+6*i])for(j=i+1;j&lt;k;j++){var multiplier=eqns[i+6*j]/eqns[i+6*i];np=6;do{eqns[(p=6-np)+6*j]=p&lt;=i?0:eqns[p+6*j]-eqns[p+6*i]*multiplier}while(--np)}}while(--n);i=2;do{j=i-1;do{var _multiplier=eqns[i+6*j]/eqns[i+6*i];np=6;do{eqns[(p=6-np)+6*j]=eqns[p+6*j]-eqns[p+6*i]*_multiplier}while(--np)}while(j--)}while(--i);i=2;do{var _multiplier2=1/eqns[i+6*i];np=6;do{eqns[(p=6-np)+6*i]=eqns[p+6*i]*_multiplier2}while(--np)}while(i--);i=2;do{j=2;do{if(p=eqns[3+j+6*i],isNaN(p)||p===1/0)throw&quot;Could not reverse! A=[&quot;+this.toString()+&quot;]&quot;;target.e(i,j,p)}while(j--)}while(i--);return target},_proto.setRotationFromQuaternion=function(q){var x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,e=this.elements;return e[0]=1-(yy+zz),e[1]=xy-wz,e[2]=xz+wy,e[3]=xy+wz,e[4]=1-(xx+zz),e[5]=yz-wx,e[6]=xz-wy,e[7]=yz+wx,e[8]=1-(xx+yy),this},_proto.transpose=function(target){void 0===target&amp;&amp;(target=new Mat3);for(var Mt=target.elements,M=this.elements,i=0;3!==i;i++)for(var j=0;3!==j;j++)Mt[3*i+j]=M[3*j+i];return target},Mat3}(),Vec3=function(){function Vec3(x,y,z){void 0===x&amp;&amp;(x=0),void 0===y&amp;&amp;(y=0),void 0===z&amp;&amp;(z=0),this.x=x,this.y=y,this.z=z}var _proto=Vec3.prototype;return _proto.cross=function(vector,target){void 0===target&amp;&amp;(target=new Vec3);var vx=vector.x,vy=vector.y,vz=vector.z,x=this.x,y=this.y,z=this.z;return target.x=y*vz-z*vy,target.y=z*vx-x*vz,target.z=x*vy-y*vx,target},_proto.set=function(x,y,z){return this.x=x,this.y=y,this.z=z,this},_proto.setZero=function(){this.x=this.y=this.z=0},_proto.vadd=function(vector,target){if(!target)return new Vec3(this.x+vector.x,this.y+vector.y,this.z+vector.z);target.x=vector.x+this.x,target.y=vector.y+this.y,target.z=vector.z+this.z},_proto.vsub=function(vector,target){if(!target)return new Vec3(this.x-vector.x,this.y-vector.y,this.z-vector.z);target.x=this.x-vector.x,target.y=this.y-vector.y,target.z=this.z-vector.z},_proto.crossmat=function(){return new Mat3([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},_proto.normalize=function(){var x=this.x,y=this.y,z=this.z,n=Math.sqrt(x*x+y*y+z*z);if(n&gt;0){var invN=1/n;this.x*=invN,this.y*=invN,this.z*=invN}else this.x=0,this.y=0,this.z=0;return n},_proto.unit=function(target){void 0===target&amp;&amp;(target=new Vec3);var x=this.x,y=this.y,z=this.z,ninv=Math.sqrt(x*x+y*y+z*z);return ninv&gt;0?(ninv=1/ninv,target.x=x*ninv,target.y=y*ninv,target.z=z*ninv):(target.x=1,target.y=0,target.z=0),target},_proto.length=function(){var x=this.x,y=this.y,z=this.z;return Math.sqrt(x*x+y*y+z*z)},_proto.lengthSquared=function(){return this.dot(this)},_proto.distanceTo=function(p){var x=this.x,y=this.y,z=this.z,px=p.x,py=p.y,pz=p.z;return Math.sqrt((px-x)*(px-x)+(py-y)*(py-y)+(pz-z)*(pz-z))},_proto.distanceSquared=function(p){var x=this.x,y=this.y,z=this.z,px=p.x,py=p.y,pz=p.z;return(px-x)*(px-x)+(py-y)*(py-y)+(pz-z)*(pz-z)},_proto.scale=function(scalar,target){void 0===target&amp;&amp;(target=new Vec3);var x=this.x,y=this.y,z=this.z;return target.x=scalar*x,target.y=scalar*y,target.z=scalar*z,target},_proto.vmul=function(vector,target){return void 0===target&amp;&amp;(target=new Vec3),target.x=vector.x*this.x,target.y=vector.y*this.y,target.z=vector.z*this.z,target},_proto.addScaledVector=function(scalar,vector,target){return void 0===target&amp;&amp;(target=new Vec3),target.x=this.x+scalar*vector.x,target.y=this.y+scalar*vector.y,target.z=this.z+scalar*vector.z,target},_proto.dot=function(vector){return this.x*vector.x+this.y*vector.y+this.z*vector.z},_proto.isZero=function(){return 0===this.x&amp;&amp;0===this.y&amp;&amp;0===this.z},_proto.negate=function(target){return void 0===target&amp;&amp;(target=new Vec3),target.x=-this.x,target.y=-this.y,target.z=-this.z,target},_proto.tangents=function(t1,t2){var norm=this.length();if(norm&gt;0){var n=Vec3_tangents_n,inorm=1/norm;n.set(this.x*inorm,this.y*inorm,this.z*inorm);var randVec=Vec3_tangents_randVec;Math.abs(n.x)&lt;.9?(randVec.set(1,0,0),n.cross(randVec,t1)):(randVec.set(0,1,0),n.cross(randVec,t1)),n.cross(t1,t2)}else t1.set(1,0,0),t2.set(0,1,0)},_proto.toString=function(){return this.x+&quot;,&quot;+this.y+&quot;,&quot;+this.z},_proto.toArray=function(){return[this.x,this.y,this.z]},_proto.copy=function(vector){return this.x=vector.x,this.y=vector.y,this.z=vector.z,this},_proto.lerp=function(vector,t,target){var x=this.x,y=this.y,z=this.z;target.x=x+(vector.x-x)*t,target.y=y+(vector.y-y)*t,target.z=z+(vector.z-z)*t},_proto.almostEquals=function(vector,precision){return void 0===precision&amp;&amp;(precision=1e-6),!(Math.abs(this.x-vector.x)&gt;precision||Math.abs(this.y-vector.y)&gt;precision||Math.abs(this.z-vector.z)&gt;precision)},_proto.almostZero=function(precision){return void 0===precision&amp;&amp;(precision=1e-6),!(Math.abs(this.x)&gt;precision||Math.abs(this.y)&gt;precision||Math.abs(this.z)&gt;precision)},_proto.isAntiparallelTo=function(vector,precision){return this.negate(antip_neg),antip_neg.almostEquals(vector,precision)},_proto.clone=function(){return new Vec3(this.x,this.y,this.z)},Vec3}();Vec3.ZERO=new Vec3(0,0,0),Vec3.UNIT_X=new Vec3(1,0,0),Vec3.UNIT_Y=new Vec3(0,1,0),Vec3.UNIT_Z=new Vec3(0,0,1);var Vec3_tangents_n=new Vec3,Vec3_tangents_randVec=new Vec3,antip_neg=new Vec3,AABB=function(){function AABB(options){void 0===options&amp;&amp;(options={}),this.lowerBound=new Vec3,this.upperBound=new Vec3,options.lowerBound&amp;&amp;this.lowerBound.copy(options.lowerBound),options.upperBound&amp;&amp;this.upperBound.copy(options.upperBound)}var _proto=AABB.prototype;return _proto.setFromPoints=function(points,position,quaternion,skinSize){var l=this.lowerBound,u=this.upperBound,q=quaternion;l.copy(points[0]),q&amp;&amp;q.vmult(l,l),u.copy(l);for(var i=1;i&lt;points.length;i++){var p=points[i];q&amp;&amp;(q.vmult(p,tmp),p=tmp),p.x&gt;u.x&amp;&amp;(u.x=p.x),p.x&lt;l.x&amp;&amp;(l.x=p.x),p.y&gt;u.y&amp;&amp;(u.y=p.y),p.y&lt;l.y&amp;&amp;(l.y=p.y),p.z&gt;u.z&amp;&amp;(u.z=p.z),p.z&lt;l.z&amp;&amp;(l.z=p.z)}return position&amp;&amp;(position.vadd(l,l),position.vadd(u,u)),skinSize&amp;&amp;(l.x-=skinSize,l.y-=skinSize,l.z-=skinSize,u.x+=skinSize,u.y+=skinSize,u.z+=skinSize),this},_proto.copy=function(aabb){return this.lowerBound.copy(aabb.lowerBound),this.upperBound.copy(aabb.upperBound),this},_proto.clone=function(){return(new AABB).copy(this)},_proto.extend=function(aabb){this.lowerBound.x=Math.min(this.lowerBound.x,aabb.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,aabb.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,aabb.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,aabb.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,aabb.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,aabb.upperBound.z)},_proto.overlaps=function(aabb){var l1=this.lowerBound,u1=this.upperBound,l2=aabb.lowerBound,u2=aabb.upperBound,overlapsX=l2.x&lt;=u1.x&amp;&amp;u1.x&lt;=u2.x||l1.x&lt;=u2.x&amp;&amp;u2.x&lt;=u1.x,overlapsY=l2.y&lt;=u1.y&amp;&amp;u1.y&lt;=u2.y||l1.y&lt;=u2.y&amp;&amp;u2.y&lt;=u1.y,overlapsZ=l2.z&lt;=u1.z&amp;&amp;u1.z&lt;=u2.z||l1.z&lt;=u2.z&amp;&amp;u2.z&lt;=u1.z;return overlapsX&amp;&amp;overlapsY&amp;&amp;overlapsZ},_proto.volume=function(){var l=this.lowerBound,u=this.upperBound;return(u.x-l.x)*(u.y-l.y)*(u.z-l.z)},_proto.contains=function(aabb){var l1=this.lowerBound,u1=this.upperBound,l2=aabb.lowerBound,u2=aabb.upperBound;return l1.x&lt;=l2.x&amp;&amp;u1.x&gt;=u2.x&amp;&amp;l1.y&lt;=l2.y&amp;&amp;u1.y&gt;=u2.y&amp;&amp;l1.z&lt;=l2.z&amp;&amp;u1.z&gt;=u2.z},_proto.getCorners=function(a,b,c,d,e,f,g,h){var l=this.lowerBound,u=this.upperBound;a.copy(l),b.set(u.x,l.y,l.z),c.set(u.x,u.y,l.z),d.set(l.x,u.y,u.z),e.set(u.x,l.y,u.z),f.set(l.x,u.y,l.z),g.set(l.x,l.y,u.z),h.copy(u)},_proto.toLocalFrame=function(frame,target){var corners=transformIntoFrame_corners,a=corners[0],b=corners[1],c=corners[2],d=corners[3],e=corners[4],f=corners[5],g=corners[6],h=corners[7];this.getCorners(a,b,c,d,e,f,g,h);for(var i=0;8!==i;i++){var corner=corners[i];frame.pointToLocal(corner,corner)}return target.setFromPoints(corners)},_proto.toWorldFrame=function(frame,target){var corners=transformIntoFrame_corners,a=corners[0],b=corners[1],c=corners[2],d=corners[3],e=corners[4],f=corners[5],g=corners[6],h=corners[7];this.getCorners(a,b,c,d,e,f,g,h);for(var i=0;8!==i;i++){var corner=corners[i];frame.pointToWorld(corner,corner)}return target.setFromPoints(corners)},_proto.overlapsRay=function(ray){var direction=ray.direction,from=ray.from,dirFracX=1/direction.x,dirFracY=1/direction.y,dirFracZ=1/direction.z,t1=(this.lowerBound.x-from.x)*dirFracX,t2=(this.upperBound.x-from.x)*dirFracX,t3=(this.lowerBound.y-from.y)*dirFracY,t4=(this.upperBound.y-from.y)*dirFracY,t5=(this.lowerBound.z-from.z)*dirFracZ,t6=(this.upperBound.z-from.z)*dirFracZ,tmin=Math.max(Math.max(Math.min(t1,t2),Math.min(t3,t4)),Math.min(t5,t6)),tmax=Math.min(Math.min(Math.max(t1,t2),Math.max(t3,t4)),Math.max(t5,t6));return!(tmax&lt;0)&amp;&amp;!(tmin&gt;tmax)},AABB}(),tmp=new Vec3,transformIntoFrame_corners=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],ArrayCollisionMatrix=function(){function ArrayCollisionMatrix(){this.matrix=[]}var _proto=ArrayCollisionMatrix.prototype;return _proto.get=function(bi,bj){var i=bi.index,j=bj.index;if(j&gt;i){var temp=j;j=i,i=temp}return this.matrix[(i*(i+1)&gt;&gt;1)+j-1]},_proto.set=function(bi,bj,value){var i=bi.index,j=bj.index;if(j&gt;i){var temp=j;j=i,i=temp}this.matrix[(i*(i+1)&gt;&gt;1)+j-1]=value?1:0},_proto.reset=function(){for(var i=0,l=this.matrix.length;i!==l;i++)this.matrix[i]=0},_proto.setNumObjects=function(n){this.matrix.length=n*(n-1)&gt;&gt;1},ArrayCollisionMatrix}();function _inheritsLoose(subClass,superClass){subClass.prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError(&quot;this hasn&#39;t been initialised - super() hasn&#39;t been called&quot;);return self}var EventTarget=function(){function EventTarget(){}var _proto=EventTarget.prototype;return _proto.addEventListener=function(type,listener){void 0===this._listeners&amp;&amp;(this._listeners={});var listeners=this._listeners;return void 0===listeners[type]&amp;&amp;(listeners[type]=[]),listeners[type].includes(listener)||listeners[type].push(listener),this},_proto.hasEventListener=function(type,listener){if(void 0===this._listeners)return!1;var listeners=this._listeners;return!(void 0===listeners[type]||!listeners[type].includes(listener))},_proto.hasAnyEventListener=function(type){return void 0!==this._listeners&amp;&amp;void 0!==this._listeners[type]},_proto.removeEventListener=function(type,listener){if(void 0===this._listeners)return this;var listeners=this._listeners;if(void 0===listeners[type])return this;var index=listeners[type].indexOf(listener);return-1!==index&amp;&amp;listeners[type].splice(index,1),this},_proto.dispatchEvent=function(event){if(void 0===this._listeners)return this;var listenerArray=this._listeners[event.type];if(void 0!==listenerArray){event.target=this;for(var i=0,l=listenerArray.length;i&lt;l;i++)listenerArray[i].call(this,event)}return this},EventTarget}(),Quaternion=function(){function Quaternion(x,y,z,w){void 0===x&amp;&amp;(x=0),void 0===y&amp;&amp;(y=0),void 0===z&amp;&amp;(z=0),void 0===w&amp;&amp;(w=1),this.x=x,this.y=y,this.z=z,this.w=w}var _proto=Quaternion.prototype;return _proto.set=function(x,y,z,w){return this.x=x,this.y=y,this.z=z,this.w=w,this},_proto.toString=function(){return this.x+&quot;,&quot;+this.y+&quot;,&quot;+this.z+&quot;,&quot;+this.w},_proto.toArray=function(){return[this.x,this.y,this.z,this.w]},_proto.setFromAxisAngle=function(vector,angle){var s=Math.sin(.5*angle);return this.x=vector.x*s,this.y=vector.y*s,this.z=vector.z*s,this.w=Math.cos(.5*angle),this},_proto.toAxisAngle=function(targetAxis){void 0===targetAxis&amp;&amp;(targetAxis=new Vec3),this.normalize();var angle=2*Math.acos(this.w),s=Math.sqrt(1-this.w*this.w);return s&lt;.001?(targetAxis.x=this.x,targetAxis.y=this.y,targetAxis.z=this.z):(targetAxis.x=this.x/s,targetAxis.y=this.y/s,targetAxis.z=this.z/s),[targetAxis,angle]},_proto.setFromVectors=function(u,v){if(u.isAntiparallelTo(v)){var t1=sfv_t1,t2=sfv_t2;u.tangents(t1,t2),this.setFromAxisAngle(t1,Math.PI)}else{var a=u.cross(v);this.x=a.x,this.y=a.y,this.z=a.z,this.w=Math.sqrt(Math.pow(u.length(),2)*Math.pow(v.length(),2))+u.dot(v),this.normalize()}return this},_proto.mult=function(quat,target){void 0===target&amp;&amp;(target=new Quaternion);var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=quat.x,by=quat.y,bz=quat.z,bw=quat.w;return target.x=ax*bw+aw*bx+ay*bz-az*by,target.y=ay*bw+aw*by+az*bx-ax*bz,target.z=az*bw+aw*bz+ax*by-ay*bx,target.w=aw*bw-ax*bx-ay*by-az*bz,target},_proto.inverse=function(target){void 0===target&amp;&amp;(target=new Quaternion);var x=this.x,y=this.y,z=this.z,w=this.w;this.conjugate(target);var inorm2=1/(x*x+y*y+z*z+w*w);return target.x*=inorm2,target.y*=inorm2,target.z*=inorm2,target.w*=inorm2,target},_proto.conjugate=function(target){return void 0===target&amp;&amp;(target=new Quaternion),target.x=-this.x,target.y=-this.y,target.z=-this.z,target.w=this.w,target},_proto.normalize=function(){var l=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return 0===l?(this.x=0,this.y=0,this.z=0,this.w=0):(l=1/l,this.x*=l,this.y*=l,this.z*=l,this.w*=l),this},_proto.normalizeFast=function(){var f=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return 0===f?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=f,this.y*=f,this.z*=f,this.w*=f),this},_proto.vmult=function(v,target){void 0===target&amp;&amp;(target=new Vec3);var x=v.x,y=v.y,z=v.z,qx=this.x,qy=this.y,qz=this.z,qw=this.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return target.x=ix*qw+iw*-qx+iy*-qz-iz*-qy,target.y=iy*qw+iw*-qy+iz*-qx-ix*-qz,target.z=iz*qw+iw*-qz+ix*-qy-iy*-qx,target},_proto.copy=function(quat){return this.x=quat.x,this.y=quat.y,this.z=quat.z,this.w=quat.w,this},_proto.toEuler=function(target,order){var heading,attitude,bank;void 0===order&amp;&amp;(order=&quot;YZX&quot;);var x=this.x,y=this.y,z=this.z,w=this.w;switch(order){case&quot;YZX&quot;:var test=x*y+z*w;if(test&gt;.499&amp;&amp;(heading=2*Math.atan2(x,w),attitude=Math.PI/2,bank=0),test&lt;-.499&amp;&amp;(heading=-2*Math.atan2(x,w),attitude=-Math.PI/2,bank=0),void 0===heading){var sqx=x*x,sqy=y*y,sqz=z*z;heading=Math.atan2(2*y*w-2*x*z,1-2*sqy-2*sqz),attitude=Math.asin(2*test),bank=Math.atan2(2*x*w-2*y*z,1-2*sqx-2*sqz)}break;default:throw new Error(&quot;Euler order &quot;+order+&quot; not supported yet.&quot;)}target.y=heading,target.z=attitude,target.x=bank},_proto.setFromEuler=function(x,y,z,order){void 0===order&amp;&amp;(order=&quot;XYZ&quot;);var c1=Math.cos(x/2),c2=Math.cos(y/2),c3=Math.cos(z/2),s1=Math.sin(x/2),s2=Math.sin(y/2),s3=Math.sin(z/2);return&quot;XYZ&quot;===order?(this.x=s1*c2*c3+c1*s2*s3,this.y=c1*s2*c3-s1*c2*s3,this.z=c1*c2*s3+s1*s2*c3,this.w=c1*c2*c3-s1*s2*s3):&quot;YXZ&quot;===order?(this.x=s1*c2*c3+c1*s2*s3,this.y=c1*s2*c3-s1*c2*s3,this.z=c1*c2*s3-s1*s2*c3,this.w=c1*c2*c3+s1*s2*s3):&quot;ZXY&quot;===order?(this.x=s1*c2*c3-c1*s2*s3,this.y=c1*s2*c3+s1*c2*s3,this.z=c1*c2*s3+s1*s2*c3,this.w=c1*c2*c3-s1*s2*s3):&quot;ZYX&quot;===order?(this.x=s1*c2*c3-c1*s2*s3,this.y=c1*s2*c3+s1*c2*s3,this.z=c1*c2*s3-s1*s2*c3,this.w=c1*c2*c3+s1*s2*s3):&quot;YZX&quot;===order?(this.x=s1*c2*c3+c1*s2*s3,this.y=c1*s2*c3+s1*c2*s3,this.z=c1*c2*s3-s1*s2*c3,this.w=c1*c2*c3-s1*s2*s3):&quot;XZY&quot;===order&amp;&amp;(this.x=s1*c2*c3-c1*s2*s3,this.y=c1*s2*c3-s1*c2*s3,this.z=c1*c2*s3+s1*s2*c3,this.w=c1*c2*c3+s1*s2*s3),this},_proto.clone=function(){return new Quaternion(this.x,this.y,this.z,this.w)},_proto.slerp=function(toQuat,t,target){void 0===target&amp;&amp;(target=new Quaternion);var omega,cosom,sinom,scale0,scale1,ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=toQuat.x,by=toQuat.y,bz=toQuat.z,bw=toQuat.w;return(cosom=ax*bx+ay*by+az*bz+aw*bw)&lt;0&amp;&amp;(cosom=-cosom,bx=-bx,by=-by,bz=-bz,bw=-bw),1-cosom&gt;1e-6?(omega=Math.acos(cosom),sinom=Math.sin(omega),scale0=Math.sin((1-t)*omega)/sinom,scale1=Math.sin(t*omega)/sinom):(scale0=1-t,scale1=t),target.x=scale0*ax+scale1*bx,target.y=scale0*ay+scale1*by,target.z=scale0*az+scale1*bz,target.w=scale0*aw+scale1*bw,target},_proto.integrate=function(angularVelocity,dt,angularFactor,target){void 0===target&amp;&amp;(target=new Quaternion);var ax=angularVelocity.x*angularFactor.x,ay=angularVelocity.y*angularFactor.y,az=angularVelocity.z*angularFactor.z,bx=this.x,by=this.y,bz=this.z,bw=this.w,half_dt=.5*dt;return target.x+=half_dt*(ax*bw+ay*bz-az*by),target.y+=half_dt*(ay*bw+az*bx-ax*bz),target.z+=half_dt*(az*bw+ax*by-ay*bx),target.w+=half_dt*(-ax*bx-ay*by-az*bz),target},Quaternion}(),sfv_t1=new Vec3,sfv_t2=new Vec3,SHAPE_TYPES={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256},Shape=function(){function Shape(options){void 0===options&amp;&amp;(options={}),this.id=Shape.idCounter++,this.type=options.type||0,this.boundingSphereRadius=0,this.collisionResponse=!options.collisionResponse||options.collisionResponse,this.collisionFilterGroup=void 0!==options.collisionFilterGroup?options.collisionFilterGroup:1,this.collisionFilterMask=void 0!==options.collisionFilterMask?options.collisionFilterMask:-1,this.material=options.material?options.material:null,this.body=null}var _proto=Shape.prototype;return _proto.updateBoundingSphereRadius=function(){throw&quot;computeBoundingSphereRadius() not implemented for shape type &quot;+this.type},_proto.volume=function(){throw&quot;volume() not implemented for shape type &quot;+this.type},_proto.calculateLocalInertia=function(mass,target){throw&quot;calculateLocalInertia() not implemented for shape type &quot;+this.type},_proto.calculateWorldAABB=function(pos,quat,min,max){throw&quot;calculateWorldAABB() not implemented for shape type &quot;+this.type},Shape}();Shape.idCounter=0,Shape.types=SHAPE_TYPES;var Transform=function(){function Transform(options){void 0===options&amp;&amp;(options={}),this.position=new Vec3,this.quaternion=new Quaternion,options.position&amp;&amp;this.position.copy(options.position),options.quaternion&amp;&amp;this.quaternion.copy(options.quaternion)}var _proto=Transform.prototype;return _proto.pointToLocal=function(worldPoint,result){return Transform.pointToLocalFrame(this.position,this.quaternion,worldPoint,result)},_proto.pointToWorld=function(localPoint,result){return Transform.pointToWorldFrame(this.position,this.quaternion,localPoint,result)},_proto.vectorToWorldFrame=function(localVector,result){return void 0===result&amp;&amp;(result=new Vec3),this.quaternion.vmult(localVector,result),result},Transform.pointToLocalFrame=function(position,quaternion,worldPoint,result){return void 0===result&amp;&amp;(result=new Vec3),worldPoint.vsub(position,result),quaternion.conjugate(tmpQuat),tmpQuat.vmult(result,result),result},Transform.pointToWorldFrame=function(position,quaternion,localPoint,result){return void 0===result&amp;&amp;(result=new Vec3),quaternion.vmult(localPoint,result),result.vadd(position,result),result},Transform.vectorToWorldFrame=function(quaternion,localVector,result){return void 0===result&amp;&amp;(result=new Vec3),quaternion.vmult(localVector,result),result},Transform.vectorToLocalFrame=function(position,quaternion,worldVector,result){return void 0===result&amp;&amp;(result=new Vec3),quaternion.w*=-1,quaternion.vmult(worldVector,result),quaternion.w*=-1,result},Transform}(),tmpQuat=new Quaternion,ConvexPolyhedron=function(_Shape){function ConvexPolyhedron(props){var _this;void 0===props&amp;&amp;(props={});var _props=props,_props$vertices=_props.vertices,vertices=void 0===_props$vertices?[]:_props$vertices,_props$faces=_props.faces,faces=void 0===_props$faces?[]:_props$faces,_props$normals=_props.normals,normals=void 0===_props$normals?[]:_props$normals,axes=_props.axes,boundingSphereRadius=_props.boundingSphereRadius;return(_this=_Shape.call(this,{type:Shape.types.CONVEXPOLYHEDRON})||this).vertices=vertices,_this.faces=faces,_this.faceNormals=normals,0===_this.faceNormals.length&amp;&amp;_this.computeNormals(),boundingSphereRadius?_this.boundingSphereRadius=boundingSphereRadius:_this.updateBoundingSphereRadius(),_this.worldVertices=[],_this.worldVerticesNeedsUpdate=!0,_this.worldFaceNormals=[],_this.worldFaceNormalsNeedsUpdate=!0,_this.uniqueAxes=axes?axes.slice():null,_this.uniqueEdges=[],_this.computeEdges(),_this}_inheritsLoose(ConvexPolyhedron,_Shape);var _proto=ConvexPolyhedron.prototype;return _proto.computeEdges=function(){var faces=this.faces,vertices=this.vertices,edges=this.uniqueEdges;edges.length=0;for(var edge=new Vec3,i=0;i!==faces.length;i++)for(var face=faces[i],numVertices=face.length,j=0;j!==numVertices;j++){var k=(j+1)%numVertices;vertices[face[j]].vsub(vertices[face[k]],edge),edge.normalize();for(var found=!1,p=0;p!==edges.length;p++)if(edges[p].almostEquals(edge)||edges[p].almostEquals(edge)){found=!0;break}found||edges.push(edge.clone())}},_proto.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var i=0;i&lt;this.faces.length;i++){for(var j=0;j&lt;this.faces[i].length;j++)if(!this.vertices[this.faces[i][j]])throw new Error(&quot;Vertex &quot;+this.faces[i][j]+&quot; not found!&quot;);var n=this.faceNormals[i]||new Vec3;this.getFaceNormal(i,n),n.negate(n),this.faceNormals[i]=n;var vertex=this.vertices[this.faces[i][0]];if(n.dot(vertex)&lt;0){console.error(&quot;.faceNormals[&quot;+i+&quot;] = Vec3(&quot;+n.toString()+&quot;) looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule.&quot;);for(var _j=0;_j&lt;this.faces[i].length;_j++)console.warn(&quot;.vertices[&quot;+this.faces[i][_j]+&quot;] = Vec3(&quot;+this.vertices[this.faces[i][_j]].toString()+&quot;)&quot;)}}},_proto.getFaceNormal=function(i,target){var f=this.faces[i],va=this.vertices[f[0]],vb=this.vertices[f[1]],vc=this.vertices[f[2]];ConvexPolyhedron.computeNormal(va,vb,vc,target)},_proto.clipAgainstHull=function(posA,quatA,hullB,posB,quatB,separatingNormal,minDist,maxDist,result){for(var WorldNormal=new Vec3,closestFaceB=-1,dmax=-Number.MAX_VALUE,face=0;face&lt;hullB.faces.length;face++){WorldNormal.copy(hullB.faceNormals[face]),quatB.vmult(WorldNormal,WorldNormal);var d=WorldNormal.dot(separatingNormal);d&gt;dmax&amp;&amp;(dmax=d,closestFaceB=face)}for(var worldVertsB1=[],i=0;i&lt;hullB.faces[closestFaceB].length;i++){var b=hullB.vertices[hullB.faces[closestFaceB][i]],worldb=new Vec3;worldb.copy(b),quatB.vmult(worldb,worldb),posB.vadd(worldb,worldb),worldVertsB1.push(worldb)}closestFaceB&gt;=0&amp;&amp;this.clipFaceAgainstHull(separatingNormal,posA,quatA,worldVertsB1,minDist,maxDist,result)},_proto.findSeparatingAxis=function(hullB,posA,quatA,posB,quatB,target,faceListA,faceListB){var faceANormalWS3=new Vec3,Worldnormal1=new Vec3,deltaC=new Vec3,worldEdge0=new Vec3,worldEdge1=new Vec3,Cross=new Vec3,dmin=Number.MAX_VALUE;if(this.uniqueAxes)for(var _i=0;_i!==this.uniqueAxes.length;_i++){quatA.vmult(this.uniqueAxes[_i],faceANormalWS3);var _d=this.testSepAxis(faceANormalWS3,hullB,posA,quatA,posB,quatB);if(!1===_d)return!1;_d&lt;dmin&amp;&amp;(dmin=_d,target.copy(faceANormalWS3))}else for(var numFacesA=faceListA?faceListA.length:this.faces.length,i=0;i&lt;numFacesA;i++){var fi=faceListA?faceListA[i]:i;faceANormalWS3.copy(this.faceNormals[fi]),quatA.vmult(faceANormalWS3,faceANormalWS3);var d=this.testSepAxis(faceANormalWS3,hullB,posA,quatA,posB,quatB);if(!1===d)return!1;d&lt;dmin&amp;&amp;(dmin=d,target.copy(faceANormalWS3))}if(hullB.uniqueAxes)for(var _i3=0;_i3!==hullB.uniqueAxes.length;_i3++){quatB.vmult(hullB.uniqueAxes[_i3],Worldnormal1);var _d3=this.testSepAxis(Worldnormal1,hullB,posA,quatA,posB,quatB);if(!1===_d3)return!1;_d3&lt;dmin&amp;&amp;(dmin=_d3,target.copy(Worldnormal1))}else for(var numFacesB=faceListB?faceListB.length:hullB.faces.length,_i2=0;_i2&lt;numFacesB;_i2++){var _fi=faceListB?faceListB[_i2]:_i2;Worldnormal1.copy(hullB.faceNormals[_fi]),quatB.vmult(Worldnormal1,Worldnormal1);var _d2=this.testSepAxis(Worldnormal1,hullB,posA,quatA,posB,quatB);if(!1===_d2)return!1;_d2&lt;dmin&amp;&amp;(dmin=_d2,target.copy(Worldnormal1))}for(var e0=0;e0!==this.uniqueEdges.length;e0++){quatA.vmult(this.uniqueEdges[e0],worldEdge0);for(var e1=0;e1!==hullB.uniqueEdges.length;e1++)if(quatB.vmult(hullB.uniqueEdges[e1],worldEdge1),worldEdge0.cross(worldEdge1,Cross),!Cross.almostZero()){Cross.normalize();var dist=this.testSepAxis(Cross,hullB,posA,quatA,posB,quatB);if(!1===dist)return!1;dist&lt;dmin&amp;&amp;(dmin=dist,target.copy(Cross))}}return posB.vsub(posA,deltaC),deltaC.dot(target)&gt;0&amp;&amp;target.negate(target),!0},_proto.testSepAxis=function(axis,hullB,posA,quatA,posB,quatB){ConvexPolyhedron.project(this,axis,posA,quatA,maxminA),ConvexPolyhedron.project(hullB,axis,posB,quatB,maxminB);var maxA=maxminA[0],minA=maxminA[1],maxB=maxminB[0],minB=maxminB[1];if(maxA&lt;minB||maxB&lt;minA)return!1;var d0=maxA-minB,d1=maxB-minA;return d0&lt;d1?d0:d1},_proto.calculateLocalInertia=function(mass,target){var aabbmax=new Vec3,aabbmin=new Vec3;this.computeLocalAABB(aabbmin,aabbmax);var x=aabbmax.x-aabbmin.x,y=aabbmax.y-aabbmin.y,z=aabbmax.z-aabbmin.z;target.x=1/12*mass*(2*y*2*y+2*z*2*z),target.y=1/12*mass*(2*x*2*x+2*z*2*z),target.z=1/12*mass*(2*y*2*y+2*x*2*x)},_proto.getPlaneConstantOfFace=function(face_i){var f=this.faces[face_i],n=this.faceNormals[face_i],v=this.vertices[f[0]];return-n.dot(v)},_proto.clipFaceAgainstHull=function(separatingNormal,posA,quatA,worldVertsB1,minDist,maxDist,result){for(var faceANormalWS=new Vec3,edge0=new Vec3,WorldEdge0=new Vec3,worldPlaneAnormal1=new Vec3,planeNormalWS1=new Vec3,worldA1=new Vec3,localPlaneNormal=new Vec3,planeNormalWS=new Vec3,pVtxIn=worldVertsB1,pVtxOut=[],closestFaceA=-1,dmin=Number.MAX_VALUE,face=0;face&lt;this.faces.length;face++){faceANormalWS.copy(this.faceNormals[face]),quatA.vmult(faceANormalWS,faceANormalWS);var d=faceANormalWS.dot(separatingNormal);d&lt;dmin&amp;&amp;(dmin=d,closestFaceA=face)}if(!(closestFaceA&lt;0)){var polyA=this.faces[closestFaceA];polyA.connectedFaces=[];for(var i=0;i&lt;this.faces.length;i++)for(var j=0;j&lt;this.faces[i].length;j++)-1!==polyA.indexOf(this.faces[i][j])&amp;&amp;i!==closestFaceA&amp;&amp;-1===polyA.connectedFaces.indexOf(i)&amp;&amp;polyA.connectedFaces.push(i);for(var numVerticesA=polyA.length,_i4=0;_i4&lt;numVerticesA;_i4++){var a=this.vertices[polyA[_i4]],b=this.vertices[polyA[(_i4+1)%numVerticesA]];a.vsub(b,edge0),WorldEdge0.copy(edge0),quatA.vmult(WorldEdge0,WorldEdge0),posA.vadd(WorldEdge0,WorldEdge0),worldPlaneAnormal1.copy(this.faceNormals[closestFaceA]),quatA.vmult(worldPlaneAnormal1,worldPlaneAnormal1),posA.vadd(worldPlaneAnormal1,worldPlaneAnormal1),WorldEdge0.cross(worldPlaneAnormal1,planeNormalWS1),planeNormalWS1.negate(planeNormalWS1),worldA1.copy(a),quatA.vmult(worldA1,worldA1),posA.vadd(worldA1,worldA1);var otherFace=polyA.connectedFaces[_i4];localPlaneNormal.copy(this.faceNormals[otherFace]);var _localPlaneEq=this.getPlaneConstantOfFace(otherFace);planeNormalWS.copy(localPlaneNormal),quatA.vmult(planeNormalWS,planeNormalWS);var _planeEqWS=_localPlaneEq-planeNormalWS.dot(posA);for(this.clipFaceAgainstPlane(pVtxIn,pVtxOut,planeNormalWS,_planeEqWS);pVtxIn.length;)pVtxIn.shift();for(;pVtxOut.length;)pVtxIn.push(pVtxOut.shift())}localPlaneNormal.copy(this.faceNormals[closestFaceA]);var localPlaneEq=this.getPlaneConstantOfFace(closestFaceA);planeNormalWS.copy(localPlaneNormal),quatA.vmult(planeNormalWS,planeNormalWS);for(var planeEqWS=localPlaneEq-planeNormalWS.dot(posA),_i5=0;_i5&lt;pVtxIn.length;_i5++){var depth=planeNormalWS.dot(pVtxIn[_i5])+planeEqWS;if(depth&lt;=minDist&amp;&amp;(console.log(&quot;clamped: depth=&quot;+depth+&quot; to minDist=&quot;+minDist),depth=minDist),depth&lt;=maxDist){var point=pVtxIn[_i5];if(depth&lt;=1e-6){var p={point:point,normal:planeNormalWS,depth:depth};result.push(p)}}}}},_proto.clipFaceAgainstPlane=function(inVertices,outVertices,planeNormal,planeConstant){var n_dot_first,n_dot_last,numVerts=inVertices.length;if(numVerts&lt;2)return outVertices;var firstVertex=inVertices[inVertices.length-1],lastVertex=inVertices[0];n_dot_first=planeNormal.dot(firstVertex)+planeConstant;for(var vi=0;vi&lt;numVerts;vi++){if(lastVertex=inVertices[vi],n_dot_last=planeNormal.dot(lastVertex)+planeConstant,n_dot_first&lt;0)if(n_dot_last&lt;0){var newv=new Vec3;newv.copy(lastVertex),outVertices.push(newv)}else{var _newv=new Vec3;firstVertex.lerp(lastVertex,n_dot_first/(n_dot_first-n_dot_last),_newv),outVertices.push(_newv)}else if(n_dot_last&lt;0){var _newv2=new Vec3;firstVertex.lerp(lastVertex,n_dot_first/(n_dot_first-n_dot_last),_newv2),outVertices.push(_newv2),outVertices.push(lastVertex)}firstVertex=lastVertex,n_dot_first=n_dot_last}return outVertices},_proto.computeWorldVertices=function(position,quat){for(;this.worldVertices.length&lt;this.vertices.length;)this.worldVertices.push(new Vec3);for(var verts=this.vertices,worldVerts=this.worldVertices,i=0;i!==this.vertices.length;i++)quat.vmult(verts[i],worldVerts[i]),position.vadd(worldVerts[i],worldVerts[i]);this.worldVerticesNeedsUpdate=!1},_proto.computeLocalAABB=function(aabbmin,aabbmax){var vertices=this.vertices;aabbmin.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),aabbmax.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;i&lt;this.vertices.length;i++){var v=vertices[i];v.x&lt;aabbmin.x?aabbmin.x=v.x:v.x&gt;aabbmax.x&amp;&amp;(aabbmax.x=v.x),v.y&lt;aabbmin.y?aabbmin.y=v.y:v.y&gt;aabbmax.y&amp;&amp;(aabbmax.y=v.y),v.z&lt;aabbmin.z?aabbmin.z=v.z:v.z&gt;aabbmax.z&amp;&amp;(aabbmax.z=v.z)}},_proto.computeWorldFaceNormals=function(quat){for(var N=this.faceNormals.length;this.worldFaceNormals.length&lt;N;)this.worldFaceNormals.push(new Vec3);for(var normals=this.faceNormals,worldNormals=this.worldFaceNormals,i=0;i!==N;i++)quat.vmult(normals[i],worldNormals[i]);this.worldFaceNormalsNeedsUpdate=!1},_proto.updateBoundingSphereRadius=function(){for(var max2=0,verts=this.vertices,i=0;i!==verts.length;i++){var norm2=verts[i].lengthSquared();norm2&gt;max2&amp;&amp;(max2=norm2)}this.boundingSphereRadius=Math.sqrt(max2)},_proto.calculateWorldAABB=function(pos,quat,min,max){for(var minx,miny,minz,maxx,maxy,maxz,verts=this.vertices,tempWorldVertex=new Vec3,i=0;i&lt;verts.length;i++){tempWorldVertex.copy(verts[i]),quat.vmult(tempWorldVertex,tempWorldVertex),pos.vadd(tempWorldVertex,tempWorldVertex);var v=tempWorldVertex;(void 0===minx||v.x&lt;minx)&amp;&amp;(minx=v.x),(void 0===maxx||v.x&gt;maxx)&amp;&amp;(maxx=v.x),(void 0===miny||v.y&lt;miny)&amp;&amp;(miny=v.y),(void 0===maxy||v.y&gt;maxy)&amp;&amp;(maxy=v.y),(void 0===minz||v.z&lt;minz)&amp;&amp;(minz=v.z),(void 0===maxz||v.z&gt;maxz)&amp;&amp;(maxz=v.z)}min.set(minx,miny,minz),max.set(maxx,maxy,maxz)},_proto.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},_proto.getAveragePointLocal=function(target){void 0===target&amp;&amp;(target=new Vec3);for(var verts=this.vertices,i=0;i&lt;verts.length;i++)target.vadd(verts[i],target);return target.scale(1/verts.length,target),target},_proto.transformAllPoints=function(offset,quat){var n=this.vertices.length,verts=this.vertices;if(quat){for(var i=0;i&lt;n;i++){var v=verts[i];quat.vmult(v,v)}for(var _i6=0;_i6&lt;this.faceNormals.length;_i6++){var _v=this.faceNormals[_i6];quat.vmult(_v,_v)}}if(offset)for(var _i7=0;_i7&lt;n;_i7++){var _v2=verts[_i7];_v2.vadd(offset,_v2)}},_proto.pointIsInside=function(p){var verts=this.vertices,faces=this.faces,normals=this.faceNormals,pointInside=new Vec3;this.getAveragePointLocal(pointInside);for(var i=0;i&lt;this.faces.length;i++){var n=normals[i],v=verts[faces[i][0]],vToP=new Vec3;p.vsub(v,vToP);var r1=n.dot(vToP),vToPointInside=new Vec3;pointInside.vsub(v,vToPointInside);var r2=n.dot(vToPointInside);if(r1&lt;0&amp;&amp;r2&gt;0||r1&gt;0&amp;&amp;r2&lt;0)return!1}return-1},ConvexPolyhedron}(Shape);ConvexPolyhedron.computeNormal=function(va,vb,vc,target){var cb=new Vec3,ab=new Vec3;vb.vsub(va,ab),vc.vsub(vb,cb),cb.cross(ab,target),target.isZero()||target.normalize()};var maxminA=[],maxminB=[];ConvexPolyhedron.project=function(shape,axis,pos,quat,result){var n=shape.vertices.length,localAxis=new Vec3,max=0,min=0,localOrigin=new Vec3,vs=shape.vertices;localOrigin.setZero(),Transform.vectorToLocalFrame(pos,quat,axis,localAxis),Transform.pointToLocalFrame(pos,quat,localOrigin,localOrigin);var add=localOrigin.dot(localAxis);min=max=vs[0].dot(localAxis);for(var i=1;i&lt;n;i++){var val=vs[i].dot(localAxis);val&gt;max&amp;&amp;(max=val),val&lt;min&amp;&amp;(min=val)}if((min-=add)&gt;(max-=add)){var temp=min;min=max,max=temp}result[0]=max,result[1]=min};var Box=function(_Shape){function Box(halfExtents){var _this;return(_this=_Shape.call(this,{type:Shape.types.BOX})||this).halfExtents=halfExtents,_this.convexPolyhedronRepresentation=null,_this.updateConvexPolyhedronRepresentation(),_this.updateBoundingSphereRadius(),_this}_inheritsLoose(Box,_Shape);var _proto=Box.prototype;return _proto.updateConvexPolyhedronRepresentation=function(){var sx=this.halfExtents.x,sy=this.halfExtents.y,sz=this.halfExtents.z,V=Vec3,vertices=[new V(-sx,-sy,-sz),new V(sx,-sy,-sz),new V(sx,sy,-sz),new V(-sx,sy,-sz),new V(-sx,-sy,sz),new V(sx,-sy,sz),new V(sx,sy,sz),new V(-sx,sy,sz)],axes=[new V(0,0,1),new V(0,1,0),new V(1,0,0)],h=new ConvexPolyhedron({vertices:vertices,faces:[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]],axes:axes});this.convexPolyhedronRepresentation=h,h.material=this.material},_proto.calculateLocalInertia=function(mass,target){return void 0===target&amp;&amp;(target=new Vec3),Box.calculateInertia(this.halfExtents,mass,target),target},_proto.getSideNormals=function(sixTargetVectors,quat){var sides=sixTargetVectors,ex=this.halfExtents;if(sides[0].set(ex.x,0,0),sides[1].set(0,ex.y,0),sides[2].set(0,0,ex.z),sides[3].set(-ex.x,0,0),sides[4].set(0,-ex.y,0),sides[5].set(0,0,-ex.z),void 0!==quat)for(var i=0;i!==sides.length;i++)quat.vmult(sides[i],sides[i]);return sides},_proto.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},_proto.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.length()},_proto.forEachWorldCorner=function(pos,quat,callback){for(var e=this.halfExtents,corners=[[e.x,e.y,e.z],[-e.x,e.y,e.z],[-e.x,-e.y,e.z],[-e.x,-e.y,-e.z],[e.x,-e.y,-e.z],[e.x,e.y,-e.z],[-e.x,e.y,-e.z],[e.x,-e.y,e.z]],i=0;i&lt;corners.length;i++)worldCornerTempPos.set(corners[i][0],corners[i][1],corners[i][2]),quat.vmult(worldCornerTempPos,worldCornerTempPos),pos.vadd(worldCornerTempPos,worldCornerTempPos),callback(worldCornerTempPos.x,worldCornerTempPos.y,worldCornerTempPos.z)},_proto.calculateWorldAABB=function(pos,quat,min,max){var e=this.halfExtents;worldCornersTemp[0].set(e.x,e.y,e.z),worldCornersTemp[1].set(-e.x,e.y,e.z),worldCornersTemp[2].set(-e.x,-e.y,e.z),worldCornersTemp[3].set(-e.x,-e.y,-e.z),worldCornersTemp[4].set(e.x,-e.y,-e.z),worldCornersTemp[5].set(e.x,e.y,-e.z),worldCornersTemp[6].set(-e.x,e.y,-e.z),worldCornersTemp[7].set(e.x,-e.y,e.z);var wc=worldCornersTemp[0];quat.vmult(wc,wc),pos.vadd(wc,wc),max.copy(wc),min.copy(wc);for(var i=1;i&lt;8;i++){var _wc=worldCornersTemp[i];quat.vmult(_wc,_wc),pos.vadd(_wc,_wc);var _x=_wc.x,_y=_wc.y,_z=_wc.z;_x&gt;max.x&amp;&amp;(max.x=_x),_y&gt;max.y&amp;&amp;(max.y=_y),_z&gt;max.z&amp;&amp;(max.z=_z),_x&lt;min.x&amp;&amp;(min.x=_x),_y&lt;min.y&amp;&amp;(min.y=_y),_z&lt;min.z&amp;&amp;(min.z=_z)}},Box}(Shape);Box.calculateInertia=function(halfExtents,mass,target){var e=halfExtents;target.x=1/12*mass*(2*e.y*2*e.y+2*e.z*2*e.z),target.y=1/12*mass*(2*e.x*2*e.x+2*e.z*2*e.z),target.z=1/12*mass*(2*e.y*2*e.y+2*e.x*2*e.x)};var worldCornerTempPos=new Vec3,worldCornersTemp=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],BODY_SLEEP_STATES={AWAKE:0,SLEEPY:1,SLEEPING:2},Body=function(_EventTarget){function Body(options){var _this;void 0===options&amp;&amp;(options={}),(_this=_EventTarget.call(this)||this).id=Body.idCounter++,_this.index=-1,_this.world=null,_this.preStep=null,_this.postStep=null,_this.vlambda=new Vec3,_this.collisionFilterGroup=&quot;number&quot;==typeof options.collisionFilterGroup?options.collisionFilterGroup:1,_this.collisionFilterMask=&quot;number&quot;==typeof options.collisionFilterMask?options.collisionFilterMask:-1,_this.collisionResponse=&quot;boolean&quot;!=typeof options.collisionResponse||options.collisionResponse,_this.position=new Vec3,_this.previousPosition=new Vec3,_this.interpolatedPosition=new Vec3,_this.initPosition=new Vec3,options.position&amp;&amp;(_this.position.copy(options.position),_this.previousPosition.copy(options.position),_this.interpolatedPosition.copy(options.position),_this.initPosition.copy(options.position)),_this.velocity=new Vec3,options.velocity&amp;&amp;_this.velocity.copy(options.velocity),_this.initVelocity=new Vec3,_this.force=new Vec3;var mass=&quot;number&quot;==typeof options.mass?options.mass:0;return _this.mass=mass,_this.invMass=mass&gt;0?1/mass:0,_this.material=options.material||null,_this.linearDamping=&quot;number&quot;==typeof options.linearDamping?options.linearDamping:.01,_this.type=mass&lt;=0?Body.STATIC:Body.DYNAMIC,typeof options.type==typeof Body.STATIC&amp;&amp;(_this.type=options.type),_this.allowSleep=void 0===options.allowSleep||options.allowSleep,_this.sleepState=0,_this.sleepSpeedLimit=void 0!==options.sleepSpeedLimit?options.sleepSpeedLimit:.1,_this.sleepTimeLimit=void 0!==options.sleepTimeLimit?options.sleepTimeLimit:1,_this.timeLastSleepy=0,_this.wakeUpAfterNarrowphase=!1,_this.torque=new Vec3,_this.quaternion=new Quaternion,_this.initQuaternion=new Quaternion,_this.previousQuaternion=new Quaternion,_this.interpolatedQuaternion=new Quaternion,options.quaternion&amp;&amp;(_this.quaternion.copy(options.quaternion),_this.initQuaternion.copy(options.quaternion),_this.previousQuaternion.copy(options.quaternion),_this.interpolatedQuaternion.copy(options.quaternion)),_this.angularVelocity=new Vec3,options.angularVelocity&amp;&amp;_this.angularVelocity.copy(options.angularVelocity),_this.initAngularVelocity=new Vec3,_this.shapes=[],_this.shapeOffsets=[],_this.shapeOrientations=[],_this.inertia=new Vec3,_this.invInertia=new Vec3,_this.invInertiaWorld=new Mat3,_this.invMassSolve=0,_this.invInertiaSolve=new Vec3,_this.invInertiaWorldSolve=new Mat3,_this.fixedRotation=void 0!==options.fixedRotation&amp;&amp;options.fixedRotation,_this.angularDamping=void 0!==options.angularDamping?options.angularDamping:.01,_this.linearFactor=new Vec3(1,1,1),options.linearFactor&amp;&amp;_this.linearFactor.copy(options.linearFactor),_this.angularFactor=new Vec3(1,1,1),options.angularFactor&amp;&amp;_this.angularFactor.copy(options.angularFactor),_this.aabb=new AABB,_this.aabbNeedsUpdate=!0,_this.boundingRadius=0,_this.wlambda=new Vec3,options.shape&amp;&amp;_this.addShape(options.shape),_this.updateMassProperties(),_this}_inheritsLoose(Body,_EventTarget);var _proto=Body.prototype;return _proto.wakeUp=function(){var prevState=this.sleepState;this.sleepState=0,this.wakeUpAfterNarrowphase=!1,prevState===Body.SLEEPING&amp;&amp;this.dispatchEvent(Body.wakeupEvent)},_proto.sleep=function(){this.sleepState=Body.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.wakeUpAfterNarrowphase=!1},_proto.sleepTick=function(time){if(this.allowSleep){var sleepState=this.sleepState,speedSquared=this.velocity.lengthSquared()+this.angularVelocity.lengthSquared(),speedLimitSquared=Math.pow(this.sleepSpeedLimit,2);sleepState===Body.AWAKE&amp;&amp;speedSquared&lt;speedLimitSquared?(this.sleepState=Body.SLEEPY,this.timeLastSleepy=time,this.dispatchEvent(Body.sleepyEvent)):sleepState===Body.SLEEPY&amp;&amp;speedSquared&gt;speedLimitSquared?this.wakeUp():sleepState===Body.SLEEPY&amp;&amp;time-this.timeLastSleepy&gt;this.sleepTimeLimit&amp;&amp;(this.sleep(),this.dispatchEvent(Body.sleepEvent))}},_proto.updateSolveMassProperties=function(){this.sleepState===Body.SLEEPING||this.type===Body.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},_proto.pointToLocalFrame=function(worldPoint,result){return void 0===result&amp;&amp;(result=new Vec3),worldPoint.vsub(this.position,result),this.quaternion.conjugate().vmult(result,result),result},_proto.vectorToLocalFrame=function(worldVector,result){return void 0===result&amp;&amp;(result=new Vec3),this.quaternion.conjugate().vmult(worldVector,result),result},_proto.pointToWorldFrame=function(localPoint,result){return void 0===result&amp;&amp;(result=new Vec3),this.quaternion.vmult(localPoint,result),result.vadd(this.position,result),result},_proto.vectorToWorldFrame=function(localVector,result){return void 0===result&amp;&amp;(result=new Vec3),this.quaternion.vmult(localVector,result),result},_proto.addShape=function(shape,_offset,_orientation){var offset=new Vec3,orientation=new Quaternion;return _offset&amp;&amp;offset.copy(_offset),_orientation&amp;&amp;orientation.copy(_orientation),this.shapes.push(shape),this.shapeOffsets.push(offset),this.shapeOrientations.push(orientation),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,shape.body=this,this},_proto.updateBoundingRadius=function(){for(var shapes=this.shapes,shapeOffsets=this.shapeOffsets,N=shapes.length,radius=0,i=0;i!==N;i++){var shape=shapes[i];shape.updateBoundingSphereRadius();var offset=shapeOffsets[i].length(),r=shape.boundingSphereRadius;offset+r&gt;radius&amp;&amp;(radius=offset+r)}this.boundingRadius=radius},_proto.computeAABB=function(){for(var shapes=this.shapes,shapeOffsets=this.shapeOffsets,shapeOrientations=this.shapeOrientations,N=shapes.length,offset=tmpVec,orientation=tmpQuat$1,bodyQuat=this.quaternion,aabb=this.aabb,shapeAABB=computeAABB_shapeAABB,i=0;i!==N;i++){var shape=shapes[i];bodyQuat.vmult(shapeOffsets[i],offset),offset.vadd(this.position,offset),bodyQuat.mult(shapeOrientations[i],orientation),shape.calculateWorldAABB(offset,orientation,shapeAABB.lowerBound,shapeAABB.upperBound),0===i?aabb.copy(shapeAABB):aabb.extend(shapeAABB)}this.aabbNeedsUpdate=!1},_proto.updateInertiaWorld=function(force){var I=this.invInertia;if(I.x!==I.y||I.y!==I.z||force){var m1=uiw_m1,m2=uiw_m2;m1.setRotationFromQuaternion(this.quaternion),m1.transpose(m2),m1.scale(I,m1),m1.mmult(m2,this.invInertiaWorld)}else;},_proto.applyForce=function(force,relativePoint){if(this.type===Body.DYNAMIC){var rotForce=Body_applyForce_rotForce;relativePoint.cross(force,rotForce),this.force.vadd(force,this.force),this.torque.vadd(rotForce,this.torque)}},_proto.applyLocalForce=function(localForce,localPoint){if(this.type===Body.DYNAMIC){var worldForce=Body_applyLocalForce_worldForce,relativePointWorld=Body_applyLocalForce_relativePointWorld;this.vectorToWorldFrame(localForce,worldForce),this.vectorToWorldFrame(localPoint,relativePointWorld),this.applyForce(worldForce,relativePointWorld)}},_proto.applyImpulse=function(impulse,relativePoint){if(this.type===Body.DYNAMIC){var r=relativePoint,velo=Body_applyImpulse_velo;velo.copy(impulse),velo.scale(this.invMass,velo),this.velocity.vadd(velo,this.velocity);var rotVelo=Body_applyImpulse_rotVelo;r.cross(impulse,rotVelo),this.invInertiaWorld.vmult(rotVelo,rotVelo),this.angularVelocity.vadd(rotVelo,this.angularVelocity)}},_proto.applyLocalImpulse=function(localImpulse,localPoint){if(this.type===Body.DYNAMIC){var worldImpulse=Body_applyLocalImpulse_worldImpulse,relativePointWorld=Body_applyLocalImpulse_relativePoint;this.vectorToWorldFrame(localImpulse,worldImpulse),this.vectorToWorldFrame(localPoint,relativePointWorld),this.applyImpulse(worldImpulse,relativePointWorld)}},_proto.updateMassProperties=function(){var halfExtents=Body_updateMassProperties_halfExtents;this.invMass=this.mass&gt;0?1/this.mass:0;var I=this.inertia,fixed=this.fixedRotation;this.computeAABB(),halfExtents.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),Box.calculateInertia(halfExtents,this.mass,I),this.invInertia.set(I.x&gt;0&amp;&amp;!fixed?1/I.x:0,I.y&gt;0&amp;&amp;!fixed?1/I.y:0,I.z&gt;0&amp;&amp;!fixed?1/I.z:0),this.updateInertiaWorld(!0)},_proto.getVelocityAtWorldPoint=function(worldPoint,result){var r=new Vec3;return worldPoint.vsub(this.position,r),this.angularVelocity.cross(r,result),this.velocity.vadd(result,result),result},_proto.integrate=function(dt,quatNormalize,quatNormalizeFast){if(this.previousPosition.copy(this.position),this.previousQuaternion.copy(this.quaternion),(this.type===Body.DYNAMIC||this.type===Body.KINEMATIC)&amp;&amp;this.sleepState!==Body.SLEEPING){var velo=this.velocity,angularVelo=this.angularVelocity,pos=this.position,force=this.force,torque=this.torque,quat=this.quaternion,invMass=this.invMass,invInertia=this.invInertiaWorld,linearFactor=this.linearFactor,iMdt=invMass*dt;velo.x+=force.x*iMdt*linearFactor.x,velo.y+=force.y*iMdt*linearFactor.y,velo.z+=force.z*iMdt*linearFactor.z;var e=invInertia.elements,angularFactor=this.angularFactor,tx=torque.x*angularFactor.x,ty=torque.y*angularFactor.y,tz=torque.z*angularFactor.z;angularVelo.x+=dt*(e[0]*tx+e[1]*ty+e[2]*tz),angularVelo.y+=dt*(e[3]*tx+e[4]*ty+e[5]*tz),angularVelo.z+=dt*(e[6]*tx+e[7]*ty+e[8]*tz),pos.x+=velo.x*dt,pos.y+=velo.y*dt,pos.z+=velo.z*dt,quat.integrate(this.angularVelocity,dt,this.angularFactor,quat),quatNormalize&amp;&amp;(quatNormalizeFast?quat.normalizeFast():quat.normalize()),this.aabbNeedsUpdate=!0,this.updateInertiaWorld()}},Body}(EventTarget);Body.COLLIDE_EVENT_NAME=&quot;collide&quot;,Body.DYNAMIC=1,Body.STATIC=2,Body.KINEMATIC=4,Body.AWAKE=BODY_SLEEP_STATES.AWAKE,Body.SLEEPY=BODY_SLEEP_STATES.SLEEPY,Body.SLEEPING=BODY_SLEEP_STATES.SLEEPING,Body.idCounter=0,Body.wakeupEvent={type:&quot;wakeup&quot;},Body.sleepyEvent={type:&quot;sleepy&quot;},Body.sleepEvent={type:&quot;sleep&quot;};var tmpVec=new Vec3,tmpQuat$1=new Quaternion,computeAABB_shapeAABB=new AABB,uiw_m1=new Mat3,uiw_m2=new Mat3,Body_applyForce_rotForce=(new Mat3,new Vec3),Body_applyLocalForce_worldForce=new Vec3,Body_applyLocalForce_relativePointWorld=new Vec3,Body_applyImpulse_velo=new Vec3,Body_applyImpulse_rotVelo=new Vec3,Body_applyLocalImpulse_worldImpulse=new Vec3,Body_applyLocalImpulse_relativePoint=new Vec3,Body_updateMassProperties_halfExtents=new Vec3,Broadphase=function(){function Broadphase(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}var _proto=Broadphase.prototype;return _proto.collisionPairs=function(world,p1,p2){throw new Error(&quot;collisionPairs not implemented for this BroadPhase class!&quot;)},_proto.needBroadphaseCollision=function(bodyA,bodyB){return 0!=(bodyA.collisionFilterGroup&amp;bodyB.collisionFilterMask)&amp;&amp;0!=(bodyB.collisionFilterGroup&amp;bodyA.collisionFilterMask)&amp;&amp;(0==(bodyA.type&amp;Body.STATIC)&amp;&amp;bodyA.sleepState!==Body.SLEEPING||0==(bodyB.type&amp;Body.STATIC)&amp;&amp;bodyB.sleepState!==Body.SLEEPING)},_proto.intersectionTest=function(bodyA,bodyB,pairs1,pairs2){this.useBoundingBoxes?this.doBoundingBoxBroadphase(bodyA,bodyB,pairs1,pairs2):this.doBoundingSphereBroadphase(bodyA,bodyB,pairs1,pairs2)},_proto.doBoundingSphereBroadphase=function(bodyA,bodyB,pairs1,pairs2){var r=Broadphase_collisionPairs_r;bodyB.position.vsub(bodyA.position,r);var boundingRadiusSum2=Math.pow(bodyA.boundingRadius+bodyB.boundingRadius,2);r.lengthSquared()&lt;boundingRadiusSum2&amp;&amp;(pairs1.push(bodyA),pairs2.push(bodyB))},_proto.doBoundingBoxBroadphase=function(bodyA,bodyB,pairs1,pairs2){bodyA.aabbNeedsUpdate&amp;&amp;bodyA.computeAABB(),bodyB.aabbNeedsUpdate&amp;&amp;bodyB.computeAABB(),bodyA.aabb.overlaps(bodyB.aabb)&amp;&amp;(pairs1.push(bodyA),pairs2.push(bodyB))},_proto.makePairsUnique=function(pairs1,pairs2){for(var t=Broadphase_makePairsUnique_temp,p1=Broadphase_makePairsUnique_p1,p2=Broadphase_makePairsUnique_p2,N=pairs1.length,i=0;i!==N;i++)p1[i]=pairs1[i],p2[i]=pairs2[i];pairs1.length=0,pairs2.length=0;for(var _i=0;_i!==N;_i++){var id1=p1[_i].id,id2=p2[_i].id,key=id1&lt;id2?id1+&quot;,&quot;+id2:id2+&quot;,&quot;+id1;t[key]=_i,t.keys.push(key)}for(var _i2=0;_i2!==t.keys.length;_i2++){var _key=t.keys.pop(),pairIndex=t[_key];pairs1.push(p1[pairIndex]),pairs2.push(p2[pairIndex]),delete t[_key]}},_proto.setWorld=function(world){},_proto.aabbQuery=function(world,aabb,result){return console.warn(&quot;.aabbQuery is not implemented in this Broadphase subclass.&quot;),[]},Broadphase}(),Broadphase_collisionPairs_r=new Vec3,Broadphase_makePairsUnique_temp=(new Vec3,new Quaternion,new Vec3,{keys:[]}),Broadphase_makePairsUnique_p1=[],Broadphase_makePairsUnique_p2=[];new Vec3;Broadphase.boundingSphereCheck=function(bodyA,bodyB){var dist=new Vec3;bodyA.position.vsub(bodyB.position,dist);var sa=bodyA.shapes[0],sb=bodyB.shapes[0];return Math.pow(sa.boundingSphereRadius+sb.boundingSphereRadius,2)&gt;dist.lengthSquared()};var GridBroadphase=function(_Broadphase){function GridBroadphase(aabbMin,aabbMax,nx,ny,nz){var _this;void 0===aabbMin&amp;&amp;(aabbMin=new Vec3(100,100,100)),void 0===aabbMax&amp;&amp;(aabbMax=new Vec3(-100,-100,-100)),void 0===nx&amp;&amp;(nx=10),void 0===ny&amp;&amp;(ny=10),void 0===nz&amp;&amp;(nz=10),(_this=_Broadphase.call(this)||this).nx=nx,_this.ny=ny,_this.nz=nz,_this.aabbMin=aabbMin,_this.aabbMax=aabbMax;var nbins=_this.nx*_this.ny*_this.nz;if(nbins&lt;=0)throw&quot;GridBroadphase: Each dimension&#39;s n must be &gt;0&quot;;_this.bins=[],_this.binLengths=[],_this.bins.length=nbins,_this.binLengths.length=nbins;for(var i=0;i&lt;nbins;i++)_this.bins[i]=[],_this.binLengths[i]=0;return _this}return _inheritsLoose(GridBroadphase,_Broadphase),GridBroadphase.prototype.collisionPairs=function(world,pairs1,pairs2){for(var N=world.numObjects(),bodies=world.bodies,max=this.aabbMax,min=this.aabbMin,nx=this.nx,ny=this.ny,nz=this.nz,xstep=ny*nz,ystep=nz,zstep=1,xmax=max.x,ymax=max.y,zmax=max.z,xmin=min.x,ymin=min.y,zmin=min.z,xmult=nx/(xmax-xmin),ymult=ny/(ymax-ymin),zmult=nz/(zmax-zmin),binsizeX=(xmax-xmin)/nx,binsizeY=(ymax-ymin)/ny,binsizeZ=(zmax-zmin)/nz,binRadius=.5*Math.sqrt(binsizeX*binsizeX+binsizeY*binsizeY+binsizeZ*binsizeZ),types=Shape.types,SPHERE=types.SPHERE,PLANE=types.PLANE,bins=(types.BOX,types.COMPOUND,types.CONVEXPOLYHEDRON,this.bins),binLengths=this.binLengths,Nbins=this.bins.length,i=0;i!==Nbins;i++)binLengths[i]=0;var ceil=Math.ceil;function addBoxToBins(x0,y0,z0,x1,y1,z1,bi){var xoff0=(x0-xmin)*xmult|0,yoff0=(y0-ymin)*ymult|0,zoff0=(z0-zmin)*zmult|0,xoff1=ceil((x1-xmin)*xmult),yoff1=ceil((y1-ymin)*ymult),zoff1=ceil((z1-zmin)*zmult);xoff0&lt;0?xoff0=0:xoff0&gt;=nx&amp;&amp;(xoff0=nx-1),yoff0&lt;0?yoff0=0:yoff0&gt;=ny&amp;&amp;(yoff0=ny-1),zoff0&lt;0?zoff0=0:zoff0&gt;=nz&amp;&amp;(zoff0=nz-1),xoff1&lt;0?xoff1=0:xoff1&gt;=nx&amp;&amp;(xoff1=nx-1),yoff1&lt;0?yoff1=0:yoff1&gt;=ny&amp;&amp;(yoff1=ny-1),zoff1&lt;0?zoff1=0:zoff1&gt;=nz&amp;&amp;(zoff1=nz-1),yoff0*=ystep,zoff0*=zstep,xoff1*=xstep,yoff1*=ystep,zoff1*=zstep;for(var xoff=xoff0*=xstep;xoff&lt;=xoff1;xoff+=xstep)for(var yoff=yoff0;yoff&lt;=yoff1;yoff+=ystep)for(var zoff=zoff0;zoff&lt;=zoff1;zoff+=zstep){var idx=xoff+yoff+zoff;bins[idx][binLengths[idx]++]=bi}}for(var _i=0;_i!==N;_i++){var bi=bodies[_i],si=bi.shapes[0];switch(si.type){case SPHERE:var shape=si,x=bi.position.x,y=bi.position.y,z=bi.position.z,r=shape.radius;addBoxToBins(x-r,y-r,z-r,x+r,y+r,z+r,bi);break;case PLANE:var _shape=si;_shape.worldNormalNeedsUpdate&amp;&amp;_shape.computeWorldNormal(bi.quaternion);var planeNormal=_shape.worldNormal,xreset=xmin+.5*binsizeX-bi.position.x,yreset=ymin+.5*binsizeY-bi.position.y,zreset=zmin+.5*binsizeZ-bi.position.z,d=GridBroadphase_collisionPairs_d;d.set(xreset,yreset,zreset);for(var xi=0,xoff=0;xi!==nx;xi++,xoff+=xstep,d.y=yreset,d.x+=binsizeX)for(var yi=0,yoff=0;yi!==ny;yi++,yoff+=ystep,d.z=zreset,d.y+=binsizeY)for(var zi=0,zoff=0;zi!==nz;zi++,zoff+=zstep,d.z+=binsizeZ)if(d.dot(planeNormal)&lt;binRadius){var idx=xoff+yoff+zoff;bins[idx][binLengths[idx]++]=bi}break;default:bi.aabbNeedsUpdate&amp;&amp;bi.computeAABB(),addBoxToBins(bi.aabb.lowerBound.x,bi.aabb.lowerBound.y,bi.aabb.lowerBound.z,bi.aabb.upperBound.x,bi.aabb.upperBound.y,bi.aabb.upperBound.z,bi)}}for(var _i2=0;_i2!==Nbins;_i2++){var binLength=binLengths[_i2];if(binLength&gt;1)for(var bin=bins[_i2],_xi=0;_xi!==binLength;_xi++)for(var _bi=bin[_xi],_yi=0;_yi!==_xi;_yi++){var bj=bin[_yi];this.needBroadphaseCollision(_bi,bj)&amp;&amp;this.intersectionTest(_bi,bj,pairs1,pairs2)}}this.makePairsUnique(pairs1,pairs2)},GridBroadphase}(Broadphase),GridBroadphase_collisionPairs_d=new Vec3,NaiveBroadphase=(new Vec3,function(_Broadphase){function NaiveBroadphase(){return _Broadphase.call(this)||this}_inheritsLoose(NaiveBroadphase,_Broadphase);var _proto=NaiveBroadphase.prototype;return _proto.collisionPairs=function(world,pairs1,pairs2){for(var bi,bj,bodies=world.bodies,n=bodies.length,i=0;i!==n;i++)for(var j=0;j!==i;j++)bi=bodies[i],bj=bodies[j],this.needBroadphaseCollision(bi,bj)&amp;&amp;this.intersectionTest(bi,bj,pairs1,pairs2)},_proto.aabbQuery=function(world,aabb,result){void 0===result&amp;&amp;(result=[]);for(var i=0;i&lt;world.bodies.length;i++){var b=world.bodies[i];b.aabbNeedsUpdate&amp;&amp;b.computeAABB(),b.aabb.overlaps(aabb)&amp;&amp;result.push(b)}return result},NaiveBroadphase}(Broadphase)),RaycastResult=function(){function RaycastResult(){this.rayFromWorld=new Vec3,this.rayToWorld=new Vec3,this.hitNormalWorld=new Vec3,this.hitPointWorld=new Vec3,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}var _proto=RaycastResult.prototype;return _proto.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1},_proto.abort=function(){this.shouldStop=!0},_proto.set=function(rayFromWorld,rayToWorld,hitNormalWorld,hitPointWorld,shape,body,distance){this.rayFromWorld.copy(rayFromWorld),this.rayToWorld.copy(rayToWorld),this.hitNormalWorld.copy(hitNormalWorld),this.hitPointWorld.copy(hitPointWorld),this.shape=shape,this.body=body,this.distance=distance},RaycastResult}(),Ray=function(){function Ray(from,to){void 0===from&amp;&amp;(from=new Vec3),void 0===to&amp;&amp;(to=new Vec3),this.from=from.clone(),this.to=to.clone(),this.direction=new Vec3,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ray.ANY,this.result=new RaycastResult,this.hasHit=!1,this.callback=function(result){}}var _proto=Ray.prototype;return _proto.intersectWorld=function(world,options){return this.mode=options.mode||Ray.ANY,this.result=options.result||new RaycastResult,this.skipBackfaces=!!options.skipBackfaces,this.collisionFilterMask=void 0!==options.collisionFilterMask?options.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==options.collisionFilterGroup?options.collisionFilterGroup:-1,this.checkCollisionResponse=void 0===options.checkCollisionResponse||options.checkCollisionResponse,options.from&amp;&amp;this.from.copy(options.from),options.to&amp;&amp;this.to.copy(options.to),this.callback=options.callback||function(){},this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(tmpAABB),tmpArray.length=0,world.broadphase.aabbQuery(world,tmpAABB,tmpArray),this.intersectBodies(tmpArray),this.hasHit},_proto.intersectBody=function(body,result){result&amp;&amp;(this.result=result,this.updateDirection());var checkCollisionResponse=this.checkCollisionResponse;if((!checkCollisionResponse||body.collisionResponse)&amp;&amp;0!=(this.collisionFilterGroup&amp;body.collisionFilterMask)&amp;&amp;0!=(body.collisionFilterGroup&amp;this.collisionFilterMask))for(var xi=intersectBody_xi,qi=intersectBody_qi,i=0,N=body.shapes.length;i&lt;N;i++){var shape=body.shapes[i];if((!checkCollisionResponse||shape.collisionResponse)&amp;&amp;(body.quaternion.mult(body.shapeOrientations[i],qi),body.quaternion.vmult(body.shapeOffsets[i],xi),xi.vadd(body.position,xi),this.intersectShape(shape,qi,xi,body),this.result.shouldStop))break}},_proto.intersectBodies=function(bodies,result){result&amp;&amp;(this.result=result,this.updateDirection());for(var i=0,l=bodies.length;!this.result.shouldStop&amp;&amp;i&lt;l;i++)this.intersectBody(bodies[i])},_proto.updateDirection=function(){this.to.vsub(this.from,this.direction),this.direction.normalize()},_proto.intersectShape=function(shape,quat,position,body){if(!(function(from,direction,position){position.vsub(from,v0);var dot=v0.dot(direction);return direction.scale(dot,intersect),intersect.vadd(from,intersect),position.distanceTo(intersect)}(this.from,this.direction,position)&gt;shape.boundingSphereRadius)){var intersectMethod=this[shape.type];intersectMethod&amp;&amp;intersectMethod.call(this,shape,quat,position,body,shape)}},_proto._intersectBox=function(box,quat,position,body,reportedShape){return this._intersectConvex(box.convexPolyhedronRepresentation,quat,position,body,reportedShape)},_proto._intersectPlane=function(shape,quat,position,body,reportedShape){var from=this.from,to=this.to,direction=this.direction,worldNormal=new Vec3(0,0,1);quat.vmult(worldNormal,worldNormal);var len=new Vec3;from.vsub(position,len);var planeToFrom=len.dot(worldNormal);if(to.vsub(position,len),!(planeToFrom*len.dot(worldNormal)&gt;0||from.distanceTo(to)&lt;planeToFrom)){var n_dot_dir=worldNormal.dot(direction);if(!(Math.abs(n_dot_dir)&lt;this.precision)){var planePointToFrom=new Vec3,dir_scaled_with_t=new Vec3,hitPointWorld=new Vec3;from.vsub(position,planePointToFrom);var t=-worldNormal.dot(planePointToFrom)/n_dot_dir;direction.scale(t,dir_scaled_with_t),from.vadd(dir_scaled_with_t,hitPointWorld),this.reportIntersection(worldNormal,hitPointWorld,reportedShape,body,-1)}}},_proto.getAABB=function(aabb){var lowerBound=aabb.lowerBound,upperBound=aabb.upperBound,to=this.to,from=this.from;lowerBound.x=Math.min(to.x,from.x),lowerBound.y=Math.min(to.y,from.y),lowerBound.z=Math.min(to.z,from.z),upperBound.x=Math.max(to.x,from.x),upperBound.y=Math.max(to.y,from.y),upperBound.z=Math.max(to.z,from.z)},_proto._intersectHeightfield=function(shape,quat,position,body,reportedShape){shape.data,shape.elementSize;var localRay=intersectHeightfield_localRay;localRay.from.copy(this.from),localRay.to.copy(this.to),Transform.pointToLocalFrame(position,quat,localRay.from,localRay.from),Transform.pointToLocalFrame(position,quat,localRay.to,localRay.to),localRay.updateDirection();var iMinX,iMinY,iMaxX,iMaxY,index=intersectHeightfield_index;iMinX=iMinY=0,iMaxX=iMaxY=shape.data.length-1;var aabb=new AABB;localRay.getAABB(aabb),shape.getIndexOfPosition(aabb.lowerBound.x,aabb.lowerBound.y,index,!0),iMinX=Math.max(iMinX,index[0]),iMinY=Math.max(iMinY,index[1]),shape.getIndexOfPosition(aabb.upperBound.x,aabb.upperBound.y,index,!0),iMaxX=Math.min(iMaxX,index[0]+1),iMaxY=Math.min(iMaxY,index[1]+1);for(var i=iMinX;i&lt;iMaxX;i++)for(var j=iMinY;j&lt;iMaxY;j++){if(this.result.shouldStop)return;if(shape.getAabbAtIndex(i,j,aabb),aabb.overlapsRay(localRay)){if(shape.getConvexTrianglePillar(i,j,!1),Transform.pointToWorldFrame(position,quat,shape.pillarOffset,worldPillarOffset),this._intersectConvex(shape.pillarConvex,quat,worldPillarOffset,body,reportedShape,intersectConvexOptions),this.result.shouldStop)return;shape.getConvexTrianglePillar(i,j,!0),Transform.pointToWorldFrame(position,quat,shape.pillarOffset,worldPillarOffset),this._intersectConvex(shape.pillarConvex,quat,worldPillarOffset,body,reportedShape,intersectConvexOptions)}}},_proto._intersectSphere=function(sphere,quat,position,body,reportedShape){var from=this.from,to=this.to,r=sphere.radius,a=Math.pow(to.x-from.x,2)+Math.pow(to.y-from.y,2)+Math.pow(to.z-from.z,2),b=2*((to.x-from.x)*(from.x-position.x)+(to.y-from.y)*(from.y-position.y)+(to.z-from.z)*(from.z-position.z)),c=Math.pow(from.x-position.x,2)+Math.pow(from.y-position.y,2)+Math.pow(from.z-position.z,2)-Math.pow(r,2),delta=Math.pow(b,2)-4*a*c,intersectionPoint=Ray_intersectSphere_intersectionPoint,normal=Ray_intersectSphere_normal;if(!(delta&lt;0))if(0===delta)from.lerp(to,delta,intersectionPoint),intersectionPoint.vsub(position,normal),normal.normalize(),this.reportIntersection(normal,intersectionPoint,reportedShape,body,-1);else{var d1=(-b-Math.sqrt(delta))/(2*a),d2=(-b+Math.sqrt(delta))/(2*a);if(d1&gt;=0&amp;&amp;d1&lt;=1&amp;&amp;(from.lerp(to,d1,intersectionPoint),intersectionPoint.vsub(position,normal),normal.normalize(),this.reportIntersection(normal,intersectionPoint,reportedShape,body,-1)),this.result.shouldStop)return;d2&gt;=0&amp;&amp;d2&lt;=1&amp;&amp;(from.lerp(to,d2,intersectionPoint),intersectionPoint.vsub(position,normal),normal.normalize(),this.reportIntersection(normal,intersectionPoint,reportedShape,body,-1))}},_proto._intersectConvex=function(shape,quat,position,body,reportedShape,options){for(var normal=intersectConvex_normal,vector=intersectConvex_vector,faceList=options&amp;&amp;options.faceList||null,faces=shape.faces,vertices=shape.vertices,normals=shape.faceNormals,direction=this.direction,from=this.from,to=this.to,fromToDistance=from.distanceTo(to),Nfaces=faceList?faceList.length:faces.length,result=this.result,j=0;!result.shouldStop&amp;&amp;j&lt;Nfaces;j++){var fi=faceList?faceList[j]:j,face=faces[fi],faceNormal=normals[fi],q=quat,x=position;vector.copy(vertices[face[0]]),q.vmult(vector,vector),vector.vadd(x,vector),vector.vsub(from,vector),q.vmult(faceNormal,normal);var dot=direction.dot(normal);if(!(Math.abs(dot)&lt;this.precision)){var scalar=normal.dot(vector)/dot;if(!(scalar&lt;0)){direction.scale(scalar,intersectPoint),intersectPoint.vadd(from,intersectPoint),a.copy(vertices[face[0]]),q.vmult(a,a),x.vadd(a,a);for(var i=1;!result.shouldStop&amp;&amp;i&lt;face.length-1;i++){b.copy(vertices[face[i]]),c.copy(vertices[face[i+1]]),q.vmult(b,b),q.vmult(c,c),x.vadd(b,b),x.vadd(c,c);var distance=intersectPoint.distanceTo(from);!pointInTriangle(intersectPoint,a,b,c)&amp;&amp;!pointInTriangle(intersectPoint,b,a,c)||distance&gt;fromToDistance||this.reportIntersection(normal,intersectPoint,reportedShape,body,fi)}}}}},_proto._intersectTrimesh=function(mesh,quat,position,body,reportedShape,options){var normal=intersectTrimesh_normal,triangles=intersectTrimesh_triangles,treeTransform=intersectTrimesh_treeTransform,vector=intersectConvex_vector,localDirection=intersectTrimesh_localDirection,localFrom=intersectTrimesh_localFrom,localTo=intersectTrimesh_localTo,worldIntersectPoint=intersectTrimesh_worldIntersectPoint,worldNormal=intersectTrimesh_worldNormal,indices=(options&amp;&amp;options.faceList,mesh.indices),from=(mesh.vertices,this.from),to=this.to,direction=this.direction;treeTransform.position.copy(position),treeTransform.quaternion.copy(quat),Transform.vectorToLocalFrame(position,quat,direction,localDirection),Transform.pointToLocalFrame(position,quat,from,localFrom),Transform.pointToLocalFrame(position,quat,to,localTo),localTo.x*=mesh.scale.x,localTo.y*=mesh.scale.y,localTo.z*=mesh.scale.z,localFrom.x*=mesh.scale.x,localFrom.y*=mesh.scale.y,localFrom.z*=mesh.scale.z,localTo.vsub(localFrom,localDirection),localDirection.normalize();var fromToDistanceSquared=localFrom.distanceSquared(localTo);mesh.tree.rayQuery(this,treeTransform,triangles);for(var i=0,N=triangles.length;!this.result.shouldStop&amp;&amp;i!==N;i++){var trianglesIndex=triangles[i];mesh.getNormal(trianglesIndex,normal),mesh.getVertex(indices[3*trianglesIndex],a),a.vsub(localFrom,vector);var dot=localDirection.dot(normal),scalar=normal.dot(vector)/dot;if(!(scalar&lt;0)){localDirection.scale(scalar,intersectPoint),intersectPoint.vadd(localFrom,intersectPoint),mesh.getVertex(indices[3*trianglesIndex+1],b),mesh.getVertex(indices[3*trianglesIndex+2],c);var squaredDistance=intersectPoint.distanceSquared(localFrom);!pointInTriangle(intersectPoint,b,a,c)&amp;&amp;!pointInTriangle(intersectPoint,a,b,c)||squaredDistance&gt;fromToDistanceSquared||(Transform.vectorToWorldFrame(quat,normal,worldNormal),Transform.pointToWorldFrame(position,quat,intersectPoint,worldIntersectPoint),this.reportIntersection(worldNormal,worldIntersectPoint,reportedShape,body,trianglesIndex))}}triangles.length=0},_proto.reportIntersection=function(normal,hitPointWorld,shape,body,hitFaceIndex){var from=this.from,to=this.to,distance=from.distanceTo(hitPointWorld),result=this.result;if(!(this.skipBackfaces&amp;&amp;normal.dot(this.direction)&gt;0))switch(result.hitFaceIndex=void 0!==hitFaceIndex?hitFaceIndex:-1,this.mode){case Ray.ALL:this.hasHit=!0,result.set(from,to,normal,hitPointWorld,shape,body,distance),result.hasHit=!0,this.callback(result);break;case Ray.CLOSEST:(distance&lt;result.distance||!result.hasHit)&amp;&amp;(this.hasHit=!0,result.hasHit=!0,result.set(from,to,normal,hitPointWorld,shape,body,distance));break;case Ray.ANY:this.hasHit=!0,result.hasHit=!0,result.set(from,to,normal,hitPointWorld,shape,body,distance),result.shouldStop=!0}},Ray}();Ray.CLOSEST=1,Ray.ANY=2,Ray.ALL=4;var tmpAABB=new AABB,tmpArray=[],v1=new Vec3,v2=new Vec3;function pointInTriangle(p,a,b,c){c.vsub(a,v0),b.vsub(a,v1),p.vsub(a,v2);var u,v,dot00=v0.dot(v0),dot01=v0.dot(v1),dot02=v0.dot(v2),dot11=v1.dot(v1),dot12=v1.dot(v2);return(u=dot11*dot02-dot01*dot12)&gt;=0&amp;&amp;(v=dot00*dot12-dot01*dot02)&gt;=0&amp;&amp;u+v&lt;dot00*dot11-dot01*dot01}Ray.pointInTriangle=pointInTriangle;var intersectBody_xi=new Vec3,intersectBody_qi=new Quaternion,intersectPoint=(new Vec3,new Vec3,new Vec3),a=new Vec3,b=new Vec3,c=new Vec3;new Vec3,new RaycastResult;Ray.prototype[Shape.types.BOX]=Ray.prototype._intersectBox,Ray.prototype[Shape.types.PLANE]=Ray.prototype._intersectPlane;var intersectConvexOptions={faceList:[0]},worldPillarOffset=new Vec3,intersectHeightfield_localRay=new Ray,intersectHeightfield_index=[];Ray.prototype[Shape.types.HEIGHTFIELD]=Ray.prototype._intersectHeightfield;var Ray_intersectSphere_intersectionPoint=new Vec3,Ray_intersectSphere_normal=new Vec3;Ray.prototype[Shape.types.SPHERE]=Ray.prototype._intersectSphere;var intersectConvex_normal=new Vec3,intersectConvex_vector=(new Vec3,new Vec3,new Vec3);Ray.prototype[Shape.types.CONVEXPOLYHEDRON]=Ray.prototype._intersectConvex;var intersectTrimesh_normal=new Vec3,intersectTrimesh_localDirection=new Vec3,intersectTrimesh_localFrom=new Vec3,intersectTrimesh_localTo=new Vec3,intersectTrimesh_worldNormal=new Vec3,intersectTrimesh_worldIntersectPoint=new Vec3,intersectTrimesh_triangles=(new AABB,[]),intersectTrimesh_treeTransform=new Transform;Ray.prototype[Shape.types.TRIMESH]=Ray.prototype._intersectTrimesh;var v0=new Vec3,intersect=new Vec3;var SAPBroadphase=function(_Broadphase){function SAPBroadphase(world){var _this;(_this=_Broadphase.call(this)||this).axisList=[],_this.world=null,_this.axisIndex=0;var axisList=_this.axisList;return _this._addBodyHandler=function(event){axisList.push(event.body)},_this._removeBodyHandler=function(event){var idx=axisList.indexOf(event.body);-1!==idx&amp;&amp;axisList.splice(idx,1)},world&amp;&amp;_this.setWorld(world),_this}_inheritsLoose(SAPBroadphase,_Broadphase);var _proto=SAPBroadphase.prototype;return _proto.setWorld=function(world){this.axisList.length=0;for(var i=0;i&lt;world.bodies.length;i++)this.axisList.push(world.bodies[i]);world.removeEventListener(&quot;addBody&quot;,this._addBodyHandler),world.removeEventListener(&quot;removeBody&quot;,this._removeBodyHandler),world.addEventListener(&quot;addBody&quot;,this._addBodyHandler),world.addEventListener(&quot;removeBody&quot;,this._removeBodyHandler),this.world=world,this.dirty=!0},_proto.collisionPairs=function(world,p1,p2){var i,j,bodies=this.axisList,N=bodies.length,axisIndex=this.axisIndex;for(this.dirty&amp;&amp;(this.sortList(),this.dirty=!1),i=0;i!==N;i++){var _bi=bodies[i];for(j=i+1;j&lt;N;j++){var _bj=bodies[j];if(this.needBroadphaseCollision(_bi,_bj)){if(!SAPBroadphase.checkBounds(_bi,_bj,axisIndex))break;this.intersectionTest(_bi,_bj,p1,p2)}}}},_proto.sortList=function(){for(var axisList=this.axisList,axisIndex=this.axisIndex,N=axisList.length,i=0;i!==N;i++){var _bi2=axisList[i];_bi2.aabbNeedsUpdate&amp;&amp;_bi2.computeAABB()}0===axisIndex?SAPBroadphase.insertionSortX(axisList):1===axisIndex?SAPBroadphase.insertionSortY(axisList):2===axisIndex&amp;&amp;SAPBroadphase.insertionSortZ(axisList)},_proto.autoDetectAxis=function(){for(var sumX=0,sumX2=0,sumY=0,sumY2=0,sumZ=0,sumZ2=0,bodies=this.axisList,N=bodies.length,invN=1/N,i=0;i!==N;i++){var b=bodies[i],centerX=b.position.x;sumX+=centerX,sumX2+=centerX*centerX;var centerY=b.position.y;sumY+=centerY,sumY2+=centerY*centerY;var centerZ=b.position.z;sumZ+=centerZ,sumZ2+=centerZ*centerZ}var varianceX=sumX2-sumX*sumX*invN,varianceY=sumY2-sumY*sumY*invN,varianceZ=sumZ2-sumZ*sumZ*invN;this.axisIndex=varianceX&gt;varianceY?varianceX&gt;varianceZ?0:2:varianceY&gt;varianceZ?1:2},_proto.aabbQuery=function(world,aabb,result){void 0===result&amp;&amp;(result=[]),this.dirty&amp;&amp;(this.sortList(),this.dirty=!1);var axisIndex=this.axisIndex,axis=&quot;x&quot;;1===axisIndex&amp;&amp;(axis=&quot;y&quot;),2===axisIndex&amp;&amp;(axis=&quot;z&quot;);for(var axisList=this.axisList,i=(aabb.lowerBound[axis],aabb.upperBound[axis],0);i&lt;axisList.length;i++){var b=axisList[i];b.aabbNeedsUpdate&amp;&amp;b.computeAABB(),b.aabb.overlaps(aabb)&amp;&amp;result.push(b)}return result},SAPBroadphase}(Broadphase);function Utils(){}SAPBroadphase.insertionSortX=function(a){for(var i=1,l=a.length;i&lt;l;i++){var v=a[i],j=void 0;for(j=i-1;j&gt;=0&amp;&amp;!(a[j].aabb.lowerBound.x&lt;=v.aabb.lowerBound.x);j--)a[j+1]=a[j];a[j+1]=v}return a},SAPBroadphase.insertionSortY=function(a){for(var i=1,l=a.length;i&lt;l;i++){var v=a[i],j=void 0;for(j=i-1;j&gt;=0&amp;&amp;!(a[j].aabb.lowerBound.y&lt;=v.aabb.lowerBound.y);j--)a[j+1]=a[j];a[j+1]=v}return a},SAPBroadphase.insertionSortZ=function(a){for(var i=1,l=a.length;i&lt;l;i++){var v=a[i],j=void 0;for(j=i-1;j&gt;=0&amp;&amp;!(a[j].aabb.lowerBound.z&lt;=v.aabb.lowerBound.z);j--)a[j+1]=a[j];a[j+1]=v}return a},SAPBroadphase.checkBounds=function(bi,bj,axisIndex){var biPos,bjPos;0===axisIndex?(biPos=bi.position.x,bjPos=bj.position.x):1===axisIndex?(biPos=bi.position.y,bjPos=bj.position.y):2===axisIndex&amp;&amp;(biPos=bi.position.z,bjPos=bj.position.z);var ri=bi.boundingRadius;return bjPos-bj.boundingRadius&lt;biPos+ri},Utils.defaults=function(options,defaults){for(var key in void 0===options&amp;&amp;(options={}),defaults)key in options||(options[key]=defaults[key]);return options};var Constraint=function(){function Constraint(bodyA,bodyB,options){void 0===options&amp;&amp;(options={}),options=Utils.defaults(options,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=bodyA,this.bodyB=bodyB,this.id=Constraint.idCounter++,this.collideConnected=options.collideConnected,options.wakeUpBodies&amp;&amp;(bodyA&amp;&amp;bodyA.wakeUp(),bodyB&amp;&amp;bodyB.wakeUp())}var _proto=Constraint.prototype;return _proto.update=function(){throw new Error(&quot;method update() not implmemented in this Constraint subclass!&quot;)},_proto.enable=function(){for(var eqs=this.equations,i=0;i&lt;eqs.length;i++)eqs[i].enabled=!0},_proto.disable=function(){for(var eqs=this.equations,i=0;i&lt;eqs.length;i++)eqs[i].enabled=!1},Constraint}();Constraint.idCounter=0;var JacobianElement=function(){function JacobianElement(){this.spatial=new Vec3,this.rotational=new Vec3}var _proto=JacobianElement.prototype;return _proto.multiplyElement=function(element){return element.spatial.dot(this.spatial)+element.rotational.dot(this.rotational)},_proto.multiplyVectors=function(spatial,rotational){return spatial.dot(this.spatial)+rotational.dot(this.rotational)},JacobianElement}(),Equation=function(){function Equation(bi,bj,minForce,maxForce){void 0===minForce&amp;&amp;(minForce=-1e6),void 0===maxForce&amp;&amp;(maxForce=1e6),this.id=Equation.id++,this.minForce=minForce,this.maxForce=maxForce,this.bi=bi,this.bj=bj,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new JacobianElement,this.jacobianElementB=new JacobianElement,this.enabled=!0,this.multiplier=0,this.setSpookParams(1e7,4,1/60)}var _proto=Equation.prototype;return _proto.setSpookParams=function(stiffness,relaxation,timeStep){var d=relaxation,k=stiffness,h=timeStep;this.a=4/(h*(1+4*d)),this.b=4*d/(1+4*d),this.eps=4/(h*h*k*(1+4*d))},_proto.computeB=function(a,b,h){var GW=this.computeGW();return-this.computeGq()*a-GW*b-this.computeGiMf()*h},_proto.computeGq=function(){var GA=this.jacobianElementA,GB=this.jacobianElementB,bi=this.bi,bj=this.bj,xi=bi.position,xj=bj.position;return GA.spatial.dot(xi)+GB.spatial.dot(xj)},_proto.computeGW=function(){var GA=this.jacobianElementA,GB=this.jacobianElementB,bi=this.bi,bj=this.bj,vi=bi.velocity,vj=bj.velocity,wi=bi.angularVelocity,wj=bj.angularVelocity;return GA.multiplyVectors(vi,wi)+GB.multiplyVectors(vj,wj)},_proto.computeGWlambda=function(){var GA=this.jacobianElementA,GB=this.jacobianElementB,bi=this.bi,bj=this.bj,vi=bi.vlambda,vj=bj.vlambda,wi=bi.wlambda,wj=bj.wlambda;return GA.multiplyVectors(vi,wi)+GB.multiplyVectors(vj,wj)},_proto.computeGiMf=function(){var GA=this.jacobianElementA,GB=this.jacobianElementB,bi=this.bi,bj=this.bj,fi=bi.force,ti=bi.torque,fj=bj.force,tj=bj.torque,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve;return fi.scale(invMassi,iMfi),fj.scale(invMassj,iMfj),bi.invInertiaWorldSolve.vmult(ti,invIi_vmult_taui),bj.invInertiaWorldSolve.vmult(tj,invIj_vmult_tauj),GA.multiplyVectors(iMfi,invIi_vmult_taui)+GB.multiplyVectors(iMfj,invIj_vmult_tauj)},_proto.computeGiMGt=function(){var GA=this.jacobianElementA,GB=this.jacobianElementB,bi=this.bi,bj=this.bj,invMassi=bi.invMassSolve,invMassj=bj.invMassSolve,invIi=bi.invInertiaWorldSolve,invIj=bj.invInertiaWorldSolve,result=invMassi+invMassj;return invIi.vmult(GA.rotational,tmp$1),result+=tmp$1.dot(GA.rotational),invIj.vmult(GB.rotational,tmp$1),result+=tmp$1.dot(GB.rotational)},_proto.addToWlambda=function(deltalambda){var GA=this.jacobianElementA,GB=this.jacobianElementB,bi=this.bi,bj=this.bj,temp=addToWlambda_temp;bi.vlambda.addScaledVector(bi.invMassSolve*deltalambda,GA.spatial,bi.vlambda),bj.vlambda.addScaledVector(bj.invMassSolve*deltalambda,GB.spatial,bj.vlambda),bi.invInertiaWorldSolve.vmult(GA.rotational,temp),bi.wlambda.addScaledVector(deltalambda,temp,bi.wlambda),bj.invInertiaWorldSolve.vmult(GB.rotational,temp),bj.wlambda.addScaledVector(deltalambda,temp,bj.wlambda)},_proto.computeC=function(){return this.computeGiMGt()+this.eps},Equation}();Equation.id=0;var iMfi=new Vec3,iMfj=new Vec3,invIi_vmult_taui=new Vec3,invIj_vmult_tauj=new Vec3,tmp$1=new Vec3,addToWlambda_temp=new Vec3,ContactEquation=function(_Equation){function ContactEquation(bodyA,bodyB,maxForce){var _this;return void 0===maxForce&amp;&amp;(maxForce=1e6),(_this=_Equation.call(this,bodyA,bodyB,0,maxForce)||this).restitution=0,_this.ri=new Vec3,_this.rj=new Vec3,_this.ni=new Vec3,_this}_inheritsLoose(ContactEquation,_Equation);var _proto=ContactEquation.prototype;return _proto.computeB=function(h){var a=this.a,b=this.b,bi=this.bi,bj=this.bj,ri=this.ri,rj=this.rj,rixn=ContactEquation_computeB_temp1,rjxn=ContactEquation_computeB_temp2,vi=bi.velocity,wi=bi.angularVelocity,vj=(bi.force,bi.torque,bj.velocity),wj=bj.angularVelocity,penetrationVec=(bj.force,bj.torque,ContactEquation_computeB_temp3),GA=this.jacobianElementA,GB=this.jacobianElementB,n=this.ni;ri.cross(n,rixn),rj.cross(n,rjxn),n.negate(GA.spatial),rixn.negate(GA.rotational),GB.spatial.copy(n),GB.rotational.copy(rjxn),penetrationVec.copy(bj.position),penetrationVec.vadd(rj,penetrationVec),penetrationVec.vsub(bi.position,penetrationVec),penetrationVec.vsub(ri,penetrationVec);var g=n.dot(penetrationVec),ePlusOne=this.restitution+1;return-g*a-(ePlusOne*vj.dot(n)-ePlusOne*vi.dot(n)+wj.dot(rjxn)-wi.dot(rixn))*b-h*this.computeGiMf()},_proto.getImpactVelocityAlongNormal=function(){var vi=ContactEquation_getImpactVelocityAlongNormal_vi,vj=ContactEquation_getImpactVelocityAlongNormal_vj,xi=ContactEquation_getImpactVelocityAlongNormal_xi,xj=ContactEquation_getImpactVelocityAlongNormal_xj,relVel=ContactEquation_getImpactVelocityAlongNormal_relVel;return this.bi.position.vadd(this.ri,xi),this.bj.position.vadd(this.rj,xj),this.bi.getVelocityAtWorldPoint(xi,vi),this.bj.getVelocityAtWorldPoint(xj,vj),vi.vsub(vj,relVel),this.ni.dot(relVel)},ContactEquation}(Equation),ContactEquation_computeB_temp1=new Vec3,ContactEquation_computeB_temp2=new Vec3,ContactEquation_computeB_temp3=new Vec3,ContactEquation_getImpactVelocityAlongNormal_vi=new Vec3,ContactEquation_getImpactVelocityAlongNormal_vj=new Vec3,ContactEquation_getImpactVelocityAlongNormal_xi=new Vec3,ContactEquation_getImpactVelocityAlongNormal_xj=new Vec3,ContactEquation_getImpactVelocityAlongNormal_relVel=new Vec3,PointToPointConstraint=function(_Constraint){function PointToPointConstraint(bodyA,pivotA,bodyB,pivotB,maxForce){var _this;void 0===pivotA&amp;&amp;(pivotA=new Vec3),void 0===pivotB&amp;&amp;(pivotB=new Vec3),void 0===maxForce&amp;&amp;(maxForce=1e6),(_this=_Constraint.call(this,bodyA,bodyB)||this).pivotA=pivotA.clone(),_this.pivotB=pivotB.clone();var x=_this.equationX=new ContactEquation(bodyA,bodyB),y=_this.equationY=new ContactEquation(bodyA,bodyB),z=_this.equationZ=new ContactEquation(bodyA,bodyB);return _this.equations.push(x,y,z),x.minForce=y.minForce=z.minForce=-maxForce,x.maxForce=y.maxForce=z.maxForce=maxForce,x.ni.set(1,0,0),y.ni.set(0,1,0),z.ni.set(0,0,1),_this}return _inheritsLoose(PointToPointConstraint,_Constraint),PointToPointConstraint.prototype.update=function(){var bodyA=this.bodyA,bodyB=this.bodyB,x=this.equationX,y=this.equationY,z=this.equationZ;bodyA.quaternion.vmult(this.pivotA,x.ri),bodyB.quaternion.vmult(this.pivotB,x.rj),y.ri.copy(x.ri),y.rj.copy(x.rj),z.ri.copy(x.ri),z.rj.copy(x.rj)},PointToPointConstraint}(Constraint),ConeEquation=function(_Equation){function ConeEquation(bodyA,bodyB,options){var _this;void 0===options&amp;&amp;(options={});var maxForce=void 0!==options.maxForce?options.maxForce:1e6;return(_this=_Equation.call(this,bodyA,bodyB,-maxForce,maxForce)||this).axisA=options.axisA?options.axisA.clone():new Vec3(1,0,0),_this.axisB=options.axisB?options.axisB.clone():new Vec3(0,1,0),_this.angle=void 0!==options.angle?options.angle:0,_this}return _inheritsLoose(ConeEquation,_Equation),ConeEquation.prototype.computeB=function(h){var a=this.a,b=this.b,ni=this.axisA,nj=this.axisB,nixnj=tmpVec1,njxni=tmpVec2,GA=this.jacobianElementA,GB=this.jacobianElementB;return ni.cross(nj,nixnj),nj.cross(ni,njxni),GA.rotational.copy(njxni),GB.rotational.copy(nixnj),-(Math.cos(this.angle)-ni.dot(nj))*a-this.computeGW()*b-h*this.computeGiMf()},ConeEquation}(Equation),tmpVec1=new Vec3,tmpVec2=new Vec3,RotationalEquation=function(_Equation){function RotationalEquation(bodyA,bodyB,options){var _this;void 0===options&amp;&amp;(options={});var maxForce=void 0!==options.maxForce?options.maxForce:1e6;return(_this=_Equation.call(this,bodyA,bodyB,-maxForce,maxForce)||this).axisA=options.axisA?options.axisA.clone():new Vec3(1,0,0),_this.axisB=options.axisB?options.axisB.clone():new Vec3(0,1,0),_this.maxAngle=Math.PI/2,_this}return _inheritsLoose(RotationalEquation,_Equation),RotationalEquation.prototype.computeB=function(h){var a=this.a,b=this.b,ni=this.axisA,nj=this.axisB,nixnj=tmpVec1$1,njxni=tmpVec2$1,GA=this.jacobianElementA,GB=this.jacobianElementB;return ni.cross(nj,nixnj),nj.cross(ni,njxni),GA.rotational.copy(njxni),GB.rotational.copy(nixnj),-(Math.cos(this.maxAngle)-ni.dot(nj))*a-this.computeGW()*b-h*this.computeGiMf()},RotationalEquation}(Equation),tmpVec1$1=new Vec3,tmpVec2$1=new Vec3,ConeTwistConstraint=function(_PointToPointConstrai){function ConeTwistConstraint(bodyA,bodyB,options){var _this;void 0===options&amp;&amp;(options={});var maxForce=void 0!==options.maxForce?options.maxForce:1e6,pivotA=options.pivotA?options.pivotA.clone():new Vec3,pivotB=options.pivotB?options.pivotB.clone():new Vec3;(_this=_PointToPointConstrai.call(this,bodyA,pivotA,bodyB,pivotB,maxForce)||this).axisA=options.axisA?options.axisA.clone():new Vec3,_this.axisB=options.axisB?options.axisB.clone():new Vec3,_this.collideConnected=!!options.collideConnected,_this.angle=void 0!==options.angle?options.angle:0;var c=_this.coneEquation=new ConeEquation(bodyA,bodyB,options),t=_this.twistEquation=new RotationalEquation(bodyA,bodyB,options);return _this.twistAngle=void 0!==options.twistAngle?options.twistAngle:0,c.maxForce=0,c.minForce=-maxForce,t.maxForce=0,t.minForce=-maxForce,_this.equations.push(c,t),_this}return _inheritsLoose(ConeTwistConstraint,_PointToPointConstrai),ConeTwistConstraint.prototype.update=function(){var bodyA=this.bodyA,bodyB=this.bodyB,cone=this.coneEquation,twist=this.twistEquation;_PointToPointConstrai.prototype.update.call(this),bodyA.vectorToWorldFrame(this.axisA,cone.axisA),bodyB.vectorToWorldFrame(this.axisB,cone.axisB),this.axisA.tangents(twist.axisA,twist.axisA),bodyA.vectorToWorldFrame(twist.axisA,twist.axisA),this.axisB.tangents(twist.axisB,twist.axisB),bodyB.vectorToWorldFrame(twist.axisB,twist.axisB),cone.angle=this.angle,twist.maxAngle=this.twistAngle},ConeTwistConstraint}(PointToPointConstraint),DistanceConstraint=(new Vec3,new Vec3,function(_Constraint){function DistanceConstraint(bodyA,bodyB,distance,maxForce){var _this;void 0===maxForce&amp;&amp;(maxForce=1e6),_this=_Constraint.call(this,bodyA,bodyB)||this,void 0===distance&amp;&amp;(distance=bodyA.position.distanceTo(bodyB.position)),_this.distance=distance;var eq=_this.distanceEquation=new ContactEquation(bodyA,bodyB);return _this.equations.push(eq),eq.minForce=-maxForce,eq.maxForce=maxForce,_this}return _inheritsLoose(DistanceConstraint,_Constraint),DistanceConstraint.prototype.update=function(){var bodyA=this.bodyA,bodyB=this.bodyB,eq=this.distanceEquation,halfDist=.5*this.distance,normal=eq.ni;bodyB.position.vsub(bodyA.position,normal),normal.normalize(),normal.scale(halfDist,eq.ri),normal.scale(-halfDist,eq.rj)},DistanceConstraint}(Constraint)),LockConstraint=function(_PointToPointConstrai){function LockConstraint(bodyA,bodyB,options){var _this;void 0===options&amp;&amp;(options={});var maxForce=void 0!==options.maxForce?options.maxForce:1e6,pivotA=new Vec3,pivotB=new Vec3,halfWay=new Vec3;bodyA.position.vadd(bodyB.position,halfWay),halfWay.scale(.5,halfWay),bodyB.pointToLocalFrame(halfWay,pivotB),bodyA.pointToLocalFrame(halfWay,pivotA),(_this=_PointToPointConstrai.call(this,bodyA,pivotA,bodyB,pivotB,maxForce)||this).xA=bodyA.vectorToLocalFrame(Vec3.UNIT_X),_this.xB=bodyB.vectorToLocalFrame(Vec3.UNIT_X),_this.yA=bodyA.vectorToLocalFrame(Vec3.UNIT_Y),_this.yB=bodyB.vectorToLocalFrame(Vec3.UNIT_Y),_this.zA=bodyA.vectorToLocalFrame(Vec3.UNIT_Z),_this.zB=bodyB.vectorToLocalFrame(Vec3.UNIT_Z);var r1=_this.rotationalEquation1=new RotationalEquation(bodyA,bodyB,options),r2=_this.rotationalEquation2=new RotationalEquation(bodyA,bodyB,options),r3=_this.rotationalEquation3=new RotationalEquation(bodyA,bodyB,options);return _this.equations.push(r1,r2,r3),_this}return _inheritsLoose(LockConstraint,_PointToPointConstrai),LockConstraint.prototype.update=function(){var bodyA=this.bodyA,bodyB=this.bodyB,r1=(this.motorEquation,this.rotationalEquation1),r2=this.rotationalEquation2,r3=this.rotationalEquation3;_PointToPointConstrai.prototype.update.call(this),bodyA.vectorToWorldFrame(this.xA,r1.axisA),bodyB.vectorToWorldFrame(this.yB,r1.axisB),bodyA.vectorToWorldFrame(this.yA,r2.axisA),bodyB.vectorToWorldFrame(this.zB,r2.axisB),bodyA.vectorToWorldFrame(this.zA,r3.axisA),bodyB.vectorToWorldFrame(this.xB,r3.axisB)},LockConstraint}(PointToPointConstraint),RotationalMotorEquation=(new Vec3,new Vec3,function(_Equation){function RotationalMotorEquation(bodyA,bodyB,maxForce){var _this;return void 0===maxForce&amp;&amp;(maxForce=1e6),(_this=_Equation.call(this,bodyA,bodyB,-maxForce,maxForce)||this).axisA=new Vec3,_this.axisB=new Vec3,_this.targetVelocity=0,_this}return _inheritsLoose(RotationalMotorEquation,_Equation),RotationalMotorEquation.prototype.computeB=function(h){this.a;var b=this.b,axisA=(this.bi,this.bj,this.axisA),axisB=this.axisB,GA=this.jacobianElementA,GB=this.jacobianElementB;return GA.rotational.copy(axisA),axisB.negate(GB.rotational),-(this.computeGW()-this.targetVelocity)*b-h*this.computeGiMf()},RotationalMotorEquation}(Equation)),HingeConstraint=function(_PointToPointConstrai){function HingeConstraint(bodyA,bodyB,options){var _this;void 0===options&amp;&amp;(options={});var maxForce=void 0!==options.maxForce?options.maxForce:1e6,pivotA=options.pivotA?options.pivotA.clone():new Vec3,pivotB=options.pivotB?options.pivotB.clone():new Vec3;((_this=_PointToPointConstrai.call(this,bodyA,pivotA,bodyB,pivotB,maxForce)||this).axisA=options.axisA?options.axisA.clone():new Vec3(1,0,0)).normalize(),(_this.axisB=options.axisB?options.axisB.clone():new Vec3(1,0,0)).normalize(),_this.collideConnected=!!options.collideConnected;var rotational1=_this.rotationalEquation1=new RotationalEquation(bodyA,bodyB,options),rotational2=_this.rotationalEquation2=new RotationalEquation(bodyA,bodyB,options),motor=_this.motorEquation=new RotationalMotorEquation(bodyA,bodyB,maxForce);return motor.enabled=!1,_this.equations.push(rotational1,rotational2,motor),_this}_inheritsLoose(HingeConstraint,_PointToPointConstrai);var _proto=HingeConstraint.prototype;return _proto.enableMotor=function(){this.motorEquation.enabled=!0},_proto.disableMotor=function(){this.motorEquation.enabled=!1},_proto.setMotorSpeed=function(speed){this.motorEquation.targetVelocity=speed},_proto.setMotorMaxForce=function(maxForce){this.motorEquation.maxForce=maxForce,this.motorEquation.minForce=-maxForce},_proto.update=function(){var bodyA=this.bodyA,bodyB=this.bodyB,motor=this.motorEquation,r1=this.rotationalEquation1,r2=this.rotationalEquation2,worldAxisA=HingeConstraint_update_tmpVec1,worldAxisB=HingeConstraint_update_tmpVec2,axisA=this.axisA,axisB=this.axisB;_PointToPointConstrai.prototype.update.call(this),bodyA.quaternion.vmult(axisA,worldAxisA),bodyB.quaternion.vmult(axisB,worldAxisB),worldAxisA.tangents(r1.axisA,r2.axisA),r1.axisB.copy(worldAxisB),r2.axisB.copy(worldAxisB),this.motorEquation.enabled&amp;&amp;(bodyA.quaternion.vmult(this.axisA,motor.axisA),bodyB.quaternion.vmult(this.axisB,motor.axisB))},HingeConstraint}(PointToPointConstraint),HingeConstraint_update_tmpVec1=new Vec3,HingeConstraint_update_tmpVec2=new Vec3,FrictionEquation=function(_Equation){function FrictionEquation(bodyA,bodyB,slipForce){var _this;return(_this=_Equation.call(this,bodyA,bodyB,-slipForce,slipForce)||this).ri=new Vec3,_this.rj=new Vec3,_this.t=new Vec3,_this}return _inheritsLoose(FrictionEquation,_Equation),FrictionEquation.prototype.computeB=function(h){this.a;var b=this.b,ri=(this.bi,this.bj,this.ri),rj=this.rj,rixt=FrictionEquation_computeB_temp1,rjxt=FrictionEquation_computeB_temp2,t=this.t;ri.cross(t,rixt),rj.cross(t,rjxt);var GA=this.jacobianElementA,GB=this.jacobianElementB;return t.negate(GA.spatial),rixt.negate(GA.rotational),GB.spatial.copy(t),GB.rotational.copy(rjxt),-this.computeGW()*b-h*this.computeGiMf()},FrictionEquation}(Equation),FrictionEquation_computeB_temp1=new Vec3,FrictionEquation_computeB_temp2=new Vec3,ContactMaterial=function ContactMaterial(m1,m2,options){options=Utils.defaults(options,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=ContactMaterial.idCounter++,this.materials=[m1,m2],this.friction=options.friction,this.restitution=options.restitution,this.contactEquationStiffness=options.contactEquationStiffness,this.contactEquationRelaxation=options.contactEquationRelaxation,this.frictionEquationStiffness=options.frictionEquationStiffness,this.frictionEquationRelaxation=options.frictionEquationRelaxation};ContactMaterial.idCounter=0;var Material=function Material(options){void 0===options&amp;&amp;(options={});var name=&quot;&quot;;&quot;string&quot;==typeof options&amp;&amp;(name=options,options={}),this.name=name,this.id=Material.idCounter++,this.friction=void 0!==options.friction?options.friction:-1,this.restitution=void 0!==options.restitution?options.restitution:-1};Material.idCounter=0;var Spring=function(){function Spring(bodyA,bodyB,options){void 0===options&amp;&amp;(options={}),this.restLength=&quot;number&quot;==typeof options.restLength?options.restLength:1,this.stiffness=options.stiffness||100,this.damping=options.damping||1,this.bodyA=bodyA,this.bodyB=bodyB,this.localAnchorA=new Vec3,this.localAnchorB=new Vec3,options.localAnchorA&amp;&amp;this.localAnchorA.copy(options.localAnchorA),options.localAnchorB&amp;&amp;this.localAnchorB.copy(options.localAnchorB),options.worldAnchorA&amp;&amp;this.setWorldAnchorA(options.worldAnchorA),options.worldAnchorB&amp;&amp;this.setWorldAnchorB(options.worldAnchorB)}var _proto=Spring.prototype;return _proto.setWorldAnchorA=function(worldAnchorA){this.bodyA.pointToLocalFrame(worldAnchorA,this.localAnchorA)},_proto.setWorldAnchorB=function(worldAnchorB){this.bodyB.pointToLocalFrame(worldAnchorB,this.localAnchorB)},_proto.getWorldAnchorA=function(result){this.bodyA.pointToWorldFrame(this.localAnchorA,result)},_proto.getWorldAnchorB=function(result){this.bodyB.pointToWorldFrame(this.localAnchorB,result)},_proto.applyForce=function(){var k=this.stiffness,d=this.damping,l=this.restLength,bodyA=this.bodyA,bodyB=this.bodyB,r=applyForce_r,r_unit=applyForce_r_unit,u=applyForce_u,f=applyForce_f,tmp=applyForce_tmp,worldAnchorA=applyForce_worldAnchorA,worldAnchorB=applyForce_worldAnchorB,ri=applyForce_ri,rj=applyForce_rj,ri_x_f=applyForce_ri_x_f,rj_x_f=applyForce_rj_x_f;this.getWorldAnchorA(worldAnchorA),this.getWorldAnchorB(worldAnchorB),worldAnchorA.vsub(bodyA.position,ri),worldAnchorB.vsub(bodyB.position,rj),worldAnchorB.vsub(worldAnchorA,r);var rlen=r.length();r_unit.copy(r),r_unit.normalize(),bodyB.velocity.vsub(bodyA.velocity,u),bodyB.angularVelocity.cross(rj,tmp),u.vadd(tmp,u),bodyA.angularVelocity.cross(ri,tmp),u.vsub(tmp,u),r_unit.scale(-k*(rlen-l)-d*u.dot(r_unit),f),bodyA.force.vsub(f,bodyA.force),bodyB.force.vadd(f,bodyB.force),ri.cross(f,ri_x_f),rj.cross(f,rj_x_f),bodyA.torque.vsub(ri_x_f,bodyA.torque),bodyB.torque.vadd(rj_x_f,bodyB.torque)},Spring}(),applyForce_r=new Vec3,applyForce_r_unit=new Vec3,applyForce_u=new Vec3,applyForce_f=new Vec3,applyForce_worldAnchorA=new Vec3,applyForce_worldAnchorB=new Vec3,applyForce_ri=new Vec3,applyForce_rj=new Vec3,applyForce_ri_x_f=new Vec3,applyForce_rj_x_f=new Vec3,applyForce_tmp=new Vec3,WheelInfo=function(){function WheelInfo(options){void 0===options&amp;&amp;(options={}),options=Utils.defaults(options,{chassisConnectionPointLocal:new Vec3,chassisConnectionPointWorld:new Vec3,directionLocal:new Vec3,directionWorld:new Vec3,axleLocal:new Vec3,axleWorld:new Vec3,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,slipInfo:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=options.maxSuspensionTravel,this.customSlidingRotationalSpeed=options.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=options.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=options.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=options.chassisConnectionPointWorld.clone(),this.directionLocal=options.directionLocal.clone(),this.directionWorld=options.directionWorld.clone(),this.axleLocal=options.axleLocal.clone(),this.axleWorld=options.axleWorld.clone(),this.suspensionRestLength=options.suspensionRestLength,this.suspensionMaxLength=options.suspensionMaxLength,this.radius=options.radius,this.suspensionStiffness=options.suspensionStiffness,this.dampingCompression=options.dampingCompression,this.dampingRelaxation=options.dampingRelaxation,this.frictionSlip=options.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=options.rollInfluence,this.maxSuspensionForce=options.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=options.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.slipInfo=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new RaycastResult,this.worldTransform=new Transform,this.isInContact=!1}return WheelInfo.prototype.updateWheel=function(chassis){var raycastResult=this.raycastResult;if(this.isInContact){var project=raycastResult.hitNormalWorld.dot(raycastResult.directionWorld);raycastResult.hitPointWorld.vsub(chassis.position,relpos),chassis.getVelocityAtWorldPoint(relpos,chassis_velocity_at_contactPoint);var projVel=raycastResult.hitNormalWorld.dot(chassis_velocity_at_contactPoint);if(project&gt;=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var inv=-1/project;this.suspensionRelativeVelocity=projVel*inv,this.clippedInvContactDotSuspension=inv}}else raycastResult.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,raycastResult.directionWorld.scale(-1,raycastResult.hitNormalWorld),this.clippedInvContactDotSuspension=1},WheelInfo}(),chassis_velocity_at_contactPoint=new Vec3,relpos=new Vec3,RaycastVehicle=function(){function RaycastVehicle(options){this.chassisBody=options.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==options.indexRightAxis?options.indexRightAxis:1,this.indexForwardAxis=void 0!==options.indexForwardAxis?options.indexForwardAxis:0,this.indexUpAxis=void 0!==options.indexUpAxis?options.indexUpAxis:2,this.constraints=[],this.preStepCallback=function(){},this.currentVehicleSpeedKmHour=0}var _proto=RaycastVehicle.prototype;return _proto.addWheel=function(options){void 0===options&amp;&amp;(options={});var info=new WheelInfo(options),index=this.wheelInfos.length;return this.wheelInfos.push(info),index},_proto.setSteeringValue=function(value,wheelIndex){this.wheelInfos[wheelIndex].steering=value},_proto.applyEngineForce=function(value,wheelIndex){this.wheelInfos[wheelIndex].engineForce=value},_proto.setBrake=function(brake,wheelIndex){this.wheelInfos[wheelIndex].brake=brake},_proto.addToWorld=function(world){this.constraints;world.addBody(this.chassisBody);var that=this;this.preStepCallback=function(){that.updateVehicle(world.dt)},world.addEventListener(&quot;preStep&quot;,this.preStepCallback),this.world=world},_proto.getVehicleAxisWorld=function(axisIndex,result){result.set(0===axisIndex?1:0,1===axisIndex?1:0,2===axisIndex?1:0),this.chassisBody.vectorToWorldFrame(result,result)},_proto.updateVehicle=function(timeStep){for(var wheelInfos=this.wheelInfos,numWheels=wheelInfos.length,chassisBody=this.chassisBody,i=0;i&lt;numWheels;i++)this.updateWheelTransform(i);this.currentVehicleSpeedKmHour=3.6*chassisBody.velocity.length();var forwardWorld=new Vec3;this.getVehicleAxisWorld(this.indexForwardAxis,forwardWorld),forwardWorld.dot(chassisBody.velocity)&lt;0&amp;&amp;(this.currentVehicleSpeedKmHour*=-1);for(var _i=0;_i&lt;numWheels;_i++)this.castRay(wheelInfos[_i]);this.updateSuspension(timeStep);for(var impulse=new Vec3,relpos=new Vec3,_i2=0;_i2&lt;numWheels;_i2++){var wheel=wheelInfos[_i2],suspensionForce=wheel.suspensionForce;suspensionForce&gt;wheel.maxSuspensionForce&amp;&amp;(suspensionForce=wheel.maxSuspensionForce),wheel.raycastResult.hitNormalWorld.scale(suspensionForce*timeStep,impulse),wheel.raycastResult.hitPointWorld.vsub(chassisBody.position,relpos),chassisBody.applyImpulse(impulse,relpos)}this.updateFriction(timeStep);for(var hitNormalWorldScaledWithProj=new Vec3,fwd=new Vec3,vel=new Vec3,_i3=0;_i3&lt;numWheels;_i3++){var _wheel=wheelInfos[_i3];chassisBody.getVelocityAtWorldPoint(_wheel.chassisConnectionPointWorld,vel);var m=1;switch(this.indexUpAxis){case 1:m=-1}if(_wheel.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,fwd);var proj=fwd.dot(_wheel.raycastResult.hitNormalWorld);_wheel.raycastResult.hitNormalWorld.scale(proj,hitNormalWorldScaledWithProj),fwd.vsub(hitNormalWorldScaledWithProj,fwd);var proj2=fwd.dot(vel);_wheel.deltaRotation=m*proj2*timeStep/_wheel.radius}!_wheel.sliding&amp;&amp;_wheel.isInContact||0===_wheel.engineForce||!_wheel.useCustomSlidingRotationalSpeed||(_wheel.deltaRotation=(_wheel.engineForce&gt;0?1:-1)*_wheel.customSlidingRotationalSpeed*timeStep),Math.abs(_wheel.brake)&gt;Math.abs(_wheel.engineForce)&amp;&amp;(_wheel.deltaRotation=0),_wheel.rotation+=_wheel.deltaRotation,_wheel.deltaRotation*=.99}},_proto.updateSuspension=function(deltaTime){for(var chassisMass=this.chassisBody.mass,wheelInfos=this.wheelInfos,numWheels=wheelInfos.length,w_it=0;w_it&lt;numWheels;w_it++){var wheel=wheelInfos[w_it];if(wheel.isInContact){var force=void 0,length_diff=wheel.suspensionRestLength-wheel.suspensionLength;force=wheel.suspensionStiffness*length_diff*wheel.clippedInvContactDotSuspension;var projected_rel_vel=wheel.suspensionRelativeVelocity;force-=(projected_rel_vel&lt;0?wheel.dampingCompression:wheel.dampingRelaxation)*projected_rel_vel,wheel.suspensionForce=force*chassisMass,wheel.suspensionForce&lt;0&amp;&amp;(wheel.suspensionForce=0)}else wheel.suspensionForce=0}},_proto.removeFromWorld=function(world){this.constraints;world.removeBody(this.chassisBody),world.removeEventListener(&quot;preStep&quot;,this.preStepCallback),this.world=null},_proto.castRay=function(wheel){var rayvector=castRay_rayvector,target=castRay_target;this.updateWheelTransformWorld(wheel);var chassisBody=this.chassisBody,depth=-1,raylen=wheel.suspensionRestLength+wheel.radius;wheel.directionWorld.scale(raylen,rayvector);var source=wheel.chassisConnectionPointWorld;source.vadd(rayvector,target);var raycastResult=wheel.raycastResult;raycastResult.reset();var oldState=chassisBody.collisionResponse;chassisBody.collisionResponse=!1,this.world.rayTest(source,target,raycastResult),chassisBody.collisionResponse=oldState;var object=raycastResult.body;if(wheel.raycastResult.groundObject=0,object){depth=raycastResult.distance,wheel.raycastResult.hitNormalWorld=raycastResult.hitNormalWorld,wheel.isInContact=!0;var hitDistance=raycastResult.distance;wheel.suspensionLength=hitDistance-wheel.radius;var minSuspensionLength=wheel.suspensionRestLength-wheel.maxSuspensionTravel,maxSuspensionLength=wheel.suspensionRestLength+wheel.maxSuspensionTravel;wheel.suspensionLength&lt;minSuspensionLength&amp;&amp;(wheel.suspensionLength=minSuspensionLength),wheel.suspensionLength&gt;maxSuspensionLength&amp;&amp;(wheel.suspensionLength=maxSuspensionLength,wheel.raycastResult.reset());var denominator=wheel.raycastResult.hitNormalWorld.dot(wheel.directionWorld),chassis_velocity_at_contactPoint=new Vec3;chassisBody.getVelocityAtWorldPoint(wheel.raycastResult.hitPointWorld,chassis_velocity_at_contactPoint);var projVel=wheel.raycastResult.hitNormalWorld.dot(chassis_velocity_at_contactPoint);if(denominator&gt;=-.1)wheel.suspensionRelativeVelocity=0,wheel.clippedInvContactDotSuspension=10;else{var inv=-1/denominator;wheel.suspensionRelativeVelocity=projVel*inv,wheel.clippedInvContactDotSuspension=inv}}else wheel.suspensionLength=wheel.suspensionRestLength+0*wheel.maxSuspensionTravel,wheel.suspensionRelativeVelocity=0,wheel.directionWorld.scale(-1,wheel.raycastResult.hitNormalWorld),wheel.clippedInvContactDotSuspension=1;return depth},_proto.updateWheelTransformWorld=function(wheel){wheel.isInContact=!1;var chassisBody=this.chassisBody;chassisBody.pointToWorldFrame(wheel.chassisConnectionPointLocal,wheel.chassisConnectionPointWorld),chassisBody.vectorToWorldFrame(wheel.directionLocal,wheel.directionWorld),chassisBody.vectorToWorldFrame(wheel.axleLocal,wheel.axleWorld)},_proto.updateWheelTransform=function(wheelIndex){var up=tmpVec4,right=tmpVec5,fwd=tmpVec6,wheel=this.wheelInfos[wheelIndex];this.updateWheelTransformWorld(wheel),wheel.directionLocal.scale(-1,up),right.copy(wheel.axleLocal),up.cross(right,fwd),fwd.normalize(),right.normalize();var steering=wheel.steering,steeringOrn=new Quaternion;steeringOrn.setFromAxisAngle(up,steering);var rotatingOrn=new Quaternion;rotatingOrn.setFromAxisAngle(right,wheel.rotation);var q=wheel.worldTransform.quaternion;this.chassisBody.quaternion.mult(steeringOrn,q),q.mult(rotatingOrn,q),q.normalize();var p=wheel.worldTransform.position;p.copy(wheel.directionWorld),p.scale(wheel.suspensionLength,p),p.vadd(wheel.chassisConnectionPointWorld,p)},_proto.getWheelTransformWorld=function(wheelIndex){return this.wheelInfos[wheelIndex].worldTransform},_proto.updateFriction=function(timeStep){for(var surfNormalWS_scaled_proj=updateFriction_surfNormalWS_scaled_proj,wheelInfos=this.wheelInfos,numWheels=wheelInfos.length,chassisBody=this.chassisBody,forwardWS=updateFriction_forwardWS,axle=updateFriction_axle,i=0;i&lt;numWheels;i++){var wheel=wheelInfos[i];wheel.raycastResult.body;wheel.sideImpulse=0,wheel.forwardImpulse=0,forwardWS[i]||(forwardWS[i]=new Vec3),axle[i]||(axle[i]=new Vec3)}for(var _i4=0;_i4&lt;numWheels;_i4++){var _wheel2=wheelInfos[_i4],_groundObject=_wheel2.raycastResult.body;if(_groundObject){var axlei=axle[_i4];this.getWheelTransformWorld(_i4).vectorToWorldFrame(directions[this.indexRightAxis],axlei);var surfNormalWS=_wheel2.raycastResult.hitNormalWorld,proj=axlei.dot(surfNormalWS);surfNormalWS.scale(proj,surfNormalWS_scaled_proj),axlei.vsub(surfNormalWS_scaled_proj,axlei),axlei.normalize(),surfNormalWS.cross(axlei,forwardWS[_i4]),forwardWS[_i4].normalize(),_wheel2.sideImpulse=resolveSingleBilateral(chassisBody,_wheel2.raycastResult.hitPointWorld,_groundObject,_wheel2.raycastResult.hitPointWorld,axlei),_wheel2.sideImpulse*=sideFrictionStiffness2}}this.sliding=!1;for(var _i5=0;_i5&lt;numWheels;_i5++){var _wheel3=wheelInfos[_i5],_groundObject2=_wheel3.raycastResult.body,rollingFriction=0;if(_wheel3.slipInfo=1,_groundObject2){var maxImpulse=_wheel3.brake?_wheel3.brake:0;rollingFriction=calcRollingFriction(chassisBody,_groundObject2,_wheel3.raycastResult.hitPointWorld,forwardWS[_i5],maxImpulse);var factor=maxImpulse/(rollingFriction+=_wheel3.engineForce*timeStep);_wheel3.slipInfo*=factor}if(_wheel3.forwardImpulse=0,_wheel3.skidInfo=1,_groundObject2){_wheel3.skidInfo=1;var maximp=_wheel3.suspensionForce*timeStep*_wheel3.frictionSlip,maximpSquared=maximp*maximp;_wheel3.forwardImpulse=rollingFriction;var x=.5*_wheel3.forwardImpulse,y=1*_wheel3.sideImpulse,impulseSquared=x*x+y*y;if(_wheel3.sliding=!1,impulseSquared&gt;maximpSquared){this.sliding=!0,_wheel3.sliding=!0;var _factor=maximp/Math.sqrt(impulseSquared);_wheel3.skidInfo*=_factor}}}if(this.sliding)for(var _i6=0;_i6&lt;numWheels;_i6++){var _wheel4=wheelInfos[_i6];0!==_wheel4.sideImpulse&amp;&amp;_wheel4.skidInfo&lt;1&amp;&amp;(_wheel4.forwardImpulse*=_wheel4.skidInfo,_wheel4.sideImpulse*=_wheel4.skidInfo)}for(var _i7=0;_i7&lt;numWheels;_i7++){var _wheel5=wheelInfos[_i7],rel_pos=new Vec3;if(_wheel5.raycastResult.hitPointWorld.vsub(chassisBody.position,rel_pos),0!==_wheel5.forwardImpulse){var impulse=new Vec3;forwardWS[_i7].scale(_wheel5.forwardImpulse,impulse),chassisBody.applyImpulse(impulse,rel_pos)}if(0!==_wheel5.sideImpulse){var _groundObject3=_wheel5.raycastResult.body,rel_pos2=new Vec3;_wheel5.raycastResult.hitPointWorld.vsub(_groundObject3.position,rel_pos2);var sideImp=new Vec3;axle[_i7].scale(_wheel5.sideImpulse,sideImp),chassisBody.vectorToLocalFrame(rel_pos,rel_pos),rel_pos[&quot;xyz&quot;[this.indexUpAxis]]*=_wheel5.rollInfluence,chassisBody.vectorToWorldFrame(rel_pos,rel_pos),chassisBody.applyImpulse(sideImp,rel_pos),sideImp.scale(-1,sideImp),_groundObject3.applyImpulse(sideImp,rel_pos2)}}},RaycastVehicle}(),tmpVec4=(new Vec3,new Vec3,new Vec3,new Vec3),tmpVec5=new Vec3,tmpVec6=new Vec3,castRay_rayvector=(new Ray,new Vec3,new Vec3),castRay_target=new Vec3,directions=[new Vec3(1,0,0),new Vec3(0,1,0),new Vec3(0,0,1)],updateFriction_surfNormalWS_scaled_proj=new Vec3,updateFriction_axle=[],updateFriction_forwardWS=[],sideFrictionStiffness2=1,calcRollingFriction_vel1=new Vec3,calcRollingFriction_vel2=new Vec3,calcRollingFriction_vel=new Vec3;function calcRollingFriction(body0,body1,frictionPosWorld,frictionDirectionWorld,maxImpulse){var j1=0,contactPosWorld=frictionPosWorld,vel1=calcRollingFriction_vel1,vel2=calcRollingFriction_vel2,vel=calcRollingFriction_vel;body0.getVelocityAtWorldPoint(contactPosWorld,vel1),body1.getVelocityAtWorldPoint(contactPosWorld,vel2),vel1.vsub(vel2,vel);return maxImpulse&lt;(j1=-frictionDirectionWorld.dot(vel)*(1/(computeImpulseDenominator(body0,frictionPosWorld,frictionDirectionWorld)+computeImpulseDenominator(body1,frictionPosWorld,frictionDirectionWorld))))&amp;&amp;(j1=maxImpulse),j1&lt;-maxImpulse&amp;&amp;(j1=-maxImpulse),j1}var computeImpulseDenominator_r0=new Vec3,computeImpulseDenominator_c0=new Vec3,computeImpulseDenominator_vec=new Vec3,computeImpulseDenominator_m=new Vec3;function computeImpulseDenominator(body,pos,normal){var r0=computeImpulseDenominator_r0,c0=computeImpulseDenominator_c0,vec=computeImpulseDenominator_vec,m=computeImpulseDenominator_m;return pos.vsub(body.position,r0),r0.cross(normal,c0),body.invInertiaWorld.vmult(c0,m),m.cross(r0,vec),body.invMass+normal.dot(vec)}var resolveSingleBilateral_vel1=new Vec3,resolveSingleBilateral_vel2=new Vec3,resolveSingleBilateral_vel=new Vec3;function resolveSingleBilateral(body1,pos1,body2,pos2,normal){if(normal.lengthSquared()&gt;1.1)return 0;var vel1=resolveSingleBilateral_vel1,vel2=resolveSingleBilateral_vel2,vel=resolveSingleBilateral_vel;body1.getVelocityAtWorldPoint(pos1,vel1),body2.getVelocityAtWorldPoint(pos2,vel2),vel1.vsub(vel2,vel);return-.2*normal.dot(vel)*(1/(body1.invMass+body2.invMass))}var Sphere=function(_Shape){function Sphere(radius){var _this;if((_this=_Shape.call(this,{type:Shape.types.SPHERE})||this).radius=void 0!==radius?radius:1,_this.radius&lt;0)throw new Error(&quot;The sphere radius cannot be negative.&quot;);return _this.updateBoundingSphereRadius(),_this}_inheritsLoose(Sphere,_Shape);var _proto=Sphere.prototype;return _proto.calculateLocalInertia=function(mass,target){void 0===target&amp;&amp;(target=new Vec3);var I=2*mass*this.radius*this.radius/5;return target.x=I,target.y=I,target.z=I,target},_proto.volume=function(){return 4*Math.PI*Math.pow(this.radius,3)/3},_proto.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},_proto.calculateWorldAABB=function(pos,quat,min,max){for(var r=this.radius,axes=[&quot;x&quot;,&quot;y&quot;,&quot;z&quot;],i=0;i&lt;axes.length;i++){var ax=axes[i];min[ax]=pos[ax]-r,max[ax]=pos[ax]+r}},Sphere}(Shape),RigidVehicle=function(){function RigidVehicle(options){void 0===options&amp;&amp;(options={}),this.wheelBodies=[],this.coordinateSystem=void 0!==options.coordinateSystem?options.coordinateSystem.clone():new Vec3(1,2,3),options.chassisBody?this.chassisBody=options.chassisBody:this.chassisBody=new Body({mass:1,shape:new Box(new Vec3(5,2,.5))}),this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}var _proto=RigidVehicle.prototype;return _proto.addWheel=function(options){var wheelBody;void 0===options&amp;&amp;(options={}),wheelBody=options.body?options.body:new Body({mass:1,shape:new Sphere(1.2)}),this.wheelBodies.push(wheelBody),this.wheelForces.push(0);new Vec3;var position=void 0!==options.position?options.position.clone():new Vec3,worldPosition=new Vec3;this.chassisBody.pointToWorldFrame(position,worldPosition),wheelBody.position.set(worldPosition.x,worldPosition.y,worldPosition.z);var axis=void 0!==options.axis?options.axis.clone():new Vec3(0,1,0);this.wheelAxes.push(axis);var hingeConstraint=new HingeConstraint(this.chassisBody,wheelBody,{pivotA:position,axisA:axis,pivotB:Vec3.ZERO,axisB:axis,collideConnected:!1});return this.constraints.push(hingeConstraint),this.wheelBodies.length-1},_proto.setSteeringValue=function(value,wheelIndex){var axis=this.wheelAxes[wheelIndex],c=Math.cos(value),s=Math.sin(value),x=axis.x,y=axis.y;this.constraints[wheelIndex].axisA.set(c*x-s*y,s*x+c*y,0)},_proto.setMotorSpeed=function(value,wheelIndex){var hingeConstraint=this.constraints[wheelIndex];hingeConstraint.enableMotor(),hingeConstraint.motorTargetVelocity=value},_proto.disableMotor=function(wheelIndex){this.constraints[wheelIndex].disableMotor()},_proto.setWheelForce=function(value,wheelIndex){this.wheelForces[wheelIndex]=value},_proto.applyWheelForce=function(value,wheelIndex){var axis=this.wheelAxes[wheelIndex],wheelBody=this.wheelBodies[wheelIndex],bodyTorque=wheelBody.torque;axis.scale(value,torque$1),wheelBody.vectorToWorldFrame(torque$1,torque$1),bodyTorque.vadd(torque$1,bodyTorque)},_proto.addToWorld=function(world){for(var constraints=this.constraints,bodies=this.wheelBodies.concat([this.chassisBody]),i=0;i&lt;bodies.length;i++)world.addBody(bodies[i]);for(var _i=0;_i&lt;constraints.length;_i++)world.addConstraint(constraints[_i]);world.addEventListener(&quot;preStep&quot;,this._update.bind(this))},_proto._update=function(){for(var wheelForces=this.wheelForces,i=0;i&lt;wheelForces.length;i++)this.applyWheelForce(wheelForces[i],i)},_proto.removeFromWorld=function(world){for(var constraints=this.constraints,bodies=this.wheelBodies.concat([this.chassisBody]),i=0;i&lt;bodies.length;i++)world.removeBody(bodies[i]);for(var _i2=0;_i2&lt;constraints.length;_i2++)world.removeConstraint(constraints[_i2])},_proto.getWheelSpeed=function(wheelIndex){var axis=this.wheelAxes[wheelIndex],w=this.wheelBodies[wheelIndex].angularVelocity;return this.chassisBody.vectorToWorldFrame(axis,worldAxis),w.dot(worldAxis)},RigidVehicle}(),torque$1=new Vec3,worldAxis=new Vec3,SPHSystem=function(){function SPHSystem(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}var _proto=SPHSystem.prototype;return _proto.add=function(particle){this.particles.push(particle),this.neighbors.length&lt;this.particles.length&amp;&amp;this.neighbors.push([])},_proto.remove=function(particle){var idx=this.particles.indexOf(particle);-1!==idx&amp;&amp;(this.particles.splice(idx,1),this.neighbors.length&gt;this.particles.length&amp;&amp;this.neighbors.pop())},_proto.getNeighbors=function(particle,neighbors){for(var N=this.particles.length,id=particle.id,R2=this.smoothingRadius*this.smoothingRadius,dist=SPHSystem_getNeighbors_dist,i=0;i!==N;i++){var p=this.particles[i];p.position.vsub(particle.position,dist),id!==p.id&amp;&amp;dist.lengthSquared()&lt;R2&amp;&amp;neighbors.push(p)}},_proto.update=function(){for(var N=this.particles.length,dist=SPHSystem_update_dist,cs=this.speedOfSound,eps=this.eps,i=0;i!==N;i++){var p=this.particles[i],neighbors=this.neighbors[i];neighbors.length=0,this.getNeighbors(p,neighbors),neighbors.push(this.particles[i]);for(var numNeighbors=neighbors.length,sum=0,j=0;j!==numNeighbors;j++){p.position.vsub(neighbors[j].position,dist);var len=dist.length(),weight=this.w(len);sum+=neighbors[j].mass*weight}this.densities[i]=sum,this.pressures[i]=cs*cs*(this.densities[i]-this.density)}for(var a_pressure=SPHSystem_update_a_pressure,a_visc=SPHSystem_update_a_visc,gradW=SPHSystem_update_gradW,r_vec=SPHSystem_update_r_vec,u=SPHSystem_update_u,_i=0;_i!==N;_i++){var particle=this.particles[_i];a_pressure.set(0,0,0),a_visc.set(0,0,0);for(var Pij=void 0,nabla=void 0,_neighbors=this.neighbors[_i],_numNeighbors=_neighbors.length,_j=0;_j!==_numNeighbors;_j++){var neighbor=_neighbors[_j];particle.position.vsub(neighbor.position,r_vec);var r=r_vec.length();Pij=-neighbor.mass*(this.pressures[_i]/(this.densities[_i]*this.densities[_i]+eps)+this.pressures[_j]/(this.densities[_j]*this.densities[_j]+eps)),this.gradw(r_vec,gradW),gradW.scale(Pij,gradW),a_pressure.vadd(gradW,a_pressure),neighbor.velocity.vsub(particle.velocity,u),u.scale(1/(1e-4+this.densities[_i]*this.densities[_j])*this.viscosity*neighbor.mass,u),nabla=this.nablaw(r),u.scale(nabla,u),a_visc.vadd(u,a_visc)}a_visc.scale(particle.mass,a_visc),a_pressure.scale(particle.mass,a_pressure),particle.force.vadd(a_visc,particle.force),particle.force.vadd(a_pressure,particle.force)}},_proto.w=function(r){var h=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(h,9))*Math.pow(h*h-r*r,3)},_proto.gradw=function(rVec,resultVec){var r=rVec.length(),h=this.smoothingRadius;rVec.scale(945/(32*Math.PI*Math.pow(h,9))*Math.pow(h*h-r*r,2),resultVec)},_proto.nablaw=function(r){var h=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(h,9))*(h*h-r*r)*(7*r*r-3*h*h)},SPHSystem}(),SPHSystem_getNeighbors_dist=new Vec3,SPHSystem_update_dist=new Vec3,SPHSystem_update_a_pressure=new Vec3,SPHSystem_update_a_visc=new Vec3,SPHSystem_update_gradW=new Vec3,SPHSystem_update_r_vec=new Vec3,SPHSystem_update_u=new Vec3,Cylinder=function(_ConvexPolyhedron){function Cylinder(radiusTop,radiusBottom,height,numSegments){var N=numSegments,vertices=[],axes=[],faces=[],bottomface=[],topface=[],cos=Math.cos,sin=Math.sin;vertices.push(new Vec3(radiusBottom*cos(0),radiusBottom*sin(0),.5*-height)),bottomface.push(0),vertices.push(new Vec3(radiusTop*cos(0),radiusTop*sin(0),.5*height)),topface.push(1);for(var i=0;i&lt;N;i++){var theta=2*Math.PI/N*(i+1),thetaN=2*Math.PI/N*(i+.5);i&lt;N-1?(vertices.push(new Vec3(radiusBottom*cos(theta),radiusBottom*sin(theta),.5*-height)),bottomface.push(2*i+2),vertices.push(new Vec3(radiusTop*cos(theta),radiusTop*sin(theta),.5*height)),topface.push(2*i+3),faces.push([2*i+2,2*i+3,2*i+1,2*i])):faces.push([0,1,2*i+1,2*i]),(N%2==1||i&lt;N/2)&amp;&amp;axes.push(new Vec3(cos(thetaN),sin(thetaN),0))}faces.push(topface),axes.push(new Vec3(0,0,1));for(var temp=[],_i=0;_i&lt;bottomface.length;_i++)temp.push(bottomface[bottomface.length-_i-1]);return faces.push(temp),_ConvexPolyhedron.call(this,{vertices:vertices,faces:faces,axes:axes})||this}return _inheritsLoose(Cylinder,_ConvexPolyhedron),Cylinder}(ConvexPolyhedron),Particle=function(_Shape){function Particle(){return _Shape.call(this,{type:Shape.types.PARTICLE})||this}_inheritsLoose(Particle,_Shape);var _proto=Particle.prototype;return _proto.calculateLocalInertia=function(mass,target){return void 0===target&amp;&amp;(target=new Vec3),target.set(0,0,0),target},_proto.volume=function(){return 0},_proto.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},_proto.calculateWorldAABB=function(pos,quat,min,max){min.copy(pos),max.copy(pos)},Particle}(Shape),Plane=function(_Shape){function Plane(){var _this;return(_this=_Shape.call(this,{type:Shape.types.PLANE})||this).worldNormal=new Vec3,_this.worldNormalNeedsUpdate=!0,_this.boundingSphereRadius=Number.MAX_VALUE,_this}_inheritsLoose(Plane,_Shape);var _proto=Plane.prototype;return _proto.computeWorldNormal=function(quat){var n=this.worldNormal;n.set(0,0,1),quat.vmult(n,n),this.worldNormalNeedsUpdate=!1},_proto.calculateLocalInertia=function(mass,target){return void 0===target&amp;&amp;(target=new Vec3),target},_proto.volume=function(){return Number.MAX_VALUE},_proto.calculateWorldAABB=function(pos,quat,min,max){tempNormal.set(0,0,1),quat.vmult(tempNormal,tempNormal);var maxVal=Number.MAX_VALUE;min.set(-maxVal,-maxVal,-maxVal),max.set(maxVal,maxVal,maxVal),1===tempNormal.x?max.x=pos.x:-1===tempNormal.x&amp;&amp;(min.x=pos.x),1===tempNormal.y?max.y=pos.y:-1===tempNormal.y&amp;&amp;(min.y=pos.y),1===tempNormal.z?max.z=pos.z:-1===tempNormal.z&amp;&amp;(min.z=pos.z)},_proto.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE},Plane}(Shape),tempNormal=new Vec3,Heightfield=function(_Shape){function Heightfield(data,options){var _this;return void 0===options&amp;&amp;(options={}),options=Utils.defaults(options,{maxValue:null,minValue:null,elementSize:1}),(_this=_Shape.call(this,{type:Shape.types.HEIGHTFIELD})||this).data=data,_this.maxValue=options.maxValue,_this.minValue=options.minValue,_this.elementSize=options.elementSize,null===options.minValue&amp;&amp;_this.updateMinValue(),null===options.maxValue&amp;&amp;_this.updateMaxValue(),_this.cacheEnabled=!0,_this.pillarConvex=new ConvexPolyhedron,_this.pillarOffset=new Vec3,_this.updateBoundingSphereRadius(),_this._cachedPillars={},_this}_inheritsLoose(Heightfield,_Shape);var _proto=Heightfield.prototype;return _proto.update=function(){this._cachedPillars={}},_proto.updateMinValue=function(){for(var data=this.data,minValue=data[0][0],i=0;i!==data.length;i++)for(var j=0;j!==data[i].length;j++){var v=data[i][j];v&lt;minValue&amp;&amp;(minValue=v)}this.minValue=minValue},_proto.updateMaxValue=function(){for(var data=this.data,maxValue=data[0][0],i=0;i!==data.length;i++)for(var j=0;j!==data[i].length;j++){var v=data[i][j];v&gt;maxValue&amp;&amp;(maxValue=v)}this.maxValue=maxValue},_proto.setHeightValueAtIndex=function(xi,yi,value){this.data[xi][yi]=value,this.clearCachedConvexTrianglePillar(xi,yi,!1),xi&gt;0&amp;&amp;(this.clearCachedConvexTrianglePillar(xi-1,yi,!0),this.clearCachedConvexTrianglePillar(xi-1,yi,!1)),yi&gt;0&amp;&amp;(this.clearCachedConvexTrianglePillar(xi,yi-1,!0),this.clearCachedConvexTrianglePillar(xi,yi-1,!1)),yi&gt;0&amp;&amp;xi&gt;0&amp;&amp;this.clearCachedConvexTrianglePillar(xi-1,yi-1,!0)},_proto.getRectMinMax=function(iMinX,iMinY,iMaxX,iMaxY,result){void 0===result&amp;&amp;(result=[]);for(var data=this.data,max=this.minValue,i=iMinX;i&lt;=iMaxX;i++)for(var j=iMinY;j&lt;=iMaxY;j++){var height=data[i][j];height&gt;max&amp;&amp;(max=height)}result[0]=this.minValue,result[1]=max},_proto.getIndexOfPosition=function(x,y,result,clamp){var w=this.elementSize,data=this.data,xi=Math.floor(x/w),yi=Math.floor(y/w);return result[0]=xi,result[1]=yi,clamp&amp;&amp;(xi&lt;0&amp;&amp;(xi=0),yi&lt;0&amp;&amp;(yi=0),xi&gt;=data.length-1&amp;&amp;(xi=data.length-1),yi&gt;=data[0].length-1&amp;&amp;(yi=data[0].length-1)),!(xi&lt;0||yi&lt;0||xi&gt;=data.length-1||yi&gt;=data[0].length-1)},_proto.getTriangleAt=function(x,y,edgeClamp,a,b,c){var idx=getHeightAt_idx;this.getIndexOfPosition(x,y,idx,edgeClamp);var xi=idx[0],yi=idx[1],data=this.data;edgeClamp&amp;&amp;(xi=Math.min(data.length-2,Math.max(0,xi)),yi=Math.min(data[0].length-2,Math.max(0,yi)));var elementSize=this.elementSize,upper=Math.pow(x/elementSize-xi,2)+Math.pow(y/elementSize-yi,2)&gt;Math.pow(x/elementSize-(xi+1),2)+Math.pow(y/elementSize-(yi+1),2);return this.getTriangle(xi,yi,upper,a,b,c),upper},_proto.getNormalAt=function(x,y,edgeClamp,result){var a=getNormalAt_a,b=getNormalAt_b,c=getNormalAt_c,e0=getNormalAt_e0,e1=getNormalAt_e1;this.getTriangleAt(x,y,edgeClamp,a,b,c),b.vsub(a,e0),c.vsub(a,e1),e0.cross(e1,result),result.normalize()},_proto.getAabbAtIndex=function(xi,yi,_ref){var lowerBound=_ref.lowerBound,upperBound=_ref.upperBound,data=this.data,elementSize=this.elementSize;lowerBound.set(xi*elementSize,yi*elementSize,data[xi][yi]),upperBound.set((xi+1)*elementSize,(yi+1)*elementSize,data[xi+1][yi+1])},_proto.getHeightAt=function(x,y,edgeClamp){var data=this.data,a=getHeightAt_a,b=getHeightAt_b,c=getHeightAt_c,idx=getHeightAt_idx;this.getIndexOfPosition(x,y,idx,edgeClamp);var xi=idx[0],yi=idx[1];edgeClamp&amp;&amp;(xi=Math.min(data.length-2,Math.max(0,xi)),yi=Math.min(data[0].length-2,Math.max(0,yi)));var upper=this.getTriangleAt(x,y,edgeClamp,a,b,c);!function(x,y,ax,ay,bx,by,cx,cy,result){result.x=((by-cy)*(x-cx)+(cx-bx)*(y-cy))/((by-cy)*(ax-cx)+(cx-bx)*(ay-cy)),result.y=((cy-ay)*(x-cx)+(ax-cx)*(y-cy))/((by-cy)*(ax-cx)+(cx-bx)*(ay-cy)),result.z=1-result.x-result.y}(x,y,a.x,a.y,b.x,b.y,c.x,c.y,getHeightAt_weights);var w=getHeightAt_weights;return upper?data[xi+1][yi+1]*w.x+data[xi][yi+1]*w.y+data[xi+1][yi]*w.z:data[xi][yi]*w.x+data[xi+1][yi]*w.y+data[xi][yi+1]*w.z},_proto.getCacheConvexTrianglePillarKey=function(xi,yi,getUpperTriangle){return xi+&quot;_&quot;+yi+&quot;_&quot;+(getUpperTriangle?1:0)},_proto.getCachedConvexTrianglePillar=function(xi,yi,getUpperTriangle){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(xi,yi,getUpperTriangle)]},_proto.setCachedConvexTrianglePillar=function(xi,yi,getUpperTriangle,convex,offset){this._cachedPillars[this.getCacheConvexTrianglePillarKey(xi,yi,getUpperTriangle)]={convex:convex,offset:offset}},_proto.clearCachedConvexTrianglePillar=function(xi,yi,getUpperTriangle){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(xi,yi,getUpperTriangle)]},_proto.getTriangle=function(xi,yi,upper,a,b,c){var data=this.data,elementSize=this.elementSize;upper?(a.set((xi+1)*elementSize,(yi+1)*elementSize,data[xi+1][yi+1]),b.set(xi*elementSize,(yi+1)*elementSize,data[xi][yi+1]),c.set((xi+1)*elementSize,yi*elementSize,data[xi+1][yi])):(a.set(xi*elementSize,yi*elementSize,data[xi][yi]),b.set((xi+1)*elementSize,yi*elementSize,data[xi+1][yi]),c.set(xi*elementSize,(yi+1)*elementSize,data[xi][yi+1]))},_proto.getConvexTrianglePillar=function(xi,yi,getUpperTriangle){var result=this.pillarConvex,offsetResult=this.pillarOffset;if(this.cacheEnabled){var _data=this.getCachedConvexTrianglePillar(xi,yi,getUpperTriangle);if(_data)return this.pillarConvex=_data.convex,void(this.pillarOffset=_data.offset);result=new ConvexPolyhedron,offsetResult=new Vec3,this.pillarConvex=result,this.pillarOffset=offsetResult}var data=this.data,elementSize=this.elementSize,faces=result.faces;result.vertices.length=6;for(var i=0;i&lt;6;i++)result.vertices[i]||(result.vertices[i]=new Vec3);faces.length=5;for(var _i=0;_i&lt;5;_i++)faces[_i]||(faces[_i]=[]);var verts=result.vertices,h=(Math.min(data[xi][yi],data[xi+1][yi],data[xi][yi+1],data[xi+1][yi+1])-this.minValue)/2+this.minValue;getUpperTriangle?(offsetResult.set((xi+.75)*elementSize,(yi+.75)*elementSize,h),verts[0].set(.25*elementSize,.25*elementSize,data[xi+1][yi+1]-h),verts[1].set(-.75*elementSize,.25*elementSize,data[xi][yi+1]-h),verts[2].set(.25*elementSize,-.75*elementSize,data[xi+1][yi]-h),verts[3].set(.25*elementSize,.25*elementSize,-h-1),verts[4].set(-.75*elementSize,.25*elementSize,-h-1),verts[5].set(.25*elementSize,-.75*elementSize,-h-1),faces[0][0]=0,faces[0][1]=1,faces[0][2]=2,faces[1][0]=5,faces[1][1]=4,faces[1][2]=3,faces[2][0]=2,faces[2][1]=5,faces[2][2]=3,faces[2][3]=0,faces[3][0]=3,faces[3][1]=4,faces[3][2]=1,faces[3][3]=0,faces[4][0]=1,faces[4][1]=4,faces[4][2]=5,faces[4][3]=2):(offsetResult.set((xi+.25)*elementSize,(yi+.25)*elementSize,h),verts[0].set(-.25*elementSize,-.25*elementSize,data[xi][yi]-h),verts[1].set(.75*elementSize,-.25*elementSize,data[xi+1][yi]-h),verts[2].set(-.25*elementSize,.75*elementSize,data[xi][yi+1]-h),verts[3].set(-.25*elementSize,-.25*elementSize,-h-1),verts[4].set(.75*elementSize,-.25*elementSize,-h-1),verts[5].set(-.25*elementSize,.75*elementSize,-h-1),faces[0][0]=0,faces[0][1]=1,faces[0][2]=2,faces[1][0]=5,faces[1][1]=4,faces[1][2]=3,faces[2][0]=0,faces[2][1]=2,faces[2][2]=5,faces[2][3]=3,faces[3][0]=1,faces[3][1]=0,faces[3][2]=3,faces[3][3]=4,faces[4][0]=4,faces[4][1]=5,faces[4][2]=2,faces[4][3]=1),result.computeNormals(),result.computeEdges(),result.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(xi,yi,getUpperTriangle,result,offsetResult)},_proto.calculateLocalInertia=function(mass,target){return void 0===target&amp;&amp;(target=new Vec3),target.set(0,0,0),target},_proto.volume=function(){return Number.MAX_VALUE},_proto.calculateWorldAABB=function(pos,quat,min,max){min.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),max.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},_proto.updateBoundingSphereRadius=function(){var data=this.data,s=this.elementSize;this.boundingSphereRadius=new Vec3(data.length*s,data[0].length*s,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).length()},_proto.setHeightsFromImage=function(image,scale){var x=scale.x,z=scale.z,y=scale.y,canvas=document.createElement(&quot;canvas&quot;);canvas.width=image.width,canvas.height=image.height;var context=canvas.getContext(&quot;2d&quot;);context.drawImage(image,0,0);var imageData=context.getImageData(0,0,image.width,image.height),matrix=this.data;matrix.length=0,this.elementSize=Math.abs(x)/imageData.width;for(var i=0;i&lt;imageData.height;i++){for(var row=[],j=0;j&lt;imageData.width;j++){var height=(imageData.data[4*(i*imageData.height+j)]+imageData.data[4*(i*imageData.height+j)+1]+imageData.data[4*(i*imageData.height+j)+2])/4/255*z;x&lt;0?row.push(height):row.unshift(height)}y&lt;0?matrix.unshift(row):matrix.push(row)}this.updateMaxValue(),this.updateMinValue(),this.update()},Heightfield}(Shape),getHeightAt_idx=[],getHeightAt_weights=new Vec3,getHeightAt_a=new Vec3,getHeightAt_b=new Vec3,getHeightAt_c=new Vec3,getNormalAt_a=new Vec3,getNormalAt_b=new Vec3,getNormalAt_c=new Vec3,getNormalAt_e0=new Vec3,getNormalAt_e1=new Vec3;var Octree=function(_OctreeNode){function Octree(aabb,options){var _this;return void 0===options&amp;&amp;(options={}),(_this=_OctreeNode.call(this,{root:null,aabb:aabb})||this).maxDepth=void 0!==options.maxDepth?options.maxDepth:8,_this}return _inheritsLoose(Octree,_OctreeNode),Octree}(function(){function OctreeNode(options){void 0===options&amp;&amp;(options={}),this.root=options.root||null,this.aabb=options.aabb?options.aabb.clone():new AABB,this.data=[],this.children=[]}var _proto=OctreeNode.prototype;return _proto.reset=function(){this.children.length=this.data.length=0},_proto.insert=function(aabb,elementData,level){void 0===level&amp;&amp;(level=0);var nodeData=this.data;if(!this.aabb.contains(aabb))return!1;var children=this.children;if(level&lt;(this.maxDepth||this.root.maxDepth)){var subdivided=!1;children.length||(this.subdivide(),subdivided=!0);for(var i=0;8!==i;i++)if(children[i].insert(aabb,elementData,level+1))return!0;subdivided&amp;&amp;(children.length=0)}return nodeData.push(elementData),!0},_proto.subdivide=function(){var aabb=this.aabb,l=aabb.lowerBound,u=aabb.upperBound,children=this.children;children.push(new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,0,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,0,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,1,0)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,1,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,1,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,0,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(1,0,1)})}),new OctreeNode({aabb:new AABB({lowerBound:new Vec3(0,1,0)})})),u.vsub(l,halfDiagonal),halfDiagonal.scale(.5,halfDiagonal);for(var root=this.root||this,i=0;8!==i;i++){var child=children[i];child.root=root;var lowerBound=child.aabb.lowerBound;lowerBound.x*=halfDiagonal.x,lowerBound.y*=halfDiagonal.y,lowerBound.z*=halfDiagonal.z,lowerBound.vadd(l,lowerBound),lowerBound.vadd(halfDiagonal,child.aabb.upperBound)}},_proto.aabbQuery=function(aabb,result){this.data,this.children;for(var queue=[this];queue.length;){var node=queue.pop();node.aabb.overlaps(aabb)&amp;&amp;Array.prototype.push.apply(result,node.data),Array.prototype.push.apply(queue,node.children)}return result},_proto.rayQuery=function(ray,treeTransform,result){return ray.getAABB(tmpAABB$1),tmpAABB$1.toLocalFrame(treeTransform,tmpAABB$1),this.aabbQuery(tmpAABB$1,result),result},_proto.removeEmptyNodes=function(){for(var i=this.children.length-1;i&gt;=0;i--)this.children[i].removeEmptyNodes(),this.children[i].children.length||this.children[i].data.length||this.children.splice(i,1)},OctreeNode}()),halfDiagonal=new Vec3,tmpAABB$1=new AABB,Trimesh=function(_Shape){function Trimesh(vertices,indices){var _this;return(_this=_Shape.call(this,{type:Shape.types.TRIMESH})||this).vertices=new Float32Array(vertices),_this.indices=new Int16Array(indices),_this.normals=new Float32Array(indices.length),_this.aabb=new AABB,_this.edges=null,_this.scale=new Vec3(1,1,1),_this.tree=new Octree,_this.updateEdges(),_this.updateNormals(),_this.updateAABB(),_this.updateBoundingSphereRadius(),_this.updateTree(),_this}_inheritsLoose(Trimesh,_Shape);var _proto=Trimesh.prototype;return _proto.updateTree=function(){var tree=this.tree;tree.reset(),tree.aabb.copy(this.aabb);var scale=this.scale;tree.aabb.lowerBound.x*=1/scale.x,tree.aabb.lowerBound.y*=1/scale.y,tree.aabb.lowerBound.z*=1/scale.z,tree.aabb.upperBound.x*=1/scale.x,tree.aabb.upperBound.y*=1/scale.y,tree.aabb.upperBound.z*=1/scale.z;for(var triangleAABB=new AABB,a=new Vec3,b=new Vec3,c=new Vec3,points=[a,b,c],i=0;i&lt;this.indices.length/3;i++){var i3=3*i;this._getUnscaledVertex(this.indices[i3],a),this._getUnscaledVertex(this.indices[i3+1],b),this._getUnscaledVertex(this.indices[i3+2],c),triangleAABB.setFromPoints(points),tree.insert(triangleAABB,i)}tree.removeEmptyNodes()},_proto.getTrianglesInAABB=function(aabb,result){unscaledAABB.copy(aabb);var scale=this.scale,isx=scale.x,isy=scale.y,isz=scale.z,l=unscaledAABB.lowerBound,u=unscaledAABB.upperBound;return l.x/=isx,l.y/=isy,l.z/=isz,u.x/=isx,u.y/=isy,u.z/=isz,this.tree.aabbQuery(unscaledAABB,result)},_proto.setScale=function(scale){var wasUniform=this.scale.x===this.scale.y&amp;&amp;this.scale.y===this.scale.z,isUniform=scale.x===scale.y&amp;&amp;scale.y===scale.z;wasUniform&amp;&amp;isUniform||this.updateNormals(),this.scale.copy(scale),this.updateAABB(),this.updateBoundingSphereRadius()},_proto.updateNormals=function(){for(var n=computeNormals_n,normals=this.normals,i=0;i&lt;this.indices.length/3;i++){var i3=3*i,a=this.indices[i3],b=this.indices[i3+1],c=this.indices[i3+2];this.getVertex(a,va),this.getVertex(b,vb),this.getVertex(c,vc),Trimesh.computeNormal(vb,va,vc,n),normals[i3]=n.x,normals[i3+1]=n.y,normals[i3+2]=n.z}},_proto.updateEdges=function(){for(var edges={},add=function(a,b){edges[a&lt;b?a+&quot;_&quot;+b:b+&quot;_&quot;+a]=!0},i=0;i&lt;this.indices.length/3;i++){var i3=3*i,a=this.indices[i3],b=this.indices[i3+1],c=this.indices[i3+2];add(a,b),add(b,c),add(c,a)}var keys=Object.keys(edges);this.edges=new Int16Array(2*keys.length);for(var _i=0;_i&lt;keys.length;_i++){var indices=keys[_i].split(&quot;_&quot;);this.edges[2*_i]=parseInt(indices[0],10),this.edges[2*_i+1]=parseInt(indices[1],10)}},_proto.getEdgeVertex=function(edgeIndex,firstOrSecond,vertexStore){var vertexIndex=this.edges[2*edgeIndex+(firstOrSecond?1:0)];this.getVertex(vertexIndex,vertexStore)},_proto.getEdgeVector=function(edgeIndex,vectorStore){var va=getEdgeVector_va,vb=getEdgeVector_vb;this.getEdgeVertex(edgeIndex,0,va),this.getEdgeVertex(edgeIndex,1,vb),vb.vsub(va,vectorStore)},_proto.getVertex=function(i,out){var scale=this.scale;return this._getUnscaledVertex(i,out),out.x*=scale.x,out.y*=scale.y,out.z*=scale.z,out},_proto._getUnscaledVertex=function(i,out){var i3=3*i,vertices=this.vertices;return out.set(vertices[i3],vertices[i3+1],vertices[i3+2])},_proto.getWorldVertex=function(i,pos,quat,out){return this.getVertex(i,out),Transform.pointToWorldFrame(pos,quat,out,out),out},_proto.getTriangleVertices=function(i,a,b,c){var i3=3*i;this.getVertex(this.indices[i3],a),this.getVertex(this.indices[i3+1],b),this.getVertex(this.indices[i3+2],c)},_proto.getNormal=function(i,target){var i3=3*i;return target.set(this.normals[i3],this.normals[i3+1],this.normals[i3+2])},_proto.calculateLocalInertia=function(mass,target){this.computeLocalAABB(cli_aabb);var x=cli_aabb.upperBound.x-cli_aabb.lowerBound.x,y=cli_aabb.upperBound.y-cli_aabb.lowerBound.y,z=cli_aabb.upperBound.z-cli_aabb.lowerBound.z;return target.set(1/12*mass*(2*y*2*y+2*z*2*z),1/12*mass*(2*x*2*x+2*z*2*z),1/12*mass*(2*y*2*y+2*x*2*x))},_proto.computeLocalAABB=function(aabb){var l=aabb.lowerBound,u=aabb.upperBound,n=this.vertices.length,v=(this.vertices,computeLocalAABB_worldVert);this.getVertex(0,v),l.copy(v),u.copy(v);for(var i=0;i!==n;i++)this.getVertex(i,v),v.x&lt;l.x?l.x=v.x:v.x&gt;u.x&amp;&amp;(u.x=v.x),v.y&lt;l.y?l.y=v.y:v.y&gt;u.y&amp;&amp;(u.y=v.y),v.z&lt;l.z?l.z=v.z:v.z&gt;u.z&amp;&amp;(u.z=v.z)},_proto.updateAABB=function(){this.computeLocalAABB(this.aabb)},_proto.updateBoundingSphereRadius=function(){for(var max2=0,vertices=this.vertices,v=new Vec3,i=0,N=vertices.length/3;i!==N;i++){this.getVertex(i,v);var norm2=v.lengthSquared();norm2&gt;max2&amp;&amp;(max2=norm2)}this.boundingSphereRadius=Math.sqrt(max2)},_proto.calculateWorldAABB=function(pos,quat,min,max){var frame=calculateWorldAABB_frame,result=calculateWorldAABB_aabb;frame.position=pos,frame.quaternion=quat,this.aabb.toWorldFrame(frame,result),min.copy(result.lowerBound),max.copy(result.upperBound)},_proto.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},Trimesh}(Shape),computeNormals_n=new Vec3,unscaledAABB=new AABB,getEdgeVector_va=new Vec3,getEdgeVector_vb=new Vec3,cb=new Vec3,ab=new Vec3;Trimesh.computeNormal=function(va,vb,vc,target){vb.vsub(va,ab),vc.vsub(vb,cb),cb.cross(ab,target),target.isZero()||target.normalize()};var va=new Vec3,vb=new Vec3,vc=new Vec3,cli_aabb=new AABB,computeLocalAABB_worldVert=new Vec3,calculateWorldAABB_frame=new Transform,calculateWorldAABB_aabb=new AABB;Trimesh.createTorus=function(radius,tube,radialSegments,tubularSegments,arc){void 0===radius&amp;&amp;(radius=1),void 0===tube&amp;&amp;(tube=.5),void 0===radialSegments&amp;&amp;(radialSegments=8),void 0===tubularSegments&amp;&amp;(tubularSegments=6),void 0===arc&amp;&amp;(arc=2*Math.PI);for(var vertices=[],indices=[],j=0;j&lt;=radialSegments;j++)for(var i=0;i&lt;=tubularSegments;i++){var u=i/tubularSegments*arc,v=j/radialSegments*Math.PI*2,x=(radius+tube*Math.cos(v))*Math.cos(u),y=(radius+tube*Math.cos(v))*Math.sin(u),z=tube*Math.sin(v);vertices.push(x,y,z)}for(var _j=1;_j&lt;=radialSegments;_j++)for(var _i2=1;_i2&lt;=tubularSegments;_i2++){var a=(tubularSegments+1)*_j+_i2-1,b=(tubularSegments+1)*(_j-1)+_i2-1,c=(tubularSegments+1)*(_j-1)+_i2,d=(tubularSegments+1)*_j+_i2;indices.push(a,b,d),indices.push(b,c,d)}return new Trimesh(vertices,indices)};var Solver=function(){function Solver(){this.equations=[]}var _proto=Solver.prototype;return _proto.solve=function(dt,world){return 0},_proto.addEquation=function(eq){eq.enabled&amp;&amp;this.equations.push(eq)},_proto.removeEquation=function(eq){var eqs=this.equations,i=eqs.indexOf(eq);-1!==i&amp;&amp;eqs.splice(i,1)},_proto.removeAllEquations=function(){this.equations.length=0},Solver}(),GSSolver=function(_Solver){function GSSolver(){var _this;return(_this=_Solver.call(this)||this).iterations=10,_this.tolerance=1e-7,_this}return _inheritsLoose(GSSolver,_Solver),GSSolver.prototype.solve=function(dt,world){var B,invC,deltalambda,deltalambdaTot,lambdaj,iter=0,maxIter=this.iterations,tolSquared=this.tolerance*this.tolerance,equations=this.equations,Neq=equations.length,bodies=world.bodies,Nbodies=bodies.length,h=dt;if(0!==Neq)for(var i=0;i!==Nbodies;i++)bodies[i].updateSolveMassProperties();var invCs=GSSolver_solve_invCs,Bs=GSSolver_solve_Bs,lambda=GSSolver_solve_lambda;invCs.length=Neq,Bs.length=Neq,lambda.length=Neq;for(var _i=0;_i!==Neq;_i++){var c=equations[_i];lambda[_i]=0,Bs[_i]=c.computeB(h),invCs[_i]=1/c.computeC()}if(0!==Neq){for(var _i2=0;_i2!==Nbodies;_i2++){var b=bodies[_i2],vlambda=b.vlambda,wlambda=b.wlambda;vlambda.set(0,0,0),wlambda.set(0,0,0)}for(iter=0;iter!==maxIter;iter++){deltalambdaTot=0;for(var j=0;j!==Neq;j++){var _c=equations[j];B=Bs[j],invC=invCs[j],(lambdaj=lambda[j])+(deltalambda=invC*(B-_c.computeGWlambda()-_c.eps*lambdaj))&lt;_c.minForce?deltalambda=_c.minForce-lambdaj:lambdaj+deltalambda&gt;_c.maxForce&amp;&amp;(deltalambda=_c.maxForce-lambdaj),lambda[j]+=deltalambda,deltalambdaTot+=deltalambda&gt;0?deltalambda:-deltalambda,_c.addToWlambda(deltalambda)}if(deltalambdaTot*deltalambdaTot&lt;tolSquared)break}for(var _i3=0;_i3!==Nbodies;_i3++){var _b=bodies[_i3],v=_b.velocity,w=_b.angularVelocity;_b.vlambda.vmul(_b.linearFactor,_b.vlambda),v.vadd(_b.vlambda,v),_b.wlambda.vmul(_b.angularFactor,_b.wlambda),w.vadd(_b.wlambda,w)}for(var l=equations.length,invDt=1/h;l--;)equations[l].multiplier=lambda[l]*invDt}return iter},GSSolver}(Solver),GSSolver_solve_lambda=[],GSSolver_solve_invCs=[],GSSolver_solve_Bs=[],SplitSolver=function(_Solver){function SplitSolver(subsolver){var _this;for((_this=_Solver.call(this)||this).iterations=10,_this.tolerance=1e-7,_this.subsolver=subsolver,_this.nodes=[],_this.nodePool=[];_this.nodePool.length&lt;128;)_this.nodePool.push(_this.createNode());return _this}_inheritsLoose(SplitSolver,_Solver);var _proto=SplitSolver.prototype;return _proto.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},_proto.solve=function(dt,world){for(var child,nodes=SplitSolver_solve_nodes,nodePool=this.nodePool,bodies=world.bodies,equations=this.equations,Neq=equations.length,Nbodies=bodies.length,subsolver=this.subsolver;nodePool.length&lt;Nbodies;)nodePool.push(this.createNode());nodes.length=Nbodies;for(var i=0;i&lt;Nbodies;i++)nodes[i]=nodePool[i];for(var _i=0;_i!==Nbodies;_i++){var _node=nodes[_i];_node.body=bodies[_i],_node.children.length=0,_node.eqs.length=0,_node.visited=!1}for(var k=0;k!==Neq;k++){var eq=equations[k],_i2=bodies.indexOf(eq.bi),j=bodies.indexOf(eq.bj),ni=nodes[_i2],nj=nodes[j];ni.children.push(nj),ni.eqs.push(eq),nj.children.push(ni),nj.eqs.push(eq)}var n=0,eqs=SplitSolver_solve_eqs;subsolver.tolerance=this.tolerance,subsolver.iterations=this.iterations;for(var dummyWorld=SplitSolver_solve_dummyWorld;child=getUnvisitedNode(nodes);){eqs.length=0,dummyWorld.bodies.length=0,bfs(child,visitFunc,dummyWorld.bodies,eqs);var Neqs=eqs.length;eqs=eqs.sort(sortById);for(var _i3=0;_i3!==Neqs;_i3++)subsolver.addEquation(eqs[_i3]);subsolver.solve(dt,dummyWorld);subsolver.removeAllEquations(),n++}return n},SplitSolver}(Solver),SplitSolver_solve_nodes=[],SplitSolver_solve_eqs=[],SplitSolver_solve_dummyWorld={bodies:[]},STATIC=Body.STATIC;function getUnvisitedNode(nodes){for(var Nnodes=nodes.length,i=0;i!==Nnodes;i++){var _node2=nodes[i];if(!(_node2.visited||_node2.body.type&amp;STATIC))return _node2}return!1}var queue=[];function bfs(root,visitFunc,bds,eqs){for(queue.push(root),root.visited=!0,visitFunc(root,bds,eqs);queue.length;)for(var _node3=queue.pop(),child=void 0;child=getUnvisitedNode(_node3.children);)child.visited=!0,visitFunc(child,bds,eqs),queue.push(child)}function visitFunc(node,bds,eqs){bds.push(node.body);for(var Neqs=node.eqs.length,i=0;i!==Neqs;i++){var eq=node.eqs[i];eqs.includes(eq)||eqs.push(eq)}}function sortById(a,b){return b.id-a.id}var Pool=function(){function Pool(){this.objects=[],this.type=Object}var _proto=Pool.prototype;return _proto.release=function(){for(var Nargs=arguments.length,i=0;i!==Nargs;i++)this.objects.push(i&lt;0||arguments.length&lt;=i?void 0:arguments[i]);return this},_proto.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},_proto.constructObject=function(){throw new Error(&quot;constructObject() not implemented in this Pool subclass yet!&quot;)},_proto.resize=function(size){for(var objects=this.objects;objects.length&gt;size;)objects.pop();for(;objects.length&lt;size;)objects.push(this.constructObject());return this},Pool}(),Vec3Pool=function(_Pool){function Vec3Pool(){var _this;return(_this=_Pool.call(this)||this).type=Vec3,_this}return _inheritsLoose(Vec3Pool,_Pool),Vec3Pool.prototype.constructObject=function(){return new Vec3},Vec3Pool}(Pool),COLLISION_TYPES={sphereSphere:Shape.types.SPHERE,spherePlane:Shape.types.SPHERE|Shape.types.PLANE,boxBox:Shape.types.BOX|Shape.types.BOX,sphereBox:Shape.types.SPHERE|Shape.types.BOX,planeBox:Shape.types.PLANE|Shape.types.BOX,convexConvex:Shape.types.CONVEXPOLYHEDRON,sphereConvex:Shape.types.SPHERE|Shape.types.CONVEXPOLYHEDRON,planeConvex:Shape.types.PLANE|Shape.types.CONVEXPOLYHEDRON,boxConvex:Shape.types.BOX|Shape.types.CONVEXPOLYHEDRON,sphereHeightfield:Shape.types.SPHERE|Shape.types.HEIGHTFIELD,boxHeightfield:Shape.types.BOX|Shape.types.HEIGHTFIELD,convexHeightfield:Shape.types.CONVEXPOLYHEDRON|Shape.types.HEIGHTFIELD,sphereParticle:Shape.types.PARTICLE|Shape.types.SPHERE,planeParticle:Shape.types.PLANE|Shape.types.PARTICLE,boxParticle:Shape.types.BOX|Shape.types.PARTICLE,convexParticle:Shape.types.PARTICLE|Shape.types.CONVEXPOLYHEDRON,sphereTrimesh:Shape.types.SPHERE|Shape.types.TRIMESH,planeTrimesh:Shape.types.PLANE|Shape.types.TRIMESH},Narrowphase=function(){function Narrowphase(world){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new Vec3Pool,this.world=world,this.currentContactMaterial=world.defaultContactMaterial,this.enableFrictionReduction=!1}var _proto=Narrowphase.prototype;return _proto.createContactEquation=function(bi,bj,si,sj,overrideShapeA,overrideShapeB){var c;this.contactPointPool.length?((c=this.contactPointPool.pop()).bi=bi,c.bj=bj):c=new ContactEquation(bi,bj),c.enabled=bi.collisionResponse&amp;&amp;bj.collisionResponse&amp;&amp;si.collisionResponse&amp;&amp;sj.collisionResponse;var cm=this.currentContactMaterial;c.restitution=cm.restitution,c.setSpookParams(cm.contactEquationStiffness,cm.contactEquationRelaxation,this.world.dt);var matA=si.material||bi.material,matB=sj.material||bj.material;return matA&amp;&amp;matB&amp;&amp;matA.restitution&gt;=0&amp;&amp;matB.restitution&gt;=0&amp;&amp;(c.restitution=matA.restitution*matB.restitution),c.si=overrideShapeA||si,c.sj=overrideShapeB||sj,c},_proto.createFrictionEquationsFromContact=function(contactEquation,outArray){var bodyA=contactEquation.bi,bodyB=contactEquation.bj,shapeA=contactEquation.si,shapeB=contactEquation.sj,world=this.world,cm=this.currentContactMaterial,friction=cm.friction,matA=shapeA.material||bodyA.material,matB=shapeB.material||bodyB.material;if(matA&amp;&amp;matB&amp;&amp;matA.friction&gt;=0&amp;&amp;matB.friction&gt;=0&amp;&amp;(friction=matA.friction*matB.friction),friction&gt;0){var mug=friction*world.gravity.length(),reducedMass=bodyA.invMass+bodyB.invMass;reducedMass&gt;0&amp;&amp;(reducedMass=1/reducedMass);var pool=this.frictionEquationPool,c1=pool.length?pool.pop():new FrictionEquation(bodyA,bodyB,mug*reducedMass),c2=pool.length?pool.pop():new FrictionEquation(bodyA,bodyB,mug*reducedMass);return c1.bi=c2.bi=bodyA,c1.bj=c2.bj=bodyB,c1.minForce=c2.minForce=-mug*reducedMass,c1.maxForce=c2.maxForce=mug*reducedMass,c1.ri.copy(contactEquation.ri),c1.rj.copy(contactEquation.rj),c2.ri.copy(contactEquation.ri),c2.rj.copy(contactEquation.rj),contactEquation.ni.tangents(c1.t,c2.t),c1.setSpookParams(cm.frictionEquationStiffness,cm.frictionEquationRelaxation,world.dt),c2.setSpookParams(cm.frictionEquationStiffness,cm.frictionEquationRelaxation,world.dt),c1.enabled=c2.enabled=contactEquation.enabled,outArray.push(c1,c2),!0}return!1},_proto.createFrictionFromAverage=function(numContacts){var c=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(c,this.frictionResult)&amp;&amp;1!==numContacts){var f1=this.frictionResult[this.frictionResult.length-2],f2=this.frictionResult[this.frictionResult.length-1];averageNormal.setZero(),averageContactPointA.setZero(),averageContactPointB.setZero();for(var bodyA=c.bi,i=(c.bj,0);i!==numContacts;i++)(c=this.result[this.result.length-1-i]).bi!==bodyA?(averageNormal.vadd(c.ni,averageNormal),averageContactPointA.vadd(c.ri,averageContactPointA),averageContactPointB.vadd(c.rj,averageContactPointB)):(averageNormal.vsub(c.ni,averageNormal),averageContactPointA.vadd(c.rj,averageContactPointA),averageContactPointB.vadd(c.ri,averageContactPointB));var invNumContacts=1/numContacts;averageContactPointA.scale(invNumContacts,f1.ri),averageContactPointB.scale(invNumContacts,f1.rj),f2.ri.copy(f1.ri),f2.rj.copy(f1.rj),averageNormal.normalize(),averageNormal.tangents(f1.t,f2.t)}},_proto.getContacts=function(p1,p2,world,result,oldcontacts,frictionResult,frictionPool){this.contactPointPool=oldcontacts,this.frictionEquationPool=frictionPool,this.result=result,this.frictionResult=frictionResult;for(var qi=tmpQuat1,qj=tmpQuat2,xi=tmpVec1$3,xj=tmpVec2$3,k=0,N=p1.length;k!==N;k++){var bi=p1[k],bj=p2[k],bodyContactMaterial=null;bi.material&amp;&amp;bj.material&amp;&amp;(bodyContactMaterial=world.getContactMaterial(bi.material,bj.material)||null);for(var justTest=bi.type&amp;Body.KINEMATIC&amp;&amp;bj.type&amp;Body.STATIC||bi.type&amp;Body.STATIC&amp;&amp;bj.type&amp;Body.KINEMATIC||bi.type&amp;Body.KINEMATIC&amp;&amp;bj.type&amp;Body.KINEMATIC,i=0;i&lt;bi.shapes.length;i++){bi.quaternion.mult(bi.shapeOrientations[i],qi),bi.quaternion.vmult(bi.shapeOffsets[i],xi),xi.vadd(bi.position,xi);for(var si=bi.shapes[i],j=0;j&lt;bj.shapes.length;j++){bj.quaternion.mult(bj.shapeOrientations[j],qj),bj.quaternion.vmult(bj.shapeOffsets[j],xj),xj.vadd(bj.position,xj);var sj=bj.shapes[j];if(si.collisionFilterMask&amp;sj.collisionFilterGroup&amp;&amp;sj.collisionFilterMask&amp;si.collisionFilterGroup&amp;&amp;!(xi.distanceTo(xj)&gt;si.boundingSphereRadius+sj.boundingSphereRadius)){var shapeContactMaterial=null;si.material&amp;&amp;sj.material&amp;&amp;(shapeContactMaterial=world.getContactMaterial(si.material,sj.material)||null),this.currentContactMaterial=shapeContactMaterial||bodyContactMaterial||world.defaultContactMaterial;var resolver=this[si.type|sj.type];if(resolver){(si.type&lt;sj.type?resolver.call(this,si,sj,xi,xj,qi,qj,bi,bj,si,sj,justTest):resolver.call(this,sj,si,xj,xi,qj,qi,bj,bi,si,sj,justTest))&amp;&amp;justTest&amp;&amp;(world.shapeOverlapKeeper.set(si.id,sj.id),world.bodyOverlapKeeper.set(bi.id,bj.id))}}}}}},_proto.sphereSphere=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){if(justTest)return xi.distanceSquared(xj)&lt;Math.pow(si.radius+sj.radius,2);var r=this.createContactEquation(bi,bj,si,sj,rsi,rsj);xj.vsub(xi,r.ni),r.ni.normalize(),r.ri.copy(r.ni),r.rj.copy(r.ni),r.ri.scale(si.radius,r.ri),r.rj.scale(-sj.radius,r.rj),r.ri.vadd(xi,r.ri),r.ri.vsub(bi.position,r.ri),r.rj.vadd(xj,r.rj),r.rj.vsub(bj.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)},_proto.spherePlane=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){var r=this.createContactEquation(bi,bj,si,sj,rsi,rsj);if(r.ni.set(0,0,1),qj.vmult(r.ni,r.ni),r.ni.negate(r.ni),r.ni.normalize(),r.ni.scale(si.radius,r.ri),xi.vsub(xj,point_on_plane_to_sphere),r.ni.scale(r.ni.dot(point_on_plane_to_sphere),plane_to_sphere_ortho),point_on_plane_to_sphere.vsub(plane_to_sphere_ortho,r.rj),-point_on_plane_to_sphere.dot(r.ni)&lt;=si.radius){if(justTest)return!0;var ri=r.ri,rj=r.rj;ri.vadd(xi,ri),ri.vsub(bi.position,ri),rj.vadd(xj,rj),rj.vsub(bj.position,rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}},_proto.boxBox=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){return si.convexPolyhedronRepresentation.material=si.material,sj.convexPolyhedronRepresentation.material=sj.material,si.convexPolyhedronRepresentation.collisionResponse=si.collisionResponse,sj.convexPolyhedronRepresentation.collisionResponse=sj.collisionResponse,this.convexConvex(si.convexPolyhedronRepresentation,sj.convexPolyhedronRepresentation,xi,xj,qi,qj,bi,bj,si,sj,justTest)},_proto.sphereBox=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){var v3pool=this.v3pool,sides=sphereBox_sides;xi.vsub(xj,box_to_sphere),sj.getSideNormals(sides,qj);for(var R=si.radius,found=!1,side_ns=sphereBox_side_ns,side_ns1=sphereBox_side_ns1,side_ns2=sphereBox_side_ns2,side_h=null,side_penetrations=0,side_dot1=0,side_dot2=0,side_distance=null,idx=0,nsides=sides.length;idx!==nsides&amp;&amp;!1===found;idx++){var ns=sphereBox_ns;ns.copy(sides[idx]);var h=ns.length();ns.normalize();var dot=box_to_sphere.dot(ns);if(dot&lt;h+R&amp;&amp;dot&gt;0){var ns1=sphereBox_ns1,ns2=sphereBox_ns2;ns1.copy(sides[(idx+1)%3]),ns2.copy(sides[(idx+2)%3]);var h1=ns1.length(),h2=ns2.length();ns1.normalize(),ns2.normalize();var dot1=box_to_sphere.dot(ns1),dot2=box_to_sphere.dot(ns2);if(dot1&lt;h1&amp;&amp;dot1&gt;-h1&amp;&amp;dot2&lt;h2&amp;&amp;dot2&gt;-h2){var _dist=Math.abs(dot-h-R);if((null===side_distance||_dist&lt;side_distance)&amp;&amp;(side_distance=_dist,side_dot1=dot1,side_dot2=dot2,side_h=h,side_ns.copy(ns),side_ns1.copy(ns1),side_ns2.copy(ns2),side_penetrations++,justTest))return!0}}}if(side_penetrations){found=!0;var _r=this.createContactEquation(bi,bj,si,sj,rsi,rsj);side_ns.scale(-R,_r.ri),_r.ni.copy(side_ns),_r.ni.negate(_r.ni),side_ns.scale(side_h,side_ns),side_ns1.scale(side_dot1,side_ns1),side_ns.vadd(side_ns1,side_ns),side_ns2.scale(side_dot2,side_ns2),side_ns.vadd(side_ns2,_r.rj),_r.ri.vadd(xi,_r.ri),_r.ri.vsub(bi.position,_r.ri),_r.rj.vadd(xj,_r.rj),_r.rj.vsub(bj.position,_r.rj),this.result.push(_r),this.createFrictionEquationsFromContact(_r,this.frictionResult)}for(var rj=v3pool.get(),sphere_to_corner=sphereBox_sphere_to_corner,j=0;2!==j&amp;&amp;!found;j++)for(var k=0;2!==k&amp;&amp;!found;k++)for(var l=0;2!==l&amp;&amp;!found;l++)if(rj.set(0,0,0),j?rj.vadd(sides[0],rj):rj.vsub(sides[0],rj),k?rj.vadd(sides[1],rj):rj.vsub(sides[1],rj),l?rj.vadd(sides[2],rj):rj.vsub(sides[2],rj),xj.vadd(rj,sphere_to_corner),sphere_to_corner.vsub(xi,sphere_to_corner),sphere_to_corner.lengthSquared()&lt;R*R){if(justTest)return!0;found=!0;var _r2=this.createContactEquation(bi,bj,si,sj,rsi,rsj);_r2.ri.copy(sphere_to_corner),_r2.ri.normalize(),_r2.ni.copy(_r2.ri),_r2.ri.scale(R,_r2.ri),_r2.rj.copy(rj),_r2.ri.vadd(xi,_r2.ri),_r2.ri.vsub(bi.position,_r2.ri),_r2.rj.vadd(xj,_r2.rj),_r2.rj.vsub(bj.position,_r2.rj),this.result.push(_r2),this.createFrictionEquationsFromContact(_r2,this.frictionResult)}v3pool.release(rj),rj=null;for(var edgeTangent=v3pool.get(),edgeCenter=v3pool.get(),r=v3pool.get(),orthogonal=v3pool.get(),dist=v3pool.get(),Nsides=sides.length,_j=0;_j!==Nsides&amp;&amp;!found;_j++)for(var _k=0;_k!==Nsides&amp;&amp;!found;_k++)if(_j%3!=_k%3){sides[_k].cross(sides[_j],edgeTangent),edgeTangent.normalize(),sides[_j].vadd(sides[_k],edgeCenter),r.copy(xi),r.vsub(edgeCenter,r),r.vsub(xj,r);var orthonorm=r.dot(edgeTangent);edgeTangent.scale(orthonorm,orthogonal);for(var _l=0;_l===_j%3||_l===_k%3;)_l++;dist.copy(xi),dist.vsub(orthogonal,dist),dist.vsub(edgeCenter,dist),dist.vsub(xj,dist);var tdist=Math.abs(orthonorm),ndist=dist.length();if(tdist&lt;sides[_l].length()&amp;&amp;ndist&lt;R){if(justTest)return!0;found=!0;var res=this.createContactEquation(bi,bj,si,sj,rsi,rsj);edgeCenter.vadd(orthogonal,res.rj),res.rj.copy(res.rj),dist.negate(res.ni),res.ni.normalize(),res.ri.copy(res.rj),res.ri.vadd(xj,res.ri),res.ri.vsub(xi,res.ri),res.ri.normalize(),res.ri.scale(R,res.ri),res.ri.vadd(xi,res.ri),res.ri.vsub(bi.position,res.ri),res.rj.vadd(xj,res.rj),res.rj.vsub(bj.position,res.rj),this.result.push(res),this.createFrictionEquationsFromContact(res,this.frictionResult)}}v3pool.release(edgeTangent,edgeCenter,r,orthogonal,dist)},_proto.planeBox=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){return sj.convexPolyhedronRepresentation.material=sj.material,sj.convexPolyhedronRepresentation.collisionResponse=sj.collisionResponse,sj.convexPolyhedronRepresentation.id=sj.id,this.planeConvex(si,sj.convexPolyhedronRepresentation,xi,xj,qi,qj,bi,bj,si,sj,justTest)},_proto.convexConvex=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest,faceListA,faceListB){var sepAxis=convexConvex_sepAxis;if(!(xi.distanceTo(xj)&gt;si.boundingSphereRadius+sj.boundingSphereRadius)&amp;&amp;si.findSeparatingAxis(sj,xi,qi,xj,qj,sepAxis,faceListA,faceListB)){var res=[],q=convexConvex_q;si.clipAgainstHull(xi,qi,sj,xj,qj,sepAxis,-100,100,res);for(var numContacts=0,j=0;j!==res.length;j++){if(justTest)return!0;var r=this.createContactEquation(bi,bj,si,sj,rsi,rsj),ri=r.ri,rj=r.rj;sepAxis.negate(r.ni),res[j].normal.negate(q),q.scale(res[j].depth,q),res[j].point.vadd(q,ri),rj.copy(res[j].point),ri.vsub(xi,ri),rj.vsub(xj,rj),ri.vadd(xi,ri),ri.vsub(bi.position,ri),rj.vadd(xj,rj),rj.vsub(bj.position,rj),this.result.push(r),numContacts++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}this.enableFrictionReduction&amp;&amp;numContacts&amp;&amp;this.createFrictionFromAverage(numContacts)}},_proto.sphereConvex=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){var v3pool=this.v3pool;xi.vsub(xj,convex_to_sphere);for(var normals=sj.faceNormals,faces=sj.faces,verts=sj.vertices,R=si.radius,found=!1,i=0;i!==verts.length;i++){var v=verts[i],worldCorner=sphereConvex_worldCorner;qj.vmult(v,worldCorner),xj.vadd(worldCorner,worldCorner);var sphere_to_corner=sphereConvex_sphereToCorner;if(worldCorner.vsub(xi,sphere_to_corner),sphere_to_corner.lengthSquared()&lt;R*R){if(justTest)return!0;found=!0;var r=this.createContactEquation(bi,bj,si,sj,rsi,rsj);return r.ri.copy(sphere_to_corner),r.ri.normalize(),r.ni.copy(r.ri),r.ri.scale(R,r.ri),worldCorner.vsub(xj,r.rj),r.ri.vadd(xi,r.ri),r.ri.vsub(bi.position,r.ri),r.rj.vadd(xj,r.rj),r.rj.vsub(bj.position,r.rj),this.result.push(r),void this.createFrictionEquationsFromContact(r,this.frictionResult)}}for(var _i=0,nfaces=faces.length;_i!==nfaces&amp;&amp;!1===found;_i++){var normal=normals[_i],face=faces[_i],worldNormal=sphereConvex_worldNormal;qj.vmult(normal,worldNormal);var worldPoint=sphereConvex_worldPoint;qj.vmult(verts[face[0]],worldPoint),worldPoint.vadd(xj,worldPoint);var worldSpherePointClosestToPlane=sphereConvex_worldSpherePointClosestToPlane;worldNormal.scale(-R,worldSpherePointClosestToPlane),xi.vadd(worldSpherePointClosestToPlane,worldSpherePointClosestToPlane);var penetrationVec=sphereConvex_penetrationVec;worldSpherePointClosestToPlane.vsub(worldPoint,penetrationVec);var penetration=penetrationVec.dot(worldNormal),worldPointToSphere=sphereConvex_sphereToWorldPoint;if(xi.vsub(worldPoint,worldPointToSphere),penetration&lt;0&amp;&amp;worldPointToSphere.dot(worldNormal)&gt;0){for(var faceVerts=[],j=0,Nverts=face.length;j!==Nverts;j++){var worldVertex=v3pool.get();qj.vmult(verts[face[j]],worldVertex),xj.vadd(worldVertex,worldVertex),faceVerts.push(worldVertex)}if(pointInPolygon(faceVerts,worldNormal,xi)){if(justTest)return!0;found=!0;var _r3=this.createContactEquation(bi,bj,si,sj,rsi,rsj);worldNormal.scale(-R,_r3.ri),worldNormal.negate(_r3.ni);var penetrationVec2=v3pool.get();worldNormal.scale(-penetration,penetrationVec2);var penetrationSpherePoint=v3pool.get();worldNormal.scale(-R,penetrationSpherePoint),xi.vsub(xj,_r3.rj),_r3.rj.vadd(penetrationSpherePoint,_r3.rj),_r3.rj.vadd(penetrationVec2,_r3.rj),_r3.rj.vadd(xj,_r3.rj),_r3.rj.vsub(bj.position,_r3.rj),_r3.ri.vadd(xi,_r3.ri),_r3.ri.vsub(bi.position,_r3.ri),v3pool.release(penetrationVec2),v3pool.release(penetrationSpherePoint),this.result.push(_r3),this.createFrictionEquationsFromContact(_r3,this.frictionResult);for(var _j2=0,Nfaceverts=faceVerts.length;_j2!==Nfaceverts;_j2++)v3pool.release(faceVerts[_j2]);return}for(var _j3=0;_j3!==face.length;_j3++){var v1=v3pool.get(),v2=v3pool.get();qj.vmult(verts[face[(_j3+1)%face.length]],v1),qj.vmult(verts[face[(_j3+2)%face.length]],v2),xj.vadd(v1,v1),xj.vadd(v2,v2);var edge=sphereConvex_edge;v2.vsub(v1,edge);var edgeUnit=sphereConvex_edgeUnit;edge.unit(edgeUnit);var p=v3pool.get(),v1_to_xi=v3pool.get();xi.vsub(v1,v1_to_xi);var dot=v1_to_xi.dot(edgeUnit);edgeUnit.scale(dot,p),p.vadd(v1,p);var xi_to_p=v3pool.get();if(p.vsub(xi,xi_to_p),dot&gt;0&amp;&amp;dot*dot&lt;edge.lengthSquared()&amp;&amp;xi_to_p.lengthSquared()&lt;R*R){if(justTest)return!0;var _r4=this.createContactEquation(bi,bj,si,sj,rsi,rsj);p.vsub(xj,_r4.rj),p.vsub(xi,_r4.ni),_r4.ni.normalize(),_r4.ni.scale(R,_r4.ri),_r4.rj.vadd(xj,_r4.rj),_r4.rj.vsub(bj.position,_r4.rj),_r4.ri.vadd(xi,_r4.ri),_r4.ri.vsub(bi.position,_r4.ri),this.result.push(_r4),this.createFrictionEquationsFromContact(_r4,this.frictionResult);for(var _j4=0,_Nfaceverts=faceVerts.length;_j4!==_Nfaceverts;_j4++)v3pool.release(faceVerts[_j4]);return v3pool.release(v1),v3pool.release(v2),v3pool.release(p),v3pool.release(xi_to_p),void v3pool.release(v1_to_xi)}v3pool.release(v1),v3pool.release(v2),v3pool.release(p),v3pool.release(xi_to_p),v3pool.release(v1_to_xi)}for(var _j5=0,_Nfaceverts2=faceVerts.length;_j5!==_Nfaceverts2;_j5++)v3pool.release(faceVerts[_j5])}}},_proto.planeConvex=function(planeShape,convexShape,planePosition,convexPosition,planeQuat,convexQuat,planeBody,convexBody,si,sj,justTest){var worldVertex=planeConvex_v,worldNormal=planeConvex_normal;worldNormal.set(0,0,1),planeQuat.vmult(worldNormal,worldNormal);for(var numContacts=0,relpos=planeConvex_relpos,i=0;i!==convexShape.vertices.length;i++){if(worldVertex.copy(convexShape.vertices[i]),convexQuat.vmult(worldVertex,worldVertex),convexPosition.vadd(worldVertex,worldVertex),worldVertex.vsub(planePosition,relpos),worldNormal.dot(relpos)&lt;=0){if(justTest)return!0;var r=this.createContactEquation(planeBody,convexBody,planeShape,convexShape,si,sj),projected=planeConvex_projected;worldNormal.scale(worldNormal.dot(relpos),projected),worldVertex.vsub(projected,projected),projected.vsub(planePosition,r.ri),r.ni.copy(worldNormal),worldVertex.vsub(convexPosition,r.rj),r.ri.vadd(planePosition,r.ri),r.ri.vsub(planeBody.position,r.ri),r.rj.vadd(convexPosition,r.rj),r.rj.vsub(convexBody.position,r.rj),this.result.push(r),numContacts++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(r,this.frictionResult)}}this.enableFrictionReduction&amp;&amp;numContacts&amp;&amp;this.createFrictionFromAverage(numContacts)},_proto.boxConvex=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){return si.convexPolyhedronRepresentation.material=si.material,si.convexPolyhedronRepresentation.collisionResponse=si.collisionResponse,this.convexConvex(si.convexPolyhedronRepresentation,sj,xi,xj,qi,qj,bi,bj,si,sj,justTest)},_proto.sphereHeightfield=function(sphereShape,hfShape,spherePos,hfPos,sphereQuat,hfQuat,sphereBody,hfBody,rsi,rsj,justTest){var data=hfShape.data,radius=sphereShape.radius,w=hfShape.elementSize,worldPillarOffset=sphereHeightfield_tmp2,localSpherePos=sphereHeightfield_tmp1;Transform.pointToLocalFrame(hfPos,hfQuat,spherePos,localSpherePos);var iMinX=Math.floor((localSpherePos.x-radius)/w)-1,iMaxX=Math.ceil((localSpherePos.x+radius)/w)+1,iMinY=Math.floor((localSpherePos.y-radius)/w)-1,iMaxY=Math.ceil((localSpherePos.y+radius)/w)+1;if(!(iMaxX&lt;0||iMaxY&lt;0||iMinX&gt;data.length||iMinY&gt;data[0].length)){iMinX&lt;0&amp;&amp;(iMinX=0),iMaxX&lt;0&amp;&amp;(iMaxX=0),iMinY&lt;0&amp;&amp;(iMinY=0),iMaxY&lt;0&amp;&amp;(iMaxY=0),iMinX&gt;=data.length&amp;&amp;(iMinX=data.length-1),iMaxX&gt;=data.length&amp;&amp;(iMaxX=data.length-1),iMaxY&gt;=data[0].length&amp;&amp;(iMaxY=data[0].length-1),iMinY&gt;=data[0].length&amp;&amp;(iMinY=data[0].length-1);var minMax=[];hfShape.getRectMinMax(iMinX,iMinY,iMaxX,iMaxY,minMax);var min=minMax[0],max=minMax[1];if(!(localSpherePos.z-radius&gt;max||localSpherePos.z+radius&lt;min))for(var result=this.result,i=iMinX;i&lt;iMaxX;i++)for(var j=iMinY;j&lt;iMaxY;j++){var numContactsBefore=result.length,intersecting=!1;if(hfShape.getConvexTrianglePillar(i,j,!1),Transform.pointToWorldFrame(hfPos,hfQuat,hfShape.pillarOffset,worldPillarOffset),spherePos.distanceTo(worldPillarOffset)&lt;hfShape.pillarConvex.boundingSphereRadius+sphereShape.boundingSphereRadius&amp;&amp;(intersecting=this.sphereConvex(sphereShape,hfShape.pillarConvex,spherePos,worldPillarOffset,sphereQuat,hfQuat,sphereBody,hfBody,sphereShape,hfShape,justTest)),justTest&amp;&amp;intersecting)return!0;if(hfShape.getConvexTrianglePillar(i,j,!0),Transform.pointToWorldFrame(hfPos,hfQuat,hfShape.pillarOffset,worldPillarOffset),spherePos.distanceTo(worldPillarOffset)&lt;hfShape.pillarConvex.boundingSphereRadius+sphereShape.boundingSphereRadius&amp;&amp;(intersecting=this.sphereConvex(sphereShape,hfShape.pillarConvex,spherePos,worldPillarOffset,sphereQuat,hfQuat,sphereBody,hfBody,sphereShape,hfShape,justTest)),justTest&amp;&amp;intersecting)return!0;if(result.length-numContactsBefore&gt;2)return}}},_proto.boxHeightfield=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){return si.convexPolyhedronRepresentation.material=si.material,si.convexPolyhedronRepresentation.collisionResponse=si.collisionResponse,this.convexHeightfield(si.convexPolyhedronRepresentation,sj,xi,xj,qi,qj,bi,bj,si,sj,justTest)},_proto.convexHeightfield=function(convexShape,hfShape,convexPos,hfPos,convexQuat,hfQuat,convexBody,hfBody,rsi,rsj,justTest){var data=hfShape.data,w=hfShape.elementSize,radius=convexShape.boundingSphereRadius,worldPillarOffset=convexHeightfield_tmp2,faceList=convexHeightfield_faceList,localConvexPos=convexHeightfield_tmp1;Transform.pointToLocalFrame(hfPos,hfQuat,convexPos,localConvexPos);var iMinX=Math.floor((localConvexPos.x-radius)/w)-1,iMaxX=Math.ceil((localConvexPos.x+radius)/w)+1,iMinY=Math.floor((localConvexPos.y-radius)/w)-1,iMaxY=Math.ceil((localConvexPos.y+radius)/w)+1;if(!(iMaxX&lt;0||iMaxY&lt;0||iMinX&gt;data.length||iMinY&gt;data[0].length)){iMinX&lt;0&amp;&amp;(iMinX=0),iMaxX&lt;0&amp;&amp;(iMaxX=0),iMinY&lt;0&amp;&amp;(iMinY=0),iMaxY&lt;0&amp;&amp;(iMaxY=0),iMinX&gt;=data.length&amp;&amp;(iMinX=data.length-1),iMaxX&gt;=data.length&amp;&amp;(iMaxX=data.length-1),iMaxY&gt;=data[0].length&amp;&amp;(iMaxY=data[0].length-1),iMinY&gt;=data[0].length&amp;&amp;(iMinY=data[0].length-1);var minMax=[];hfShape.getRectMinMax(iMinX,iMinY,iMaxX,iMaxY,minMax);var min=minMax[0],max=minMax[1];if(!(localConvexPos.z-radius&gt;max||localConvexPos.z+radius&lt;min))for(var i=iMinX;i&lt;iMaxX;i++)for(var j=iMinY;j&lt;iMaxY;j++){var intersecting=!1;if(hfShape.getConvexTrianglePillar(i,j,!1),Transform.pointToWorldFrame(hfPos,hfQuat,hfShape.pillarOffset,worldPillarOffset),convexPos.distanceTo(worldPillarOffset)&lt;hfShape.pillarConvex.boundingSphereRadius+convexShape.boundingSphereRadius&amp;&amp;(intersecting=this.convexConvex(convexShape,hfShape.pillarConvex,convexPos,worldPillarOffset,convexQuat,hfQuat,convexBody,hfBody,null,null,justTest,faceList,null)),justTest&amp;&amp;intersecting)return!0;if(hfShape.getConvexTrianglePillar(i,j,!0),Transform.pointToWorldFrame(hfPos,hfQuat,hfShape.pillarOffset,worldPillarOffset),convexPos.distanceTo(worldPillarOffset)&lt;hfShape.pillarConvex.boundingSphereRadius+convexShape.boundingSphereRadius&amp;&amp;(intersecting=this.convexConvex(convexShape,hfShape.pillarConvex,convexPos,worldPillarOffset,convexQuat,hfQuat,convexBody,hfBody,null,null,justTest,faceList,null)),justTest&amp;&amp;intersecting)return!0}}},_proto.sphereParticle=function(sj,si,xj,xi,qj,qi,bj,bi,rsi,rsj,justTest){var normal=particleSphere_normal;if(normal.set(0,0,1),xi.vsub(xj,normal),normal.lengthSquared()&lt;=sj.radius*sj.radius){if(justTest)return!0;var r=this.createContactEquation(bi,bj,si,sj,rsi,rsj);normal.normalize(),r.rj.copy(normal),r.rj.scale(sj.radius,r.rj),r.ni.copy(normal),r.ni.negate(r.ni),r.ri.set(0,0,0),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}},_proto.planeParticle=function(sj,si,xj,xi,qj,qi,bj,bi,rsi,rsj,justTest){var normal=particlePlane_normal;normal.set(0,0,1),bj.quaternion.vmult(normal,normal);var relpos=particlePlane_relpos;if(xi.vsub(bj.position,relpos),normal.dot(relpos)&lt;=0){if(justTest)return!0;var r=this.createContactEquation(bi,bj,si,sj,rsi,rsj);r.ni.copy(normal),r.ni.negate(r.ni),r.ri.set(0,0,0);var projected=particlePlane_projected;normal.scale(normal.dot(xi),projected),xi.vsub(projected,projected),r.rj.copy(projected),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}},_proto.boxParticle=function(si,sj,xi,xj,qi,qj,bi,bj,rsi,rsj,justTest){return si.convexPolyhedronRepresentation.material=si.material,si.convexPolyhedronRepresentation.collisionResponse=si.collisionResponse,this.convexParticle(si.convexPolyhedronRepresentation,sj,xi,xj,qi,qj,bi,bj,si,sj,justTest)},_proto.convexParticle=function(sj,si,xj,xi,qj,qi,bj,bi,rsi,rsj,justTest){var penetratedFaceIndex=-1,penetratedFaceNormal=convexParticle_penetratedFaceNormal,worldPenetrationVec=convexParticle_worldPenetrationVec,minPenetration=null,local=convexParticle_local;if(local.copy(xi),local.vsub(xj,local),qj.conjugate(cqj),cqj.vmult(local,local),sj.pointIsInside(local)){sj.worldVerticesNeedsUpdate&amp;&amp;sj.computeWorldVertices(xj,qj),sj.worldFaceNormalsNeedsUpdate&amp;&amp;sj.computeWorldFaceNormals(qj);for(var i=0,nfaces=sj.faces.length;i!==nfaces;i++){var verts=[sj.worldVertices[sj.faces[i][0]]],normal=sj.worldFaceNormals[i];xi.vsub(verts[0],convexParticle_vertexToParticle);var penetration=-normal.dot(convexParticle_vertexToParticle);if(null===minPenetration||Math.abs(penetration)&lt;Math.abs(minPenetration)){if(justTest)return!0;minPenetration=penetration,penetratedFaceIndex=i,penetratedFaceNormal.copy(normal)}}if(-1!==penetratedFaceIndex){var r=this.createContactEquation(bi,bj,si,sj,rsi,rsj);penetratedFaceNormal.scale(minPenetration,worldPenetrationVec),worldPenetrationVec.vadd(xi,worldPenetrationVec),worldPenetrationVec.vsub(xj,worldPenetrationVec),r.rj.copy(worldPenetrationVec),penetratedFaceNormal.negate(r.ni),r.ri.set(0,0,0);var ri=r.ri,rj=r.rj;ri.vadd(xi,ri),ri.vsub(bi.position,ri),rj.vadd(xj,rj),rj.vsub(bj.position,rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}else console.warn(&quot;Point found inside convex, but did not find penetrating face!&quot;)}},_proto.sphereTrimesh=function(sphereShape,trimeshShape,spherePos,trimeshPos,sphereQuat,trimeshQuat,sphereBody,trimeshBody,rsi,rsj,justTest){var edgeVertexA=sphereTrimesh_edgeVertexA,edgeVertexB=sphereTrimesh_edgeVertexB,edgeVector=sphereTrimesh_edgeVector,edgeVectorUnit=sphereTrimesh_edgeVectorUnit,localSpherePos=sphereTrimesh_localSpherePos,tmp=sphereTrimesh_tmp,localSphereAABB=sphereTrimesh_localSphereAABB,v2=sphereTrimesh_v2,relpos=sphereTrimesh_relpos,triangles=sphereTrimesh_triangles;Transform.pointToLocalFrame(trimeshPos,trimeshQuat,spherePos,localSpherePos);var sphereRadius=sphereShape.radius;localSphereAABB.lowerBound.set(localSpherePos.x-sphereRadius,localSpherePos.y-sphereRadius,localSpherePos.z-sphereRadius),localSphereAABB.upperBound.set(localSpherePos.x+sphereRadius,localSpherePos.y+sphereRadius,localSpherePos.z+sphereRadius),trimeshShape.getTrianglesInAABB(localSphereAABB,triangles);for(var v=sphereTrimesh_v,radiusSquared=sphereShape.radius*sphereShape.radius,i=0;i&lt;triangles.length;i++)for(var j=0;j&lt;3;j++)if(trimeshShape.getVertex(trimeshShape.indices[3*triangles[i]+j],v),v.vsub(localSpherePos,relpos),relpos.lengthSquared()&lt;=radiusSquared){if(v2.copy(v),Transform.pointToWorldFrame(trimeshPos,trimeshQuat,v2,v),v.vsub(spherePos,relpos),justTest)return!0;var r=this.createContactEquation(sphereBody,trimeshBody,sphereShape,trimeshShape,rsi,rsj);r.ni.copy(relpos),r.ni.normalize(),r.ri.copy(r.ni),r.ri.scale(sphereShape.radius,r.ri),r.ri.vadd(spherePos,r.ri),r.ri.vsub(sphereBody.position,r.ri),r.rj.copy(v),r.rj.vsub(trimeshBody.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}for(var _i2=0;_i2&lt;triangles.length;_i2++)for(var _j6=0;_j6&lt;3;_j6++){trimeshShape.getVertex(trimeshShape.indices[3*triangles[_i2]+_j6],edgeVertexA),trimeshShape.getVertex(trimeshShape.indices[3*triangles[_i2]+(_j6+1)%3],edgeVertexB),edgeVertexB.vsub(edgeVertexA,edgeVector),localSpherePos.vsub(edgeVertexB,tmp);var positionAlongEdgeB=tmp.dot(edgeVector);localSpherePos.vsub(edgeVertexA,tmp);var positionAlongEdgeA=tmp.dot(edgeVector);if(positionAlongEdgeA&gt;0&amp;&amp;positionAlongEdgeB&lt;0)if(localSpherePos.vsub(edgeVertexA,tmp),edgeVectorUnit.copy(edgeVector),edgeVectorUnit.normalize(),positionAlongEdgeA=tmp.dot(edgeVectorUnit),edgeVectorUnit.scale(positionAlongEdgeA,tmp),tmp.vadd(edgeVertexA,tmp),tmp.distanceTo(localSpherePos)&lt;sphereShape.radius){if(justTest)return!0;var _r5=this.createContactEquation(sphereBody,trimeshBody,sphereShape,trimeshShape,rsi,rsj);tmp.vsub(localSpherePos,_r5.ni),_r5.ni.normalize(),_r5.ni.scale(sphereShape.radius,_r5.ri),_r5.ri.vadd(spherePos,_r5.ri),_r5.ri.vsub(sphereBody.position,_r5.ri),Transform.pointToWorldFrame(trimeshPos,trimeshQuat,tmp,tmp),tmp.vsub(trimeshBody.position,_r5.rj),Transform.vectorToWorldFrame(trimeshQuat,_r5.ni,_r5.ni),Transform.vectorToWorldFrame(trimeshQuat,_r5.ri,_r5.ri),this.result.push(_r5),this.createFrictionEquationsFromContact(_r5,this.frictionResult)}}for(var va=sphereTrimesh_va,vb=sphereTrimesh_vb,vc=sphereTrimesh_vc,normal=sphereTrimesh_normal,_i3=0,N=triangles.length;_i3!==N;_i3++){trimeshShape.getTriangleVertices(triangles[_i3],va,vb,vc),trimeshShape.getNormal(triangles[_i3],normal),localSpherePos.vsub(va,tmp);var _dist2=tmp.dot(normal);if(normal.scale(_dist2,tmp),localSpherePos.vsub(tmp,tmp),_dist2=tmp.distanceTo(localSpherePos),Ray.pointInTriangle(tmp,va,vb,vc)&amp;&amp;_dist2&lt;sphereShape.radius){if(justTest)return!0;var _r6=this.createContactEquation(sphereBody,trimeshBody,sphereShape,trimeshShape,rsi,rsj);tmp.vsub(localSpherePos,_r6.ni),_r6.ni.normalize(),_r6.ni.scale(sphereShape.radius,_r6.ri),_r6.ri.vadd(spherePos,_r6.ri),_r6.ri.vsub(sphereBody.position,_r6.ri),Transform.pointToWorldFrame(trimeshPos,trimeshQuat,tmp,tmp),tmp.vsub(trimeshBody.position,_r6.rj),Transform.vectorToWorldFrame(trimeshQuat,_r6.ni,_r6.ni),Transform.vectorToWorldFrame(trimeshQuat,_r6.ri,_r6.ri),this.result.push(_r6),this.createFrictionEquationsFromContact(_r6,this.frictionResult)}}triangles.length=0},_proto.planeTrimesh=function(planeShape,trimeshShape,planePos,trimeshPos,planeQuat,trimeshQuat,planeBody,trimeshBody,rsi,rsj,justTest){var v=new Vec3,normal=planeTrimesh_normal;normal.set(0,0,1),planeQuat.vmult(normal,normal);for(var i=0;i&lt;trimeshShape.vertices.length/3;i++){trimeshShape.getVertex(i,v);var v2=new Vec3;v2.copy(v),Transform.pointToWorldFrame(trimeshPos,trimeshQuat,v2,v);var relpos=planeTrimesh_relpos;if(v.vsub(planePos,relpos),normal.dot(relpos)&lt;=0){if(justTest)return!0;var r=this.createContactEquation(planeBody,trimeshBody,planeShape,trimeshShape,rsi,rsj);r.ni.copy(normal);var projected=planeTrimesh_projected;normal.scale(relpos.dot(normal),projected),v.vsub(projected,projected),r.ri.copy(projected),r.ri.vsub(planeBody.position,r.ri),r.rj.copy(v),r.rj.vsub(trimeshBody.position,r.rj),this.result.push(r),this.createFrictionEquationsFromContact(r,this.frictionResult)}}},Narrowphase}(),averageNormal=new Vec3,averageContactPointA=new Vec3,averageContactPointB=new Vec3,tmpVec1$3=new Vec3,tmpVec2$3=new Vec3,tmpQuat1=new Quaternion,tmpQuat2=new Quaternion;Narrowphase.prototype[COLLISION_TYPES.boxBox]=Narrowphase.prototype.boxBox,Narrowphase.prototype[COLLISION_TYPES.boxConvex]=Narrowphase.prototype.boxConvex,Narrowphase.prototype[COLLISION_TYPES.boxParticle]=Narrowphase.prototype.boxParticle,Narrowphase.prototype[COLLISION_TYPES.sphereSphere]=Narrowphase.prototype.sphereSphere;var planeTrimesh_normal=new Vec3,planeTrimesh_relpos=new Vec3,planeTrimesh_projected=new Vec3;Narrowphase.prototype[COLLISION_TYPES.planeTrimesh]=Narrowphase.prototype.planeTrimesh;var sphereTrimesh_normal=new Vec3,sphereTrimesh_relpos=new Vec3,sphereTrimesh_v=(new Vec3,new Vec3),sphereTrimesh_v2=new Vec3,sphereTrimesh_edgeVertexA=new Vec3,sphereTrimesh_edgeVertexB=new Vec3,sphereTrimesh_edgeVector=new Vec3,sphereTrimesh_edgeVectorUnit=new Vec3,sphereTrimesh_localSpherePos=new Vec3,sphereTrimesh_tmp=new Vec3,sphereTrimesh_va=new Vec3,sphereTrimesh_vb=new Vec3,sphereTrimesh_vc=new Vec3,sphereTrimesh_localSphereAABB=new AABB,sphereTrimesh_triangles=[];Narrowphase.prototype[COLLISION_TYPES.sphereTrimesh]=Narrowphase.prototype.sphereTrimesh;var point_on_plane_to_sphere=new Vec3,plane_to_sphere_ortho=new Vec3;Narrowphase.prototype[COLLISION_TYPES.spherePlane]=Narrowphase.prototype.spherePlane;var pointInPolygon_edge=new Vec3,pointInPolygon_edge_x_normal=new Vec3,pointInPolygon_vtp=new Vec3;function pointInPolygon(verts,normal,p){for(var positiveResult=null,N=verts.length,i=0;i!==N;i++){var v=verts[i],edge=pointInPolygon_edge;verts[(i+1)%N].vsub(v,edge);var edge_x_normal=pointInPolygon_edge_x_normal;edge.cross(normal,edge_x_normal);var vertex_to_p=pointInPolygon_vtp;p.vsub(v,vertex_to_p);var r=edge_x_normal.dot(vertex_to_p);if(!(null===positiveResult||r&gt;0&amp;&amp;!0===positiveResult||r&lt;=0&amp;&amp;!1===positiveResult))return!1;null===positiveResult&amp;&amp;(positiveResult=r&gt;0)}return!0}var box_to_sphere=new Vec3,sphereBox_ns=new Vec3,sphereBox_ns1=new Vec3,sphereBox_ns2=new Vec3,sphereBox_sides=[new Vec3,new Vec3,new Vec3,new Vec3,new Vec3,new Vec3],sphereBox_sphere_to_corner=new Vec3,sphereBox_side_ns=new Vec3,sphereBox_side_ns1=new Vec3,sphereBox_side_ns2=new Vec3;Narrowphase.prototype[COLLISION_TYPES.sphereBox]=Narrowphase.prototype.sphereBox;var convex_to_sphere=new Vec3,sphereConvex_edge=new Vec3,sphereConvex_edgeUnit=new Vec3,sphereConvex_sphereToCorner=new Vec3,sphereConvex_worldCorner=new Vec3,sphereConvex_worldNormal=new Vec3,sphereConvex_worldPoint=new Vec3,sphereConvex_worldSpherePointClosestToPlane=new Vec3,sphereConvex_penetrationVec=new Vec3,sphereConvex_sphereToWorldPoint=new Vec3;Narrowphase.prototype[COLLISION_TYPES.sphereConvex]=Narrowphase.prototype.sphereConvex;new Vec3,new Vec3;Narrowphase.prototype[COLLISION_TYPES.planeBox]=Narrowphase.prototype.planeBox;var planeConvex_v=new Vec3,planeConvex_normal=new Vec3,planeConvex_relpos=new Vec3,planeConvex_projected=new Vec3;Narrowphase.prototype[COLLISION_TYPES.planeConvex]=Narrowphase.prototype.planeConvex;var convexConvex_sepAxis=new Vec3,convexConvex_q=new Vec3;Narrowphase.prototype[COLLISION_TYPES.convexConvex]=Narrowphase.prototype.convexConvex;var particlePlane_normal=new Vec3,particlePlane_relpos=new Vec3,particlePlane_projected=new Vec3;Narrowphase.prototype[COLLISION_TYPES.planeParticle]=Narrowphase.prototype.planeParticle;var particleSphere_normal=new Vec3;Narrowphase.prototype[COLLISION_TYPES.sphereParticle]=Narrowphase.prototype.sphereParticle;var cqj=new Quaternion,convexParticle_local=new Vec3,convexParticle_penetratedFaceNormal=(new Vec3,new Vec3),convexParticle_vertexToParticle=new Vec3,convexParticle_worldPenetrationVec=new Vec3;Narrowphase.prototype[COLLISION_TYPES.convexParticle]=Narrowphase.prototype.convexParticle,Narrowphase.prototype[COLLISION_TYPES.boxHeightfield]=Narrowphase.prototype.boxHeightfield;var convexHeightfield_tmp1=new Vec3,convexHeightfield_tmp2=new Vec3,convexHeightfield_faceList=[0];Narrowphase.prototype[COLLISION_TYPES.convexHeightfield]=Narrowphase.prototype.convexHeightfield;var sphereHeightfield_tmp1=new Vec3,sphereHeightfield_tmp2=new Vec3;Narrowphase.prototype[COLLISION_TYPES.sphereHeightfield]=Narrowphase.prototype.sphereHeightfield;var OverlapKeeper=function(){function OverlapKeeper(){this.current=[],this.previous=[]}var _proto=OverlapKeeper.prototype;return _proto.getKey=function(i,j){if(j&lt;i){var temp=j;j=i,i=temp}return i&lt;&lt;16|j},_proto.set=function(i,j){for(var key=this.getKey(i,j),current=this.current,index=0;key&gt;current[index];)index++;if(key!==current[index]){for(var _j=current.length-1;_j&gt;=index;_j--)current[_j+1]=current[_j];current[index]=key}},_proto.tick=function(){var tmp=this.current;this.current=this.previous,this.previous=tmp,this.current.length=0},_proto.getDiff=function(additions,removals){for(var a=this.current,b=this.previous,al=a.length,bl=b.length,j=0,i=0;i&lt;al;i++){for(var keyA=a[i];keyA&gt;b[j];)j++;keyA===b[j]||unpackAndPush(additions,keyA)}j=0;for(var _i=0;_i&lt;bl;_i++){for(var keyB=b[_i];keyB&gt;a[j];)j++;a[j]===keyB||unpackAndPush(removals,keyB)}},OverlapKeeper}();function unpackAndPush(array,key){array.push((4294901760&amp;key)&gt;&gt;16,65535&amp;key)}var TupleDictionary=function(){function TupleDictionary(){this.data={keys:[]}}var _proto=TupleDictionary.prototype;return _proto.get=function(i,j){if(i&gt;j){var temp=j;j=i,i=temp}return this.data[i+&quot;-&quot;+j]},_proto.set=function(i,j,value){if(i&gt;j){var temp=j;j=i,i=temp}var key=i+&quot;-&quot;+j;this.get(i,j)||this.data.keys.push(key),this.data[key]=value},_proto.reset=function(){for(var data=this.data,keys=data.keys;keys.length&gt;0;){delete data[keys.pop()]}},TupleDictionary}(),World=function(_EventTarget){function World(options){var _this;return void 0===options&amp;&amp;(options={}),(_this=_EventTarget.call(this)||this).dt=-1,_this.allowSleep=!!options.allowSleep,_this.contacts=[],_this.frictionEquations=[],_this.quatNormalizeSkip=void 0!==options.quatNormalizeSkip?options.quatNormalizeSkip:0,_this.quatNormalizeFast=void 0!==options.quatNormalizeFast&amp;&amp;options.quatNormalizeFast,_this.time=0,_this.stepnumber=0,_this.default_dt=1/60,_this.nextId=0,_this.gravity=new Vec3,options.gravity&amp;&amp;_this.gravity.copy(options.gravity),_this.broadphase=void 0!==options.broadphase?options.broadphase:new NaiveBroadphase,_this.bodies=[],_this.hasActiveBodies=!1,_this.solver=void 0!==options.solver?options.solver:new GSSolver,_this.constraints=[],_this.narrowphase=new Narrowphase(_assertThisInitialized(_this)),_this.collisionMatrix=new ArrayCollisionMatrix,_this.collisionMatrixPrevious=new ArrayCollisionMatrix,_this.bodyOverlapKeeper=new OverlapKeeper,_this.shapeOverlapKeeper=new OverlapKeeper,_this.materials=[],_this.contactmaterials=[],_this.contactMaterialTable=new TupleDictionary,_this.defaultMaterial=new Material(&quot;default&quot;),_this.defaultContactMaterial=new ContactMaterial(_this.defaultMaterial,_this.defaultMaterial,{friction:.3,restitution:0}),_this.doProfiling=!1,_this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},_this.accumulator=0,_this.subsystems=[],_this.addBodyEvent={type:&quot;addBody&quot;,body:null},_this.removeBodyEvent={type:&quot;removeBody&quot;,body:null},_this.idToBodyMap={},_this.broadphase.setWorld(_assertThisInitialized(_this)),_this}_inheritsLoose(World,_EventTarget);var _proto=World.prototype;return _proto.getContactMaterial=function(m1,m2){return this.contactMaterialTable.get(m1.id,m2.id)},_proto.numObjects=function(){return this.bodies.length},_proto.collisionMatrixTick=function(){var temp=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=temp,this.collisionMatrix.reset(),this.bodyOverlapKeeper.tick(),this.shapeOverlapKeeper.tick()},_proto.addConstraint=function(c){this.constraints.push(c)},_proto.removeConstraint=function(c){var idx=this.constraints.indexOf(c);-1!==idx&amp;&amp;this.constraints.splice(idx,1)},_proto.rayTest=function(from,to,result){result instanceof RaycastResult?this.raycastClosest(from,to,{skipBackfaces:!0},result):this.raycastAll(from,to,{skipBackfaces:!0},result)},_proto.raycastAll=function(from,to,options,callback){return void 0===options&amp;&amp;(options={}),options.mode=Ray.ALL,options.from=from,options.to=to,options.callback=callback,tmpRay$1.intersectWorld(this,options)},_proto.raycastAny=function(from,to,options,result){return void 0===options&amp;&amp;(options={}),options.mode=Ray.ANY,options.from=from,options.to=to,options.result=result,tmpRay$1.intersectWorld(this,options)},_proto.raycastClosest=function(from,to,options,result){return void 0===options&amp;&amp;(options={}),options.mode=Ray.CLOSEST,options.from=from,options.to=to,options.result=result,tmpRay$1.intersectWorld(this,options)},_proto.addBody=function(body){this.bodies.includes(body)||(body.index=this.bodies.length,this.bodies.push(body),body.world=this,body.initPosition.copy(body.position),body.initVelocity.copy(body.velocity),body.timeLastSleepy=this.time,body instanceof Body&amp;&amp;(body.initAngularVelocity.copy(body.angularVelocity),body.initQuaternion.copy(body.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=body,this.idToBodyMap[body.id]=body,this.dispatchEvent(this.addBodyEvent))},_proto.removeBody=function(body){body.world=null;var n=this.bodies.length-1,bodies=this.bodies,idx=bodies.indexOf(body);if(-1!==idx){bodies.splice(idx,1);for(var i=0;i!==bodies.length;i++)bodies[i].index=i;this.collisionMatrix.setNumObjects(n),this.removeBodyEvent.body=body,delete this.idToBodyMap[body.id],this.dispatchEvent(this.removeBodyEvent)}},_proto.getBodyById=function(id){return this.idToBodyMap[id]},_proto.getShapeById=function(id){for(var bodies=this.bodies,i=0,bl=bodies.length;i&lt;bl;i++)for(var shapes=bodies[i].shapes,j=0,sl=shapes.length;j&lt;sl;j++){var shape=shapes[j];if(shape.id===id)return shape}},_proto.addMaterial=function(m){this.materials.push(m)},_proto.addContactMaterial=function(cmat){this.contactmaterials.push(cmat),this.contactMaterialTable.set(cmat.materials[0].id,cmat.materials[1].id,cmat)},_proto.step=function(dt,timeSinceLastCalled,maxSubSteps){if(void 0===timeSinceLastCalled&amp;&amp;(timeSinceLastCalled=0),void 0===maxSubSteps&amp;&amp;(maxSubSteps=10),0===timeSinceLastCalled)this.internalStep(dt),this.time+=dt;else{this.accumulator+=timeSinceLastCalled;for(var substeps=0;this.accumulator&gt;=dt&amp;&amp;substeps&lt;maxSubSteps;)this.internalStep(dt),this.accumulator-=dt,substeps++;for(var t=this.accumulator%dt/dt,j=0;j!==this.bodies.length;j++){var b=this.bodies[j];b.previousPosition.lerp(b.position,t,b.interpolatedPosition),b.previousQuaternion.slerp(b.quaternion,t,b.interpolatedQuaternion),b.previousQuaternion.normalize()}this.time+=timeSinceLastCalled}},_proto.internalStep=function(dt){this.dt=dt;var contacts=this.contacts,p1=World_step_p1,p2=World_step_p2,N=this.numObjects(),bodies=this.bodies,solver=this.solver,gravity=this.gravity,doProfiling=this.doProfiling,profile=this.profile,DYNAMIC=Body.DYNAMIC,profilingStart=-1/0,constraints=this.constraints,frictionEquationPool=World_step_frictionEquationPool,gx=(gravity.length(),gravity.x),gy=gravity.y,gz=gravity.z,i=0;for(doProfiling&amp;&amp;(profilingStart=performance.now()),i=0;i!==N;i++){var bi=bodies[i];if(bi.type===DYNAMIC){var f=bi.force,m=bi.mass;f.x+=m*gx,f.y+=m*gy,f.z+=m*gz}}for(var _i=0,Nsubsystems=this.subsystems.length;_i!==Nsubsystems;_i++)this.subsystems[_i].update();doProfiling&amp;&amp;(profilingStart=performance.now()),p1.length=0,p2.length=0,this.broadphase.collisionPairs(this,p1,p2),doProfiling&amp;&amp;(profile.broadphase=performance.now()-profilingStart);var Nconstraints=constraints.length;for(i=0;i!==Nconstraints;i++){var c=constraints[i];if(!c.collideConnected)for(var j=p1.length-1;j&gt;=0;j-=1)(c.bodyA===p1[j]&amp;&amp;c.bodyB===p2[j]||c.bodyB===p1[j]&amp;&amp;c.bodyA===p2[j])&amp;&amp;(p1.splice(j,1),p2.splice(j,1))}this.collisionMatrixTick(),doProfiling&amp;&amp;(profilingStart=performance.now());var oldcontacts=World_step_oldContacts,NoldContacts=contacts.length;for(i=0;i!==NoldContacts;i++)oldcontacts.push(contacts[i]);contacts.length=0;var NoldFrictionEquations=this.frictionEquations.length;for(i=0;i!==NoldFrictionEquations;i++)frictionEquationPool.push(this.frictionEquations[i]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(p1,p2,this,contacts,oldcontacts,this.frictionEquations,frictionEquationPool),doProfiling&amp;&amp;(profile.narrowphase=performance.now()-profilingStart),doProfiling&amp;&amp;(profilingStart=performance.now()),i=0;i&lt;this.frictionEquations.length;i++)solver.addEquation(this.frictionEquations[i]);for(var ncontacts=contacts.length,k=0;k!==ncontacts;k++){var _c=contacts[k],_bi=_c.bi,bj=_c.bj,si=_c.si,sj=_c.sj;(_bi.material&amp;&amp;bj.material&amp;&amp;this.getContactMaterial(_bi.material,bj.material)||this.defaultContactMaterial).friction;if(_bi.material&amp;&amp;bj.material&amp;&amp;(_bi.material.friction&gt;=0&amp;&amp;bj.material.friction&gt;=0&amp;&amp;_bi.material.friction*bj.material.friction,_bi.material.restitution&gt;=0&amp;&amp;bj.material.restitution&gt;=0&amp;&amp;(_c.restitution=_bi.material.restitution*bj.material.restitution)),solver.addEquation(_c),_bi.allowSleep&amp;&amp;_bi.type===Body.DYNAMIC&amp;&amp;_bi.sleepState===Body.SLEEPING&amp;&amp;bj.sleepState===Body.AWAKE&amp;&amp;bj.type!==Body.STATIC)bj.velocity.lengthSquared()+bj.angularVelocity.lengthSquared()&gt;=2*Math.pow(bj.sleepSpeedLimit,2)&amp;&amp;(_bi.wakeUpAfterNarrowphase=!0);if(bj.allowSleep&amp;&amp;bj.type===Body.DYNAMIC&amp;&amp;bj.sleepState===Body.SLEEPING&amp;&amp;_bi.sleepState===Body.AWAKE&amp;&amp;_bi.type!==Body.STATIC)_bi.velocity.lengthSquared()+_bi.angularVelocity.lengthSquared()&gt;=2*Math.pow(_bi.sleepSpeedLimit,2)&amp;&amp;(bj.wakeUpAfterNarrowphase=!0);this.collisionMatrix.set(_bi,bj,!0),this.collisionMatrixPrevious.get(_bi,bj)||(World_step_collideEvent.body=bj,World_step_collideEvent.contact=_c,_bi.dispatchEvent(World_step_collideEvent),World_step_collideEvent.body=_bi,bj.dispatchEvent(World_step_collideEvent)),this.bodyOverlapKeeper.set(_bi.id,bj.id),this.shapeOverlapKeeper.set(si.id,sj.id)}for(this.emitContactEvents(),doProfiling&amp;&amp;(profile.makeContactConstraints=performance.now()-profilingStart,profilingStart=performance.now()),i=0;i!==N;i++){var _bi2=bodies[i];_bi2.wakeUpAfterNarrowphase&amp;&amp;(_bi2.wakeUp(),_bi2.wakeUpAfterNarrowphase=!1)}for(Nconstraints=constraints.length,i=0;i!==Nconstraints;i++){var _c2=constraints[i];_c2.update();for(var _j=0,Neq=_c2.equations.length;_j!==Neq;_j++){var eq=_c2.equations[_j];solver.addEquation(eq)}}solver.solve(dt,this),doProfiling&amp;&amp;(profile.solve=performance.now()-profilingStart),solver.removeAllEquations();var pow=Math.pow;for(i=0;i!==N;i++){var _bi3=bodies[i];if(_bi3.type&amp;DYNAMIC){var ld=pow(1-_bi3.linearDamping,dt),v=_bi3.velocity;v.scale(ld,v);var av=_bi3.angularVelocity;if(av){var ad=pow(1-_bi3.angularDamping,dt);av.scale(ad,av)}}}for(this.dispatchEvent(World_step_preStepEvent),i=0;i!==N;i++){var _bi4=bodies[i];_bi4.preStep&amp;&amp;_bi4.preStep.call(_bi4)}doProfiling&amp;&amp;(profilingStart=performance.now());var quatNormalize=this.stepnumber%(this.quatNormalizeSkip+1)==0,quatNormalizeFast=this.quatNormalizeFast;for(i=0;i!==N;i++)bodies[i].integrate(dt,quatNormalize,quatNormalizeFast);for(this.clearForces(),this.broadphase.dirty=!0,doProfiling&amp;&amp;(profile.integrate=performance.now()-profilingStart),this.time+=dt,this.stepnumber+=1,this.dispatchEvent(World_step_postStepEvent),i=0;i!==N;i++){var _bi5=bodies[i],postStep=_bi5.postStep;postStep&amp;&amp;postStep.call(_bi5)}var hasActiveBodies=!0;if(this.allowSleep)for(hasActiveBodies=!1,i=0;i!==N;i++){var _bi6=bodies[i];_bi6.sleepTick(this.time),_bi6.sleepState!==Body.SLEEPING&amp;&amp;(hasActiveBodies=!0)}this.hasActiveBodies=hasActiveBodies},_proto.clearForces=function(){for(var bodies=this.bodies,N=bodies.length,i=0;i!==N;i++){var b=bodies[i];b.force,b.torque;b.force.set(0,0,0),b.torque.set(0,0,0)}},World}(EventTarget),tmpRay$1=(new AABB,new Ray);if(&quot;undefined&quot;==typeof performance&amp;&amp;(performance={}),!performance.now){var nowOffset=Date.now();performance.timing&amp;&amp;performance.timing.navigationStart&amp;&amp;(nowOffset=performance.timing.navigationStart),performance.now=function(){return Date.now()-nowOffset}}new Vec3;var additions,removals,beginContactEvent,endContactEvent,beginShapeContactEvent,endShapeContactEvent,World_step_postStepEvent={type:&quot;postStep&quot;},World_step_preStepEvent={type:&quot;preStep&quot;},World_step_collideEvent={type:Body.COLLIDE_EVENT_NAME,body:null,contact:null},World_step_oldContacts=[],World_step_frictionEquationPool=[],World_step_p1=[],World_step_p2=[];World.prototype.emitContactEvents=(additions=[],removals=[],beginContactEvent={type:&quot;beginContact&quot;,bodyA:null,bodyB:null},endContactEvent={type:&quot;endContact&quot;,bodyA:null,bodyB:null},beginShapeContactEvent={type:&quot;beginShapeContact&quot;,bodyA:null,bodyB:null,shapeA:null,shapeB:null},endShapeContactEvent={type:&quot;endShapeContact&quot;,bodyA:null,bodyB:null,shapeA:null,shapeB:null},function(){var hasBeginContact=this.hasAnyEventListener(&quot;beginContact&quot;),hasEndContact=this.hasAnyEventListener(&quot;endContact&quot;);if((hasBeginContact||hasEndContact)&amp;&amp;this.bodyOverlapKeeper.getDiff(additions,removals),hasBeginContact){for(var i=0,l=additions.length;i&lt;l;i+=2)beginContactEvent.bodyA=this.getBodyById(additions[i]),beginContactEvent.bodyB=this.getBodyById(additions[i+1]),this.dispatchEvent(beginContactEvent);beginContactEvent.bodyA=beginContactEvent.bodyB=null}if(hasEndContact){for(var _i2=0,_l=removals.length;_i2&lt;_l;_i2+=2)endContactEvent.bodyA=this.getBodyById(removals[_i2]),endContactEvent.bodyB=this.getBodyById(removals[_i2+1]),this.dispatchEvent(endContactEvent);endContactEvent.bodyA=endContactEvent.bodyB=null}additions.length=removals.length=0;var hasBeginShapeContact=this.hasAnyEventListener(&quot;beginShapeContact&quot;),hasEndShapeContact=this.hasAnyEventListener(&quot;endShapeContact&quot;);if((hasBeginShapeContact||hasEndShapeContact)&amp;&amp;this.shapeOverlapKeeper.getDiff(additions,removals),hasBeginShapeContact){for(var _i3=0,_l2=additions.length;_i3&lt;_l2;_i3+=2){var shapeA=this.getShapeById(additions[_i3]),shapeB=this.getShapeById(additions[_i3+1]);beginShapeContactEvent.shapeA=shapeA,beginShapeContactEvent.shapeB=shapeB,beginShapeContactEvent.bodyA=shapeA.body,beginShapeContactEvent.bodyB=shapeB.body,this.dispatchEvent(beginShapeContactEvent)}beginShapeContactEvent.bodyA=beginShapeContactEvent.bodyB=beginShapeContactEvent.shapeA=beginShapeContactEvent.shapeB=null}if(hasEndShapeContact){for(var _i4=0,_l3=removals.length;_i4&lt;_l3;_i4+=2){var _shapeA=this.getShapeById(removals[_i4]),_shapeB=this.getShapeById(removals[_i4+1]);endShapeContactEvent.shapeA=_shapeA,endShapeContactEvent.shapeB=_shapeB,endShapeContactEvent.bodyA=_shapeA.body,endShapeContactEvent.bodyB=_shapeB.body,this.dispatchEvent(endShapeContactEvent)}endShapeContactEvent.bodyA=endShapeContactEvent.bodyB=endShapeContactEvent.shapeA=endShapeContactEvent.shapeB=null}}),exports.AABB=AABB,exports.ArrayCollisionMatrix=ArrayCollisionMatrix,exports.BODY_SLEEP_STATES=BODY_SLEEP_STATES,exports.BODY_TYPES={DYNAMIC:1,STATIC:2,KINEMATIC:4},exports.Body=Body,exports.Box=Box,exports.Broadphase=Broadphase,exports.COLLISION_TYPES=COLLISION_TYPES,exports.ConeTwistConstraint=ConeTwistConstraint,exports.Constraint=Constraint,exports.ContactEquation=ContactEquation,exports.ContactMaterial=ContactMaterial,exports.ConvexPolyhedron=ConvexPolyhedron,exports.Cylinder=Cylinder,exports.DistanceConstraint=DistanceConstraint,exports.Equation=Equation,exports.EventTarget=EventTarget,exports.FrictionEquation=FrictionEquation,exports.GSSolver=GSSolver,exports.GridBroadphase=GridBroadphase,exports.Heightfield=Heightfield,exports.HingeConstraint=HingeConstraint,exports.JacobianElement=JacobianElement,exports.LockConstraint=LockConstraint,exports.Mat3=Mat3,exports.Material=Material,exports.NaiveBroadphase=NaiveBroadphase,exports.Narrowphase=Narrowphase,exports.ObjectCollisionMatrix=ObjectCollisionMatrix,exports.Particle=Particle,exports.Plane=Plane,exports.PointToPointConstraint=PointToPointConstraint,exports.Pool=Pool,exports.Quaternion=Quaternion,exports.RAY_MODES={CLOSEST:1,ANY:2,ALL:4},exports.Ray=Ray,exports.RaycastResult=RaycastResult,exports.RaycastVehicle=RaycastVehicle,exports.RigidVehicle=RigidVehicle,exports.RotationalEquation=RotationalEquation,exports.RotationalMotorEquation=RotationalMotorEquation,exports.SAPBroadphase=SAPBroadphase,exports.SHAPE_TYPES=SHAPE_TYPES,exports.SPHSystem=SPHSystem,exports.Shape=Shape,exports.Solver=Solver,exports.Sphere=Sphere,exports.SplitSolver=SplitSolver,exports.Spring=Spring,exports.Transform=Transform,exports.Trimesh=Trimesh,exports.Vec3=Vec3,exports.Vec3Pool=Vec3Pool,exports.World=World},{}],5:[function(require,module,exports){&quot;use strict&quot;;const TYPE=exports.TYPE={BOX:&quot;box&quot;,CYLINDER:&quot;cylinder&quot;,SPHERE:&quot;sphere&quot;,CAPSULE:&quot;capsule&quot;,CONE:&quot;cone&quot;,HULL:&quot;hull&quot;,HACD:&quot;hacd&quot;,VHACD:&quot;vhacd&quot;,MESH:&quot;mesh&quot;},FIT=exports.FIT={ALL:&quot;all&quot;,MANUAL:&quot;manual&quot;},hasUpdateMatricesFunction=THREE.Object3D.prototype.hasOwnProperty(&quot;updateMatrices&quot;);function _setOptions(options){options.fit=options.hasOwnProperty(&quot;fit&quot;)?options.fit:FIT.ALL,options.type=options.type||TYPE.HULL,options.minHalfExtent=options.hasOwnProperty(&quot;minHalfExtent&quot;)?options.minHalfExtent:0,options.maxHalfExtent=options.hasOwnProperty(&quot;maxHalfExtent&quot;)?options.maxHalfExtent:Number.POSITIVE_INFINITY,options.cylinderAxis=options.cylinderAxis||&quot;y&quot;,options.margin=options.hasOwnProperty(&quot;margin&quot;)?options.margin:.01,options.offset||(options.offset=new THREE.Vector3),options.orientation||(options.orientation=new THREE.Quaternion)}exports.createCollisionShapes=function(root,options){switch(options.type){case TYPE.BOX:return[this.createBoxShape(root,options)];case TYPE.CYLINDER:return[this.createCylinderShape(root,options)];case TYPE.CAPSULE:return[this.createCapsuleShape(root,options)];case TYPE.CONE:return[this.createConeShape(root,options)];case TYPE.SPHERE:return[this.createSphereShape(root,options)];case TYPE.HULL:return[this.createHullShape(root,options)];case TYPE.HACD:return this.createHACDShapes(root,options);case TYPE.VHACD:return this.createVHACDShapes(root,options);case TYPE.MESH:return[this.createTriMeshShape(root,options)];default:return console.warn(options.type+&quot; is not currently supported&quot;),[]}},exports.createBoxShape=function(root,options){options.type=TYPE.BOX,_setOptions(options),options.fit===FIT.ALL&amp;&amp;(options.halfExtents=_computeHalfExtents(root,_computeBounds(root),options.minHalfExtent,options.maxHalfExtent));const btHalfExtents=new Ammo.btVector3(options.halfExtents.x,options.halfExtents.y,options.halfExtents.z),collisionShape=new Ammo.btBoxShape(btHalfExtents);return Ammo.destroy(btHalfExtents),_finishCollisionShape(collisionShape,options,_computeScale(root,options)),collisionShape},exports.createCylinderShape=function(root,options){options.type=TYPE.CYLINDER,_setOptions(options),options.fit===FIT.ALL&amp;&amp;(options.halfExtents=_computeHalfExtents(root,_computeBounds(root),options.minHalfExtent,options.maxHalfExtent));const btHalfExtents=new Ammo.btVector3(options.halfExtents.x,options.halfExtents.y,options.halfExtents.z),collisionShape=(()=&gt;{switch(options.cylinderAxis){case&quot;y&quot;:return new Ammo.btCylinderShape(btHalfExtents);case&quot;x&quot;:return new Ammo.btCylinderShapeX(btHalfExtents);case&quot;z&quot;:return new Ammo.btCylinderShapeZ(btHalfExtents)}return null})();return Ammo.destroy(btHalfExtents),_finishCollisionShape(collisionShape,options,_computeScale(root,options)),collisionShape},exports.createCapsuleShape=function(root,options){options.type=TYPE.CAPSULE,_setOptions(options),options.fit===FIT.ALL&amp;&amp;(options.halfExtents=_computeHalfExtents(root,_computeBounds(root),options.minHalfExtent,options.maxHalfExtent));const{x:x,y:y,z:z}=options.halfExtents,collisionShape=(()=&gt;{switch(options.cylinderAxis){case&quot;y&quot;:return new Ammo.btCapsuleShape(Math.max(x,z),2*y);case&quot;x&quot;:return new Ammo.btCapsuleShapeX(Math.max(y,z),2*x);case&quot;z&quot;:return new Ammo.btCapsuleShapeZ(Math.max(x,y),2*z)}return null})();return _finishCollisionShape(collisionShape,options,_computeScale(root,options)),collisionShape},exports.createConeShape=function(root,options){options.type=TYPE.CONE,_setOptions(options),options.fit===FIT.ALL&amp;&amp;(options.halfExtents=_computeHalfExtents(root,_computeBounds(root),options.minHalfExtent,options.maxHalfExtent));const{x:x,y:y,z:z}=options.halfExtents,collisionShape=(()=&gt;{switch(options.cylinderAxis){case&quot;y&quot;:return new Ammo.btConeShape(Math.max(x,z),2*y);case&quot;x&quot;:return new Ammo.btConeShapeX(Math.max(y,z),2*x);case&quot;z&quot;:return new Ammo.btConeShapeZ(Math.max(x,y),2*z)}return null})();return _finishCollisionShape(collisionShape,options,_computeScale(root,options)),collisionShape},exports.createSphereShape=function(root,options){let radius;options.type=TYPE.SPHERE,radius=options.fit!==FIT.MANUAL||isNaN(options.sphereRadius)?_computeRadius(root,_computeBounds(root)):options.sphereRadius;const collisionShape=new Ammo.btSphereShape(radius);return _finishCollisionShape(collisionShape,options,_computeScale(root,options)),collisionShape},exports.createHullShape=function(){const vertex=new THREE.Vector3,center=new THREE.Vector3;return function(root,options){if(options.type=TYPE.HULL,_setOptions(options),options.fit===FIT.MANUAL)return console.warn(&quot;cannot use fit: manual with type: hull&quot;),null;const bounds=_computeBounds(root),btVertex=new Ammo.btVector3,originalHull=new Ammo.btConvexHullShape;originalHull.setMargin(options.margin),center.addVectors(bounds.max,bounds.min).multiplyScalar(.5);let vertexCount=0;_iterateGeometries(root,geo=&gt;{vertexCount+=geo.attributes.position.array.length/3});const maxVertices=options.hullMaxVertices||1e5;vertexCount&gt;maxVertices&amp;&amp;console.warn(`too many vertices for hull shape; sampling ~${maxVertices} from ~${vertexCount} vertices`);const p=Math.min(1,maxVertices/vertexCount);_iterateGeometries(root,(geo,transform)=&gt;{const components=geo.attributes.position.array;for(let i=0;i&lt;components.length;i+=3)Math.random()&lt;=p&amp;&amp;(vertex.set(components[i],components[i+1],components[i+2]).applyMatrix4(transform).sub(center),btVertex.setValue(vertex.x,vertex.y,vertex.z),originalHull.addPoint(btVertex,i===components.length-3))});let collisionShape=originalHull;if(originalHull.getNumVertices()&gt;=100){const shapeHull=new Ammo.btShapeHull(originalHull);shapeHull.buildHull(options.margin),Ammo.destroy(originalHull),collisionShape=new Ammo.btConvexHullShape(Ammo.getPointer(shapeHull.getVertexPointer()),shapeHull.numVertices()),Ammo.destroy(shapeHull)}return Ammo.destroy(btVertex),_finishCollisionShape(collisionShape,options,_computeScale(root,options)),collisionShape}}(),exports.createHACDShapes=function(){const v=new THREE.Vector3,center=new THREE.Vector3;return function(root,options){if(options.type=TYPE.HACD,_setOptions(options),options.fit===FIT.MANUAL)return console.warn(&quot;cannot use fit: manual with type: hacd&quot;),[];if(!Ammo.hasOwnProperty(&quot;HACD&quot;))return console.warn(&quot;HACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version.&quot;),[];const bounds=_computeBounds(root),scale=_computeScale(root,options);let vertexCount=0,triCount=0;center.addVectors(bounds.max,bounds.min).multiplyScalar(.5),_iterateGeometries(root,geo=&gt;{vertexCount+=geo.attributes.position.array.length/3,geo.index?triCount+=geo.index.array.length/3:triCount+=geo.attributes.position.array.length/9});const hacd=new Ammo.HACD;options.hasOwnProperty(&quot;compacityWeight&quot;)&amp;&amp;hacd.SetCompacityWeight(options.compacityWeight),options.hasOwnProperty(&quot;volumeWeight&quot;)&amp;&amp;hacd.SetVolumeWeight(options.volumeWeight),options.hasOwnProperty(&quot;nClusters&quot;)&amp;&amp;hacd.SetNClusters(options.nClusters),options.hasOwnProperty(&quot;nVerticesPerCH&quot;)&amp;&amp;hacd.SetNVerticesPerCH(options.nVerticesPerCH),options.hasOwnProperty(&quot;concavity&quot;)&amp;&amp;hacd.SetConcavity(options.concavity);const points=Ammo._malloc(3*vertexCount*8),triangles=Ammo._malloc(3*triCount*4);hacd.SetPoints(points),hacd.SetTriangles(triangles),hacd.SetNPoints(vertexCount),hacd.SetNTriangles(triCount);const pptr=points/8,tptr=triangles/4;_iterateGeometries(root,(geo,transform)=&gt;{const components=geo.attributes.position.array,indices=geo.index?geo.index.array:null;for(let i=0;i&lt;components.length;i+=3)v.set(components[i+0],components[i+1],components[i+2]).applyMatrix4(transform).sub(center),Ammo.HEAPF64[pptr+i+0]=v.x,Ammo.HEAPF64[pptr+i+1]=v.y,Ammo.HEAPF64[pptr+i+2]=v.z;if(indices)for(let i=0;i&lt;indices.length;i++)Ammo.HEAP32[tptr+i]=indices[i];else for(let i=0;i&lt;components.length/3;i++)Ammo.HEAP32[tptr+i]=i}),hacd.Compute();const nClusters=hacd.GetNClusters(),shapes=[];for(let i=0;i&lt;nClusters;i++){const hull=new Ammo.btConvexHullShape;hull.setMargin(options.margin);const nPoints=hacd.GetNPointsCH(i),nTriangles=hacd.GetNTrianglesCH(i),hullPoints=Ammo._malloc(3*nPoints*8),hullTriangles=Ammo._malloc(3*nTriangles*4);hacd.GetCH(i,hullPoints,hullTriangles);const pptr=hullPoints/8;for(let pi=0;pi&lt;nPoints;pi++){const btVertex=new Ammo.btVector3,px=Ammo.HEAPF64[pptr+3*pi+0],py=Ammo.HEAPF64[pptr+3*pi+1],pz=Ammo.HEAPF64[pptr+3*pi+2];btVertex.setValue(px,py,pz),hull.addPoint(btVertex,pi===nPoints-1),Ammo.destroy(btVertex)}_finishCollisionShape(hull,options,scale),shapes.push(hull)}return shapes}}(),exports.createVHACDShapes=function(){const v=new THREE.Vector3,center=new THREE.Vector3;return function(root,options){if(options.type=TYPE.VHACD,_setOptions(options),options.fit===FIT.MANUAL)return console.warn(&quot;cannot use fit: manual with type: vhacd&quot;),[];if(!Ammo.hasOwnProperty(&quot;VHACD&quot;))return console.warn(&quot;VHACD unavailable in included build of Ammo.js. Visit https://github.com/mozillareality/ammo.js for the latest version.&quot;),[];const bounds=_computeBounds(root),scale=_computeScale(root,options);let vertexCount=0,triCount=0;center.addVectors(bounds.max,bounds.min).multiplyScalar(.5),_iterateGeometries(root,geo=&gt;{vertexCount+=geo.attributes.position.count,geo.index?triCount+=geo.index.count/3:triCount+=geo.attributes.position.count/3});const vhacd=new Ammo.VHACD,params=new Ammo.Parameters;options.hasOwnProperty(&quot;resolution&quot;)&amp;&amp;params.set_m_resolution(options.resolution),options.hasOwnProperty(&quot;depth&quot;)&amp;&amp;params.set_m_depth(options.depth),options.hasOwnProperty(&quot;concavity&quot;)&amp;&amp;params.set_m_concavity(options.concavity),options.hasOwnProperty(&quot;planeDownsampling&quot;)&amp;&amp;params.set_m_planeDownsampling(options.planeDownsampling),options.hasOwnProperty(&quot;convexhullDownsampling&quot;)&amp;&amp;params.set_m_convexhullDownsampling(options.convexhullDownsampling),options.hasOwnProperty(&quot;alpha&quot;)&amp;&amp;params.set_m_alpha(options.alpha),options.hasOwnProperty(&quot;beta&quot;)&amp;&amp;params.set_m_beta(options.beta),options.hasOwnProperty(&quot;gamma&quot;)&amp;&amp;params.set_m_gamma(options.gamma),options.hasOwnProperty(&quot;pca&quot;)&amp;&amp;params.set_m_pca(options.pca),options.hasOwnProperty(&quot;mode&quot;)&amp;&amp;params.set_m_mode(options.mode),options.hasOwnProperty(&quot;maxNumVerticesPerCH&quot;)&amp;&amp;params.set_m_maxNumVerticesPerCH(options.maxNumVerticesPerCH),options.hasOwnProperty(&quot;minVolumePerCH&quot;)&amp;&amp;params.set_m_minVolumePerCH(options.minVolumePerCH),options.hasOwnProperty(&quot;convexhullApproximation&quot;)&amp;&amp;params.set_m_convexhullApproximation(options.convexhullApproximation),options.hasOwnProperty(&quot;oclAcceleration&quot;)&amp;&amp;params.set_m_oclAcceleration(options.oclAcceleration);const points=Ammo._malloc(3*vertexCount*8),triangles=Ammo._malloc(3*triCount*4);let pptr=points/8,tptr=triangles/4;_iterateGeometries(root,(geo,transform)=&gt;{const components=geo.attributes.position.array,indices=geo.index?geo.index.array:null;for(let i=0;i&lt;components.length;i+=3)v.set(components[i+0],components[i+1],components[i+2]).applyMatrix4(transform).sub(center),Ammo.HEAPF64[pptr+0]=v.x,Ammo.HEAPF64[pptr+1]=v.y,Ammo.HEAPF64[pptr+2]=v.z,pptr+=3;if(indices)for(let i=0;i&lt;indices.length;i++)Ammo.HEAP32[tptr]=indices[i],tptr++;else for(let i=0;i&lt;components.length/3;i++)Ammo.HEAP32[tptr]=i,tptr++}),vhacd.Compute(points,3,vertexCount,triangles,3,triCount,params),Ammo._free(points),Ammo._free(triangles);const nHulls=vhacd.GetNConvexHulls(),shapes=[],ch=new Ammo.ConvexHull;for(let i=0;i&lt;nHulls;i++){vhacd.GetConvexHull(i,ch);const nPoints=ch.get_m_nPoints(),hull=(ch.get_m_points(),new Ammo.btConvexHullShape);hull.setMargin(options.margin);for(let pi=0;pi&lt;nPoints;pi++){const btVertex=new Ammo.btVector3,px=ch.get_m_points(3*pi+0),py=ch.get_m_points(3*pi+1),pz=ch.get_m_points(3*pi+2);btVertex.setValue(px,py,pz),hull.addPoint(btVertex,pi===nPoints-1),Ammo.destroy(btVertex)}_finishCollisionShape(hull,options,scale),shapes.push(hull)}return Ammo.destroy(ch),Ammo.destroy(vhacd),shapes}}(),exports.createTriMeshShape=function(){const va=new THREE.Vector3,vb=new THREE.Vector3,vc=new THREE.Vector3;return function(root,options){if(options.type=TYPE.MESH,_setOptions(options),options.fit===FIT.MANUAL)return console.warn(&quot;cannot use fit: manual with type: mesh&quot;),null;const scale=_computeScale(root,options),bta=new Ammo.btVector3,btb=new Ammo.btVector3,btc=new Ammo.btVector3,triMesh=new Ammo.btTriangleMesh(!0,!1);_iterateGeometries(root,(geo,transform)=&gt;{const components=geo.attributes.position.array;if(geo.index)for(let i=0;i&lt;geo.index.count;i+=3){const ai=3*geo.index.array[i],bi=3*geo.index.array[i+1],ci=3*geo.index.array[i+2];va.set(components[ai],components[ai+1],components[ai+2]).applyMatrix4(transform),vb.set(components[bi],components[bi+1],components[bi+2]).applyMatrix4(transform),vc.set(components[ci],components[ci+1],components[ci+2]).applyMatrix4(transform),bta.setValue(va.x,va.y,va.z),btb.setValue(vb.x,vb.y,vb.z),btc.setValue(vc.x,vc.y,vc.z),triMesh.addTriangle(bta,btb,btc,!1)}else for(let i=0;i&lt;components.length;i+=9)va.set(components[i+0],components[i+1],components[i+2]).applyMatrix4(transform),vb.set(components[i+3],components[i+4],components[i+5]).applyMatrix4(transform),vc.set(components[i+6],components[i+7],components[i+8]).applyMatrix4(transform),bta.setValue(va.x,va.y,va.z),btb.setValue(vb.x,vb.y,vb.z),btc.setValue(vc.x,vc.y,vc.z),triMesh.addTriangle(bta,btb,btc,!1)});const localScale=new Ammo.btVector3(scale.x,scale.y,scale.z);triMesh.setScaling(localScale),Ammo.destroy(localScale);const collisionShape=new Ammo.btBvhTriangleMeshShape(triMesh,!0,!0);return collisionShape.resources=[triMesh],Ammo.destroy(bta),Ammo.destroy(btb),Ammo.destroy(btc),_finishCollisionShape(collisionShape,options),collisionShape}}();const _finishCollisionShape=function(collisionShape,options,scale){collisionShape.type=options.type,collisionShape.setMargin(options.margin),collisionShape.destroy=(()=&gt;{for(let res of collisionShape.resources||[])Ammo.destroy(res);Ammo.destroy(collisionShape)});const localTransform=new Ammo.btTransform,rotation=new Ammo.btQuaternion;if(localTransform.setIdentity(),localTransform.getOrigin().setValue(options.offset.x,options.offset.y,options.offset.z),rotation.setValue(options.orientation.x,options.orientation.y,options.orientation.z,options.orientation.w),localTransform.setRotation(rotation),Ammo.destroy(rotation),scale){const localScale=new Ammo.btVector3(scale.x,scale.y,scale.z);collisionShape.setLocalScaling(localScale),Ammo.destroy(localScale)}collisionShape.localTransform=localTransform},_iterateGeometries=function(){const transform=new THREE.Matrix4,inverse=new THREE.Matrix4,bufferGeometry=new THREE.BufferGeometry;return function(root,cb){inverse.getInverse(root.matrixWorld),root.traverse(mesh=&gt;{!mesh.isMesh||THREE.Sky&amp;&amp;mesh.__proto__==THREE.Sky.prototype||(mesh===root?transform.identity():(hasUpdateMatricesFunction&amp;&amp;mesh.updateMatrices(),transform.multiplyMatrices(inverse,mesh.matrixWorld)),cb(mesh.geometry.isBufferGeometry?mesh.geometry:bufferGeometry.fromGeometry(mesh.geometry),transform))})}}(),_computeScale=function(root,options){const scale=new THREE.Vector3(1,1,1);return options.fit===FIT.ALL&amp;&amp;scale.setFromMatrixScale(root.matrixWorld),scale},_computeRadius=function(){const v=new THREE.Vector3,center=new THREE.Vector3;return function(root,bounds){let maxRadiusSq=0,{x:cx,y:cy,z:cz}=bounds.getCenter(center);return _iterateGeometries(root,(geo,transform)=&gt;{const components=geo.attributes.position.array;for(let i=0;i&lt;components.length;i+=3){v.set(components[i],components[i+1],components[i+2]).applyMatrix4(transform);const dx=cx-v.x,dy=cy-v.y,dz=cz-v.z;maxRadiusSq=Math.max(maxRadiusSq,dx*dx+dy*dy+dz*dz)}}),Math.sqrt(maxRadiusSq)}}(),_computeHalfExtents=function(root,bounds,minHalfExtent,maxHalfExtent){return(new THREE.Vector3).subVectors(bounds.max,bounds.min).multiplyScalar(.5).clampScalar(minHalfExtent,maxHalfExtent)},_computeBounds=function(){const v=new THREE.Vector3;return function(root){const bounds=new THREE.Box3;let minX=1/0,minY=1/0,minZ=1/0,maxX=-1/0,maxY=-1/0,maxZ=-1/0;return bounds.min.set(0,0,0),bounds.max.set(0,0,0),_iterateGeometries(root,(geo,transform)=&gt;{const components=geo.attributes.position.array;for(let i=0;i&lt;components.length;i+=3)v.set(components[i],components[i+1],components[i+2]).applyMatrix4(transform),v.x&lt;minX&amp;&amp;(minX=v.x),v.y&lt;minY&amp;&amp;(minY=v.y),v.z&lt;minZ&amp;&amp;(minZ=v.z),v.x&gt;maxX&amp;&amp;(maxX=v.x),v.y&gt;maxY&amp;&amp;(maxY=v.y),v.z&gt;maxZ&amp;&amp;(maxZ=v.z)}),bounds.min.set(minX,minY,minZ),bounds.max.set(maxX,maxY,maxZ),bounds}}()},{}],6:[function(require,module,exports){var e=require(&quot;cannon-es&quot;),t=function(){var e,t,r,n,o,i,s,a,u,c,m,f,l,d,p,x,y,E,h,g=[],v=[],w=0,T=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(n,o,i){return e.subVectors(i,n),t.subVectors(o,n),r.crossVectors(e,t),r.normalize()}}();function V(e,t){if(void 0!==e.normal)return e.normal;var r=t[e[0]],n=t[e[2]];return m.subVectors(t[e[1]],r),f.subVectors(n,r),p.crossVectors(f,m),p.normalize(),e.normal=p.clone()}function b(e,t,r){var n=r[e[0]],o=[],i=V(e,r);t.sort(function(e,t){return o[e.x/3]=void 0!==o[e.x/3]?o[e.x/3]:i.dot(l.subVectors(e,n)),o[t.x/3]=void 0!==o[t.x/3]?o[t.x/3]:i.dot(d.subVectors(t,n)),o[e.x/3]-o[t.x/3]});var s=t.length;for(1===s&amp;&amp;(o[t[0].x/3]=i.dot(l.subVectors(t[0],n)));s-- &gt;0&amp;&amp;o[t[s].x/3]&gt;0;);s+1&lt;t.length&amp;&amp;o[t[s+1].x/3]&gt;0&amp;&amp;(e.visiblePoints=t.splice(s+1))}function R(e,t){for(var r,n=g.length,o=[e],i=t.indexOf(e.visiblePoints.pop());n-- &gt;0;)(r=g[n])!==e&amp;&amp;V(r,t).dot(x.subVectors(t[i],t[r[0]]))&gt;0&amp;&amp;o.push(r);var s,a,u,c,m=n=o.length,f=1===n,l=[],d=0,p=[];if(1===o.length)l=[(r=o[0])[0],r[1],r[1],r[2],r[2],r[0]],v.indexOf(r)&gt;-1&amp;&amp;v.splice(v.indexOf(r),1),r.visiblePoints&amp;&amp;(p=p.concat(r.visiblePoints)),g.splice(g.indexOf(r),1);else for(;n-- &gt;0;){var y;for(v.indexOf(r=o[n])&gt;-1&amp;&amp;v.splice(v.indexOf(r),1),r.visiblePoints&amp;&amp;(p=p.concat(r.visiblePoints)),g.splice(g.indexOf(r),1),cEdgeIndex=0;cEdgeIndex&lt;3;){for(y=!1,m=o.length,u=r[cEdgeIndex],c=r[(cEdgeIndex+1)%3];m-- &gt;0&amp;&amp;!y;)if(d=0,(s=o[m])!==r)for(;d&lt;3&amp;&amp;!y;)a=d+1,y=s[d]===u&amp;&amp;s[a%3]===c||s[d]===c&amp;&amp;s[a%3]===u,d++;y&amp;&amp;!f||(l.push(u),l.push(c)),cEdgeIndex++}}n=0;for(var E,h=l.length/2;n&lt;h;)b(E=[l[2*n+1],i,l[2*n]],p,t),g.push(E),void 0!==E.visiblePoints&amp;&amp;v.push(E),n++}var H=function(){var e=new THREE.Vector3,t=new THREE.Vector3,r=new THREE.Vector3;return function(n,o,i){e.subVectors(o,n),t.subVectors(i,n),r.subVectors(i,o);var s=t.dot(e);if(s&lt;0)return t.dot(t);var a=e.dot(e);return s&gt;=a?r.dot(r):t.dot(t)-s*s/a}}();return function(V){for(m=new THREE.Vector3,f=new THREE.Vector3,new THREE.Vector3,l=new THREE.Vector3,d=new THREE.Vector3,p=new THREE.Vector3,x=new THREE.Vector3,y=new THREE.Vector3,E=new THREE.Vector3,h=new THREE.Vector3,points=V.vertices,g=[],v=[],M=e=points.length,t=points.slice(0,6),w=0;M-- &gt;0;)points[M].x&lt;t[0].x&amp;&amp;(t[0]=points[M]),points[M].x&gt;t[1].x&amp;&amp;(t[1]=points[M]),points[M].y&lt;t[2].y&amp;&amp;(t[2]=points[M]),points[M].y&lt;t[3].y&amp;&amp;(t[3]=points[M]),points[M].z&lt;t[4].z&amp;&amp;(t[4]=points[M]),points[M].z&lt;t[5].z&amp;&amp;(t[5]=points[M]);for(n=M=6;M-- &gt;0;)for(n=M-1;n-- &gt;0;)w&lt;(r=t[M].distanceToSquared(t[n]))&amp;&amp;(w=r,o=t[M],i=t[n]);for(M=6,w=0;M-- &gt;0;)r=H(o,i,t[M]),w&lt;r&amp;&amp;(w=r,s=t[M]);for(u=T(o,i,s),c=u.dot(o),w=0,M=e;M-- &gt;0;)r=Math.abs(points[M].dot(u)-c),w&lt;r&amp;&amp;(w=r,a=points[M]);var B=points.indexOf(o),z=points.indexOf(i),S=points.indexOf(s),O=points.indexOf(a),G=[[S,z,B],[z,O,B],[S,O,z],[B,O,S]];y.subVectors(i,o).normalize(),E.subVectors(s,o).normalize(),h.subVectors(a,o).normalize(),h.dot((new THREE.Vector3).crossVectors(E,y))&lt;0&amp;&amp;(G[0].reverse(),G[1].reverse(),G[2].reverse(),G[3].reverse());var C=points.slice();C.splice(C.indexOf(o),1),C.splice(C.indexOf(i),1),C.splice(C.indexOf(s),1),C.splice(C.indexOf(a),1);for(var M=G.length;M-- &gt;0;)b(G[M],C,points),void 0!==G[M].visiblePoints&amp;&amp;v.push(G[M]),g.push(G[M]);!function(e){for(;v.length&gt;0;)R(v.shift(),e)}(points);for(var P=g.length;P-- &gt;0;)V.faces[P]=new THREE.Face3(g[P][2],g[P][1],g[P][0],g[P].normal);return V.normalsNeedUpdate=!0,V}}(),r=Math.PI/2,n={BOX:&quot;Box&quot;,CYLINDER:&quot;Cylinder&quot;,SPHERE:&quot;Sphere&quot;,HULL:&quot;ConvexPolyhedron&quot;,MESH:&quot;Trimesh&quot;},o=function(o,c){var m;if((c=c||{}).type===n.BOX)return s(o);if(c.type===n.CYLINDER)return function(t,n){var o,i,s,a=new THREE.Box3,u=[&quot;x&quot;,&quot;y&quot;,&quot;z&quot;],c=n.cylinderAxis||&quot;y&quot;,m=u.splice(u.indexOf(c),1)&amp;&amp;u;return a.setFromObject(t),isFinite(a.min.lengthSq())?(i=a.max[c]-a.min[c],s=.5*Math.max(a.max[m[0]]-a.min[m[0]],a.max[m[1]]-a.min[m[1]]),(o=new e.Cylinder(s,s,i,12))._type=e.Shape.types.CYLINDER,o.radiusTop=s,o.radiusBottom=s,o.height=i,o.numSegments=12,o.orientation=new e.Quaternion,o.orientation.setFromEuler(&quot;y&quot;===c?r:0,&quot;z&quot;===c?r:0,0,&quot;XYZ&quot;).normalize(),o):null}(o,c);if(c.type===n.SPHERE)return function(t,r){if(r.sphereRadius)return new e.Sphere(r.sphereRadius);var n=a(t);return n?(n.computeBoundingSphere(),new e.Sphere(n.boundingSphere.radius)):null}(o,c);if(c.type===n.HULL)return function(r){var n,o,i,s,u=a(r);if(!u||!u.vertices.length)return null;for(n=0;n&lt;u.vertices.length;n++)u.vertices[n].x+=1e-4*(Math.random()-.5),u.vertices[n].y+=1e-4*(Math.random()-.5),u.vertices[n].z+=1e-4*(Math.random()-.5);for(s=t(u),o=new Array(s.vertices.length),n=0;n&lt;s.vertices.length;n++)o[n]=new e.Vec3(s.vertices[n].x,s.vertices[n].y,s.vertices[n].z);for(i=new Array(s.faces.length),n=0;n&lt;s.faces.length;n++)i[n]=[s.faces[n].a,s.faces[n].b,s.faces[n].c];return new e.ConvexPolyhedron(o,i)}(o);if(c.type===n.MESH)return(m=a(o))?function(t){var r,n=u(m);return n.length?(r=Object.keys(n).map(Number),new e.Trimesh(n,r)):null}():null;if(c.type)throw new Error(&#39;[CANNON.threeToCannon] Invalid type &quot;%s&quot;.&#39;,c.type);if(!(m=a(o)))return null;switch(m.metadata?m.metadata.type:m.type){case&quot;BoxGeometry&quot;:case&quot;BoxBufferGeometry&quot;:return i(m);case&quot;CylinderGeometry&quot;:case&quot;CylinderBufferGeometry&quot;:return function(t){var r,n=t.metadata?t.metadata.parameters:t.parameters;return(r=new e.Cylinder(n.radiusTop,n.radiusBottom,n.height,n.radialSegments))._type=e.Shape.types.CYLINDER,r.radiusTop=n.radiusTop,r.radiusBottom=n.radiusBottom,r.height=n.height,r.numSegments=n.radialSegments,r.orientation=new e.Quaternion,r.orientation.setFromEuler(THREE.Math.degToRad(90),0,0,&quot;XYZ&quot;).normalize(),r}(m);case&quot;PlaneGeometry&quot;:case&quot;PlaneBufferGeometry&quot;:return function(t){t.computeBoundingBox();var r=t.boundingBox;return new e.Box(new e.Vec3((r.max.x-r.min.x)/2||.1,(r.max.y-r.min.y)/2||.1,(r.max.z-r.min.z)/2||.1))}(m);case&quot;SphereGeometry&quot;:case&quot;SphereBufferGeometry&quot;:return function(t){return new e.Sphere((t.metadata?t.metadata.parameters:t.parameters).radius)}(m);case&quot;TubeGeometry&quot;:case&quot;Geometry&quot;:case&quot;BufferGeometry&quot;:return s(o);default:return console.warn(&#39;Unrecognized geometry: &quot;%s&quot;. Using bounding box as shape.&#39;,m.type),i(m)}};function i(t){if(!u(t).length)return null;t.computeBoundingBox();var r=t.boundingBox;return new e.Box(new e.Vec3((r.max.x-r.min.x)/2,(r.max.y-r.min.y)/2,(r.max.z-r.min.z)/2))}function s(t){var r,n,o=new THREE.Box3,i=t.clone();return i.quaternion.set(0,0,0,1),i.updateMatrixWorld(),o.setFromObject(i),isFinite(o.min.lengthSq())?(r=new e.Box(new e.Vec3((o.max.x-o.min.x)/2,(o.max.y-o.min.y)/2,(o.max.z-o.min.z)/2)),(n=o.translate(i.position.negate()).getCenter(new THREE.Vector3)).lengthSq()&amp;&amp;(r.offset=n),r):null}function a(e){var t,r,n=function(e){var t=[];return e.traverse(function(e){&quot;Mesh&quot;===e.type&amp;&amp;t.push(e)}),t}(e),o=new THREE.Geometry,i=new THREE.Geometry;if(0===n.length)return null;if(1===n.length){var s=new THREE.Vector3,a=new THREE.Quaternion,u=new THREE.Vector3;return n[0].geometry.isBufferGeometry?n[0].geometry.attributes.position&amp;&amp;n[0].geometry.attributes.position.itemSize&gt;2&amp;&amp;o.fromBufferGeometry(n[0].geometry):o=n[0].geometry.clone(),o.metadata=n[0].geometry.metadata,n[0].updateMatrixWorld(),n[0].matrixWorld.decompose(s,a,u),o.scale(u.x,u.y,u.z)}for(;r=n.pop();)if(r.updateMatrixWorld(),r.geometry.isBufferGeometry){if(r.geometry.attributes.position&amp;&amp;r.geometry.attributes.position.itemSize&gt;2){var c=new THREE.Geometry;c.fromBufferGeometry(r.geometry),i.merge(c,r.matrixWorld),c.dispose()}}else i.merge(r.geometry,r.matrixWorld);return(t=new THREE.Matrix4).scale(e.scale),i.applyMatrix(t),i}function u(e){return e.attributes||(e=(new THREE.BufferGeometry).fromGeometry(e)),(e.attributes.position||{}).array||[]}o.Type=n,exports.threeToCannon=o},{&quot;cannon-es&quot;:4}],7:[function(require,module,exports){var bundleFn=arguments[3],sources=arguments[4],cache=arguments[5],stringify=JSON.stringify;module.exports=function(fn,options){for(var wkey,cacheKeys=Object.keys(cache),i=0,l=cacheKeys.length;i&lt;l;i++){var key=cacheKeys[i],exp=cache[key].exports;if(exp===fn||exp&amp;&amp;exp.default===fn){wkey=key;break}}if(!wkey){wkey=Math.floor(Math.pow(16,8)*Math.random()).toString(16);var wcache={};for(i=0,l=cacheKeys.length;i&lt;l;i++){wcache[key=cacheKeys[i]]=key}sources[wkey]=[Function([&quot;require&quot;,&quot;module&quot;,&quot;exports&quot;],&quot;(&quot;+fn+&quot;)(self)&quot;),wcache]}var skey=Math.floor(Math.pow(16,8)*Math.random()).toString(16),scache={};scache[wkey]=wkey,sources[skey]=[Function([&quot;require&quot;],&quot;var f = require(&quot;+stringify(wkey)+&quot;);(f.default ? f.default : f)(self);&quot;),scache];var workerSources={};!function resolveSources(key){workerSources[key]=!0;for(var depPath in sources[key][1]){var depKey=sources[key][1][depPath];workerSources[depKey]||resolveSources(depKey)}}(skey);var src=&quot;(&quot;+bundleFn+&quot;)({&quot;+Object.keys(workerSources).map(function(key){return stringify(key)+&quot;:[&quot;+sources[key][0]+&quot;,&quot;+stringify(sources[key][1])+&quot;]&quot;}).join(&quot;,&quot;)+&quot;},{},[&quot;+stringify(skey)+&quot;])&quot;,URL=window.URL||window.webkitURL||window.mozURL||window.msURL,blob=new Blob([src],{type:&quot;text/javascript&quot;});if(options&amp;&amp;options.bare)return blob;var workerUrl=URL.createObjectURL(blob),worker=new Worker(workerUrl);return worker.objectURL=workerUrl,worker}},{}],8:[function(require,module,exports){const CONSTRAINT=require(&quot;../constants&quot;).CONSTRAINT;module.exports=AFRAME.registerComponent(&quot;ammo-constraint&quot;,{multiple:!0,schema:{type:{default:CONSTRAINT.LOCK,oneOf:[CONSTRAINT.LOCK,CONSTRAINT.FIXED,CONSTRAINT.SPRING,CONSTRAINT.SLIDER,CONSTRAINT.HINGE,CONSTRAINT.CONE_TWIST,CONSTRAINT.POINT_TO_POINT]},target:{type:&quot;selector&quot;},pivot:{type:&quot;vec3&quot;},targetPivot:{type:&quot;vec3&quot;},axis:{type:&quot;vec3&quot;,default:{x:0,y:0,z:1}},targetAxis:{type:&quot;vec3&quot;,default:{x:0,y:0,z:1}}},init:function(){this.system=this.el.sceneEl.systems.physics,this.constraint=null},remove:function(){this.constraint&amp;&amp;(this.system.removeConstraint(this.constraint),this.constraint=null)},update:function(){const el=this.el,data=this.data;this.remove(),el.body&amp;&amp;data.target.body?(this.constraint=this.createConstraint(),this.system.addConstraint(this.constraint)):(el.body?data.target:el).addEventListener(&quot;body-loaded&quot;,this.update.bind(this,{}),{once:!0})},createConstraint:function(){let constraint;const data=this.data,body=this.el.body,targetBody=data.target.body,bodyTransform=body.getCenterOfMassTransform().inverse().op_mul(targetBody.getWorldTransform()),targetTransform=new Ammo.btTransform;switch(targetTransform.setIdentity(),data.type){case CONSTRAINT.LOCK:{constraint=new Ammo.btGeneric6DofConstraint(body,targetBody,bodyTransform,targetTransform,!0);const zero=new Ammo.btVector3(0,0,0);constraint.setLinearLowerLimit(zero),constraint.setLinearUpperLimit(zero),constraint.setAngularLowerLimit(zero),constraint.setAngularUpperLimit(zero),Ammo.destroy(zero);break}case CONSTRAINT.FIXED:bodyTransform.setRotation(body.getWorldTransform().getRotation()),targetTransform.setRotation(targetBody.getWorldTransform().getRotation()),constraint=new Ammo.btFixedConstraint(body,targetBody,bodyTransform,targetTransform);break;case CONSTRAINT.SPRING:constraint=new Ammo.btGeneric6DofSpringConstraint(body,targetBody,bodyTransform,targetTransform,!0);break;case CONSTRAINT.SLIDER:(constraint=new Ammo.btSliderConstraint(body,targetBody,bodyTransform,targetTransform,!0)).setLowerLinLimit(-1),constraint.setUpperLinLimit(1);break;case CONSTRAINT.HINGE:{const pivot=new Ammo.btVector3(data.pivot.x,data.pivot.y,data.pivot.z),targetPivot=new Ammo.btVector3(data.targetPivot.x,data.targetPivot.y,data.targetPivot.z),axis=new Ammo.btVector3(data.axis.x,data.axis.y,data.axis.z),targetAxis=new Ammo.btVector3(data.targetAxis.x,data.targetAxis.y,data.targetAxis.z);constraint=new Ammo.btHingeConstraint(body,targetBody,pivot,targetPivot,axis,targetAxis,!0),Ammo.destroy(pivot),Ammo.destroy(targetPivot),Ammo.destroy(axis),Ammo.destroy(targetAxis);break}case CONSTRAINT.CONE_TWIST:{const pivotTransform=new Ammo.btTransform;pivotTransform.setIdentity(),pivotTransform.getOrigin().setValue(data.targetPivot.x,data.targetPivot.y,data.targetPivot.z),constraint=new Ammo.btConeTwistConstraint(body,pivotTransform),Ammo.destroy(pivotTransform);break}case CONSTRAINT.POINT_TO_POINT:{const pivot=new Ammo.btVector3(data.pivot.x,data.pivot.y,data.pivot.z),targetPivot=new Ammo.btVector3(data.targetPivot.x,data.targetPivot.y,data.targetPivot.z);constraint=new Ammo.btPoint2PointConstraint(body,targetBody,pivot,targetPivot),Ammo.destroy(pivot),Ammo.destroy(targetPivot);break}default:throw new Error(&quot;[constraint] Unexpected type: &quot;+data.type)}return Ammo.destroy(bodyTransform),Ammo.destroy(targetTransform),constraint}})},{&quot;../constants&quot;:19}],9:[function(require,module,exports){require(&quot;ammo-debug-drawer&quot;);const threeToAmmo=require(&quot;three-to-ammo&quot;),CONSTANTS=require(&quot;../../constants&quot;),ACTIVATION_STATE=CONSTANTS.ACTIVATION_STATE,COLLISION_FLAG=CONSTANTS.COLLISION_FLAG,SHAPE=CONSTANTS.SHAPE,TYPE=CONSTANTS.TYPE,ACTIVATION_STATES=(CONSTANTS.FIT,[ACTIVATION_STATE.ACTIVE_TAG,ACTIVATION_STATE.ISLAND_SLEEPING,ACTIVATION_STATE.WANTS_DEACTIVATION,ACTIVATION_STATE.DISABLE_DEACTIVATION,ACTIVATION_STATE.DISABLE_SIMULATION]),RIGID_BODY_FLAGS_NONE=0,RIGID_BODY_FLAGS_DISABLE_WORLD_GRAVITY=1;function almostEqualsVector3(epsilon,u,v){return Math.abs(u.x-v.x)&lt;epsilon&amp;&amp;Math.abs(u.y-v.y)&lt;epsilon&amp;&amp;Math.abs(u.z-v.z)&lt;epsilon}function almostEqualsBtVector3(epsilon,u,v){return Math.abs(u.x()-v.x())&lt;epsilon&amp;&amp;Math.abs(u.y()-v.y())&lt;epsilon&amp;&amp;Math.abs(u.z()-v.z())&lt;epsilon}let AmmoBody={schema:{loadedEvent:{default:&quot;&quot;},mass:{default:1},gravity:{type:&quot;vec3&quot;,default:{x:0,y:-9.8,z:0}},linearDamping:{default:.01},angularDamping:{default:.01},linearSleepingThreshold:{default:1.6},angularSleepingThreshold:{default:2.5},angularFactor:{type:&quot;vec3&quot;,default:{x:1,y:1,z:1}},activationState:{default:ACTIVATION_STATE.ACTIVE_TAG,oneOf:ACTIVATION_STATES},type:{default:&quot;dynamic&quot;,oneOf:[TYPE.STATIC,TYPE.DYNAMIC,TYPE.KINEMATIC]},emitCollisionEvents:{default:!1},disableCollision:{default:!1},collisionFilterGroup:{default:1},collisionFilterMask:{default:1},scaleAutoUpdate:{default:!0}},init:function(){this.system=this.el.sceneEl.systems.physics,this.shapeComponents=[],&quot;&quot;===this.data.loadedEvent?this.loadedEventFired=!0:this.el.addEventListener(this.data.loadedEvent,()=&gt;{this.loadedEventFired=!0},{once:!0}),this.system.initialized&amp;&amp;this.loadedEventFired&amp;&amp;this.initBody()},initBody:function(){const pos=new THREE.Vector3,quat=new THREE.Quaternion;new THREE.Box3;return function(){const el=this.el,data=this.data;this.localScaling=new Ammo.btVector3;const obj=this.el.object3D;obj.getWorldPosition(pos),obj.getWorldQuaternion(quat),this.prevScale=new THREE.Vector3(1,1,1),this.prevNumChildShapes=0,this.msTransform=new Ammo.btTransform,this.msTransform.setIdentity(),this.rotation=new Ammo.btQuaternion(quat.x,quat.y,quat.z,quat.w),this.msTransform.getOrigin().setValue(pos.x,pos.y,pos.z),this.msTransform.setRotation(this.rotation),this.motionState=new Ammo.btDefaultMotionState(this.msTransform),this.localInertia=new Ammo.btVector3(0,0,0),this.compoundShape=new Ammo.btCompoundShape(!0),this.rbInfo=new Ammo.btRigidBodyConstructionInfo(data.mass,this.motionState,this.compoundShape,this.localInertia),this.body=new Ammo.btRigidBody(this.rbInfo),this.body.setActivationState(ACTIVATION_STATES.indexOf(data.activationState)+1),this.body.setSleepingThresholds(data.linearSleepingThreshold,data.angularSleepingThreshold),this.body.setDamping(data.linearDamping,data.angularDamping);const angularFactor=new Ammo.btVector3(data.angularFactor.x,data.angularFactor.y,data.angularFactor.z);this.body.setAngularFactor(angularFactor),Ammo.destroy(angularFactor);const gravity=new Ammo.btVector3(data.gravity.x,data.gravity.y,data.gravity.z);almostEqualsBtVector3(.001,gravity,this.system.driver.physicsWorld.getGravity())||(this.body.setGravity(gravity),this.body.setFlags(RIGID_BODY_FLAGS_DISABLE_WORLD_GRAVITY)),Ammo.destroy(gravity),this.updateCollisionFlags(),this.el.body=this.body,this.body.el=el,this.isLoaded=!0,this.el.emit(&quot;body-loaded&quot;,{body:this.el.body}),this._addToSystem()}}(),tick:function(){this.system.initialized&amp;&amp;!this.isLoaded&amp;&amp;this.loadedEventFired&amp;&amp;this.initBody()},_updateShapes:function(){const needsPolyhedralInitialization=[SHAPE.HULL,SHAPE.HACD,SHAPE.VHACD];return function(){let updated=!1;const obj=this.el.object3D;if(this.data.scaleAutoUpdate&amp;&amp;this.prevScale&amp;&amp;!almostEqualsVector3(.001,obj.scale,this.prevScale)&amp;&amp;(this.prevScale.copy(obj.scale),updated=!0,this.localScaling.setValue(this.prevScale.x,this.prevScale.y,this.prevScale.z),this.compoundShape.setLocalScaling(this.localScaling)),this.shapeComponentsChanged){this.shapeComponentsChanged=!1,updated=!0;for(let i=0;i&lt;this.shapeComponents.length;i++){const shapeComponent=this.shapeComponents[i];0===shapeComponent.getShapes().length&amp;&amp;this._createCollisionShape(shapeComponent);const collisionShapes=shapeComponent.getShapes();for(let j=0;j&lt;collisionShapes.length;j++){const collisionShape=collisionShapes[j];collisionShape.added||(this.compoundShape.addChildShape(collisionShape.localTransform,collisionShape),collisionShape.added=!0)}}this.data.type===TYPE.DYNAMIC&amp;&amp;this.updateMass(),this.system.driver.updateBody(this.body)}if(this.system.debug&amp;&amp;(updated||!this.polyHedralFeaturesInitialized)){for(let i=0;i&lt;this.shapeComponents.length;i++){const collisionShapes=this.shapeComponents[i].getShapes();for(let j=0;j&lt;collisionShapes.length;j++){const collisionShape=collisionShapes[j];-1!==needsPolyhedralInitialization.indexOf(collisionShape.type)&amp;&amp;collisionShape.initializePolyhedralFeatures(0)}}this.polyHedralFeaturesInitialized=!0}}}(),_createCollisionShape:function(shapeComponent){const data=shapeComponent.data,collisionShapes=threeToAmmo.createCollisionShapes(shapeComponent.getMesh(),data);shapeComponent.addShapes(collisionShapes)},play:function(){this.isLoaded&amp;&amp;this._addToSystem()},_addToSystem:function(){this.addedToSystem||(this.system.addBody(this.body,this.data.collisionFilterGroup,this.data.collisionFilterMask),this.data.emitCollisionEvents&amp;&amp;this.system.driver.addEventListener(this.body),this.system.addComponent(this),this.addedToSystem=!0)},pause:function(){this.addedToSystem&amp;&amp;(this.system.removeComponent(this),this.system.removeBody(this.body),this.addedToSystem=!1)},update:function(prevData){if(this.isLoaded){if(!this.hasUpdated)return void(this.hasUpdated=!0);const data=this.data;if(prevData.type===data.type&amp;&amp;prevData.disableCollision===data.disableCollision||this.updateCollisionFlags(),prevData.activationState!==data.activationState&amp;&amp;(this.body.forceActivationState(ACTIVATION_STATES.indexOf(data.activationState)+1),data.activationState===ACTIVATION_STATE.ACTIVE_TAG&amp;&amp;this.body.activate(!0)),prevData.collisionFilterGroup!==data.collisionFilterGroup||prevData.collisionFilterMask!==data.collisionFilterMask){const broadphaseProxy=this.body.getBroadphaseProxy();broadphaseProxy.set_m_collisionFilterGroup(data.collisionFilterGroup),broadphaseProxy.set_m_collisionFilterMask(data.collisionFilterMask),this.system.driver.broadphase.getOverlappingPairCache().removeOverlappingPairsContainingProxy(broadphaseProxy,this.system.driver.dispatcher)}if(prevData.linearDamping==data.linearDamping&amp;&amp;prevData.angularDamping==data.angularDamping||this.body.setDamping(data.linearDamping,data.angularDamping),!almostEqualsVector3(.001,prevData.gravity,data.gravity)){const gravity=new Ammo.btVector3(data.gravity.x,data.gravity.y,data.gravity.z);almostEqualsBtVector3(.001,gravity,this.system.driver.physicsWorld.getGravity())?this.body.setFlags(RIGID_BODY_FLAGS_NONE):this.body.setFlags(RIGID_BODY_FLAGS_DISABLE_WORLD_GRAVITY),this.body.setGravity(gravity),Ammo.destroy(gravity)}if(prevData.linearSleepingThreshold==data.linearSleepingThreshold&amp;&amp;prevData.angularSleepingThreshold==data.angularSleepingThreshold||this.body.setSleepingThresholds(data.linearSleepingThreshold,data.angularSleepingThreshold),!almostEqualsVector3(.001,prevData.angularFactor,data.angularFactor)){const angularFactor=new Ammo.btVector3(data.angularFactor.x,data.angularFactor.y,data.angularFactor.z);this.body.setAngularFactor(angularFactor),Ammo.destroy(angularFactor)}}},remove:function(){this.triMesh&amp;&amp;Ammo.destroy(this.triMesh),this.localScaling&amp;&amp;Ammo.destroy(this.localScaling),this.compoundShape&amp;&amp;Ammo.destroy(this.compoundShape),this.body&amp;&amp;(Ammo.destroy(this.body),delete this.body),Ammo.destroy(this.rbInfo),Ammo.destroy(this.msTransform),Ammo.destroy(this.motionState),Ammo.destroy(this.localInertia),Ammo.destroy(this.rotation)},beforeStep:function(){this._updateShapes(),this.data.type!==TYPE.DYNAMIC&amp;&amp;this.syncToPhysics()},step:function(){this.data.type===TYPE.DYNAMIC&amp;&amp;this.syncFromPhysics()},syncToPhysics:function(){const q=new THREE.Quaternion,v=new THREE.Vector3,q2=new THREE.Vector3,v2=new THREE.Vector3;return function(){const el=this.el,parentEl=el.parentEl;if(!this.body)return;this.motionState.getWorldTransform(this.msTransform),parentEl.isScene?(v.copy(el.object3D.position),q.copy(el.object3D.quaternion)):(el.object3D.getWorldPosition(v),el.object3D.getWorldQuaternion(q));const position=this.msTransform.getOrigin();v2.set(position.x(),position.y(),position.z());const quaternion=this.msTransform.getRotation();q2.set(quaternion.x(),quaternion.y(),quaternion.z(),quaternion.w()),almostEqualsVector3(.001,v,v2)&amp;&amp;function(epsilon,u,v){return Math.abs(u.x-v.x)&lt;epsilon&amp;&amp;Math.abs(u.y-v.y)&lt;epsilon&amp;&amp;Math.abs(u.z-v.z)&lt;epsilon&amp;&amp;Math.abs(u.w-v.w)&lt;epsilon||Math.abs(u.x+v.x)&lt;epsilon&amp;&amp;Math.abs(u.y+v.y)&lt;epsilon&amp;&amp;Math.abs(u.z+v.z)&lt;epsilon&amp;&amp;Math.abs(u.w+v.w)&lt;epsilon}(.001,q,q2)||(this.body.isActive()||this.body.activate(!0),this.msTransform.getOrigin().setValue(v.x,v.y,v.z),this.rotation.setValue(q.x,q.y,q.z,q.w),this.msTransform.setRotation(this.rotation),this.motionState.setWorldTransform(this.msTransform),this.data.type===TYPE.STATIC&amp;&amp;this.body.setCenterOfMassTransform(this.msTransform))}}(),syncFromPhysics:function(){const v=new THREE.Vector3,q1=new THREE.Quaternion,q2=new THREE.Quaternion;return function(){this.motionState.getWorldTransform(this.msTransform);const position=this.msTransform.getOrigin(),quaternion=this.msTransform.getRotation(),el=this.el,parentEl=el.parentEl;this.body&amp;&amp;parentEl&amp;&amp;(parentEl.isScene?(el.object3D.position.set(position.x(),position.y(),position.z()),el.object3D.quaternion.set(quaternion.x(),quaternion.y(),quaternion.z(),quaternion.w())):(q1.set(quaternion.x(),quaternion.y(),quaternion.z(),quaternion.w()),parentEl.object3D.getWorldQuaternion(q2),q1.multiply(q2.inverse()),el.object3D.quaternion.copy(q1),v.set(position.x(),position.y(),position.z()),parentEl.object3D.worldToLocal(v),el.object3D.position.copy(v)))}}(),addShapeComponent:function(shapeComponent){shapeComponent.data.type!==SHAPE.MESH||this.data.type===TYPE.STATIC?(this.shapeComponents.push(shapeComponent),this.shapeComponentsChanged=!0):console.warn(&quot;non-static mesh colliders not supported&quot;)},removeShapeComponent:function(shapeComponent){const index=this.shapeComponents.indexOf(shapeComponent);if(this.compoundShape&amp;&amp;-1!==index&amp;&amp;this.body){const shapes=shapeComponent.getShapes();for(var i=0;i&lt;shapes.length;i++)this.compoundShape.removeChildShape(shapes[i]);this.shapeComponentsChanged=!0,this.shapeComponents.splice(index,1)}},updateMass:function(){const shape=this.body.getCollisionShape(),mass=this.data.type===TYPE.DYNAMIC?this.data.mass:0;shape.calculateLocalInertia(mass,this.localInertia),this.body.setMassProps(mass,this.localInertia),this.body.updateInertiaTensor()},updateCollisionFlags:function(){let flags=this.data.disableCollision?4:0;switch(this.data.type){case TYPE.STATIC:flags|=COLLISION_FLAG.STATIC_OBJECT;break;case TYPE.KINEMATIC:flags|=COLLISION_FLAG.KINEMATIC_OBJECT;break;default:this.body.applyGravity()}this.body.setCollisionFlags(flags),this.updateMass(),this.system.driver.updateBody(this.body)},getVelocity:function(){return this.body.getLinearVelocity()}};module.exports.definition=AmmoBody,module.exports.Component=AFRAME.registerComponent(&quot;ammo-body&quot;,AmmoBody)},{&quot;../../constants&quot;:19,&quot;ammo-debug-drawer&quot;:3,&quot;three-to-ammo&quot;:5}],10:[function(require,module,exports){var CANNON=require(&quot;cannon-es&quot;),mesh2shape=require(&quot;three-to-cannon&quot;).threeToCannon;require(&quot;../../../lib/CANNON-shape2mesh&quot;);var q,v,Body={dependencies:[&quot;velocity&quot;],schema:{mass:{default:5,if:{type:&quot;dynamic&quot;}},linearDamping:{default:.01,if:{type:&quot;dynamic&quot;}},angularDamping:{default:.01,if:{type:&quot;dynamic&quot;}},shape:{default:&quot;auto&quot;,oneOf:[&quot;auto&quot;,&quot;box&quot;,&quot;cylinder&quot;,&quot;sphere&quot;,&quot;hull&quot;,&quot;mesh&quot;,&quot;none&quot;]},cylinderAxis:{default:&quot;y&quot;,oneOf:[&quot;x&quot;,&quot;y&quot;,&quot;z&quot;]},sphereRadius:{default:NaN},type:{default:&quot;dynamic&quot;,oneOf:[&quot;static&quot;,&quot;dynamic&quot;]}},init:function(){this.system=this.el.sceneEl.systems.physics,this.el.sceneEl.hasLoaded?this.initBody():this.el.sceneEl.addEventListener(&quot;loaded&quot;,this.initBody.bind(this))},initBody:function(){var el=this.el,data=this.data,obj=this.el.object3D,pos=obj.position,quat=obj.quaternion;if(this.body=new CANNON.Body({mass:&quot;static&quot;===data.type?0:data.mass||0,material:this.system.getMaterial(&quot;defaultMaterial&quot;),position:new CANNON.Vec3(pos.x,pos.y,pos.z),quaternion:new CANNON.Quaternion(quat.x,quat.y,quat.z,quat.w),linearDamping:data.linearDamping,angularDamping:data.angularDamping,type:&quot;dynamic&quot;===data.type?CANNON.Body.DYNAMIC:CANNON.Body.STATIC}),this.el.object3D.updateMatrixWorld(!0),&quot;none&quot;!==data.shape){var options=&quot;auto&quot;===data.shape?void 0:AFRAME.utils.extend({},this.data,{type:mesh2shape.Type[data.shape.toUpperCase()]}),shape=mesh2shape(this.el.object3D,options);if(!shape)return void el.addEventListener(&quot;object3dset&quot;,this.initBody.bind(this));this.body.addShape(shape,shape.offset,shape.orientation),this.system.debug&amp;&amp;(this.shouldUpdateWireframe=!0),this.isLoaded=!0}this.el.body=this.body,this.body.el=el,this.isPlaying&amp;&amp;this._play(),this.isLoaded&amp;&amp;this.el.emit(&quot;body-loaded&quot;,{body:this.el.body})},addShape:function(shape,offset,orientation){&quot;none&quot;===this.data.shape?shape?this.body?(this.body.addShape(shape,offset,orientation),this.system.debug&amp;&amp;(this.shouldUpdateWireframe=!0),this.shouldUpdateBody=!0):console.warn(&quot;shape cannot be added before body is loaded&quot;):console.warn(&quot;shape cannot be null&quot;):console.warn(&quot;shape can only be added if shape property is none&quot;)},tick:function(){this.shouldUpdateBody&amp;&amp;(this.isLoaded=!0,this._play(),this.el.emit(&quot;body-loaded&quot;,{body:this.el.body}),this.shouldUpdateBody=!1),this.shouldUpdateWireframe&amp;&amp;(this.createWireframe(this.body),this.shouldUpdateWireframe=!1)},play:function(){this.isLoaded&amp;&amp;this._play()},_play:function(){this.syncToPhysics(),this.system.addComponent(this),this.system.addBody(this.body),this.wireframe&amp;&amp;this.el.sceneEl.object3D.add(this.wireframe)},pause:function(){this.isLoaded&amp;&amp;this._pause()},_pause:function(){this.system.removeComponent(this),this.body&amp;&amp;this.system.removeBody(this.body),this.wireframe&amp;&amp;this.el.sceneEl.object3D.remove(this.wireframe)},update:function(prevData){if(this.body){var data=this.data;void 0!=prevData.type&amp;&amp;data.type!=prevData.type&amp;&amp;(this.body.type=&quot;dynamic&quot;===data.type?CANNON.Body.DYNAMIC:CANNON.Body.STATIC),this.body.mass=data.mass||0,&quot;dynamic&quot;===data.type&amp;&amp;(this.body.linearDamping=data.linearDamping,this.body.angularDamping=data.angularDamping),data.mass!==prevData.mass&amp;&amp;this.body.updateMassProperties(),this.body.updateProperties&amp;&amp;this.body.updateProperties()}},remove:function(){this.body&amp;&amp;(delete this.body.el,delete this.body),delete this.el.body,delete this.wireframe},beforeStep:function(){0===this.body.mass&amp;&amp;this.syncToPhysics()},step:function(){0!==this.body.mass&amp;&amp;this.syncFromPhysics()},createWireframe:function(body){var offset,mesh;this.wireframe&amp;&amp;(this.el.sceneEl.object3D.remove(this.wireframe),delete this.wireframe),this.wireframe=new THREE.Object3D,this.el.sceneEl.object3D.add(this.wireframe);for(var orientation=new THREE.Quaternion,i=0;i&lt;this.body.shapes.length;i++){offset=this.body.shapeOffsets[i],orientation.copy(this.body.shapeOrientations[i]),mesh=CANNON.shape2mesh(this.body).children[i];var wireframe=new THREE.LineSegments(new THREE.EdgesGeometry(mesh.geometry),new THREE.LineBasicMaterial({color:16711680}));offset&amp;&amp;wireframe.position.copy(offset),orientation&amp;&amp;wireframe.quaternion.copy(orientation),this.wireframe.add(wireframe)}this.syncWireframe()},syncWireframe:function(){var offset,wireframe=this.wireframe;this.wireframe&amp;&amp;(wireframe.quaternion.copy(this.body.quaternion),wireframe.orientation&amp;&amp;wireframe.quaternion.multiply(wireframe.orientation),wireframe.position.copy(this.body.position),wireframe.offset&amp;&amp;(offset=wireframe.offset.clone().applyQuaternion(wireframe.quaternion),wireframe.position.add(offset)),wireframe.updateMatrix())},syncToPhysics:(q=new THREE.Quaternion,v=new THREE.Vector3,function(){var el=this.el,parentEl=el.parentEl,body=this.body;body&amp;&amp;(el.components.velocity&amp;&amp;body.velocity.copy(el.getAttribute(&quot;velocity&quot;)),parentEl.isScene?(body.quaternion.copy(el.object3D.quaternion),body.position.copy(el.object3D.position)):(el.object3D.getWorldQuaternion(q),body.quaternion.copy(q),el.object3D.getWorldPosition(v),body.position.copy(v)),this.body.updateProperties&amp;&amp;this.body.updateProperties(),this.wireframe&amp;&amp;this.syncWireframe())}),syncFromPhysics:function(){var v=new THREE.Vector3,q1=new THREE.Quaternion,q2=new THREE.Quaternion;return function(){var el=this.el,parentEl=el.parentEl,body=this.body;body&amp;&amp;parentEl&amp;&amp;(parentEl.isScene?(el.object3D.quaternion.copy(body.quaternion),el.object3D.position.copy(body.position)):(q1.copy(body.quaternion),parentEl.object3D.getWorldQuaternion(q2),q1.premultiply(q2.inverse()),el.object3D.quaternion.copy(q1),v.copy(body.position),parentEl.object3D.worldToLocal(v),el.object3D.position.copy(v)),this.wireframe&amp;&amp;this.syncWireframe())}}()};module.exports.definition=Body,module.exports.Component=AFRAME.registerComponent(&quot;body&quot;,Body)},{&quot;../../../lib/CANNON-shape2mesh&quot;:2,&quot;cannon-es&quot;:4,&quot;three-to-cannon&quot;:6}],11:[function(require,module,exports){var Body=require(&quot;./body&quot;),DynamicBody=AFRAME.utils.extend({},Body.definition);module.exports=AFRAME.registerComponent(&quot;dynamic-body&quot;,DynamicBody)},{&quot;./body&quot;:10}],12:[function(require,module,exports){var Body=require(&quot;./body&quot;),StaticBody=AFRAME.utils.extend({},Body.definition);StaticBody.schema=AFRAME.utils.extend({},Body.definition.schema,{type:{default:&quot;static&quot;,oneOf:[&quot;static&quot;,&quot;dynamic&quot;]},mass:{default:0}}),module.exports=AFRAME.registerComponent(&quot;static-body&quot;,StaticBody)},{&quot;./body&quot;:10}],13:[function(require,module,exports){var CANNON=require(&quot;cannon-es&quot;);module.exports=AFRAME.registerComponent(&quot;constraint&quot;,{multiple:!0,schema:{type:{default:&quot;lock&quot;,oneOf:[&quot;coneTwist&quot;,&quot;distance&quot;,&quot;hinge&quot;,&quot;lock&quot;,&quot;pointToPoint&quot;]},target:{type:&quot;selector&quot;},maxForce:{default:1e6,min:0},collideConnected:{default:!0},wakeUpBodies:{default:!0},distance:{default:0,min:0},pivot:{type:&quot;vec3&quot;},targetPivot:{type:&quot;vec3&quot;},axis:{type:&quot;vec3&quot;,default:{x:0,y:0,z:1}},targetAxis:{type:&quot;vec3&quot;,default:{x:0,y:0,z:1}}},init:function(){this.system=this.el.sceneEl.systems.physics,this.constraint=null},remove:function(){this.constraint&amp;&amp;(this.system.removeConstraint(this.constraint),this.constraint=null)},update:function(){var el=this.el,data=this.data;this.remove(),el.body&amp;&amp;data.target.body?(this.constraint=this.createConstraint(),this.system.addConstraint(this.constraint)):(el.body?data.target:el).addEventListener(&quot;body-loaded&quot;,this.update.bind(this,{}))},createConstraint:function(){var constraint,data=this.data,pivot=new CANNON.Vec3(data.pivot.x,data.pivot.y,data.pivot.z),targetPivot=new CANNON.Vec3(data.targetPivot.x,data.targetPivot.y,data.targetPivot.z),axis=new CANNON.Vec3(data.axis.x,data.axis.y,data.axis.z),targetAxis=new CANNON.Vec3(data.targetAxis.x,data.targetAxis.y,data.targetAxis.z);switch(data.type){case&quot;lock&quot;:(constraint=new CANNON.LockConstraint(this.el.body,data.target.body,{maxForce:data.maxForce})).type=&quot;LockConstraint&quot;;break;case&quot;distance&quot;:(constraint=new CANNON.DistanceConstraint(this.el.body,data.target.body,data.distance,data.maxForce)).type=&quot;DistanceConstraint&quot;;break;case&quot;hinge&quot;:(constraint=new CANNON.HingeConstraint(this.el.body,data.target.body,{pivotA:pivot,pivotB:targetPivot,axisA:axis,axisB:targetAxis,maxForce:data.maxForce})).type=&quot;HingeConstraint&quot;;break;case&quot;coneTwist&quot;:(constraint=new CANNON.ConeTwistConstraint(this.el.body,data.target.body,{pivotA:pivot,pivotB:targetPivot,axisA:axis,axisB:targetAxis,maxForce:data.maxForce})).type=&quot;ConeTwistConstraint&quot;;break;case&quot;pointToPoint&quot;:(constraint=new CANNON.PointToPointConstraint(this.el.body,pivot,data.target.body,targetPivot,data.maxForce)).type=&quot;PointToPointConstraint&quot;;break;default:throw new Error(&quot;[constraint] Unexpected type: &quot;+data.type)}return constraint.collideConnected=data.collideConnected,constraint}})},{&quot;cannon-es&quot;:4}],14:[function(require,module,exports){module.exports={velocity:require(&quot;./velocity&quot;),registerAll:function(AFRAME){this._registered||((AFRAME=AFRAME||window.AFRAME).components.velocity||AFRAME.registerComponent(&quot;velocity&quot;,this.velocity),this._registered=!0)}}},{&quot;./velocity&quot;:15}],15:[function(require,module,exports){module.exports=AFRAME.registerComponent(&quot;velocity&quot;,{schema:{type:&quot;vec3&quot;},init:function(){this.system=this.el.sceneEl.systems.physics,this.system&amp;&amp;this.system.addComponent(this)},remove:function(){this.system&amp;&amp;this.system.removeComponent(this)},tick:function(t,dt){dt&amp;&amp;(this.system||this.afterStep(t,dt))},afterStep:function(t,dt){if(dt){var physics=this.el.sceneEl.systems.physics||{data:{maxInterval:1/60}},velocity=this.el.getAttribute(&quot;velocity&quot;)||{x:0,y:0,z:0},position=this.el.object3D.position||{x:0,y:0,z:0};dt=Math.min(dt,1e3*physics.data.maxInterval),this.el.object3D.position.set(position.x+velocity.x*dt/1e3,position.y+velocity.y*dt/1e3,position.z+velocity.z*dt/1e3)}}})},{}],16:[function(require,module,exports){require(&quot;three-to-ammo&quot;);const CONSTANTS=require(&quot;../../constants&quot;),SHAPE=CONSTANTS.SHAPE,FIT=CONSTANTS.FIT;var AmmoShape={schema:{type:{default:SHAPE.HULL,oneOf:[SHAPE.BOX,SHAPE.CYLINDER,SHAPE.SPHERE,SHAPE.CAPSULE,SHAPE.CONE,SHAPE.HULL,SHAPE.HACD,SHAPE.VHACD,SHAPE.MESH,SHAPE.HEIGHTFIELD]},fit:{default:FIT.ALL,oneOf:[FIT.ALL,FIT.MANUAL]},halfExtents:{type:&quot;vec3&quot;,default:{x:1,y:1,z:1}},minHalfExtent:{default:0},maxHalfExtent:{default:Number.POSITIVE_INFINITY},sphereRadius:{default:NaN},cylinderAxis:{default:&quot;y&quot;,oneOf:[&quot;x&quot;,&quot;y&quot;,&quot;z&quot;]},margin:{default:.01},offset:{type:&quot;vec3&quot;,default:{x:0,y:0,z:0}},orientation:{type:&quot;vec4&quot;,default:{x:0,y:0,z:0,w:1}},heightfieldData:{default:[]},heightfieldDistance:{default:1},includeInvisible:{default:!1}},multiple:!0,init:function(){this.system=this.el.sceneEl.systems.physics,this.collisionShapes=[];let bodyEl=this.el;for(this.body=bodyEl.components[&quot;ammo-body&quot;]||null;!this.body&amp;&amp;bodyEl.parentNode!=this.el.sceneEl;)(bodyEl=bodyEl.parentNode).components[&quot;ammo-body&quot;]&amp;&amp;(this.body=bodyEl.components[&quot;ammo-body&quot;]);if(this.body){if(this.data.fit!==FIT.MANUAL){if(!this.el.object3DMap.mesh)return void console.error(&quot;Cannot use FIT.ALL without object3DMap.mesh&quot;);this.mesh=this.el.object3DMap.mesh}this.body.addShapeComponent(this)}else console.warn(&quot;body not found&quot;)},getMesh:function(){return this.mesh||null},addShapes:function(collisionShapes){this.collisionShapes=collisionShapes},getShapes:function(){return this.collisionShapes},remove:function(){if(this.body)for(this.body.removeShapeComponent(this);this.collisionShapes.length&gt;0;){const collisionShape=this.collisionShapes.pop();collisionShape.destroy(),Ammo.destroy(collisionShape.localTransform)}}};module.exports.definition=AmmoShape,module.exports.Component=AFRAME.registerComponent(&quot;ammo-shape&quot;,AmmoShape)},{&quot;../../constants&quot;:19,&quot;three-to-ammo&quot;:5}],17:[function(require,module,exports){var CANNON=require(&quot;cannon-es&quot;),Shape={schema:{shape:{default:&quot;box&quot;,oneOf:[&quot;box&quot;,&quot;sphere&quot;,&quot;cylinder&quot;]},offset:{type:&quot;vec3&quot;,default:{x:0,y:0,z:0}},orientation:{type:&quot;vec4&quot;,default:{x:0,y:0,z:0,w:1}},radius:{type:&quot;number&quot;,default:1,if:{shape:[&quot;sphere&quot;]}},halfExtents:{type:&quot;vec3&quot;,default:{x:.5,y:.5,z:.5},if:{shape:[&quot;box&quot;]}},radiusTop:{type:&quot;number&quot;,default:1,if:{shape:[&quot;cylinder&quot;]}},radiusBottom:{type:&quot;number&quot;,default:1,if:{shape:[&quot;cylinder&quot;]}},height:{type:&quot;number&quot;,default:1,if:{shape:[&quot;cylinder&quot;]}},numSegments:{type:&quot;int&quot;,default:8,if:{shape:[&quot;cylinder&quot;]}}},multiple:!0,init:function(){this.el.sceneEl.hasLoaded?this.initShape():this.el.sceneEl.addEventListener(&quot;loaded&quot;,this.initShape.bind(this))},initShape:function(){this.bodyEl=this.el;for(var bodyType=this._findType(this.bodyEl),data=this.data;!bodyType&amp;&amp;this.bodyEl.parentNode!=this.el.sceneEl;)this.bodyEl=this.bodyEl.parentNode,bodyType=this._findType(this.bodyEl);if(bodyType){var shape,offset,orientation,scale=new THREE.Vector3;switch(this.bodyEl.object3D.getWorldScale(scale),data.hasOwnProperty(&quot;offset&quot;)&amp;&amp;(offset=new CANNON.Vec3(data.offset.x*scale.x,data.offset.y*scale.y,data.offset.z*scale.z)),data.hasOwnProperty(&quot;orientation&quot;)&amp;&amp;(orientation=new CANNON.Quaternion).copy(data.orientation),data.shape){case&quot;sphere&quot;:shape=new CANNON.Sphere(data.radius*scale.x);break;case&quot;box&quot;:var halfExtents=new CANNON.Vec3(data.halfExtents.x*scale.x,data.halfExtents.y*scale.y,data.halfExtents.z*scale.z);shape=new CANNON.Box(halfExtents);break;case&quot;cylinder&quot;:shape=new CANNON.Cylinder(data.radiusTop*scale.x,data.radiusBottom*scale.x,data.height*scale.y,data.numSegments);var quat=new CANNON.Quaternion;quat.setFromEuler(90*THREE.Math.DEG2RAD,0,0,&quot;XYZ&quot;).normalize(),orientation.mult(quat,orientation);break;default:return void console.warn(data.shape+&quot; shape not supported&quot;)}this.bodyEl.body?this.bodyEl.components[bodyType].addShape(shape,offset,orientation):this.bodyEl.addEventListener(&quot;body-loaded&quot;,function(){this.bodyEl.components[bodyType].addShape(shape,offset,orientation)},{once:!0})}else console.warn(&quot;body not found&quot;)},_findType:function(el){return el.hasAttribute(&quot;body&quot;)?&quot;body&quot;:el.hasAttribute(&quot;dynamic-body&quot;)?&quot;dynamic-body&quot;:el.hasAttribute(&quot;static-body&quot;)?&quot;static-body&quot;:null},remove:function(){this.bodyEl.parentNode&amp;&amp;console.warn(&quot;removing shape component not currently supported&quot;)}};module.exports.definition=Shape,module.exports.Component=AFRAME.registerComponent(&quot;shape&quot;,Shape)},{&quot;cannon-es&quot;:4}],18:[function(require,module,exports){var CANNON=require(&quot;cannon-es&quot;);module.exports=AFRAME.registerComponent(&quot;spring&quot;,{multiple:!0,schema:{target:{type:&quot;selector&quot;},restLength:{default:1,min:0},stiffness:{default:100,min:0},damping:{default:1,min:0},localAnchorA:{type:&quot;vec3&quot;,default:{x:0,y:0,z:0}},localAnchorB:{type:&quot;vec3&quot;,default:{x:0,y:0,z:0}}},init:function(){this.system=this.el.sceneEl.systems.physics,this.system.addComponent(this),this.isActive=!0,this.spring=null},update:function(oldData){var el=this.el,data=this.data;data.target?el.body&amp;&amp;data.target.body?(this.createSpring(),this.updateSpring(oldData)):(el.body?data.target:el).addEventListener(&quot;body-loaded&quot;,this.update.bind(this,{})):console.warn(&quot;Spring: invalid target specified.&quot;)},updateSpring:function(oldData){if(this.spring){var data=this.data,spring=this.spring;Object.keys(data).forEach(function(attr){if(data[attr]!==oldData[attr]){if(&quot;target&quot;===attr)return void(spring.bodyB=data.target.body);spring[attr]=data[attr]}})}else console.warn(&quot;Spring: Component attempted to change spring before its created. No changes made.&quot;)},createSpring:function(){this.spring||(this.spring=new CANNON.Spring(this.el.body))},step:function(t,dt){return this.spring&amp;&amp;this.isActive?this.spring.applyForce():void 0},play:function(){this.isActive=!0},pause:function(){this.isActive=!1},remove:function(){this.spring&amp;&amp;delete this.spring,this.spring=null}})},{&quot;cannon-es&quot;:4}],19:[function(require,module,exports){module.exports={GRAVITY:-9.8,MAX_INTERVAL:4/60,ITERATIONS:10,CONTACT_MATERIAL:{friction:.01,restitution:.3,contactEquationStiffness:1e8,contactEquationRelaxation:3,frictionEquationStiffness:1e8,frictionEquationRegularization:3},ACTIVATION_STATE:{ACTIVE_TAG:&quot;active&quot;,ISLAND_SLEEPING:&quot;islandSleeping&quot;,WANTS_DEACTIVATION:&quot;wantsDeactivation&quot;,DISABLE_DEACTIVATION:&quot;disableDeactivation&quot;,DISABLE_SIMULATION:&quot;disableSimulation&quot;},COLLISION_FLAG:{STATIC_OBJECT:1,KINEMATIC_OBJECT:2,NO_CONTACT_RESPONSE:4,CUSTOM_MATERIAL_CALLBACK:8,CHARACTER_OBJECT:16,DISABLE_VISUALIZE_OBJECT:32,DISABLE_SPU_COLLISION_PROCESSING:64},TYPE:{STATIC:&quot;static&quot;,DYNAMIC:&quot;dynamic&quot;,KINEMATIC:&quot;kinematic&quot;},SHAPE:{BOX:&quot;box&quot;,CYLINDER:&quot;cylinder&quot;,SPHERE:&quot;sphere&quot;,CAPSULE:&quot;capsule&quot;,CONE:&quot;cone&quot;,HULL:&quot;hull&quot;,HACD:&quot;hacd&quot;,VHACD:&quot;vhacd&quot;,MESH:&quot;mesh&quot;,HEIGHTFIELD:&quot;heightfield&quot;},FIT:{ALL:&quot;all&quot;,MANUAL:&quot;manual&quot;},CONSTRAINT:{LOCK:&quot;lock&quot;,FIXED:&quot;fixed&quot;,SPRING:&quot;spring&quot;,SLIDER:&quot;slider&quot;,HINGE:&quot;hinge&quot;,CONE_TWIST:&quot;coneTwist&quot;,POINT_TO_POINT:&quot;pointToPoint&quot;}}},{}],20:[function(require,module,exports){const Driver=require(&quot;./driver&quot;);&quot;undefined&quot;!=typeof window&amp;&amp;(window.AmmoModule=window.Ammo,window.Ammo=null);function AmmoDriver(){this.collisionConfiguration=null,this.dispatcher=null,this.broadphase=null,this.solver=null,this.physicsWorld=null,this.debugDrawer=null,this.els=new Map,this.eventListeners=[],this.collisions=new Map,this.collisionKeys=[],this.currentCollisions=new Map}AmmoDriver.prototype=new Driver,AmmoDriver.prototype.constructor=AmmoDriver,module.exports=AmmoDriver,AmmoDriver.prototype.init=function(worldConfig){return new Promise(resolve=&gt;{AmmoModule().then(result=&gt;{Ammo=result,this.epsilon=worldConfig.epsilon||1e-5,this.debugDrawMode=worldConfig.debugDrawMode||THREE.AmmoDebugConstants.NoDebug,this.maxSubSteps=worldConfig.maxSubSteps||4,this.fixedTimeStep=worldConfig.fixedTimeStep||1/60,this.collisionConfiguration=new Ammo.btDefaultCollisionConfiguration,this.dispatcher=new Ammo.btCollisionDispatcher(this.collisionConfiguration),this.broadphase=new Ammo.btDbvtBroadphase,this.solver=new Ammo.btSequentialImpulseConstraintSolver,this.physicsWorld=new Ammo.btDiscreteDynamicsWorld(this.dispatcher,this.broadphase,this.solver,this.collisionConfiguration),this.physicsWorld.setForceUpdateAllAabbs(!1),this.physicsWorld.setGravity(new Ammo.btVector3(0,worldConfig.hasOwnProperty(&quot;gravity&quot;)?worldConfig.gravity:-9.8,0)),this.physicsWorld.getSolverInfo().set_m_numIterations(worldConfig.solverIterations),resolve()})})},AmmoDriver.prototype.addBody=function(body,group,mask){this.physicsWorld.addRigidBody(body,group,mask),this.els.set(Ammo.getPointer(body),body.el)},AmmoDriver.prototype.removeBody=function(body){this.physicsWorld.removeRigidBody(body),this.removeEventListener(body);const bodyptr=Ammo.getPointer(body);this.els.delete(bodyptr),this.collisions.delete(bodyptr),this.collisionKeys.splice(this.collisionKeys.indexOf(bodyptr),1),this.currentCollisions.delete(bodyptr)},AmmoDriver.prototype.updateBody=function(body){this.els.has(Ammo.getPointer(body))&amp;&amp;this.physicsWorld.updateSingleAabb(body)},AmmoDriver.prototype.step=function(deltaTime){this.physicsWorld.stepSimulation(deltaTime,this.maxSubSteps,this.fixedTimeStep);const numManifolds=this.dispatcher.getNumManifolds();for(let i=0;i&lt;numManifolds;i++){const persistentManifold=this.dispatcher.getManifoldByIndexInternal(i),numContacts=persistentManifold.getNumContacts(),body0ptr=Ammo.getPointer(persistentManifold.getBody0()),body1ptr=Ammo.getPointer(persistentManifold.getBody1());let collided=!1;for(let j=0;j&lt;numContacts;j++){if(persistentManifold.getContactPoint(j).getDistance()&lt;=this.epsilon){collided=!0;break}}collided&amp;&amp;(this.collisions.has(body0ptr)||(this.collisions.set(body0ptr,[]),this.collisionKeys.push(body0ptr)),-1===this.collisions.get(body0ptr).indexOf(body1ptr)&amp;&amp;(this.collisions.get(body0ptr).push(body1ptr),-1!==this.eventListeners.indexOf(body0ptr)&amp;&amp;this.els.get(body0ptr).emit(&quot;collidestart&quot;,{targetEl:this.els.get(body1ptr)}),-1!==this.eventListeners.indexOf(body1ptr)&amp;&amp;this.els.get(body1ptr).emit(&quot;collidestart&quot;,{targetEl:this.els.get(body0ptr)})),this.currentCollisions.has(body0ptr)||this.currentCollisions.set(body0ptr,new Set),this.currentCollisions.get(body0ptr).add(body1ptr))}for(let i=0;i&lt;this.collisionKeys.length;i++){const body0ptr=this.collisionKeys[i],body1ptrs=this.collisions.get(body0ptr);for(let j=body1ptrs.length-1;j&gt;=0;j--){const body1ptr=body1ptrs[j];this.currentCollisions.get(body0ptr).has(body1ptr)||(-1!==this.eventListeners.indexOf(body0ptr)&amp;&amp;this.els.get(body0ptr).emit(&quot;collideend&quot;,{targetEl:this.els.get(body1ptr)}),-1!==this.eventListeners.indexOf(body1ptr)&amp;&amp;this.els.get(body1ptr).emit(&quot;collideend&quot;,{targetEl:this.els.get(body0ptr)}),body1ptrs.splice(j,1))}this.currentCollisions.get(body0ptr).clear()}this.debugDrawer&amp;&amp;this.debugDrawer.update()},AmmoDriver.prototype.addConstraint=function(constraint){this.physicsWorld.addConstraint(constraint,!1)},AmmoDriver.prototype.removeConstraint=function(constraint){this.physicsWorld.removeConstraint(constraint)},AmmoDriver.prototype.addEventListener=function(body){this.eventListeners.push(Ammo.getPointer(body))},AmmoDriver.prototype.removeEventListener=function(body){const ptr=Ammo.getPointer(body);-1!==this.eventListeners.indexOf(ptr)&amp;&amp;this.eventListeners.splice(this.eventListeners.indexOf(ptr),1)},AmmoDriver.prototype.destroy=function(){Ammo.destroy(this.collisionConfiguration),Ammo.destroy(this.dispatcher),Ammo.destroy(this.broadphase),Ammo.destroy(this.solver),Ammo.destroy(this.physicsWorld),Ammo.destroy(this.debugDrawer)},AmmoDriver.prototype.getDebugDrawer=function(scene,options){return this.debugDrawer||((options=options||{}).debugDrawMode=options.debugDrawMode||this.debugDrawMode,this.debugDrawer=new THREE.AmmoDebugDrawer(scene,this.physicsWorld,options)),this.debugDrawer}},{&quot;./driver&quot;:21}],21:[function(require,module,exports){function Driver(){}function abstractMethod(){throw new Error(&quot;Method not implemented.&quot;)}module.exports=Driver,Driver.prototype.init=abstractMethod,Driver.prototype.step=abstractMethod,Driver.prototype.destroy=abstractMethod,Driver.prototype.addBody=abstractMethod,Driver.prototype.removeBody=abstractMethod,Driver.prototype.applyBodyMethod=abstractMethod,Driver.prototype.updateBodyProperties=abstractMethod,Driver.prototype.addMaterial=abstractMethod,Driver.prototype.addContactMaterial=abstractMethod,Driver.prototype.addConstraint=abstractMethod,Driver.prototype.removeConstraint=abstractMethod,Driver.prototype.getContacts=abstractMethod},{}],22:[function(require,module,exports){module.exports={INIT:&quot;init&quot;,STEP:&quot;step&quot;,ADD_BODY:&quot;add-body&quot;,REMOVE_BODY:&quot;remove-body&quot;,APPLY_BODY_METHOD:&quot;apply-body-method&quot;,UPDATE_BODY_PROPERTIES:&quot;update-body-properties&quot;,ADD_MATERIAL:&quot;add-material&quot;,ADD_CONTACT_MATERIAL:&quot;add-contact-material&quot;,ADD_CONSTRAINT:&quot;add-constraint&quot;,REMOVE_CONSTRAINT:&quot;remove-constraint&quot;,COLLIDE:&quot;collide&quot;}},{}],23:[function(require,module,exports){var CANNON=require(&quot;cannon-es&quot;),Driver=require(&quot;./driver&quot;);function LocalDriver(){this.world=null,this.materials={},this.contactMaterial=null}LocalDriver.prototype=new Driver,LocalDriver.prototype.constructor=LocalDriver,module.exports=LocalDriver,LocalDriver.prototype.init=function(worldConfig){var world=new CANNON.World;world.quatNormalizeSkip=worldConfig.quatNormalizeSkip,world.quatNormalizeFast=worldConfig.quatNormalizeFast,world.solver.iterations=worldConfig.solverIterations,world.gravity.set(0,worldConfig.gravity,0),world.broadphase=new CANNON.NaiveBroadphase,this.world=world},LocalDriver.prototype.step=function(deltaMS){this.world.step(deltaMS)},LocalDriver.prototype.destroy=function(){delete this.world,delete this.contactMaterial,this.materials={}},LocalDriver.prototype.addBody=function(body){this.world.addBody(body)},LocalDriver.prototype.removeBody=function(body){this.world.removeBody(body)},LocalDriver.prototype.applyBodyMethod=function(body,methodName,args){body[&quot;__&quot;+methodName].apply(body,args)},LocalDriver.prototype.updateBodyProperties=function(){},LocalDriver.prototype.getMaterial=function(name){return this.materials[name]},LocalDriver.prototype.addMaterial=function(materialConfig){this.materials[materialConfig.name]=new CANNON.Material(materialConfig),this.materials[materialConfig.name].name=materialConfig.name},LocalDriver.prototype.addContactMaterial=function(matName1,matName2,contactMaterialConfig){var mat1=this.materials[matName1],mat2=this.materials[matName2];this.contactMaterial=new CANNON.ContactMaterial(mat1,mat2,contactMaterialConfig),this.world.addContactMaterial(this.contactMaterial)},LocalDriver.prototype.addConstraint=function(constraint){constraint.type||(constraint instanceof CANNON.LockConstraint?constraint.type=&quot;LockConstraint&quot;:constraint instanceof CANNON.DistanceConstraint?constraint.type=&quot;DistanceConstraint&quot;:constraint instanceof CANNON.HingeConstraint?constraint.type=&quot;HingeConstraint&quot;:constraint instanceof CANNON.ConeTwistConstraint?constraint.type=&quot;ConeTwistConstraint&quot;:constraint instanceof CANNON.PointToPointConstraint&amp;&amp;(constraint.type=&quot;PointToPointConstraint&quot;)),this.world.addConstraint(constraint)},LocalDriver.prototype.removeConstraint=function(constraint){this.world.removeConstraint(constraint)},LocalDriver.prototype.getContacts=function(){return this.world.contacts}},{&quot;./driver&quot;:21,&quot;cannon-es&quot;:4}],24:[function(require,module,exports){var Driver=require(&quot;./driver&quot;);function NetworkDriver(){throw new Error(&quot;[NetworkDriver] Driver not implemented.&quot;)}NetworkDriver.prototype=new Driver,NetworkDriver.prototype.constructor=NetworkDriver,module.exports=NetworkDriver},{&quot;./driver&quot;:21}],25:[function(require,module,exports){function EventTarget(){this.listeners=[]}module.exports=function(worker){var targetA=new EventTarget,targetB=new EventTarget;return targetA.setTarget(targetB),targetB.setTarget(targetA),worker(targetA),targetB},EventTarget.prototype.setTarget=function(target){this.target=target},EventTarget.prototype.addEventListener=function(type,fn){this.listeners.push(fn)},EventTarget.prototype.dispatchEvent=function(type,event){for(var i=0;i&lt;this.listeners.length;i++)this.listeners[i](event)},EventTarget.prototype.postMessage=function(msg){this.target.dispatchEvent(&quot;message&quot;,{data:msg})}},{}],26:[function(require,module,exports){var webworkify=require(&quot;webworkify&quot;),webworkifyDebug=require(&quot;./webworkify-debug&quot;),Driver=require(&quot;./driver&quot;),Event=require(&quot;./event&quot;),worker=require(&quot;./worker&quot;),protocol=require(&quot;../utils/protocol&quot;),ID=protocol.ID;function WorkerDriver(options){this.fps=options.fps,this.engine=options.engine,this.interpolate=options.interpolate,this.interpBufferSize=options.interpolationBufferSize,this.debug=options.debug,this.bodies={},this.contacts=[],this.frameDelay=1e3*this.interpBufferSize/this.fps,this.frameBuffer=[],this.worker=this.debug?webworkifyDebug(worker):webworkify(worker),this.worker.addEventListener(&quot;message&quot;,this._onMessage.bind(this))}WorkerDriver.prototype=new Driver,WorkerDriver.prototype.constructor=WorkerDriver,module.exports=WorkerDriver,WorkerDriver.prototype.init=function(worldConfig){this.worker.postMessage({type:Event.INIT,worldConfig:worldConfig,fps:this.fps,engine:this.engine})},WorkerDriver.prototype.step=function(){if(this.interpolate){for(var prevFrame=this.frameBuffer[0],nextFrame=this.frameBuffer[1],timestamp=performance.now();prevFrame&amp;&amp;nextFrame&amp;&amp;timestamp-prevFrame.timestamp&gt;this.frameDelay;)this.frameBuffer.shift(),prevFrame=this.frameBuffer[0],nextFrame=this.frameBuffer[1];if(prevFrame&amp;&amp;nextFrame){var mix=(timestamp-prevFrame.timestamp)/this.frameDelay;for(var id in mix=(mix-(1-1/this.interpBufferSize))*this.interpBufferSize,prevFrame.bodies)prevFrame.bodies.hasOwnProperty(id)&amp;&amp;nextFrame.bodies.hasOwnProperty(id)&amp;&amp;protocol.deserializeInterpBodyUpdate(prevFrame.bodies[id],nextFrame.bodies[id],this.bodies[id],mix)}}},WorkerDriver.prototype.destroy=function(){this.worker.terminate(),delete this.worker},WorkerDriver.prototype._onMessage=function(event){if(event.data.type===Event.STEP){var bodies=event.data.bodies;if(this.contacts=event.data.contacts,this.interpolate)this.frameBuffer.push({timestamp:performance.now(),bodies:bodies});else for(var id in bodies)bodies.hasOwnProperty(id)&amp;&amp;protocol.deserializeBodyUpdate(bodies[id],this.bodies[id])}else{if(event.data.type!==Event.COLLIDE)throw new Error(&quot;[WorkerDriver] Unexpected message type.&quot;);var body=this.bodies[event.data.bodyID],target=this.bodies[event.data.targetID],contact=protocol.deserializeContact(event.data.contact,this.bodies);if(!body._listeners||!body._listeners.collide)return;for(var i=0;i&lt;body._listeners.collide.length;i++)body._listeners.collide[i]({target:target,body:body,contact:contact})}},WorkerDriver.prototype.addBody=function(body){protocol.assignID(&quot;body&quot;,body),this.bodies[body[ID]]=body,this.worker.postMessage({type:Event.ADD_BODY,body:protocol.serializeBody(body)})},WorkerDriver.prototype.removeBody=function(body){this.worker.postMessage({type:Event.REMOVE_BODY,bodyID:body[ID]}),delete this.bodies[body[ID]]},WorkerDriver.prototype.applyBodyMethod=function(body,methodName,args){switch(methodName){case&quot;applyForce&quot;:case&quot;applyImpulse&quot;:this.worker.postMessage({type:Event.APPLY_BODY_METHOD,bodyID:body[ID],methodName:methodName,args:[args[0].toArray(),args[1].toArray()]});break;default:throw new Error(&quot;Unexpected methodName: %s&quot;,methodName)}},WorkerDriver.prototype.updateBodyProperties=function(body){this.worker.postMessage({type:Event.UPDATE_BODY_PROPERTIES,body:protocol.serializeBody(body)})},WorkerDriver.prototype.getMaterial=function(name){},WorkerDriver.prototype.addMaterial=function(materialConfig){this.worker.postMessage({type:Event.ADD_MATERIAL,materialConfig:materialConfig})},WorkerDriver.prototype.addContactMaterial=function(matName1,matName2,contactMaterialConfig){this.worker.postMessage({type:Event.ADD_CONTACT_MATERIAL,materialName1:matName1,materialName2:matName2,contactMaterialConfig:contactMaterialConfig})},WorkerDriver.prototype.addConstraint=function(constraint){constraint.type||(constraint instanceof CANNON.LockConstraint?constraint.type=&quot;LockConstraint&quot;:constraint instanceof CANNON.DistanceConstraint?constraint.type=&quot;DistanceConstraint&quot;:constraint instanceof CANNON.HingeConstraint?constraint.type=&quot;HingeConstraint&quot;:constraint instanceof CANNON.ConeTwistConstraint?constraint.type=&quot;ConeTwistConstraint&quot;:constraint instanceof CANNON.PointToPointConstraint&amp;&amp;(constraint.type=&quot;PointToPointConstraint&quot;)),protocol.assignID(&quot;constraint&quot;,constraint),this.worker.postMessage({type:Event.ADD_CONSTRAINT,constraint:protocol.serializeConstraint(constraint)})},WorkerDriver.prototype.removeConstraint=function(constraint){this.worker.postMessage({type:Event.REMOVE_CONSTRAINT,constraintID:constraint[ID]})},WorkerDriver.prototype.getContacts=function(){var bodies=this.bodies;return this.contacts.map(function(message){return protocol.deserializeContact(message,bodies)})}},{&quot;../utils/protocol&quot;:30,&quot;./driver&quot;:21,&quot;./event&quot;:22,&quot;./webworkify-debug&quot;:25,&quot;./worker&quot;:27,webworkify:7}],27:[function(require,module,exports){var Event=require(&quot;./event&quot;),LocalDriver=require(&quot;./local-driver&quot;),AmmoDriver=require(&quot;./ammo-driver&quot;),protocol=require(&quot;../utils/protocol&quot;),ID=protocol.ID;module.exports=function(self){var stepSize,driver=null,bodies={},constraints={};function step(){driver.step(stepSize);var bodyMessages={};Object.keys(bodies).forEach(function(id){bodyMessages[id]=protocol.serializeBody(bodies[id])}),self.postMessage({type:Event.STEP,bodies:bodyMessages,contacts:driver.getContacts().map(protocol.serializeContact)})}self.addEventListener(&quot;message&quot;,function(event){var data=event.data;switch(data.type){case Event.INIT:(driver=&quot;cannon&quot;===data.engine?new LocalDriver:new AmmoDriver).init(data.worldConfig),stepSize=1/data.fps,setInterval(step,1e3/data.fps);break;case Event.ADD_BODY:var body=protocol.deserializeBody(data.body);body.material=driver.getMaterial(&quot;defaultMaterial&quot;),bodies[body[ID]]=body,body.addEventListener(&quot;collide&quot;,function(evt){var message={type:Event.COLLIDE,bodyID:evt.target[ID],targetID:evt.body[ID],contact:protocol.serializeContact(evt.contact)};self.postMessage(message)}),driver.addBody(body);break;case Event.REMOVE_BODY:driver.removeBody(bodies[data.bodyID]),delete bodies[data.bodyID];break;case Event.APPLY_BODY_METHOD:bodies[data.bodyID][data.methodName](protocol.deserializeVec3(data.args[0]),protocol.deserializeVec3(data.args[1]));break;case Event.UPDATE_BODY_PROPERTIES:protocol.deserializeBodyUpdate(data.body,bodies[data.body.id]);break;case Event.ADD_MATERIAL:driver.addMaterial(data.materialConfig);break;case Event.ADD_CONTACT_MATERIAL:driver.addContactMaterial(data.materialName1,data.materialName2,data.contactMaterialConfig);break;case Event.ADD_CONSTRAINT:var constraint=protocol.deserializeConstraint(data.constraint,bodies);constraints[constraint[ID]]=constraint,driver.addConstraint(constraint);break;case Event.REMOVE_CONSTRAINT:driver.removeConstraint(constraints[data.constraintID]),delete constraints[data.constraintID];break;default:throw new Error(&quot;[Worker] Unexpected event type: %s&quot;,data.type)}})}},{&quot;../utils/protocol&quot;:30,&quot;./ammo-driver&quot;:20,&quot;./event&quot;:22,&quot;./local-driver&quot;:23}],28:[function(require,module,exports){require(&quot;cannon-es&quot;);var CONSTANTS=require(&quot;./constants&quot;),C_GRAV=CONSTANTS.GRAVITY,C_MAT=CONSTANTS.CONTACT_MATERIAL,LocalDriver=require(&quot;./drivers/local-driver&quot;),WorkerDriver=require(&quot;./drivers/worker-driver&quot;),NetworkDriver=require(&quot;./drivers/network-driver&quot;),AmmoDriver=require(&quot;./drivers/ammo-driver&quot;);module.exports=AFRAME.registerSystem(&quot;physics&quot;,{schema:{driver:{default:&quot;local&quot;,oneOf:[&quot;local&quot;,&quot;worker&quot;,&quot;network&quot;,&quot;ammo&quot;]},networkUrl:{default:&quot;&quot;,if:{driver:&quot;network&quot;}},workerFps:{default:60,if:{driver:&quot;worker&quot;}},workerInterpolate:{default:!0,if:{driver:&quot;worker&quot;}},workerInterpBufferSize:{default:2,if:{driver:&quot;worker&quot;}},workerEngine:{default:&quot;cannon&quot;,if:{driver:&quot;worker&quot;},oneOf:[&quot;cannon&quot;]},workerDebug:{default:!1,if:{driver:&quot;worker&quot;}},gravity:{default:C_GRAV},iterations:{default:CONSTANTS.ITERATIONS},friction:{default:C_MAT.friction},restitution:{default:C_MAT.restitution},contactEquationStiffness:{default:C_MAT.contactEquationStiffness},contactEquationRelaxation:{default:C_MAT.contactEquationRelaxation},frictionEquationStiffness:{default:C_MAT.frictionEquationStiffness},frictionEquationRegularization:{default:C_MAT.frictionEquationRegularization},maxInterval:{default:4/60},debug:{default:!1},debugDrawMode:{default:THREE.AmmoDebugConstants.NoDebug},maxSubSteps:{default:4},fixedTimeStep:{default:1/60}},async init(){var data=this.data;switch(this.debug=data.debug,this.callbacks={beforeStep:[],step:[],afterStep:[]},this.listeners={},this.driver=null,data.driver){case&quot;local&quot;:this.driver=new LocalDriver;break;case&quot;ammo&quot;:this.driver=new AmmoDriver;break;case&quot;network&quot;:this.driver=new NetworkDriver(data.networkUrl);break;case&quot;worker&quot;:this.driver=new WorkerDriver({fps:data.workerFps,engine:data.workerEngine,interpolate:data.workerInterpolate,interpolationBufferSize:data.workerInterpBufferSize,debug:data.workerDebug});break;default:throw new Error(&#39;[physics] Driver not recognized: &quot;%s&quot;.&#39;,data.driver)}&quot;ammo&quot;!==data.driver?(await this.driver.init({quatNormalizeSkip:0,quatNormalizeFast:!1,solverIterations:data.iterations,gravity:data.gravity}),this.driver.addMaterial({name:&quot;defaultMaterial&quot;}),this.driver.addMaterial({name:&quot;staticMaterial&quot;}),this.driver.addContactMaterial(&quot;defaultMaterial&quot;,&quot;defaultMaterial&quot;,{friction:data.friction,restitution:data.restitution,contactEquationStiffness:data.contactEquationStiffness,contactEquationRelaxation:data.contactEquationRelaxation,frictionEquationStiffness:data.frictionEquationStiffness,frictionEquationRegularization:data.frictionEquationRegularization}),this.driver.addContactMaterial(&quot;staticMaterial&quot;,&quot;defaultMaterial&quot;,{friction:1,restitution:0,contactEquationStiffness:data.contactEquationStiffness,contactEquationRelaxation:data.contactEquationRelaxation,frictionEquationStiffness:data.frictionEquationStiffness,frictionEquationRegularization:data.frictionEquationRegularization})):await this.driver.init({gravity:data.gravity,debugDrawMode:data.debugDrawMode,solverIterations:data.iterations,maxSubSteps:data.maxSubSteps,fixedTimeStep:data.fixedTimeStep}),this.initialized=!0,this.debug&amp;&amp;this.setDebug(!0)},tick:function(t,dt){if(this.initialized&amp;&amp;dt){var i,callbacks=this.callbacks;for(i=0;i&lt;this.callbacks.beforeStep.length;i++)this.callbacks.beforeStep[i].beforeStep(t,dt);for(this.driver.step(Math.min(dt/1e3,this.data.maxInterval)),i=0;i&lt;callbacks.step.length;i++)callbacks.step[i].step(t,dt);for(i=0;i&lt;callbacks.afterStep.length;i++)callbacks.afterStep[i].afterStep(t,dt)}},setDebug:function(debug){this.debug=debug,&quot;ammo&quot;===this.data.driver&amp;&amp;this.initialized&amp;&amp;(debug&amp;&amp;!this.debugDrawer?(this.debugDrawer=this.driver.getDebugDrawer(this.el.object3D),this.debugDrawer.enable()):this.debugDrawer&amp;&amp;(this.debugDrawer.disable(),this.debugDrawer=null))},addBody:function(body,group,mask){var driver=this.driver;&quot;local&quot;===this.data.driver&amp;&amp;(body.__applyImpulse=body.applyImpulse,body.applyImpulse=function(){driver.applyBodyMethod(body,&quot;applyImpulse&quot;,arguments)},body.__applyForce=body.applyForce,body.applyForce=function(){driver.applyBodyMethod(body,&quot;applyForce&quot;,arguments)},body.updateProperties=function(){driver.updateBodyProperties(body)},this.listeners[body.id]=function(e){body.el.emit(&quot;collide&quot;,e)},body.addEventListener(&quot;collide&quot;,this.listeners[body.id])),this.driver.addBody(body,group,mask)},removeBody:function(body){this.driver.removeBody(body),&quot;local&quot;!==this.data.driver&amp;&amp;&quot;worker&quot;!==this.data.driver||(body.removeEventListener(&quot;collide&quot;,this.listeners[body.id]),delete this.listeners[body.id],body.applyImpulse=body.__applyImpulse,delete body.__applyImpulse,body.applyForce=body.__applyForce,delete body.__applyForce,delete body.updateProperties)},addConstraint:function(constraint){this.driver.addConstraint(constraint)},removeConstraint:function(constraint){this.driver.removeConstraint(constraint)},addComponent:function(component){var callbacks=this.callbacks;component.beforeStep&amp;&amp;callbacks.beforeStep.push(component),component.step&amp;&amp;callbacks.step.push(component),component.afterStep&amp;&amp;callbacks.afterStep.push(component)},removeComponent:function(component){var callbacks=this.callbacks;component.beforeStep&amp;&amp;callbacks.beforeStep.splice(callbacks.beforeStep.indexOf(component),1),component.step&amp;&amp;callbacks.step.splice(callbacks.step.indexOf(component),1),component.afterStep&amp;&amp;callbacks.afterStep.splice(callbacks.afterStep.indexOf(component),1)},getContacts:function(){return this.driver.getContacts()},getMaterial:function(name){return this.driver.getMaterial(name)}})},{&quot;./constants&quot;:19,&quot;./drivers/ammo-driver&quot;:20,&quot;./drivers/local-driver&quot;:23,&quot;./drivers/network-driver&quot;:24,&quot;./drivers/worker-driver&quot;:26,&quot;cannon-es&quot;:4}],29:[function(require,module,exports){module.exports.slerp=function(a,b,t){if(t&lt;=0)return a;if(t&gt;=1)return b;var x=a[0],y=a[1],z=a[2],w=a[3],cosHalfTheta=w*b[3]+x*b[0]+y*b[1]+z*b[2];if(!(cosHalfTheta&lt;0))return b;if((a=a.slice())[3]=-b[3],a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],(cosHalfTheta=-cosHalfTheta)&gt;=1)return a[3]=w,a[0]=x,a[1]=y,a[2]=z,this;var sinHalfTheta=Math.sqrt(1-cosHalfTheta*cosHalfTheta);if(Math.abs(sinHalfTheta)&lt;.001)return a[3]=.5*(w+a[3]),a[0]=.5*(x+a[0]),a[1]=.5*(y+a[1]),a[2]=.5*(z+a[2]),this;var halfTheta=Math.atan2(sinHalfTheta,cosHalfTheta),ratioA=Math.sin((1-t)*halfTheta)/sinHalfTheta,ratioB=Math.sin(t*halfTheta)/sinHalfTheta;return a[3]=w*ratioA+a[3]*ratioB,a[0]=x*ratioA+a[0]*ratioB,a[1]=y*ratioA+a[1]*ratioB,a[2]=z*ratioA+a[2]*ratioB,a}},{}],30:[function(require,module,exports){var CANNON=require(&quot;cannon-es&quot;),mathUtils=require(&quot;./math&quot;),ID=&quot;__id&quot;;module.exports.ID=ID;var nextID={};function serializeShape(shape){var shapeMsg={type:shape.type};if(shape.type===CANNON.Shape.types.BOX)shapeMsg.halfExtents=serializeVec3(shape.halfExtents);else if(shape.type===CANNON.Shape.types.SPHERE)shapeMsg.radius=shape.radius;else{if(shape._type!==CANNON.Shape.types.CYLINDER)throw new Error(&quot;Unimplemented shape type: %s&quot;,shape.type);shapeMsg.type=CANNON.Shape.types.CYLINDER,shapeMsg.radiusTop=shape.radiusTop,shapeMsg.radiusBottom=shape.radiusBottom,shapeMsg.height=shape.height,shapeMsg.numSegments=shape.numSegments}return shapeMsg}function deserializeShape(message){var shape;if(message.type===CANNON.Shape.types.BOX)shape=new CANNON.Box(deserializeVec3(message.halfExtents));else if(message.type===CANNON.Shape.types.SPHERE)shape=new CANNON.Sphere(message.radius);else{if(message.type!==CANNON.Shape.types.CYLINDER)throw new Error(&quot;Unimplemented shape type: %s&quot;,message.type);(shape=new CANNON.Cylinder(message.radiusTop,message.radiusBottom,message.height,message.numSegments))._type=CANNON.Shape.types.CYLINDER}return shape}function serializeVec3(vec3){return vec3.toArray()}function deserializeVec3(message){return new CANNON.Vec3(message[0],message[1],message[2])}function serializeQuaternion(quat){return quat.toArray()}function deserializeQuaternion(message){return new CANNON.Quaternion(message[0],message[1],message[2],message[3])}module.exports.assignID=function(prefix,object){object[ID]||(nextID[prefix]=nextID[prefix]||1,object[ID]=prefix+&quot;_&quot;+nextID[prefix]++)},module.exports.serializeBody=function(body){return{shapes:body.shapes.map(serializeShape),shapeOffsets:body.shapeOffsets.map(serializeVec3),shapeOrientations:body.shapeOrientations.map(serializeQuaternion),position:serializeVec3(body.position),quaternion:body.quaternion.toArray(),velocity:serializeVec3(body.velocity),angularVelocity:serializeVec3(body.angularVelocity),id:body[ID],mass:body.mass,linearDamping:body.linearDamping,angularDamping:body.angularDamping,fixedRotation:body.fixedRotation,allowSleep:body.allowSleep,sleepSpeedLimit:body.sleepSpeedLimit,sleepTimeLimit:body.sleepTimeLimit}},module.exports.deserializeBodyUpdate=function(message,body){return body.position.set(message.position[0],message.position[1],message.position[2]),body.quaternion.set(message.quaternion[0],message.quaternion[1],message.quaternion[2],message.quaternion[3]),body.velocity.set(message.velocity[0],message.velocity[1],message.velocity[2]),body.angularVelocity.set(message.angularVelocity[0],message.angularVelocity[1],message.angularVelocity[2]),body.linearDamping=message.linearDamping,body.angularDamping=message.angularDamping,body.fixedRotation=message.fixedRotation,body.allowSleep=message.allowSleep,body.sleepSpeedLimit=message.sleepSpeedLimit,body.sleepTimeLimit=message.sleepTimeLimit,body.mass!==message.mass&amp;&amp;(body.mass=message.mass,body.updateMassProperties()),body},module.exports.deserializeInterpBodyUpdate=function(message1,message2,body,mix){var weight1=1-mix,weight2=mix;body.position.set(message1.position[0]*weight1+message2.position[0]*weight2,message1.position[1]*weight1+message2.position[1]*weight2,message1.position[2]*weight1+message2.position[2]*weight2);var quaternion=mathUtils.slerp(message1.quaternion,message2.quaternion,mix);return body.quaternion.set(quaternion[0],quaternion[1],quaternion[2],quaternion[3]),body.velocity.set(message1.velocity[0]*weight1+message2.velocity[0]*weight2,message1.velocity[1]*weight1+message2.velocity[1]*weight2,message1.velocity[2]*weight1+message2.velocity[2]*weight2),body.angularVelocity.set(message1.angularVelocity[0]*weight1+message2.angularVelocity[0]*weight2,message1.angularVelocity[1]*weight1+message2.angularVelocity[1]*weight2,message1.angularVelocity[2]*weight1+message2.angularVelocity[2]*weight2),body.linearDamping=message2.linearDamping,body.angularDamping=message2.angularDamping,body.fixedRotation=message2.fixedRotation,body.allowSleep=message2.allowSleep,body.sleepSpeedLimit=message2.sleepSpeedLimit,body.sleepTimeLimit=message2.sleepTimeLimit,body.mass!==message2.mass&amp;&amp;(body.mass=message2.mass,body.updateMassProperties()),body},module.exports.deserializeBody=function(message){for(var shapeMsg,body=new CANNON.Body({mass:message.mass,position:deserializeVec3(message.position),quaternion:deserializeQuaternion(message.quaternion),velocity:deserializeVec3(message.velocity),angularVelocity:deserializeVec3(message.angularVelocity),linearDamping:message.linearDamping,angularDamping:message.angularDamping,fixedRotation:message.fixedRotation,allowSleep:message.allowSleep,sleepSpeedLimit:message.sleepSpeedLimit,sleepTimeLimit:message.sleepTimeLimit}),i=0;shapeMsg=message.shapes[i];i++)body.addShape(deserializeShape(shapeMsg),deserializeVec3(message.shapeOffsets[i]),deserializeQuaternion(message.shapeOrientations[i]));return body[ID]=message.id,body},module.exports.serializeShape=serializeShape,module.exports.deserializeShape=deserializeShape,module.exports.serializeConstraint=function(constraint){var message={id:constraint[ID],type:constraint.type,maxForce:constraint.maxForce,bodyA:constraint.bodyA[ID],bodyB:constraint.bodyB[ID]};switch(constraint.type){case&quot;LockConstraint&quot;:break;case&quot;DistanceConstraint&quot;:message.distance=constraint.distance;break;case&quot;HingeConstraint&quot;:case&quot;ConeTwistConstraint&quot;:message.axisA=serializeVec3(constraint.axisA),message.axisB=serializeVec3(constraint.axisB),message.pivotA=serializeVec3(constraint.pivotA),message.pivotB=serializeVec3(constraint.pivotB);break;case&quot;PointToPointConstraint&quot;:message.pivotA=serializeVec3(constraint.pivotA),message.pivotB=serializeVec3(constraint.pivotB);break;default:throw new Error(&quot;Unexpected constraint type: &quot;+constraint.type+&#39;. You may need to manually set `constraint.type = &quot;FooConstraint&quot;;`.&#39;)}return message},module.exports.deserializeConstraint=function(message,bodies){var constraint,TypedConstraint=CANNON[message.type],bodyA=bodies[message.bodyA],bodyB=bodies[message.bodyB];switch(message.type){case&quot;LockConstraint&quot;:constraint=new CANNON.LockConstraint(bodyA,bodyB,message);break;case&quot;DistanceConstraint&quot;:constraint=new CANNON.DistanceConstraint(bodyA,bodyB,message.distance,message.maxForce);break;case&quot;HingeConstraint&quot;:case&quot;ConeTwistConstraint&quot;:constraint=new TypedConstraint(bodyA,bodyB,{pivotA:deserializeVec3(message.pivotA),pivotB:deserializeVec3(message.pivotB),axisA:deserializeVec3(message.axisA),axisB:deserializeVec3(message.axisB),maxForce:message.maxForce});break;case&quot;PointToPointConstraint&quot;:constraint=new CANNON.PointToPointConstraint(bodyA,deserializeVec3(message.pivotA),bodyB,deserializeVec3(message.pivotB),message.maxForce);break;default:throw new Error(&quot;Unexpected constraint type: &quot;+message.type)}return constraint[ID]=message.id,constraint},module.exports.serializeContact=function(contact){return{bi:contact.bi[ID],bj:contact.bj[ID],ni:serializeVec3(contact.ni),ri:serializeVec3(contact.ri),rj:serializeVec3(contact.rj)}},module.exports.deserializeContact=function(message,bodies){return{bi:bodies[message.bi],bj:bodies[message.bj],ni:deserializeVec3(message.ni),ri:deserializeVec3(message.ri),rj:deserializeVec3(message.rj)}},module.exports.serializeVec3=serializeVec3,module.exports.deserializeVec3=deserializeVec3,module.exports.serializeQuaternion=serializeQuaternion,module.exports.deserializeQuaternion=deserializeQuaternion},{&quot;./math&quot;:29,&quot;cannon-es&quot;:4}]},{},[1]);</td>
      </tr>
</table>

  <details class="details-reset details-overlay BlobToolbar position-absolute js-file-line-actions dropdown d-none" aria-hidden="true">
    <summary class="btn-octicon ml-0 px-2 p-0 bg-white border border-gray-dark rounded-1" aria-label="Inline file action toolbar">
      <svg class="octicon octicon-kebab-horizontal" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M8 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zM1.5 9a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm13 0a1.5 1.5 0 100-3 1.5 1.5 0 000 3z"></path></svg>
    </summary>
    <details-menu>
      <ul class="BlobToolbar-dropdown dropdown-menu dropdown-menu-se mt-2" style="width:185px">
        <li>
          <clipboard-copy role="menuitem" class="dropdown-item" id="js-copy-lines" style="cursor:pointer;">
            Copy lines
          </clipboard-copy>
        </li>
        <li>
          <clipboard-copy role="menuitem" class="dropdown-item" id="js-copy-permalink" style="cursor:pointer;">
            Copy permalink
          </clipboard-copy>
        </li>
        <li><a class="dropdown-item js-update-url-with-hash" id="js-view-git-blame" role="menuitem" href="/powersimple/aframe-physics-system/blame/477aeafc668db7e46fe1fdc8d0f451c66cf4613b/dist/aframe-physics-system.min.js">View git blame</a></li>
      </ul>
    </details-menu>
  </details>

  </div>

    </div>

  


  <details class="details-reset details-overlay details-overlay-dark" id="jumpto-line-details-dialog">
    <summary data-hotkey="l" aria-label="Jump to line"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast linejump" aria-label="Jump to line">
      <!-- '"` --><!-- </textarea></xmp> --></option></form><form class="js-jump-to-line-form Box-body d-flex" action="" accept-charset="UTF-8" method="get">
        <input class="form-control flex-auto mr-3 linejump-input js-jump-to-line-field" type="text" placeholder="Jump to line&hellip;" aria-label="Jump to line" autofocus>
        <button type="submit" class="btn" data-close-dialog>Go</button>
</form>    </details-dialog>
  </details>

    <div class="Popover anim-scale-in js-tagsearch-popover"
     hidden
     data-tagsearch-url="/powersimple/aframe-physics-system/find-definition"
     data-tagsearch-ref="master"
     data-tagsearch-path="dist/aframe-physics-system.min.js"
     data-tagsearch-lang="JavaScript"
     data-hydro-click="{&quot;event_type&quot;:&quot;code_navigation.click_on_symbol&quot;,&quot;payload&quot;:{&quot;action&quot;:&quot;click_on_symbol&quot;,&quot;repository_id&quot;:287959869,&quot;ref&quot;:&quot;master&quot;,&quot;language&quot;:&quot;JavaScript&quot;,&quot;originating_url&quot;:&quot;https://github.com/powersimple/aframe-physics-system/blob/master/dist/aframe-physics-system.min.js&quot;,&quot;user_id&quot;:32787544}}"
     data-hydro-click-hmac="00a2e38c41e65efff01fa408df0d1200c87b6df3ab393d7817cad1aab9003b04">
  <div class="Popover-message Popover-message--large Popover-message--top-left TagsearchPopover mt-1 mb-4 mx-auto Box box-shadow-large">
    <div class="TagsearchPopover-content js-tagsearch-popover-content overflow-auto" style="will-change:transform;">
    </div>
  </div>
</div>




  </div>
</div>

    </main>
  </div>
  

  </div>

        
<div class="footer container-xl width-full p-responsive" role="contentinfo">
  <div class="position-relative d-flex flex-row-reverse flex-lg-row flex-wrap flex-lg-nowrap flex-justify-center flex-lg-justify-between pt-6 pb-2 mt-6 f6 text-gray border-top border-gray-light ">
    <ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
      <li class="mr-3 mr-lg-0">&copy; 2020 GitHub, Inc.</li>
        <li class="mr-3 mr-lg-0"><a data-ga-click="Footer, go to terms, text:terms" href="https://github.com/site/terms">Terms</a></li>
        <li class="mr-3 mr-lg-0"><a data-ga-click="Footer, go to privacy, text:privacy" href="https://github.com/site/privacy">Privacy</a></li>
        <li class="mr-3 mr-lg-0"><a data-ga-click="Footer, go to security, text:security" href="https://github.com/security">Security</a></li>
        <li class="mr-3 mr-lg-0"><a href="https://githubstatus.com/" data-ga-click="Footer, go to status, text:status">Status</a></li>
        <li><a data-ga-click="Footer, go to help, text:help" href="https://docs.github.com">Help</a></li>

    </ul>

    <a aria-label="Homepage" title="GitHub" class="footer-octicon d-none d-lg-block mx-lg-4" href="https://github.com">
      <svg height="24" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="24" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg>
</a>
   <ul class="list-style-none d-flex flex-wrap col-12 col-lg-5 flex-justify-center flex-lg-justify-between mb-2 mb-lg-0">
        <li class="mr-3 mr-lg-0"><a data-ga-click="Footer, go to contact, text:contact" href="https://github.com/contact">Contact GitHub</a></li>
        <li class="mr-3 mr-lg-0"><a href="https://github.com/pricing" data-ga-click="Footer, go to Pricing, text:Pricing">Pricing</a></li>
      <li class="mr-3 mr-lg-0"><a href="https://docs.github.com" data-ga-click="Footer, go to api, text:api">API</a></li>
      <li class="mr-3 mr-lg-0"><a href="https://training.github.com" data-ga-click="Footer, go to training, text:training">Training</a></li>
        <li class="mr-3 mr-lg-0"><a href="https://github.blog" data-ga-click="Footer, go to blog, text:blog">Blog</a></li>
        <li><a data-ga-click="Footer, go to about, text:about" href="https://github.com/about">About</a></li>
    </ul>
  </div>
  <div class="d-flex flex-justify-center pb-6">
    <span class="f6 text-gray-light"></span>
  </div>
</div>



  <div id="ajax-error-message" class="ajax-error-message flash flash-error">
    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path></svg>
    <button type="button" class="flash-close js-ajax-error-dismiss" aria-label="Dismiss error">
      <svg class="octicon octicon-x" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>
    </button>
    You can‚Äôt perform that action at this time.
  </div>


    <script crossorigin="anonymous" async="async" integrity="sha512-bn/3rKJzBl2H64K38R8KaVcT26vKK7BJQC59lwYc+9fjlHzmy0fwh+hzBtsgTdhIi13dxjzNKWhdSN8WTM9qUw==" type="application/javascript" id="js-conditional-compat" data-src="https://github.githubassets.com/assets/compat-bootstrap-6e7ff7ac.js"></script>
    <script crossorigin="anonymous" integrity="sha512-CxjaMepCmi+z0LTeztU2S8qGD25LyHD6j9t0RSPevy63trFWJVwUM6ipAVLgtpMBBgZ53wq8JPkSeQ6ruaZL2w==" type="application/javascript" src="https://github.githubassets.com/assets/environment-bootstrap-0b18da31.js"></script>
    <script crossorigin="anonymous" async="async" integrity="sha512-4KeMyOMjaU4gLw23VDvhs6FX3eHEEZ5C+dUYw6J6EMnWNoQE60QdPftkds5mG/cL5M5hOYcPjg7rDJgDCbbUuA==" type="application/javascript" src="https://github.githubassets.com/assets/vendor-e0a78cc8.js"></script>
    <script crossorigin="anonymous" async="async" integrity="sha512-tfUHds7XEtr1RxjlJ8V2RPynxBvp6KPiAsMcI7HsRiobQH0r3SZ4/BKNujrr+8aTOzWpUzeFR/cqh08xEsJWrg==" type="application/javascript" src="https://github.githubassets.com/assets/frameworks-b5f50776.js"></script>
    
    <script crossorigin="anonymous" async="async" integrity="sha512-GZdeExfdh0Rl9COLEptIopcXS658FXUJkAro1MIsyr0iCcqYsjYuFBfhYAX8UKfkSQKAuWuK74vucv4TzwvtDg==" type="application/javascript" src="https://github.githubassets.com/assets/behaviors-bootstrap-19975e13.js"></script>
    
      <script crossorigin="anonymous" async="async" integrity="sha512-TjmDUfspgN28WRWfc01tOL0BFS8pI/TAi8TQ665TcA3jG1C3QgfFu0YKa32Z03rlEL8dukbsy+amwBzgGyjESQ==" type="application/javascript" data-module-id="./Sortable.js" data-src="https://github.githubassets.com/assets/Sortable-4e398351.js"></script>
      <script crossorigin="anonymous" async="async" integrity="sha512-8hScl0DkWwAjCqAQA50kQOn2QTYfPcKEyJjkKYtjGB88r9GB/6kmBBsneJPgwhW3yewwt64ABgsQGpQSLX8zpg==" type="application/javascript" data-module-id="./contributions-spider-graph.js" data-src="https://github.githubassets.com/assets/contributions-spider-graph-f2149c97.js"></script>
      <script crossorigin="anonymous" async="async" integrity="sha512-QOViDUFlNJwNDkBXlntZ4AUm/OFx3TuM7jg4Z1tb3E7dnf3V5p3Oh3E8cwRdjDMDBp4LyOdoBFIhur0biAIdlw==" type="application/javascript" data-module-id="./drag-drop.js" data-src="https://github.githubassets.com/assets/drag-drop-40e5620d.js"></script>
      <script crossorigin="anonymous" async="async" integrity="sha512-iLuC2weaJqL9mYAud2WDWjhd8cJe8dXVxw2KhCH2Rnj6WJvTzlZRmvTtL09wNWX6nRze/TDaQ7gq7BFLchaDYg==" type="application/javascript" data-module-id="./image-crop-element-loader.js" data-src="https://github.githubassets.com/assets/image-crop-element-loader-88bb82db.js"></script>
      <script crossorigin="anonymous" async="async" integrity="sha512-C5x+stvxtmEBcNL91ztKn1VHWPvnzIkl2axVur33464YrY+en7MaqyJHiZ1V4iuV/hwcjMAWnJyyqg0ZY9WioQ==" type="application/javascript" data-module-id="./jump-to.js" data-src="https://github.githubassets.com/assets/jump-to-0b9c7eb2.js"></script>
      <script crossorigin="anonymous" async="async" integrity="sha512-/qu1ZgsxqvzkIPvkOxFe7ioHOms48uHPkflrrH6SHCQ/XNfAydkj2fS7w9yCZR3DDFja9941EMR1+fy4NVBm7g==" type="application/javascript" data-module-id="./profile-pins-element.js" data-src="https://github.githubassets.com/assets/profile-pins-element-feabb566.js"></script>
      <script crossorigin="anonymous" async="async" integrity="sha512-qECv/jhsvLFN77eGNu0cjMR2+zvAlLyhQVTnmayJc5OLZoxMLjQZxZW1hK/dhcYro6Wec/aiF21HYf2N5OilYQ==" type="application/javascript" data-module-id="./randomColor.js" data-src="https://github.githubassets.com/assets/randomColor-a840affe.js"></script>
      <script crossorigin="anonymous" async="async" integrity="sha512-YCODMOpm6dIHRZy9o7UJlwcXMjGIZZzzdwq2JZU6R2VIXZMHJHq/j5KmCFTf+wD+swamrXmse1TPjkdZo4e2RQ==" type="application/javascript" data-module-id="./tweetsodium.js" data-src="https://github.githubassets.com/assets/tweetsodium-60238330.js"></script>
      <script crossorigin="anonymous" async="async" integrity="sha512-82UbY8UGehLCOGUidGJpNHS0lljnI06yNTaUWWUrDn7dR0ScU2E0Fy7OhU664tasUCepPNZD7fuPHO/F4/NqWg==" type="application/javascript" data-module-id="./user-status-submit.js" data-src="https://github.githubassets.com/assets/user-status-submit-f3651b63.js"></script>
    
    <script crossorigin="anonymous" async="async" integrity="sha512-65Dyh6Rx9iAVNbWXLj7DFmsARkC9xOmgvNQi+9srP2fQbqJIO65D4u91ne5Yr+V/332jpgn54yTgrlIrGv8kYg==" type="application/javascript" src="https://github.githubassets.com/assets/github-bootstrap-eb90f287.js"></script>
  <div class="js-stale-session-flash flash flash-warn flash-banner" hidden
    >
    <svg class="octicon octicon-alert" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"></path></svg>
    <span class="js-stale-session-flash-signed-in" hidden>You signed in with another tab or window. <a href="">Reload</a> to refresh your session.</span>
    <span class="js-stale-session-flash-signed-out" hidden>You signed out in another tab or window. <a href="">Reload</a> to refresh your session.</span>
  </div>
  <template id="site-details-dialog">
  <details class="details-reset details-overlay details-overlay-dark lh-default text-gray-dark hx_rsm" open>
    <summary role="button" aria-label="Close dialog"></summary>
    <details-dialog class="Box Box--overlay d-flex flex-column anim-fade-in fast hx_rsm-dialog hx_rsm-modal">
      <button class="Box-btn-octicon m-0 btn-octicon position-absolute right-0 top-0" type="button" aria-label="Close dialog" data-close-dialog>
        <svg class="octicon octicon-x" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"></path></svg>
      </button>
      <div class="octocat-spinner my-6 js-details-dialog-spinner"></div>
    </details-dialog>
  </details>
</template>

  <div class="Popover js-hovercard-content position-absolute" style="display: none; outline: none;" tabindex="0">
  <div class="Popover-message Popover-message--bottom-left Popover-message--large Box box-shadow-large" style="width:360px;">
  </div>
</div>


  </body>
</html>

